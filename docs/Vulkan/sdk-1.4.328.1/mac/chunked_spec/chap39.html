<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="author" content="The Khronos® Vulkan  Working Group">
<title>Vulkan® 1.4.328 - A Specification (with all registered extensions)</title>
<link rel="stylesheet" href="style0.css" type="text/css">
<link rel="stylesheet" href="style1.css" type="text/css">
<link rel="stylesheet" href="style2.css" type="text/css">

<!-- dragged in by font-awesome css included by asciidoctor, but preloaded in this extension for convenience -->
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/fonts/fontawesome-webfont.woff2?v=4.7.0" as="font" type="font/woff2" crossorigin="">

<!-- Note: Chrome needs crossorigin="" even for same-origin fonts -->
<link rel="preload" href="../katex/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../katex/fonts/KaTeX_Main-Italic.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../katex/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../katex/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../katex/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../katex/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../katex/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../katex/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="">
<link rel="preload" href="../katex/fonts/KaTeX_Typewriter-Regular.woff2" as="font" type="font/woff2" crossorigin=""><link rel="stylesheet" href="../katex/katex.min.css">
<!--ChunkedSearchJSMarker-->
<link href="chunked.css?4" rel="stylesheet">
<script>var searchindexurl = 'search.index.js?4' + (document.title.replace(/[^0-9.]/g, ''));</script>
<script src="chunked.js?4"></script>
<link rel="stylesheet" href="style3.css" type="text/css">
<script>
    function hideElement(e){
        e.setAttribute("hidden", "");
        e.classList.add("hidden");
    }

    function unhideElement(e){
        e.classList.remove("hidden");
        e.removeAttribute("hidden");
    }

    function hideLoadableContent(){
        unhideElement( document.getElementById("loading_msg") );
        for( var loadable of document.getElementsByClassName("loadable") ) hideElement(loadable);
    }

    function unhideLoadableContent(){
        hideElement( document.getElementById("loading_msg") );
        for( var loadable of document.getElementsByClassName("loadable") ) unhideElement(loadable);
    }

    window.addEventListener("load", unhideLoadableContent);
</script>
<link rel="stylesheet" href="asciidoctor-chunker.css" type="text/css"></head>
<body class="book toc2 toc-left">
<div style="text-align: center;">
    <span class="image"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgdmlld0JveD0iMCAwIDExNTAgMzI2IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MS40MTQyMTsiPgogICAgPGcgaWQ9IkFydGJvYXJkMSIgdHJhbnNmb3JtPSJtYXRyaXgoMC45NTUxNSwwLDAsMC44ODgyODMsLTQwLjExNjMsLTMwLjIwMTYpIj4KICAgICAgICA8cmVjdCB4PSI0MiIgeT0iMzQiIHdpZHRoPSIxMjA0IiBoZWlnaHQ9IjM2NyIgc3R5bGU9ImZpbGw6bm9uZTsiLz4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgxLjA0Njk2LDAsMCwxLjEyNTc3LC00Ni45OTEzLC01MC40MzI1KSI+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik03MjQuMSwzODUuMDZMNjgzLjUzLDM4NS4wNkM2ODMuNTMsMzg1LjA2IDY4My41MywyODYuMDkgNjgzLjUzLDI1NS40QzY5Ni40OSwyNjIuNjIgNzEzLjYyLDI3NS45NCA3MjQuMSwyODguNzJMNzI0LjEsMzg1LjA2WiIgc3R5bGU9ImZpbGw6cmdiKDE3MiwyMiw0NCk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgIDxnPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTM4MS43NSwzODUuMDZMMzMxLjE3LDM4NS4wNkwyNjUuMTYsMTgxLjAzTDMxMS4xNywxODEuMDNMMzU2LjYxLDMyNC40OEwzNTcuMTgsMzI0LjQ4TDQwMy4xOCwxODEuMDNMNDQ5LjQ3LDE4MS4wM0wzODEuNzUsMzg1LjA2WiIgc3R5bGU9ImZpbGw6cmdiKDE3MiwyMiw0NCk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNTg1LjUxLDM4NS4wNkw1NDYuOTMsMzg1LjA2TDU0Ni45MywzNjQuNDlMNTQ2LjA4LDM2NC40OUM1NDAuOTMsMzczLjA3IDUzNC4yNywzNzkuMjYgNTI2LjA3LDM4My4wN0M1MTcuODgsMzg2Ljg4IDUwOS41LDM4OC43OCA1MDAuOTIsMzg4Ljc4QzQ5MC4wNiwzODguNzggNDgxLjE2LDM4Ny4zNSA0NzQuMiwzODQuNUM0NjcuMjUsMzgxLjY1IDQ2MS43NywzNzcuNTkgNDU3Ljc3LDM3Mi4zNkM0NTMuNzYsMzY3LjEyIDQ1MC45NSwzNjAuNzQgNDQ5LjMzLDM1My4yMUM0NDcuNzIsMzQ1LjY5IDQ0Ni45MSwzMzcuMzUgNDQ2LjkxLDMyOC4yMUw0NDYuOTEsMjM3LjMzTDQ4Ny40OSwyMzcuMzNMNDg3LjQ5LDMyMC43N0M0ODcuNDksMzMyLjk2IDQ4OS40LDM0Mi4wNiA0OTMuMjEsMzQ4LjA2QzQ5Ny4wMiwzNTQuMDcgNTAzLjc4LDM1Ny4wNiA1MTMuNSwzNTcuMDZDNTI0LjU1LDM1Ny4wNiA1MzIuNTUsMzUzLjc4IDUzNy41LDM0Ny4yQzU0Mi40NiwzNDAuNjIgNTQ0LjkzLDMyOS44MSA1NDQuOTMsMzE0Ljc2TDU0NC45MywyMzcuMzJMNTg1LjUyLDIzNy4zMkw1ODUuNTIsMzg1LjA2TDU4NS41MSwzODUuMDZaIiBzdHlsZT0iZmlsbDpyZ2IoMTcyLDIyLDQ0KTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8cGF0aCBkPSJNNzMwLjg0LDI5Ni4xOUw3MzAuNzQsMjkwLjQ3TDc4MS44OSwyMzcuMzNMODI5LjkxLDIzNy4zM0w3NzQuMTgsMjkxLjYyTDgzNi4xOSwzODUuMDZMNzg3LjA0LDM4NS4wNkw3MzAuODQsMjk2LjE5WiIgc3R5bGU9ImZpbGw6cmdiKDE3MiwyMiw0NCk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik04NDMuNjIsMjgyLjc2Qzg0NC4xOSwyNzMuMjQgODQ2LjU4LDI2NS4zMyA4NTAuNzcsMjU5LjA0Qzg1NC45NiwyNTIuNzUgODYwLjI5LDI0Ny43MSA4NjYuNzcsMjQzLjlDODczLjI1LDI0MC4wOSA4ODAuNTQsMjM3LjM3IDg4OC42NCwyMzUuNzZDODk2LjczLDIzNC4xNCA5MDQuODgsMjMzLjMzIDkxMy4wNywyMzMuMzNDOTIwLjUsMjMzLjMzIDkyOC4wMiwyMzMuODUgOTM1LjY0LDIzNC45Qzk0My4yNywyMzUuOTUgOTUwLjIxLDIzOCA5NTYuNSwyNDEuMDVDOTYyLjc4LDI0NC4xIDk2Ny45MywyNDguMzQgOTcxLjk0LDI1My43NkM5NzUuOTQsMjU5LjE5IDk3Ny45NCwyNjYuMzggOTc3Ljk0LDI3NS4zNEw5NzcuOTQsMzUyLjIxQzk3Ny45NCwzNTguODggOTc4LjMyLDM2NS4yNyA5NzkuMDgsMzcxLjM2Qzk3OS44NCwzNzcuNDYgOTgxLjE4LDM4Mi4wMyA5ODMuMDksMzg1LjA4TDk0MS45NCwzODUuMDhDOTQxLjE4LDM4Mi44IDk0MC41NiwzODAuNDYgOTQwLjA4LDM3OC4wOEM5MzkuNjEsMzc1LjcgOTM5LjI3LDM3My4yOCA5MzkuMDgsMzcwLjc5QzkzMi42LDM3Ny40NyA5MjQuOTcsMzgyLjEzIDkxNi4yMSwzODQuOEM5MDcuNDUsMzg3LjQ2IDg5OC40OSwzODguOCA4ODkuMzUsMzg4LjhDODgyLjMsMzg4LjggODc1LjcyLDM4Ny45NCA4NjkuNjQsMzg2LjIzQzg2My41NCwzODQuNTIgODU4LjIsMzgxLjg1IDg1My42NCwzNzguMjNDODQ5LjA2LDM3NC42MSA4NDUuNDgsMzcwLjA0IDg0Mi45MiwzNjQuNTFDODQwLjM1LDM1OC45OSA4MzkuMDYsMzUyLjQyIDgzOS4wNiwzNDQuOEM4MzkuMDYsMzM2LjQyIDg0MC41NCwzMjkuNTEgODQzLjQ5LDMyNC4wOEM4NDYuNDUsMzE4LjY1IDg1MC4yNSwzMTQuMzIgODU0LjkzLDMxMS4wOEM4NTkuNiwzMDcuODQgODY0LjkzLDMwNS40MSA4NzAuOTMsMzAzLjc5Qzg3Ni45MywzMDIuMTcgODgyLjk4LDMwMC44OCA4ODkuMDcsMjk5LjkzQzg5NS4xNywyOTguOTkgOTAxLjE3LDI5OC4yMiA5MDcuMDgsMjk3LjY1QzkxMi45OSwyOTcuMDggOTE4LjIyLDI5Ni4yMiA5MjIuNzksMjk1LjA4QzkyNy4zNywyOTMuOTMgOTMwLjk4LDI5Mi4yNyA5MzMuNjUsMjkwLjA3QzkzNi4zMiwyODcuODggOTM3LjU2LDI4NC42OSA5MzcuMzcsMjgwLjVDOTM3LjM3LDI3Ni4xMiA5MzYuNjUsMjcyLjY0IDkzNS4yMiwyNzAuMDdDOTMzLjc5LDI2Ny41IDkzMS44OSwyNjUuNSA5MjkuNTEsMjY0LjA3QzkyNy4xMywyNjIuNjQgOTI0LjM3LDI2MS42OSA5MjEuMjIsMjYxLjIxQzkxOC4wNywyNjAuNzMgOTE0LjcsMjYwLjQ5IDkxMS4wOCwyNjAuNDlDOTAzLjA4LDI2MC40OSA4OTYuNzksMjYyLjIgODkyLjIyLDI2NS42NEM4ODcuNjUsMjY5LjA3IDg4NC45OCwyNzQuNzggODg0LjIyLDI4Mi43OUw4NDMuNjIsMjgyLjc5TDg0My42MiwyODIuNzZaTTkzNy4zNSwzMTIuNzdDOTM1LjYzLDMxNC4zIDkzMy40OSwzMTUuNDggOTMwLjkyLDMxNi4zNEM5MjguMzUsMzE3LjIxIDkyNS41OSwzMTcuOTIgOTIyLjYzLDMxOC40OUM5MTkuNjgsMzE5LjA2IDkxNi41OCwzMTkuNTQgOTEzLjM1LDMxOS45MkM5MTAuMTEsMzIwLjMgOTA2Ljg3LDMyMC43NyA5MDMuNjMsMzIxLjM1QzkwMC41OCwzMjEuOTIgODk3LjU4LDMyMi42OSA4OTQuNjMsMzIzLjYzQzg5MS42OCwzMjQuNTkgODg5LjEsMzI1Ljg3IDg4Ni45MSwzMjcuNDlDODg0LjcyLDMyOS4xMSA4ODIuOTYsMzMxLjE2IDg4MS42MiwzMzMuNjNDODgwLjI5LDMzNi4xMSA4NzkuNjIsMzM5LjI1IDg3OS42MiwzNDMuMDZDODc5LjYyLDM0Ni42OCA4ODAuMjksMzQ5LjczIDg4MS42MiwzNTIuMkM4ODIuOTYsMzU0LjY4IDg4NC43NywzNTYuNjMgODg3LjA1LDM1OC4wNkM4ODkuMzQsMzU5LjQ5IDg5MiwzNjAuNDkgODk1LjA1LDM2MS4wNkM4OTguMSwzNjEuNjMgOTAxLjI0LDM2MS45MSA5MDQuNDgsMzYxLjkxQzkxMi40OCwzNjEuOTEgOTE4LjY4LDM2MC41OCA5MjMuMDYsMzU3LjkyQzkyNy40NCwzNTUuMjUgOTMwLjY5LDM1Mi4wNiA5MzIuNzcsMzQ4LjM0QzkzNC44NiwzNDQuNjMgOTM2LjE2LDM0MC44NyA5MzYuNjIsMzM3LjA2QzkzNy4xLDMzMy4yNSA5MzcuMzMsMzMwLjIgOTM3LjM0LDMyNy45Mkw5MzcuMzQsMzEyLjc3TDkzNy4zNSwzMTIuNzdaIiBzdHlsZT0iZmlsbDpyZ2IoMTcyLDIyLDQ0KTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICAgICAgPHBhdGggZD0iTTEwMDQuMjEsMjM3LjMzTDEwNDIuOCwyMzcuMzNMMTA0Mi44LDI1Ny45TDEwNDMuNjUsMjU3LjlDMTA0OC43OSwyNDkuMzMgMTA1NS40NiwyNDMuMDkgMTA2My42NSwyMzkuMTlDMTA3MS44NCwyMzUuMjggMTA4MC4yMywyMzMuMzMgMTA4OC43OSwyMzMuMzNDMTA5OS42NiwyMzMuMzMgMTEwOC41NiwyMzQuODEgMTExNS41MiwyMzcuNzZDMTEyMi40NywyNDAuNzIgMTEyNy45NCwyNDQuODEgMTEzMS45NSwyNTAuMDVDMTEzNS45NSwyNTUuMjkgMTEzOC43NiwyNjEuNjcgMTE0MC4zOCwyNjkuMTlDMTE0MiwyNzYuNzIgMTE0Mi44MSwyODUuMDUgMTE0Mi44MSwyOTQuMkwxMTQyLjgxLDM4NS4wN0wxMTAyLjI0LDM4NS4wN0wxMTAyLjI0LDMwMS42M0MxMTAyLjI0LDI4OS40MyAxMTAwLjMzLDI4MC4zNCAxMDk2LjUzLDI3NC4zNEMxMDkyLjcxLDI2OC4zNCAxMDg1Ljk1LDI2NS4zNCAxMDc2LjIzLDI2NS4zNEMxMDY1LjE4LDI2NS4zNCAxMDU3LjE5LDI2OC42MyAxMDUyLjIzLDI3NS4yQzEwNDcuMjcsMjgxLjc2IDEwNDQuOCwyOTIuNTggMTA0NC44LDMwNy42M0wxMDQ0LjgsMzg1LjA3TDEwMDQuMjIsMzg1LjA3TDEwMDQuMjIsMjM3LjMzTDEwMDQuMjEsMjM3LjMzWiIgc3R5bGU9ImZpbGw6cmdiKDE3MiwyMiw0NCk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik02MTIuMzcsMjExLjg0TDYxMi4zNywzODUuMDdMNjUyLjk1LDM4NS4wN0w2NTIuOTUsMjM0LjIxQzYzOS45MywyMjYuMjMgNjI2LjM2LDIxOC43NCA2MTIuMzcsMjExLjg0WiIgc3R5bGU9ImZpbGw6cmdiKDE3MiwyMiw0NCk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xOTguNDMsMjE5LjIxQzIyMS45NSwxNTAuMzIgMzYyLjU4LDEyNS4wNSA1MTIuNTgsMTYyLjc4QzYwMi41NSwxODUuNCA2NzYuMDcsMjI5LjI4IDcyNC4wOSwyNzIuNjdDNzAyLjMsMjE1LjEyIDU5Ni42NSwxMzMuMDggNDUxLjE4LDEwNC45NkMyODYuNyw3My4xNiAxMjQuNDcsMTAxLjExIDEwNC4zOSwxNzQuMUM4OS44OSwyMjYuODMgMTUzLjU3LDI4OC42IDI1Mi4wNSwzMzAuODRDMjA3LjgxLDI5NS4wMiAxODYuMjksMjU0Ljc4IDE5OC40MywyMTkuMjFaIiBzdHlsZT0iZmlsbDpyZ2IoMTcyLDIyLDQ0KTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICAgICAgPHBhdGggZD0iTTcyNC4xNiwyNDcuNjJMNzI0LjE2LDE4MS4wM0w2ODMuNTcsMTgxLjAzTDY4My41NywyMDEuMjVDNzAwLjg4LDIxNi43MSA3MTQuNjEsMjMyLjQ1IDcyNC4xNiwyNDcuNjJaIiBzdHlsZT0iZmlsbDpyZ2IoMTcyLDIyLDQ0KTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICA8L2c+CiAgICAgICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoMS4wNDY5NiwwLDAsMS4xMjU3NywtNDYuOTkxMywtNTAuNDMyNSkiPgogICAgICAgICAgICA8cGF0aCBkPSJNMTIxNC45OCwzNjMuNDNDMTIxNC45OCwzNzUuNjkgMTIwNS4zNSwzODUuMzIgMTE5Mi44MywzODUuMzJDMTE4MC40MywzODUuMzIgMTE3MC41NCwzNzUuNjkgMTE3MC41NCwzNjMuNDNDMTE3MC41NCwzNTEuNDMgMTE4MC40MywzNDEuOCAxMTkyLjgzLDM0MS44QzEyMDUuMzUsMzQxLjggMTIxNC45OCwzNTEuNDMgMTIxNC45OCwzNjMuNDNaTTExNzYuMDgsMzYzLjQzQzExNzYuMDgsMzczLjA2IDExODMuMiwzODAuNyAxMTkyLjk2LDM4MC43QzEyMDIuNDUsMzgwLjcgMTIwOS40NCwzNzMuMDUgMTIwOS40NCwzNjMuNTZDMTIwOS40NCwzNTMuOTMgMTIwMi40NSwzNDYuMTUgMTE5Mi44MiwzNDYuMTVDMTE4My4yLDM0Ni4xNiAxMTc2LjA4LDM1My45NCAxMTc2LjA4LDM2My40M1pNMTE4OS4zOSwzNzQuNzdMMTE4NC4zOCwzNzQuNzdMMTE4NC4zOCwzNTMuMTRDMTE4Ni4zNiwzNTIuNzQgMTE4OS4xMywzNTIuNDggMTE5Mi42OSwzNTIuNDhDMTE5Ni43OCwzNTIuNDggMTE5OC42MiwzNTMuMTQgMTIwMC4yMSwzNTQuMDZDMTIwMS40LDM1NC45OCAxMjAyLjMyLDM1Ni43IDEyMDIuMzIsMzU4LjgxQzEyMDIuMzIsMzYxLjE4IDEyMDAuNDcsMzYzLjAzIDExOTcuODQsMzYzLjgyTDExOTcuODQsMzY0LjA4QzExOTkuOTUsMzY0Ljg3IDEyMDEuMTQsMzY2LjQ1IDEyMDEuOCwzNjkuMzVDMTIwMi40NiwzNzIuNjUgMTIwMi44NSwzNzMuOTcgMTIwMy4zOCwzNzQuNzZMMTE5Ny45NywzNzQuNzZDMTE5Ny4zMSwzNzMuOTcgMTE5Ni45MiwzNzEuOTkgMTE5Ni4yNiwzNjkuNDlDMTE5NS44NiwzNjcuMTIgMTE5NC41NSwzNjYuMDYgMTE5MS43OCwzNjYuMDZMMTE4OS40MSwzNjYuMDZMMTE4OS40MSwzNzQuNzdMMTE4OS4zOSwzNzQuNzdaTTExODkuNTMsMzYyLjUxTDExOTEuOSwzNjIuNTFDMTE5NC42NywzNjIuNTEgMTE5Ni45MSwzNjEuNTkgMTE5Ni45MSwzNTkuMzRDMTE5Ni45MSwzNTcuMzYgMTE5NS40NiwzNTYuMDQgMTE5Mi4yOSwzNTYuMDRDMTE5MC45NywzNTYuMDQgMTE5MC4wNSwzNTYuMTcgMTE4OS41MiwzNTYuM0wxMTg5LjUyLDM2Mi41MUwxMTg5LjUzLDM2Mi41MVoiIHN0eWxlPSJmaWxsOnJnYigxNzIsMjIsNDQpO2ZpbGwtcnVsZTpub256ZXJvOyIvPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+Cg==" alt="Vulkan Logo" width="50%">
    </span>
</div>
<div id="header">
<h1>Vulkan<sup>®</sup> 1.4.328 - A Specification (with all registered extensions)</h1>
<div class="details">
<span id="author" class="author">The Khronos<sup>®</sup> Vulkan  Working Group</span><br>
<span id="revnumber">version 1.4.328,</span>
<span id="revdate">2025-10-08 21:55:58Z</span>
<br><span id="revremark">from git branch: Git branch not available commit: Git commit not available</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="index.html">Titlepage</a></li><li><a href="chap1.html">1. Preamble</a></li>
<li><a href="chap2.html">2. Introduction</a>
<ul class="sectlevel2">
<li><a href="chap2.html#introduction-conventions">2.1. Document Conventions</a></li>
</ul>
</li>
<li><a href="chap3.html">3. Fundamentals</a>
<ul class="sectlevel2">
<li><a href="chap3.html#fundamentals-host-environment">3.1. Host and Device Environment</a></li>
<li><a href="chap3.html#fundamentals-execmodel">3.2. Execution Model</a></li>
<li><a href="chap3.html#fundamentals-objectmodel-overview">3.3. Object Model</a></li>
<li><a href="chap3.html#fundamentals-abi">3.4. Application Binary Interface</a></li>
<li><a href="chap3.html#fundamentals-commandsyntax">3.5. Command Syntax and Duration</a></li>
<li><a href="chap3.html#fundamentals-threadingbehavior">3.6. Threading Behavior</a></li>
<li><a href="chap3.html#fundamentals-validusage">3.7. Valid Usage</a></li>
<li><a href="chap3.html#fundamentals-returncodes">3.8. <code>VkResult</code> Return Codes</a></li>
<li><a href="chap3.html#fundamentals-numerics">3.9. Numeric Representation and Computation</a></li>
<li><a href="chap3.html#fundamentals-fixedconv">3.10. Fixed-Point Data Conversions</a></li>
<li><a href="chap3.html#fundamentals-strings">3.11. String Representation</a></li>
<li><a href="chap3.html#fundamentals-common-objects">3.12. Common Object Types</a></li>
<li><a href="chap3.html#fundamentals-api-name-aliases">3.13. API Name Aliases</a></li>
</ul>
</li>
<li><a href="chap4.html">4. Initialization</a>
<ul class="sectlevel2">
<li><a href="chap4.html#initialization-functionpointers">4.1. Command Function Pointers</a></li>
<li><a href="chap4.html#initialization-instances">4.2. Instances</a></li>
</ul>
</li>
<li><a href="chap5.html">5. Devices and Queues</a>
<ul class="sectlevel2">
<li><a href="chap5.html#devsandqueues-physical-device-enumeration">5.1. Physical Devices</a></li>
<li><a href="chap5.html#devsandqueues-devices">5.2. Devices</a></li>
<li><a href="chap5.html#devsandqueues-queues">5.3. Queues</a></li>
</ul>
</li>
<li><a href="chap6.html">6. Command Buffers</a>
<ul class="sectlevel2">
<li><a href="chap6.html#commandbuffers-lifecycle">6.1. Command Buffer Lifecycle</a></li>
<li><a href="chap6.html#commandbuffers-pools">6.2. Command Pools</a></li>
<li><a href="chap6.html#commandbuffer-allocation">6.3. Command Buffer Allocation and Management</a></li>
<li><a href="chap6.html#commandbuffers-recording">6.4. Command Buffer Recording</a></li>
<li><a href="chap6.html#commandbuffers-submission">6.5. Command Buffer Submission</a></li>
<li><a href="chap6.html#commandbuffers-submission-progress">6.6. Queue Forward Progress</a></li>
<li><a href="chap6.html#commandbuffers-secondary">6.7. Secondary Command Buffer Execution</a></li>
<li><a href="chap6.html#commandbuffers-nested">6.8. Nested Command Buffers</a></li>
<li><a href="chap6.html#commandbuffers-devicemask">6.9. Command Buffer Device Mask</a></li>
</ul>
</li>
<li><a href="chap7.html">7. Synchronization and Cache Control</a>
<ul class="sectlevel2">
<li><a href="chap7.html#synchronization-dependencies">7.1. Execution and Memory Dependencies</a></li>
<li><a href="chap7.html#synchronization-implicit">7.2. Implicit Synchronization Guarantees</a></li>
<li><a href="chap7.html#synchronization-fences">7.3. Fences</a></li>
<li><a href="chap7.html#synchronization-semaphores">7.4. Semaphores</a></li>
<li><a href="chap7.html#synchronization-events">7.5. Events</a></li>
<li><a href="chap7.html#synchronization-pipeline-barriers">7.6. Pipeline Barriers</a></li>
<li><a href="chap7.html#synchronization-memory-barriers">7.7. Memory Barriers</a></li>
<li><a href="chap7.html#synchronization-wait-idle">7.8. Wait Idle Operations</a></li>
<li><a href="chap7.html#synchronization-submission-host-writes">7.9. Host Write Ordering Guarantees</a></li>
<li><a href="chap7.html#synchronization-device-group">7.10. Synchronization and Multiple Physical Devices</a></li>
<li><a href="chap7.html#calibrated-timestamps">7.11. Calibrated Timestamps</a></li>
</ul>
</li>
<li><a href="chap8.html">8. Render Pass</a>
<ul class="sectlevel2">
<li><a href="chap8.html#renderpass-objects">8.1. Render Pass Objects</a></li>
<li><a href="chap8.html#renderpass-creation">8.2. Render Pass Creation</a></li>
<li><a href="chap8.html#renderpass-compatibility">8.3. Render Pass Compatibility</a></li>
<li><a href="chap8.html#_framebuffers">8.4. Framebuffers</a></li>
<li><a href="chap8.html#renderpass-load-operations">8.5. Render Pass Load Operations</a></li>
<li><a href="chap8.html#renderpass-store-operations">8.6. Render Pass Store Operations</a></li>
<li><a href="chap8.html#renderpass-resolve-operations">8.7. Render Pass Multisample Resolve Operations</a></li>
<li><a href="chap8.html#renderpass-commands">8.8. Render Pass Commands</a></li>
<li><a href="chap8.html#renderpass-creation-feedback">8.9. Render Pass Creation Feedback</a></li>
<li><a href="chap8.html#common-render-pass-data-races">8.10. Common Render Pass Data Races (Informative)</a></li>
<li><a href="chap8.html#renderpass-tile-shading">8.11. Tile Shading Render Pass</a></li>
</ul>
</li>
<li><a href="chap9.html">9. Shaders</a>
<ul class="sectlevel2">
<li><a href="chap9.html#shaders-objects">9.1. Shader Objects</a></li>
<li><a href="chap9.html#shader-modules">9.2. Shader Modules</a></li>
<li><a href="chap9.html#shaders-identifiers">9.3. Shader Module Identifiers</a></li>
<li><a href="chap9.html#shaders-binding">9.4. Binding Shaders</a></li>
<li><a href="chap9.html#shaders-execution">9.5. Shader Execution</a></li>
<li><a href="chap9.html#shaders-execution-memory-access-bounds">9.6. Shader Out-of-Bounds Memory Access</a></li>
<li><a href="chap9.html#shaders-execution-memory-ordering">9.7. Shader Memory Access Ordering</a></li>
<li><a href="chap9.html#shaders-inputs">9.8. Shader Inputs and Outputs</a></li>
<li><a href="chap9.html#shaders-task">9.9. Task Shaders</a></li>
<li><a href="chap9.html#shaders-mesh">9.10. Mesh Shaders</a></li>
<li><a href="chap9.html#shaders-cluster-culling">9.11. Cluster Culling Shaders</a></li>
<li><a href="chap9.html#shaders-vertex">9.12. Vertex Shaders</a></li>
<li><a href="chap9.html#shaders-tessellation-control">9.13. Tessellation Control Shaders</a></li>
<li><a href="chap9.html#shaders-tessellation-evaluation">9.14. Tessellation Evaluation Shaders</a></li>
<li><a href="chap9.html#shaders-geometry">9.15. Geometry Shaders</a></li>
<li><a href="chap9.html#shaders-fragment">9.16. Fragment Shaders</a></li>
<li><a href="chap9.html#shaders-compute">9.17. Compute Shaders</a></li>
<li><a href="chap9.html#shaders-ray-generation">9.18. Ray Generation Shaders</a></li>
<li><a href="chap9.html#shaders-intersection">9.19. Intersection Shaders</a></li>
<li><a href="chap9.html#shaders-any-hit">9.20. Any-Hit Shaders</a></li>
<li><a href="chap9.html#shaders-closest-hit">9.21. Closest Hit Shaders</a></li>
<li><a href="chap9.html#shaders-miss">9.22. Miss Shaders</a></li>
<li><a href="chap9.html#shaders-callable">9.23. Callable Shaders</a></li>
<li><a href="chap9.html#shaders-interpolation-decorations">9.24. Interpolation Decorations</a></li>
<li><a href="chap9.html#shaders-staticuse">9.25. Static Use</a></li>
<li><a href="chap9.html#shaders-scope">9.26. Scope</a></li>
<li><a href="chap9.html#shaders-group-operations">9.27. Group Operations</a></li>
<li><a href="chap9.html#shaders-quad-operations">9.28. Quad Group Operations</a></li>
<li><a href="chap9.html#shaders-derivative-operations">9.29. Derivative Operations</a></li>
<li><a href="chap9.html#shaders-helper-invocations">9.30. Helper Invocations</a></li>
<li><a href="chap9.html#cooperative-matrices">9.31. Cooperative Matrices</a></li>
<li><a href="chap9.html#_cooperative_vectors">9.32. Cooperative Vectors</a></li>
<li><a href="chap9.html#shaders-validation-cache">9.33. Validation Cache</a></li>
<li><a href="chap9.html#cuda-modules">9.34. CUDA Modules</a></li>
</ul>
</li>
<li><a href="chap10.html">10. Pipelines</a>
<ul class="sectlevel2">
<li><a href="chap10.html#pipelines-multiple">10.1. Multiple Pipeline Creation</a></li>
<li><a href="chap10.html#pipelines-creation-flags">10.2. Pipeline Creation Flags</a></li>
<li><a href="chap10.html#pipelines-compute">10.3. Compute Pipelines</a></li>
<li><a href="chap10.html#pipelines-graphics">10.4. Graphics Pipelines</a></li>
<li><a href="chap10.html#pipelines-ray-tracing">10.5. Ray Tracing Pipelines</a></li>
<li><a href="chap10.html#pipelines-destruction">10.6. Pipeline Destruction</a></li>
<li><a href="chap10.html#pipelines-pipeline-derivatives">10.7. Pipeline Derivatives</a></li>
<li><a href="chap10.html#pipelines-cache">10.8. Pipeline Cache</a></li>
<li><a href="chap10.html#pipelines-binaries">10.9. Pipeline Binaries</a></li>
<li><a href="chap10.html#pipelines-specialization-constants">10.10. Specialization Constants</a></li>
<li><a href="chap10.html#pipelines-library">10.11. Pipeline Libraries</a></li>
<li><a href="chap10.html#pipelines-binding">10.12. Pipeline Binding</a></li>
<li><a href="chap10.html#pipelines-dynamic-state">10.13. Dynamic State</a></li>
<li><a href="chap10.html#pipelines-shader-information">10.14. Pipeline Properties and Shader Information</a></li>
<li><a href="chap10.html#pipelines-compiler-control">10.15. Pipeline Compiler Control</a></li>
<li><a href="chap10.html#pipelines-creation-feedback">10.16. Pipeline Creation Feedback</a></li>
</ul>
</li>
<li><a href="chap11.html">11. Memory Allocation</a>
<ul class="sectlevel2">
<li><a href="chap11.html#memory-host">11.1. Host Memory</a></li>
<li><a href="chap11.html#memory-device">11.2. Device Memory</a></li>
</ul>
</li>
<li><a href="chap12.html">12. Resource Creation</a>
<ul class="sectlevel2">
<li><a href="chap12.html#resources-buffers">12.1. Buffers</a></li>
<li><a href="chap12.html#resources-buffer-views">12.2. Buffer Views</a></li>
<li><a href="chap12.html#resources-buffer-device-addresses">12.3. Buffer Device Addresses</a></li>
<li><a href="chap12.html#resources-images">12.4. Images</a></li>
<li><a href="chap12.html#resources-image-layouts">12.5. Image Layouts</a></li>
<li><a href="chap12.html#resources-image-views">12.6. Image Views</a></li>
<li><a href="chap12.html#resources-acceleration-structures">12.7. Acceleration Structures</a></li>
<li><a href="chap12.html#resources-micromaps">12.8. Micromaps</a></li>
<li><a href="chap12.html#resources-association">12.9. Resource Memory Association</a></li>
<li><a href="chap12.html#resources-sharing">12.10. Resource Sharing Mode</a></li>
<li><a href="chap12.html#resources-memory-aliasing">12.11. Memory Aliasing</a></li>
<li><a href="chap12.html#resources-buffer-collection-fuchsia">12.12. Buffer Collections</a></li>
<li><a href="chap12.html#resources-tensors">12.13. Tensors</a></li>
<li><a href="chap12.html#resources-tensor-views">12.14. Tensor Views</a></li>
</ul>
</li>
<li><a href="chap13.html">13. Images</a>
<ul class="sectlevel2">
<li><a href="chap13.html#images-coordinate-validation">13.1. Image Coordinate Validation</a></li>
<li><a href="chap13.html#images-reads">13.2. Image Reads</a></li>
<li><a href="chap13.html#images-writes">13.3. Image Writes</a></li>
</ul>
</li>
<li><a href="chap14.html">14. Samplers</a>
<ul class="sectlevel2">
<li><a href="chap14.html#samplers-YCbCr-conversion">14.1. Sampler Y′C<sub>B</sub>C<sub>R</sub> Conversion</a></li>
</ul>
</li>
<li><a href="chap15.html">15. Resource Descriptors</a>
<ul class="sectlevel2">
<li><a href="chap15.html#descriptorsets-types">15.1. Descriptor Types</a></li>
<li><a href="chap15.html#descriptorsets-sets">15.2. Descriptor Sets</a></li>
<li><a href="chap15.html#descriptorsets-physical-storage-buffer">15.3. Physical Storage Buffer Access</a></li>
<li><a href="chap15.html#descriptorbuffers">15.4. Descriptor Buffers</a></li>
</ul>
</li>
<li><a href="chap16.html">16. Shader Interfaces</a>
<ul class="sectlevel2">
<li><a href="chap16.html#interfaces-iointerfaces">16.1. Shader Input and Output Interfaces</a></li>
<li><a href="chap16.html#interfaces-vertexinput">16.2. Vertex Input Interface</a></li>
<li><a href="chap16.html#interfaces-fragmentoutput">16.3. Fragment Output Interface</a></li>
<li><a href="chap16.html#interfaces-legacy-dithering">16.4. Legacy Dithering</a></li>
<li><a href="chap16.html#interfaces-fragmenttileimage">16.5. Fragment Tile Image Interface</a></li>
<li><a href="chap16.html#interfaces-tile-attachment">16.6. Tile Attachment Interface</a></li>
<li><a href="chap16.html#interfaces-inputattachment">16.7. Fragment Input Attachment Interface</a></li>
<li><a href="chap16.html#interfaces-raypipeline">16.8. Ray Tracing Pipeline Interface</a></li>
<li><a href="chap16.html#interfaces-resources">16.9. Shader Resource Interface</a></li>
<li><a href="chap16.html#interfaces-builtin-variables">16.10. Built-In Variables</a></li>
</ul>
</li>
<li><a href="chap17.html">17. Image Operations</a>
<ul class="sectlevel2">
<li><a href="chap17.html#_image_operations_overview">17.1. Image Operations Overview</a></li>
<li><a href="chap17.html#textures-input">17.2. Sampling Operations</a></li>
<li><a href="chap17.html#textures-normalized-operations">17.3. Normalized Texel Coordinate Operations</a></li>
<li><a href="chap17.html#textures-unnormalized-operations">17.4. Unnormalized Texel Coordinate Operations</a></li>
<li><a href="chap17.html#textures-integer-coordinate-operations">17.5. Integer Texel Coordinate Operations</a></li>
<li><a href="chap17.html#textures-sample-operations">17.6. Image Sample Operations</a></li>
<li><a href="chap17.html#textures-footprint">17.7. Texel Footprint Evaluation</a></li>
<li><a href="chap17.html#textures-weightimage">17.8. Weight Image Sampling</a></li>
<li><a href="chap17.html#textures-blockmatch">17.9. Block Matching</a></li>
<li><a href="chap17.html#textures-boxfilter">17.10. Box Filter Sampling</a></li>
<li><a href="chap17.html#textures-instructions">17.11. Image Operation Steps</a></li>
<li><a href="chap17.html#textures-queries">17.12. Image Query Instructions</a></li>
</ul>
</li>
<li><a href="chap18.html">18. Fragment Density Map Operations</a>
<ul class="sectlevel2">
<li><a href="chap18.html#_fragment_density_map_operations_overview">18.1. Fragment Density Map Operations Overview</a></li>
<li><a href="chap18.html#fragmentdensitymap-fetch-density-value">18.2. Fetch Density Value</a></li>
<li><a href="chap18.html#fragmentdensitymap-conversion-to-fragment-area">18.3. Fragment Area Conversion</a></li>
</ul>
</li>
<li><a href="chap19.html">19. Tensor Operations</a>
<ul class="sectlevel2">
<li><a href="chap19.html#_tensor_operations_overview">19.1. Tensor Operations Overview</a></li>
<li><a href="chap19.html#_tensor_element_input_operations">19.2. Tensor Element Input Operations</a></li>
<li><a href="chap19.html#_tensor_element_output_operations">19.3. Tensor Element Output Operations</a></li>
<li><a href="chap19.html#tensors-queries">19.4. Tensor Query Instructions</a></li>
</ul>
</li>
<li><a href="chap20.html">20. Queries</a>
<ul class="sectlevel2">
<li><a href="chap20.html#queries-pools">20.1. Query Pools</a></li>
<li><a href="chap20.html#queries-operation">20.2. Query Operation</a></li>
<li><a href="chap20.html#queries-occlusion">20.3. Occlusion Queries</a></li>
<li><a href="chap20.html#queries-pipestats">20.4. Pipeline Statistics Queries</a></li>
<li><a href="chap20.html#queries-timestamps">20.5. Timestamp Queries</a></li>
<li><a href="chap20.html#queries-performance">20.6. Performance Queries</a></li>
<li><a href="chap20.html#queries-transform-feedback">20.7. Transform Feedback Queries</a></li>
<li><a href="chap20.html#queries-primitives-generated">20.8. Primitives Generated Queries</a></li>
<li><a href="chap20.html#queries-mesh-shader">20.9. Mesh Shader Queries</a></li>
<li><a href="chap20.html#queries-performance-intel">20.10. Intel Performance Queries</a></li>
<li><a href="chap20.html#queries-result-status-only">20.11. Result Status Queries</a></li>
<li><a href="chap20.html#queries-video-encode-feedback">20.12. Video Encode Feedback Queries</a></li>
</ul>
</li>
<li><a href="chap21.html">21. Clear Commands</a>
<ul class="sectlevel2">
<li><a href="chap21.html#clears-outside">21.1. Clearing Images Outside a Render Pass Instance</a></li>
<li><a href="chap21.html#clears-inside">21.2. Clearing Images Inside a Render Pass Instance</a></li>
<li><a href="chap21.html#clears-values">21.3. Clear Values</a></li>
<li><a href="chap21.html#clears-filling-buffers">21.4. Filling Buffers</a></li>
<li><a href="chap21.html#clears-updating-buffers">21.5. Updating Buffers</a></li>
</ul>
</li>
<li><a href="chap22.html">22. Copy Commands</a>
<ul class="sectlevel2">
<li><a href="chap22.html#copies-buffers">22.1. Copying Data Between Buffers</a></li>
<li><a href="chap22.html#copies-images">22.2. Copying Data Between Images</a></li>
<li><a href="chap22.html#copies-buffers-images">22.3. Copying Data Between Buffers and Images</a></li>
<li><a href="chap22.html#indirect-copies">22.4. Indirect Copies</a></li>
<li><a href="chap22.html#copies-imagescaling">22.5. Image Copies With Scaling</a></li>
<li><a href="chap22.html#copies-resolve">22.6. Resolving Multisample Images</a></li>
<li><a href="chap22.html#copies-buffer-markers">22.7. Buffer Markers</a></li>
<li><a href="chap22.html#copies-tensors">22.8. Copying Data Between Tensors</a></li>
</ul>
</li>
<li><a href="chap23.html">23. Drawing Commands</a>
<ul class="sectlevel2">
<li><a href="chap23.html#drawing-primitive-topologies">23.1. Primitive Topologies</a></li>
<li><a href="chap23.html#drawing-effective-primitive-topology">23.2. Effective Primitive Topology</a></li>
<li><a href="chap23.html#drawing-primitive-order">23.3. Primitive Order</a></li>
<li><a href="chap23.html#drawing-primitive-shading">23.4. Programmable Primitive Shading</a></li>
<li><a href="chap23.html#drawing-conditional-rendering">23.5. Conditional Rendering</a></li>
<li><a href="chap23.html#drawing-mesh-shading">23.6. Programmable Mesh Shading</a></li>
<li><a href="chap23.html#drawing-cluster-culling-shading">23.7. Programmable Cluster Culling Shading</a></li>
</ul>
</li>
<li><a href="chap24.html">24. Fixed-Function Vertex Processing</a>
<ul class="sectlevel2">
<li><a href="chap24.html#fxvertex-attrib">24.1. Vertex Attributes</a></li>
<li><a href="chap24.html#fxvertex-input">24.2. Vertex Input Description</a></li>
<li><a href="chap24.html#fxvertex-attribute_divisor">24.3. Vertex Attribute Divisor in Instanced Rendering</a></li>
<li><a href="chap24.html#fxvertex-input-address-calculation">24.4. Vertex Input Address Calculation</a></li>
</ul>
</li>
<li><a href="chap25.html">25. Tessellation</a>
<ul class="sectlevel2">
<li><a href="chap25.html#_tessellator">25.1. Tessellator</a></li>
<li><a href="chap25.html#_tessellator_patch_discard">25.2. Tessellator Patch Discard</a></li>
<li><a href="chap25.html#tessellation-tessellator-spacing">25.3. Tessellator Spacing</a></li>
<li><a href="chap25.html#tessellation-primitive-order">25.4. Tessellation Primitive Ordering</a></li>
<li><a href="chap25.html#tessellation-vertex-winding-order">25.5. Tessellator Vertex Winding Order</a></li>
<li><a href="chap25.html#tessellation-triangle-tessellation">25.6. Triangle Tessellation</a></li>
<li><a href="chap25.html#tessellation-quad-tessellation">25.7. Quad Tessellation</a></li>
<li><a href="chap25.html#tessellation-isoline-tessellation">25.8. Isoline Tessellation</a></li>
<li><a href="chap25.html#tessellation-point-mode">25.9. Tessellation Point Mode</a></li>
<li><a href="chap25.html#_tessellation_pipeline_state">25.10. Tessellation Pipeline State</a></li>
</ul>
</li>
<li><a href="chap26.html">26. Geometry Shading</a>
<ul class="sectlevel2">
<li><a href="chap26.html#geometry-input">26.1. Geometry Shader Input Primitives</a></li>
<li><a href="chap26.html#geometry-output">26.2. Geometry Shader Output Primitives</a></li>
<li><a href="chap26.html#geometry-invocations">26.3. Multiple Invocations of Geometry Shaders</a></li>
<li><a href="chap26.html#geometry-ordering">26.4. Geometry Shader Primitive Ordering</a></li>
<li><a href="chap26.html#geometry-passthrough">26.5. Geometry Shader Passthrough</a></li>
</ul>
</li>
<li><a href="chap27.html">27. Mesh Shading</a>
<ul class="sectlevel2">
<li><a href="chap27.html#mesh-task-input">27.1. Task Shader Input</a></li>
<li><a href="chap27.html#mesh-task-output">27.2. Task Shader Output</a></li>
<li><a href="chap27.html#mesh-generation">27.3. Mesh Generation</a></li>
<li><a href="chap27.html#mesh-input">27.4. Mesh Shader Input</a></li>
<li><a href="chap27.html#mesh-output">27.5. Mesh Shader Output</a></li>
<li><a href="chap27.html#mesh-output-perview">27.6. Mesh Shader Per-View Outputs</a></li>
<li><a href="chap27.html#mesh-ordering">27.7. Mesh Shader Primitive Ordering</a></li>
</ul>
</li>
<li><a href="chap28.html">28. Cluster Culling Shading</a>
<ul class="sectlevel2">
<li><a href="chap28.html#cluster-culling-input">28.1. Cluster Culling Shader Input</a></li>
<li><a href="chap28.html#cluster-culling-output">28.2. Cluster Culling Shader Output</a></li>
<li><a href="chap28.html#cluster-culling-cluster-ordering">28.3. Cluster Culling Shader Cluster Ordering</a></li>
<li><a href="chap28.html#cluster-culling-primitive-ordering">28.4. Cluster Culling Shader Primitive Ordering</a></li>
</ul>
</li>
<li><a href="chap29.html">29. Fixed-Function Vertex Post-Processing</a>
<ul class="sectlevel2">
<li><a href="chap29.html#vertexpostproc-transform-feedback">29.1. Transform Feedback</a></li>
<li><a href="chap29.html#vertexpostproc-viewport-swizzle">29.2. Viewport Swizzle</a></li>
<li><a href="chap29.html#vertexpostproc-flatshading">29.3. Flat Shading</a></li>
<li><a href="chap29.html#vertexpostproc-clipping">29.4. Primitive Clipping</a></li>
<li><a href="chap29.html#vertexpostproc-clipping-shader-outputs">29.5. Clipping Shader Outputs</a></li>
<li><a href="chap29.html#vertexpostproc-viewportwscaling">29.6. Controlling Viewport W Scaling</a></li>
<li><a href="chap29.html#vertexpostproc-coord-transform">29.7. Coordinate Transformations</a></li>
<li><a href="chap29.html#vertexpostproc-renderpass-transform">29.8. Render Pass Transform</a></li>
<li><a href="chap29.html#vertexpostproc-viewport">29.9. Controlling the Viewport</a></li>
</ul>
</li>
<li><a href="chap30.html">30. Rasterization</a>
<ul class="sectlevel2">
<li><a href="chap30.html#primsrast-discard">30.1. Discarding Primitives Before Rasterization</a></li>
<li><a href="chap30.html#primsrast-stream">30.2. Controlling the Vertex Stream Used for Rasterization</a></li>
<li><a href="chap30.html#primsrast-order">30.3. Rasterization Order</a></li>
<li><a href="chap30.html#primsrast-multisampling">30.4. Multisampling</a></li>
<li><a href="chap30.html#primsrast-samplelocations">30.5. Custom Sample Locations</a></li>
<li><a href="chap30.html#primsrast-fragment-shading-rate">30.6. Fragment Shading Rates</a></li>
<li><a href="chap30.html#primsrast-shading-rate-image">30.7. Shading Rate Image</a></li>
<li><a href="chap30.html#primsrast-sampleshading">30.8. Sample Shading</a></li>
<li><a href="chap30.html#primsrast-barycentric">30.9. Barycentric Interpolation</a></li>
<li><a href="chap30.html#primsrast-points">30.10. Points</a></li>
<li><a href="chap30.html#primsrast-lines">30.11. Line Segments</a></li>
<li><a href="chap30.html#primsrast-polygons">30.12. Polygons</a></li>
</ul>
</li>
<li><a href="chap31.html">31. Fragment Operations</a>
<ul class="sectlevel2">
<li><a href="chap31.html#fragops-discard-rectangles">31.1. Discard Rectangles Test</a></li>
<li><a href="chap31.html#fragops-scissor">31.2. Scissor Test</a></li>
<li><a href="chap31.html#fragops-exclusive-scissor">31.3. Exclusive Scissor Test</a></li>
<li><a href="chap31.html#fragops-samplemask">31.4. Sample Mask Test</a></li>
<li><a href="chap31.html#fragops-shader">31.5. Fragment Shading</a></li>
<li><a href="chap31.html#fragops-covg">31.6. Multisample Coverage</a></li>
<li><a href="chap31.html#fragops-ds-state">31.7. Depth and Stencil Operations</a></li>
<li><a href="chap31.html#fragops-dbt">31.8. Depth Bounds Test</a></li>
<li><a href="chap31.html#fragops-stencil">31.9. Stencil Test</a></li>
<li><a href="chap31.html#fragops-depth">31.10. Depth Test</a></li>
<li><a href="chap31.html#fragops-rep-frag-test">31.11. Representative Fragment Test</a></li>
<li><a href="chap31.html#fragops-samplecount">31.12. Sample Counting</a></li>
<li><a href="chap31.html#fragops-coverage-to-color">31.13. Fragment Coverage to Color</a></li>
<li><a href="chap31.html#fragops-coverage-reduction">31.14. Coverage Reduction</a></li>
</ul>
</li>
<li><a href="chap32.html">32. The Framebuffer</a>
<ul class="sectlevel2">
<li><a href="chap32.html#framebuffer-blending">32.1. Blending</a></li>
<li><a href="chap32.html#framebuffer-logicop">32.2. Logical Operations</a></li>
<li><a href="chap32.html#framebuffer-color-write-mask">32.3. Color Write Mask</a></li>
<li><a href="chap32.html#framebuffer-color-write-enable">32.4. Color Write Enable</a></li>
<li><a href="chap32.html#framebuffer-queries">32.5. Framebuffer Query Instructions</a></li>
</ul>
</li>
<li><a href="chap33.html">33. Dispatching Commands</a>
<ul class="sectlevel2">
<li><a href="chap33.html#cudadispatch">33.1. Dispatch Command for CUDA PTX Kernels</a></li>
</ul>
</li>
<li><a href="chap34.html">34. Device-Generated Commands</a>
<ul class="sectlevel2">
<li><a href="chap34.html#indirectmdslayout">34.1. Indirect Commands Layout</a></li>
<li><a href="chap34.html#_indirect_commands_generation_and_execution">34.2. Indirect Commands Generation and Execution</a></li>
</ul>
</li>
<li><a href="chap35.html">35. Sparse Resources</a>
<ul class="sectlevel2">
<li><a href="chap35.html#sparsememory-sparseresourcefeatures">35.1. Sparse Resource Features</a></li>
<li><a href="chap35.html#sparsememory-fully-resident">35.2. Sparse Buffers and Fully-Resident Images</a></li>
<li><a href="chap35.html#sparsememory-partially-resident-buffers">35.3. Sparse Partially-Resident Buffers</a></li>
<li><a href="chap35.html#sparsememory-partially-resident-images">35.4. Sparse Partially-Resident Images</a></li>
<li><a href="chap35.html#sparsememory-sparse-memory-aliasing">35.5. Sparse Memory Aliasing</a></li>
<li><a href="chap35.html#_sparse_resource_implementation_guidelines_informative">35.6. Sparse Resource Implementation Guidelines (Informative)</a></li>
<li><a href="chap35.html#sparsememory-resourceapi">35.7. Sparse Resource API</a></li>
</ul>
</li>
<li><a href="chap36.html">36. Window System Integration (WSI)</a>
<ul class="sectlevel2">
<li><a href="chap36.html#_wsi_platform">36.1. WSI Platform</a></li>
<li><a href="chap36.html#_wsi_surface">36.2. WSI Surface</a></li>
<li><a href="chap36.html#display">36.3. Presenting Directly to Display Devices</a></li>
<li><a href="chap36.html#_querying_for_wsi_support">36.4. Querying for WSI Support</a></li>
<li><a href="chap36.html#_surface_queries">36.5. Surface Queries</a></li>
<li><a href="chap36.html#_full_screen_exclusive_control">36.6. Full Screen Exclusive Control</a></li>
<li><a href="chap36.html#_device_group_queries">36.7. Device Group Queries</a></li>
<li><a href="chap36.html#_display_timing_queries">36.8. Display Timing Queries</a></li>
<li><a href="chap36.html#present-wait2">36.9. Present Wait</a></li>
<li><a href="chap36.html#wsi-swapchain">36.10. WSI Swapchain</a></li>
<li><a href="chap36.html#_hdr_metadata">36.11. HDR Metadata</a></li>
<li><a href="chap36.html#lag-control">36.12. Lag Control</a></li>
<li><a href="chap36.html#present-barrier">36.13. Present Barrier</a></li>
</ul>
</li>
<li><a href="chap37.html">37. Deferred Host Operations</a>
<ul class="sectlevel2">
<li><a href="chap37.html#deferred-host-operations-requesting">37.1. Requesting Deferral</a></li>
<li><a href="chap37.html#_deferred_host_operations_api">37.2. Deferred Host Operations API</a></li>
</ul>
</li>
<li><a href="chap38.html">38. Private Data</a></li>
<li class="current"><a href="chap39.html">39. Acceleration Structures</a>
<ul class="sectlevel2">
<li class="current"><a href="chap39.html#acceleration-structure-def">39.1. Acceleration Structures</a></li>
<li class="current"><a href="chap39.html#cluster-geometry">39.2. Cluster Level Acceleration Structures</a></li>
<li class="current"><a href="chap39.html#partitioned-tlas">39.3. Partitioned Top Level Acceleration Structures</a></li>
<li class="current"><a href="chap39.html#host-acceleration-structure">39.4. Host Acceleration Structure Operations</a></li>
</ul>
</li>
<li><a href="chap40.html">40. Compressed triangle data</a>
<ul class="sectlevel2">
<li><a href="chap40.html#dense-geometry-format">40.1. Dense Geometry Format Version 1 (DGF1)</a></li>
</ul>
</li>
<li><a href="chap41.html">41. Micromap</a>
<ul class="sectlevel2">
<li><a href="chap41.html#micromap-def">41.1. Micromaps</a></li>
<li><a href="chap41.html#host-micromap">41.2. Host Micromap Operations</a></li>
</ul>
</li>
<li><a href="chap42.html">42. Ray Traversal</a>
<ul class="sectlevel2">
<li><a href="chap42.html#ray-intersection-candidate-determination">42.1. Ray Intersection Candidate Determination</a></li>
<li><a href="chap42.html#ray-intersection-culling">42.2. Ray Intersection Culling</a></li>
<li><a href="chap42.html#ray-intersection-confirmation">42.3. Ray Intersection Confirmation</a></li>
<li><a href="chap42.html#ray-closest-hit-determination">42.4. Ray Closest Hit Determination</a></li>
<li><a href="chap42.html#ray-result-determination">42.5. Ray Result Determination</a></li>
</ul>
</li>
<li><a href="chap43.html">43. Ray Tracing</a>
<ul class="sectlevel2">
<li><a href="chap43.html#ray-tracing-shader-call">43.1. Shader Call Instructions</a></li>
<li><a href="chap43.html#ray-tracing-commands">43.2. Ray Tracing Commands</a></li>
<li><a href="chap43.html#shader-binding-table">43.3. Shader Binding Table</a></li>
<li><a href="chap43.html#ray-tracing-pipeline-stack">43.4. Ray Tracing Pipeline Stack</a></li>
<li><a href="chap43.html#ray-tracing-capture-replay">43.5. Ray Tracing Capture Replay</a></li>
<li><a href="chap43.html#ray-tracing-validation">43.6. Ray Tracing Validation</a></li>
</ul>
</li>
<li><a href="chap44.html">44. Memory Decompression</a></li>
<li><a href="chap45.html">45. Video Coding</a>
<ul class="sectlevel2">
<li><a href="chap45.html#video-picture-resources">45.1. Video Picture Resources</a></li>
<li><a href="chap45.html#dpb">45.2. Decoded Picture Buffer</a></li>
<li><a href="chap45.html#video-profiles">45.3. Video Profiles</a></li>
<li><a href="chap45.html#video-capabilities">45.4. Video Capabilities</a></li>
<li><a href="chap45.html#video-session">45.5. Video Sessions</a></li>
<li><a href="chap45.html#video-profile-compatibility">45.6. Video Profile Compatibility</a></li>
<li><a href="chap45.html#video-session-parameters">45.7. Video Session Parameters</a></li>
<li><a href="chap45.html#video-coding-scope">45.8. Video Coding Scope</a></li>
<li><a href="chap45.html#video-coding-control">45.9. Video Coding Control</a></li>
<li><a href="chap45.html#video-inline-queries">45.10. Inline Queries</a></li>
<li><a href="chap45.html#video-decode-operations">45.11. Video Decode Operations</a></li>
<li><a href="chap45.html#decode-h264">45.12. H.264 Decode Operations</a></li>
<li><a href="chap45.html#decode-h265">45.13. H.265 Decode Operations</a></li>
<li><a href="chap45.html#decode-vp9">45.14. VP9 Decode Operations</a></li>
<li><a href="chap45.html#decode-av1">45.15. AV1 Decode Operations</a></li>
<li><a href="chap45.html#video-encode-operations">45.16. Video Encode Operations</a></li>
<li><a href="chap45.html#encode-intra-refresh">45.17. Video Encode Intra Refresh</a></li>
<li><a href="chap45.html#encode-rate-control">45.18. Video Encode Rate Control</a></li>
<li><a href="chap45.html#encode-quantization-map">45.19. Video Encode Quantization Maps</a></li>
<li><a href="chap45.html#encode-rgb-conversion">45.20. Video Encode R′G′B′ Conversion</a></li>
<li><a href="chap45.html#encode-h264">45.21. H.264 Encode Operations</a></li>
<li><a href="chap45.html#encode-h265">45.22. H.265 Encode Operations</a></li>
<li><a href="chap45.html#encode-av1">45.23. AV1 Encode Operations</a></li>
</ul>
</li>
<li><a href="chap46.html">46. Optical Flow</a>
<ul class="sectlevel2">
<li><a href="chap46.html#_optical_flow_queues">46.1. Optical Flow Queues</a></li>
<li><a href="chap46.html#opticalflow-formats">46.2. Optical Flow Image Formats</a></li>
<li><a href="chap46.html#opticalflow-session">46.3. Optical Flow Session</a></li>
</ul>
</li>
<li><a href="chap47.html">47. Execution Graphs</a>
<ul class="sectlevel2">
<li><a href="chap47.html#_pipeline_creation">47.1. Pipeline Creation</a></li>
<li><a href="chap47.html#_initializing_scratch_memory">47.2. Initializing Scratch Memory</a></li>
<li><a href="chap47.html#_dispatching_a_graph">47.3. Dispatching a Graph</a></li>
<li><a href="chap47.html#_shader_enqueue">47.4. Shader Enqueue</a></li>
</ul>
</li>
<li><a href="chap48.html">48. External Compute Queues</a></li>
<li><a href="chap49.html">49. Data graphs</a>
<ul class="sectlevel2">
<li><a href="chap49.html#graphs-pipelines">49.1. Pipeline Creation</a></li>
<li><a href="chap49.html#_sessions">49.2. Sessions</a></li>
<li><a href="chap49.html#_dispatch">49.3. Dispatch</a></li>
<li><a href="chap49.html#graphs-properties">49.4. Properties</a></li>
<li><a href="chap49.html#graphs-processing-engines">49.5. Processing Engines</a></li>
<li><a href="chap49.html#graphs-operations">49.6. Operations</a></li>
</ul>
</li>
<li><a href="chap50.html">50. Extending Vulkan</a>
<ul class="sectlevel2">
<li><a href="chap50.html#extendingvulkan-functionalitylevels">50.1. Functionality Levels</a></li>
<li><a href="chap50.html#extendingvulkan-instanceanddeviceversions">50.2. Instance and Device Versions</a></li>
<li><a href="chap50.html#extendingvulkan-coreversions">50.3. Core Versions</a></li>
<li><a href="chap50.html#extendingvulkan-layers">50.4. Layers</a></li>
<li><a href="chap50.html#extendingvulkan-extensions">50.5. Extensions</a></li>
<li><a href="chap50.html#extendingvulkan-extensions-extensiondependencies">50.6. Extension Dependencies</a></li>
<li><a href="chap50.html#_compatibility_guarantees_informative">50.7. Compatibility Guarantees (Informative)</a></li>
</ul>
</li>
<li><a href="chap51.html">51. Features</a>
<ul class="sectlevel2">
<li><a href="chap51.html#features-requirements">51.1. Feature Requirements</a></li>
<li><a href="chap51.html#profile-features">51.2. Profile Features</a></li>
</ul>
</li>
<li><a href="chap52.html">52. Limits</a>
<ul class="sectlevel2">
<li><a href="chap52.html#limits-minmax">52.1. Limit Requirements</a></li>
<li><a href="chap52.html#limits-multisample">52.2. Additional Multisampling Capabilities</a></li>
<li><a href="chap52.html#profile-limits">52.3. Profile Limits</a></li>
</ul>
</li>
<li><a href="chap53.html">53. Formats</a>
<ul class="sectlevel2">
<li><a href="chap53.html#formats-definition">53.1. Format Definition</a></li>
<li><a href="chap53.html#formats-properties">53.2. Format Properties</a></li>
<li><a href="chap53.html#features-required-format-support">53.3. Required Format Support</a></li>
</ul>
</li>
<li><a href="chap54.html">54. Additional Capabilities</a>
<ul class="sectlevel2">
<li><a href="chap54.html#capabilities-image">54.1. Additional Image Capabilities</a></li>
<li><a href="chap54.html#capabilities-buffer">54.2. Additional Buffer Capabilities</a></li>
<li><a href="chap54.html#capabilities-tensor">54.3. Additional Tensor Capabilities</a></li>
<li><a href="chap54.html#capabilities-semaphore">54.4. Optional Semaphore Capabilities</a></li>
<li><a href="chap54.html#capabilities-fence">54.5. Optional Fence Capabilities</a></li>
<li><a href="chap54.html#features-timestamp-calibration">54.6. Timestamp Calibration Capabilities</a></li>
</ul>
</li>
<li><a href="chap55.html">55. Debugging</a>
<ul class="sectlevel2">
<li><a href="chap55.html#debugging-debug-utils">55.1. Debug Utilities</a></li>
<li><a href="chap55.html#debugging-debug-markers">55.2. Debug Markers</a></li>
<li><a href="chap55.html#debugging-debug-report-callbacks">55.3. Debug Report Callbacks</a></li>
<li><a href="chap55.html#_device_loss_debugging">55.4. Device Loss Debugging</a></li>
<li><a href="chap55.html#debugging-tooling-info">55.5. Active Tooling Information</a></li>
<li><a href="chap55.html#_frame_boundary">55.6. Frame Boundary</a></li>
</ul>
</li>
<li><a href="chap56.html">Appendix A: Vulkan Environment for SPIR-V</a>
<ul class="sectlevel2">
<li><a href="chap56.html#_versions_and_formats">Versions and Formats</a></li>
<li><a href="chap56.html#spirvenv-capabilities">Capabilities</a></li>
<li><a href="chap56.html#spirvenv-module-validation">Validation Rules Within a Module</a></li>
<li><a href="chap56.html#spirvenv-precision-operation">Precision and Operation of SPIR-V Instructions</a></li>
<li><a href="chap56.html#spirvenv-buffer-indexing">Buffer Indexing Calculations</a></li>
<li><a href="chap56.html#spirvenv-image-signedness">Signedness of SPIR-V Image Accesses</a></li>
<li><a href="chap56.html#spirvenv-format-type-matching">Image Format and Type Matching</a></li>
<li><a href="chap56.html#spirvenv-image-dimensions">Compatibility Between SPIR-V Image Dimensions and Vulkan ImageView Types</a></li>
<li><a href="chap56.html#spirvenv-image-formats">Compatibility Between SPIR-V Image Formats and Vulkan Formats</a></li>
<li><a href="chap56.html#spirenv-ray-query-precision-operation">Ray Query Precision and Operation</a></li>
<li><a href="chap56.html#spirvenv-tensor-formats">Compatibility Between SPIR-V Tensor Element Types And Vulkan Formats</a></li>
</ul>
</li>
<li><a href="chap57.html">Appendix B: Memory Model</a>
<ul class="sectlevel2">
<li><a href="chap57.html#memory-model-agent">Agent</a></li>
<li><a href="chap57.html#memory-model-memory-location">Memory Location</a></li>
<li><a href="chap57.html#memory-model-allocation">Allocation</a></li>
<li><a href="chap57.html#memory-model-memory-operation">Memory Operation</a></li>
<li><a href="chap57.html#memory-model-references">Reference</a></li>
<li><a href="chap57.html#memory-model-program-order">Program-Order</a></li>
<li><a href="chap57.html#shader-call-related">Shader Call Related</a></li>
<li><a href="chap57.html#shader-call-order">Shader Call Order</a></li>
<li><a href="chap57.html#memory-model-scope">Scope</a></li>
<li><a href="chap57.html#memory-model-atomic-operation">Atomic Operation</a></li>
<li><a href="chap57.html#memory-model-scoped-modification-order">Scoped Modification Order</a></li>
<li><a href="chap57.html#memory-model-memory-semantics">Memory Semantics</a></li>
<li><a href="chap57.html#memory-model-release-sequence">Release Sequence</a></li>
<li><a href="chap57.html#memory-model-synchronizes-with">Synchronizes-With</a></li>
<li><a href="chap57.html#memory-model-system-synchronizes-with">System-Synchronizes-With</a></li>
<li><a href="chap57.html#memory-model-non-private">Private vs. Non-Private</a></li>
<li><a href="chap57.html#memory-model-inter-thread-happens-before">Inter-Thread-Happens-Before</a></li>
<li><a href="chap57.html#memory-model-happens-before">Happens-Before</a></li>
<li><a href="chap57.html#memory-model-availability-visibility">Availability and Visibility</a></li>
<li><a href="chap57.html#memory-model-vulkan-availability-visibility">Availability, Visibility, and Domain Operations</a></li>
<li><a href="chap57.html#memory-model-availability-visibility-semantics">Availability and Visibility Semantics</a></li>
<li><a href="chap57.html#memory-model-instruction-av-vis">Per-Instruction Availability and Visibility Semantics</a></li>
<li><a href="chap57.html#memory-model-location-ordered">Location-Ordered</a></li>
<li><a href="chap57.html#memory-model-access-data-race">Data Race</a></li>
<li><a href="chap57.html#memory-model-visible-to">Visible-To</a></li>
<li><a href="chap57.html#memory-model-acyclicity">Acyclicity</a></li>
<li><a href="chap57.html#memory-model-shader-io">Shader I/O</a></li>
<li><a href="chap57.html#memory-model-deallocation">Deallocation</a></li>
<li><a href="chap57.html#memory-model-informative-descriptions">Descriptions (Informative)</a></li>
<li><a href="chap57.html#memory-model-tessellation-output-ordering">Tessellation Output Ordering</a></li>
<li><a href="chap57.html#memory-model-cooperative-matrix">Cooperative Matrix Memory Access</a></li>
</ul>
</li>
<li><a href="chap58.html">Appendix C: Compressed Image Formats</a>
<ul class="sectlevel2">
<li><a href="chap58.html#appendix-compressedtex-bc">Block-Compressed Image Formats</a></li>
<li><a href="chap58.html#appendix-compressedtex-etc2">ETC Compressed Image Formats</a></li>
<li><a href="chap58.html#appendix-compressedtex-astc">ASTC Compressed Image Formats</a></li>
<li><a href="chap58.html#appendix-compressedtex-pvrtc">PVRTC Compressed Image Formats</a></li>
</ul>
</li>
<li><a href="chap59.html">Appendix D: Core Revisions (Informative)</a>
<ul class="sectlevel2">
<li><a href="chap59.html#versions-1.4">Vulkan Version 1.4</a></li>
<li><a href="chap59.html#versions-1.3">Vulkan Version 1.3</a></li>
<li><a href="chap59.html#versions-1.2">Vulkan Version 1.2</a></li>
<li><a href="chap59.html#versions-1.1">Vulkan Version 1.1</a></li>
<li><a href="chap59.html#versions-1.0">Vulkan Version 1.0</a></li>
</ul>
</li>
<li><a href="chap60.html">Appendix E: Layers &amp; Extensions (Informative)</a>
<ul class="sectlevel2">
<li><a href="chap60.html#_extension_dependencies">Extension Dependencies</a></li>
<li><a href="chap60.html#_extension_interactions">Extension Interactions</a></li>
<li><a href="chap60.html#current-extension-appendices-list">List of Current Extensions</a></li>
<li><a href="chap60.html#provisional-extension-appendices-list">List of Provisional Extensions</a></li>
<li><a href="chap60.html#deprecated-extension-appendices-list">List of Deprecated Extensions</a></li>
</ul>
</li>
<li><a href="chap61.html">Appendix F: Vulkan Roadmap Milestones</a>
<ul class="sectlevel2">
<li><a href="chap61.html#roadmap-2022">Roadmap 2022</a></li>
<li><a href="chap61.html#roadmap-2024">Roadmap 2024</a></li>
</ul>
</li>
<li><a href="chap62.html">Appendix G: Deprecation</a>
<ul class="sectlevel2">
<li><a href="chap62.html#_deprecated_functionality">Deprecated Functionality</a></li>
</ul>
</li>
<li><a href="chap63.html">Appendix H: API Boilerplate</a>
<ul class="sectlevel2">
<li><a href="chap63.html#boilerplate-headers">Vulkan Header Files</a></li>
<li><a href="chap63.html#boilerplate-wsi-header">Window System-Specific Header Control (Informative)</a></li>
<li><a href="chap63.html#boilerplate-provisional-header">Provisional Extension Header Control (Informative)</a></li>
<li><a href="chap63.html#boilerplate-video-std-headers">Video Std Headers</a></li>
</ul>
</li>
<li><a href="chap64.html">Appendix I: Invariance</a>
<ul class="sectlevel2">
<li><a href="chap64.html#_repeatability">Repeatability</a></li>
<li><a href="chap64.html#_multi_pass_algorithms">Multi-Pass Algorithms</a></li>
<li><a href="chap64.html#_invariance_rules">Invariance Rules</a></li>
<li><a href="chap64.html#_tessellation_invariance">Tessellation Invariance</a></li>
</ul>
</li>
<li><a href="chap65.html">Appendix J: Lexicon</a>
<ul class="sectlevel2">
<li><a href="chap65.html#glossary">Glossary</a></li>
<li><a href="chap65.html#lexicon-common-abbreviations">Common Abbreviations</a></li>
<li><a href="chap65.html#lexicon-video-abbreviations">Video-Specific Abbreviations</a></li>
<li><a href="chap65.html#lexicon-prefixes">Prefixes</a></li>
</ul>
</li>
<li><a href="chap66.html">Appendix K: Credits (Informative)</a>
<ul class="sectlevel2">
<li><a href="chap66.html#_working_group_contributors_to_vulkan">Working Group Contributors to Vulkan</a></li>
<li><a href="chap66.html#_other_credits">Other Credits</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="loading_msg" class="hidden" hidden=""><p>Loading… please wait.</p></div>
<!--ChunkedSearchboxMarker-->
<div class="searchbox"><label for="searchbox">Search: </label><input id="searchbox" type="text" disabled="disabled" value="Loading Search Data"><div id="resultsdiv"><ol id="results"></ol></div></div>
<div id="content" class="loadable"><div class="sect1">
<h2 id="acceleration-structure"><a class="anchor" href="chap39.html"></a>39. Acceleration Structures</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="acceleration-structure-def"><a class="anchor" href="chap39.html#acceleration-structure-def"></a>39.1. Acceleration Structures</h3>
<div class="paragraph">
<p><em>Acceleration structures</em> are data structures used by the implementation to
efficiently manage scene geometry as it is <a href="chap42.html">traversed during
a ray tracing query</a>.
The application is responsible for managing acceleration structure objects
(see <a href="chap12.html#resources-acceleration-structures">Acceleration Structures</a>),
including allocation, destruction, executing builds or updates, and
synchronizing resources used during ray tracing queries.</p>
</div>
<div class="paragraph">
<p>There are two types of acceleration structures, <em>top level acceleration
structures</em> and <em>bottom level acceleration structures</em>.</p>
</div>
<div class="paragraph">
<p>An acceleration structure is considered to be constructed if an
<a href="chap39.html#acceleration-structure-building">acceleration structure build command</a> or
<a href="chap39.html#acceleration-structure-copying">copy command</a> has been executed with the
given acceleration structure as the destination.</p>
</div>
<div id="fig-accelstruct" class="imageblock text-center">
<div class="content">
<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="122.6349mm" height="111.36717mm" viewBox="0 0 122.6349 111.36717" version="1.1" id="svg4035" inkscape:version="0.92.3 (2405546, 2018-03-11)" sodipodi:docname="accelstruct.svg">
  <defs id="defs4029">
    <marker inkscape:isstock="true" style="overflow:visible" id="marker5699" refX="0" refY="0" orient="auto" inkscape:stockid="Arrow1Lend">
      <path transform="matrix(-0.8,0,0,-0.8,-10,0)" style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1.00000003pt;stroke-opacity:1" d="M 0,0 5,-5 -12.5,0 5,5 Z" id="path5697" inkscape:connector-curvature="0"></path>
    </marker>
    <marker inkscape:stockid="Arrow1Lend" orient="auto" refY="0" refX="0" id="Arrow1Lend" style="overflow:visible" inkscape:isstock="true" inkscape:collect="always">
      <path id="path4902" d="M 0,0 5,-5 -12.5,0 5,5 Z" style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1.00000003pt;stroke-opacity:1" transform="matrix(-0.8,0,0,-0.8,-10,0)" inkscape:connector-curvature="0"></path>
    </marker>
    <marker inkscape:stockid="Arrow1Lend" orient="auto" refY="0" refX="0" id="Arrow1Lend-2" style="overflow:visible" inkscape:isstock="true">
      <path inkscape:connector-curvature="0" id="path4902-7" d="M 0,0 5,-5 -12.5,0 5,5 Z" style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1.00000003pt;stroke-opacity:1" transform="matrix(-0.8,0,0,-0.8,-10,0)"></path>
    </marker>
    <marker inkscape:stockid="Arrow1Lend" orient="auto" refY="0" refX="0" id="Arrow1Lend-1" style="overflow:visible" inkscape:isstock="true">
      <path inkscape:connector-curvature="0" id="path4902-5" d="M 0,0 5,-5 -12.5,0 5,5 Z" style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1.00000003pt;stroke-opacity:1" transform="matrix(-0.8,0,0,-0.8,-10,0)"></path>
    </marker>
    <marker inkscape:stockid="Arrow1Lend" orient="auto" refY="0" refX="0" id="Arrow1Lend-0" style="overflow:visible" inkscape:isstock="true">
      <path inkscape:connector-curvature="0" id="path4902-3" d="M 0,0 5,-5 -12.5,0 5,5 Z" style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1.00000003pt;stroke-opacity:1" transform="matrix(-0.8,0,0,-0.8,-10,0)"></path>
    </marker>
  </defs>
  <sodipodi:namedview id="base" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageopacity="0.0" inkscape:pageshadow="2" inkscape:zoom="1.4" inkscape:cx="205.45633" inkscape:cy="48.906685" inkscape:document-units="mm" inkscape:current-layer="layer1" showgrid="false" inkscape:window-width="2560" inkscape:window-height="1538" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="0"></sodipodi:namedview>
  <metadata id="metadata4032">
    <rdf:rdf>
      <cc:work rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"></dc:type>
        <dc:title></dc:title>
      </cc:work>
    </rdf:rdf>
  </metadata>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-36.531136,-66.301968)">
    <rect id="rect4037" width="117.55059" height="33.639881" x="39.498512" y="66.434525" style="fill:#cecece;fill-opacity:1;stroke:#000000;stroke-width:0.26511249;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"></rect>
    <rect id="rect4037-1" width="34.855381" height="33.760372" x="54.720116" y="143.83646" style="fill:#cecece;fill-opacity:1;stroke:#000000;stroke-width:0.14462024;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"></rect>
    <rect id="rect4037-1-1" width="34.855381" height="33.760372" x="120.36967" y="143.83646" style="fill:#cecece;fill-opacity:1;stroke:#000000;stroke-width:0.14462024;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"></rect>
    <rect style="fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:0.26511249;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" id="rect4874" width="34.206844" height="21.355652" x="36.663692" y="109.68093" ry="6.6145835"></rect>
    <rect style="fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:0.26511249;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" id="rect4874-5" width="34.206844" height="21.355654" x="82.682297" y="109.68093" ry="6.6145835"></rect>
    <rect style="fill:#ffffff;fill-opacity:1;stroke:#000000;stroke-width:0.26511249;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" id="rect4874-4" width="34.206844" height="21.355654" x="124.82664" y="109.68093" ry="6.6145835"></rect>
    <path style="fill:none;stroke:#000000;stroke-width:0.26458332;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-end:url(#Arrow1Lend)" d="m 53.861607,100.45238 v 9.07143" id="path4897" inkscape:connector-curvature="0"></path>
    <path style="fill:none;stroke:#000000;stroke-width:0.26458332;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-end:url(#Arrow1Lend-2)" d="m 100.35268,100.00656 v 9.07143" id="path4897-7" inkscape:connector-curvature="0"></path>
    <path style="fill:none;stroke:#000000;stroke-width:0.26458332;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-end:url(#Arrow1Lend-1)" d="m 141.17411,100.38454 v 9.07144" id="path4897-3" inkscape:connector-curvature="0"></path>
    <path style="fill:none;stroke:#000000;stroke-width:0.30833337;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;marker-end:url(#Arrow1Lend-0)" d="m 137.20536,131.26903 v 12.31946" id="path4897-4" inkscape:connector-curvature="0"></path>
    <path style="fill:none;stroke:#000000;stroke-width:0.26458332px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;marker-end:url(#marker5699)" d="m 52.727677,131.25744 v 7.18155 h 18.898811 v 5.29166" id="path5689" inkscape:connector-curvature="0"></path>
    <path style="fill:none;stroke:#000000;stroke-width:0.2711173px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 100.35268,130.50149 v 7.9375 H 71.626488" id="path5743" inkscape:connector-curvature="0"></path>
    <text xml:space="preserve" style="font-style:normal;font-weight:normal;font-size:10.58333302px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332" x="46.680061" y="85.333328" id="text5747"><tspan sodipodi:role="line" x="46.680061" y="85.333328" style="font-size:6.3499999px;stroke-width:0.26458332" id="tspan5749">Top-Level Acceleration Structure</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-weight:normal;font-size:10.58333302px;line-height:0.75;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332" x="55.942436" y="153.21938" id="text5747-1"><tspan sodipodi:role="line" x="55.942436" y="153.21938" style="font-size:4.93888903px;line-height:0px;stroke-width:0.26458332" id="tspan5749-5">Bottom-Level</tspan><tspan sodipodi:role="line" x="55.942436" y="161.15688" style="font-size:4.93888903px;line-height:0px;stroke-width:0.26458332" id="tspan5773">Acceleration</tspan><tspan sodipodi:role="line" x="55.942436" y="169.09438" style="font-size:4.93888903px;line-height:0px;stroke-width:0.26458332" id="tspan5777">Structure</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-weight:normal;font-size:10.58333302px;line-height:0.75;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332" x="120.77655" y="153.21938" id="text5747-1-2"><tspan sodipodi:role="line" x="120.77655" y="153.21938" style="font-size:4.93888903px;line-height:0px;stroke-width:0.26458332" id="tspan5749-5-0">Bottom-Level</tspan><tspan sodipodi:role="line" x="120.77655" y="161.15688" style="font-size:4.93888903px;line-height:0px;stroke-width:0.26458332" id="tspan5773-3">Acceleration</tspan><tspan sodipodi:role="line" x="120.77655" y="169.09438" style="font-size:4.93888903px;line-height:0px;stroke-width:0.26458332" id="tspan5777-3">Structure</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-weight:normal;font-size:4.23333311px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332" x="41.388393" y="117.02173" id="text5810"><tspan sodipodi:role="line" id="tspan5808" x="41.388393" y="117.02173" style="stroke-width:0.26458332">Transform</tspan><tspan sodipodi:role="line" x="41.388393" y="122.31339" style="stroke-width:0.26458332" id="tspan5812">and shading</tspan><tspan sodipodi:role="line" x="41.388393" y="127.60506" style="stroke-width:0.26458332" id="tspan5814">information</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-weight:normal;font-size:4.23333311px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332" x="87.024742" y="117.02173" id="text5810-7"><tspan sodipodi:role="line" id="tspan5808-6" x="87.024742" y="117.02173" style="stroke-width:0.26458332">Transform</tspan><tspan sodipodi:role="line" x="87.024742" y="122.31339" style="stroke-width:0.26458332" id="tspan5812-7">and shading</tspan><tspan sodipodi:role="line" x="87.024742" y="127.60506" style="stroke-width:0.26458332" id="tspan5814-8">information</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-weight:normal;font-size:4.23333311px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332" x="129.92503" y="117.02173" id="text5810-73"><tspan sodipodi:role="line" id="tspan5808-5" x="129.92503" y="117.02173" style="stroke-width:0.26458332">Transform</tspan><tspan sodipodi:role="line" x="129.92503" y="122.31339" style="stroke-width:0.26458332" id="tspan5812-1">and shading</tspan><tspan sodipodi:role="line" x="129.92503" y="127.60506" style="stroke-width:0.26458332" id="tspan5814-80">information</tspan></text>
  </g>
</svg>
</div>
<div class="title">Figure 27. Acceleration Structure</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Caption</div>
<div class="paragraph">
<p>The diagram shows the relationship between top and bottom level acceleration
structures.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="acceleration-structure-geometry"><a class="anchor" href="chap39.html#acceleration-structure-geometry"></a>39.1.1. Geometry</h4>
<div class="paragraph">
<p><em>Geometries</em> refer to a triangle,
sphere, linear swept sphere (LSS),
or axis-aligned bounding box.</p>
</div>
<div id="ray-tracing-triangle-primitive" class="paragraph">
<p>A triangle is a fundamental geometric primitive defined by three vertices in
3D space, forming a flat, planar surface.</p>
</div>
<div id="aabb-primitive" class="paragraph">
<p>An axis-aligned bounding box (AABB) is a rectangular box defined by two
points (minimum and maximum corners) that encloses a 3D object or scene.
Its faces are aligned with the coordinate axes, making intersection tests
efficient for spatial partitioning and acceleration structures.</p>
</div>
<div id="sphere-primitive" class="paragraph">
<p>A sphere primitive is defined by a position and a radius.</p>
</div>
<div id="linear-swept-sphere-primitive" class="paragraph">
<p>The linear swept sphere (LSS) primitive is comprised of two sphere endcaps
and a truncated cone midsection.
The midsection is constructed so that it tangentially intersects with the
endcaps.
Two points, <span class="eq">P<sub>0</sub></span> and <span class="eq">P<sub>1</sub></span>, and two radii, <span class="eq">r<sub>0</sub></span> and
<span class="eq">r<sub>1</sub></span>, fully describe the primitive.</p>
</div>
<div class="paragraph">
<p>The following figure shows an example of the LSS primitive composed of two
sphere endcaps connected by a midsection.
The solid non-dotted outline indicates the intersectable portion of the
primitive.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<svg width="12cm" height="9cm" viewBox="0 0 120 90" version="1.1" id="svg1" inkscape:version="1.3.2 (091e20e, 2023-11-25, custom)" sodipodi:docname="1.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview id="namedview1" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" inkscape:document-units="mm" inkscape:zoom="1.9830139" inkscape:cx="332.57457" inkscape:cy="135.39996" inkscape:window-width="1920" inkscape:window-height="1001" inkscape:window-x="-9" inkscape:window-y="-9" inkscape:window-maximized="1" inkscape:current-layer="layer1" showguides="true"></sodipodi:namedview>
  <defs id="defs1">
    <rect x="272.78512" y="36.727931" width="23.177821" height="20.325166" id="rect48"></rect>
    <linearGradient id="linearGradient39" inkscape:collect="always">
      <stop style="stop-color:#a3a3a3;stop-opacity:0.78402363;" offset="0" id="stop39"></stop>
      <stop style="stop-color:#a3a3a3;stop-opacity:0;" offset="1" id="stop40"></stop>
    </linearGradient>
    <rect x="55.62677" y="60.975498" width="149.4078" height="34.231858" id="rect38"></rect>
    <rect x="57.053097" y="54.200442" width="50.991206" height="23.177821" id="rect37"></rect>
    <linearGradient inkscape:collect="always" xlink:href="#linearGradient39" id="linearGradient40" x1="27.47444" y1="11.498958" x2="30.811357" y2="11.498958" gradientUnits="userSpaceOnUse"></linearGradient>
  </defs>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1">
    <path id="path26" style="fill:none;stroke:#0f0c0e;stroke-width:0.5" d="m 24.812897,56.418678 c -6.513205,10e-7 -11.793202,-5.195516 -11.793202,-11.604511 0,-6.408995 5.279997,-11.604512 11.793202,-11.604511" sodipodi:nodetypes="csc"></path>
    <path style="color:#000000;fill:none;-inkscape-stroke:none" d="m 87.363281,62.894531 c 10.868916,-10e-7 19.685549,-8.814678 19.685549,-19.683594 0,-10.868916 -8.816633,-19.685545 -19.685549,-19.685546 m 0,0.490234 c 10.603779,1e-6 19.195309,8.591533 19.195309,19.195312 0,10.603779 -8.59153,19.193359 -19.195309,19.19336 -10.603779,-10e-7 -19.193359,-8.58958 -19.193359,-19.19336 0,-10.603779 8.58958,-19.195311 19.193359,-19.195312 z" id="path27" sodipodi:nodetypes="cscsssss"></path>
    <ellipse style="fill:none;fill-opacity:1;stroke:#0f0c0e;stroke-width:0.5;stroke-dasharray:none;stroke-opacity:1" id="ellipse28" cx="65.256149" cy="-922.97943" rx="0.49999973" ry="5.517088e-13"></ellipse>
    <text xml:space="preserve" style="font-size:3.175px;fill:none;fill-opacity:1;stroke:#0f0c0e;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" x="22.831638" y="46.040661" id="text28"><tspan sodipodi:role="line" id="tspan28" style="stroke-width:0.5"></tspan></text>
    <path id="path30" style="fill:none;stroke:#212121;stroke-width:0.5;stroke-opacity:1;stroke-dasharray:1, 0.5;stroke-dashoffset:0" d="m 24.836847,33.233577 c 6.500163,0 11.769586,5.200801 11.769586,11.616314 0,6.415513 -5.269423,11.616314 -11.769586,11.616314" sodipodi:nodetypes="csc"></path>
    <path id="path26-3" style="fill:none;stroke:#0f0c0e;stroke-width:0.515221;stroke-dasharray:none" d="m 84.648915,62.507469 c 11.304323,2e-6 20.468285,-8.647693 20.468285,-19.315166 0,-10.667472 -9.163962,-19.315165 -20.468285,-19.315164" sodipodi:nodetypes="csc"></path>
    <path id="path30-8" style="fill:none;stroke:#1c1c1c;stroke-width:0.443551;stroke-dasharray:0.88710201, 0.443551;stroke-opacity:1;stroke-dashoffset:0" d="m 84.629387,23.930424 c -10.544454,0 -19.092428,8.629765 -19.092428,19.27512 0,10.645353 8.547974,19.275118 19.092428,19.275118" sodipodi:nodetypes="csc"></path>
    <path style="fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" d="m 24.817022,33.156075 59.707621,-9.33974" id="path31"></path>
    <path style="fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" d="m 24.683597,56.371997 59.841046,6.137545" id="path32"></path>
    <ellipse style="fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" id="path33" cx="24.199652" cy="44.460373" rx="0.28303683" ry="0.25945044"></ellipse>
    <ellipse style="fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" id="path34" cx="84.958229" cy="42.76215" rx="0.28303683" ry="0.25945044"></ellipse>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.52777px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" x="18.491741" y="18.114357" id="text34"><tspan sodipodi:role="line" id="tspan34" style="stroke-width:0.5"></tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#550000;fill-opacity:1;stroke:#414141;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="20.944727" y="46.795422" id="text38"><tspan sodipodi:role="line" id="tspan38" style="stroke-width:0.2"></tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:none;fill-opacity:0.78402364;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="26.8885" y="13.680114" id="text39"><tspan sodipodi:role="line" id="tspan39" style="stroke-width:0.2;fill:none;fill-opacity:0.78402364;stroke:none" x="26.8885" y="13.680114">H</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="87.458389" y="50.946632" id="text43"><tspan sodipodi:role="line" id="tspan43" style="stroke-width:0.2" x="87.458389" y="50.946632">1</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="85.005402" y="49.531448" id="text44"><tspan sodipodi:role="line" id="tspan44" style="font-size:6px;stroke-width:0.2" x="85.005402" y="49.531448">P</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="18.397394" y="48.871029" id="text45"><tspan sodipodi:role="line" id="tspan45" style="stroke-width:0.2" x="18.397394" y="48.871029">P</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="20.756033" y="51.040977" id="text46"><tspan sodipodi:role="line" id="tspan46" style="font-size:4px;stroke-width:0.2" x="20.756033" y="51.040977">0</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.03824px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.301912;stroke-dasharray:none;stroke-opacity:1" x="24.508297" y="45.922848" id="text47" transform="scale(1.1215466,0.89162591)"><tspan sodipodi:role="line" id="tspan47" style="stroke-width:0.301912" x="24.508297" y="45.922848">r</tspan></text>
    <text xml:space="preserve" transform="matrix(0.44795054,0,0,0.40188712,-43.666076,19.928265)" id="text48" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:15.1181px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;white-space:pre;shape-inside:url(#rect48);display:inline;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.755906;stroke-dasharray:none;stroke-opacity:1"><tspan x="272.78516" y="41.072404" id="tspan2">r</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.54732px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.354732;stroke-dasharray:none;stroke-opacity:1" x="26.566378" y="46.573872" id="text49" transform="scale(1.0926333,0.91522017)"><tspan sodipodi:role="line" id="tspan49" style="stroke-width:0.354732" x="26.566378" y="46.573872">0</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.92808px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.392808;stroke-dasharray:none;stroke-opacity:1" x="64.27961" y="47.437763" id="text50" transform="scale(1.2415022,0.80547583)"><tspan sodipodi:role="line" id="tspan50" style="stroke-width:0.392808" x="64.27961" y="47.437763">1</tspan></text>
    <path style="fill:#141414;fill-opacity:0.56382978;stroke:#414141;stroke-width:0.0927675;stroke-dasharray:none;stroke-opacity:1" d="M 24.003773,44.472418 25.055947,33.362713" id="path50"></path>
    <path style="fill:#cbcbcb;fill-opacity:0.64184397;stroke:#414141;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" d="M 84.824847,42.79602 84.557999,23.649554" id="path51"></path>
  </g>
</svg>
</div>
<div class="title">Figure 28. LSS primitive</div>
</div>
<div class="paragraph">
<p>Endcaps on LSS primitives are optional and are controlled by
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>endCapsMode</code>.
The following figure shows an example of the LSS primitive without the
endcaps with only the midsection present.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<svg width="12cm" height="9cm" viewBox="0 0 120 90" version="1.1" id="svg1" inkscape:version="1.3.2 (091e20e, 2023-11-25, custom)" sodipodi:docname="2.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview id="namedview1" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" inkscape:document-units="mm" inkscape:zoom="1.9830139" inkscape:cx="332.07029" inkscape:cy="135.90424" inkscape:window-width="1920" inkscape:window-height="1001" inkscape:window-x="-9" inkscape:window-y="-9" inkscape:window-maximized="1" inkscape:current-layer="layer1" showguides="true"></sodipodi:namedview>
  <defs id="defs1">
    <rect x="272.78512" y="36.727931" width="23.177821" height="20.325166" id="rect48"></rect>
    <linearGradient id="linearGradient39" inkscape:collect="always">
      <stop style="stop-color:#a3a3a3;stop-opacity:0.78402363;" offset="0" id="stop39"></stop>
      <stop style="stop-color:#a3a3a3;stop-opacity:0;" offset="1" id="stop40"></stop>
    </linearGradient>
    <rect x="55.62677" y="60.975498" width="149.4078" height="34.231858" id="rect38"></rect>
    <rect x="57.053097" y="54.200442" width="50.991206" height="23.177821" id="rect37"></rect>
    <linearGradient inkscape:collect="always" xlink:href="#linearGradient39" id="linearGradient40" x1="27.47444" y1="11.498958" x2="30.811357" y2="11.498958" gradientUnits="userSpaceOnUse"></linearGradient>
  </defs>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1">
    <path id="path26" style="fill:none;stroke:#0f0c0e;stroke-width:0.5;stroke-opacity:0.1264706;stroke-dasharray:2,0.5;stroke-dashoffset:0" d="m 24.812897,56.418678 c -6.513205,10e-7 -11.793202,-5.195516 -11.793202,-11.604511 0,-6.408995 5.279997,-11.604512 11.793202,-11.604511" sodipodi:nodetypes="csc"></path>
    <path style="color:#000000;fill:none;-inkscape-stroke:none" d="m 87.363281,62.894531 c 10.868916,-10e-7 19.685549,-8.814678 19.685549,-19.683594 0,-10.868916 -8.816633,-19.685545 -19.685549,-19.685546 m 0,0.490234 c 10.603779,1e-6 19.195309,8.591533 19.195309,19.195312 0,10.603779 -8.59153,19.193359 -19.195309,19.19336 -10.603779,-10e-7 -19.193359,-8.58958 -19.193359,-19.19336 0,-10.603779 8.58958,-19.195311 19.193359,-19.195312 z" id="path27" sodipodi:nodetypes="cscsssss"></path>
    <ellipse style="fill:none;fill-opacity:1;stroke:#0f0c0e;stroke-width:0.5;stroke-dasharray:none;stroke-opacity:1" id="ellipse28" cx="65.256149" cy="-922.97943" rx="0.49999973" ry="5.517088e-13"></ellipse>
    <text xml:space="preserve" style="font-size:3.175px;fill:none;fill-opacity:1;stroke:#0f0c0e;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" x="22.831638" y="46.040661" id="text28"><tspan sodipodi:role="line" id="tspan28" style="stroke-width:0.5"></tspan></text>
    <path id="path30" style="fill:none;stroke:#a4a4a4;stroke-width:0.5;stroke-opacity:0.30000001;stroke-dasharray:2,0.5;stroke-dashoffset:0" d="m 24.836847,33.233577 c 6.500163,0 11.769586,5.200801 11.769586,11.616314 0,6.415513 -5.269423,11.616314 -11.769586,11.616314" sodipodi:nodetypes="csc"></path>
    <path id="path26-3" style="fill:none;stroke:#0f0c0e;stroke-width:0.515221;stroke-dasharray:2.060884,0.515221;stroke-opacity:0.1;stroke-dashoffset:0" d="m 84.648915,62.507469 c 11.304323,2e-6 20.468285,-8.647693 20.468285,-19.315166 0,-10.667472 -9.163962,-19.315165 -20.468285,-19.315164" sodipodi:nodetypes="csc"></path>
    <path id="path30-8" style="fill:none;stroke:#a4a4a4;stroke-width:0.443551;stroke-dasharray:1.77420401,0.443551;stroke-opacity:0.33529413;stroke-dashoffset:0" d="m 84.629387,23.930424 c -10.544454,0 -19.092428,8.629765 -19.092428,19.27512 0,10.645353 8.547974,19.275118 19.092428,19.275118" sodipodi:nodetypes="csc"></path>
    <path style="fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" d="m 24.817022,33.156075 59.707621,-9.33974" id="path31"></path>
    <path style="fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" d="m 24.683597,56.371997 59.841046,6.137545" id="path32"></path>
    <ellipse style="fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" id="path33" cx="24.199652" cy="44.460373" rx="0.28303683" ry="0.25945044"></ellipse>
    <ellipse style="fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" id="path34" cx="84.958229" cy="42.76215" rx="0.28303683" ry="0.25945044"></ellipse>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.52777px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#550000;fill-opacity:1;stroke:#131313;stroke-width:0.499999;stroke-dasharray:none;stroke-opacity:1" x="18.491741" y="18.114357" id="text34"><tspan sodipodi:role="line" id="tspan34" style="stroke-width:0.5"></tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#550000;fill-opacity:1;stroke:#414141;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="20.944727" y="46.795422" id="text38"><tspan sodipodi:role="line" id="tspan38" style="stroke-width:0.2"></tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:none;fill-opacity:0.78402364;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="26.8885" y="13.680114" id="text39"><tspan sodipodi:role="line" id="tspan39" style="stroke-width:0.2;fill:none;fill-opacity:0.78402364;stroke:none" x="26.8885" y="13.680114">H</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="87.458389" y="50.946632" id="text43"><tspan sodipodi:role="line" id="tspan43" style="stroke-width:0.2" x="87.458389" y="50.946632">1</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="85.005402" y="49.531448" id="text44"><tspan sodipodi:role="line" id="tspan44" style="font-size:6px;stroke-width:0.2" x="85.005402" y="49.531448">P</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="18.397394" y="48.871029" id="text45"><tspan sodipodi:role="line" id="tspan45" style="stroke-width:0.2" x="18.397394" y="48.871029">P</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:4px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:1" x="20.756033" y="51.040977" id="text46"><tspan sodipodi:role="line" id="tspan46" style="font-size:4px;stroke-width:0.2" x="20.756033" y="51.040977">0</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:6.03824px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.301912;stroke-dasharray:none;stroke-opacity:1" x="24.508297" y="45.922848" id="text47" transform="scale(1.1215466,0.89162591)"><tspan sodipodi:role="line" id="tspan47" style="stroke-width:0.301912" x="24.508297" y="45.922848">r</tspan></text>
    <text xml:space="preserve" transform="matrix(0.44795054,0,0,0.40188712,-43.666076,19.928265)" id="text48" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:15.1181px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;white-space:pre;shape-inside:url(#rect48);display:inline;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.755906;stroke-dasharray:none;stroke-opacity:1"><tspan x="272.78516" y="41.072404" id="tspan2">r</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.54732px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.354732;stroke-dasharray:none;stroke-opacity:1" x="26.566378" y="46.573872" id="text49" transform="scale(1.0926333,0.91522017)"><tspan sodipodi:role="line" id="tspan49" style="stroke-width:0.354732" x="26.566378" y="46.573872">0</tspan></text>
    <text xml:space="preserve" style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.92808px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#141414;fill-opacity:0.784024;stroke:none;stroke-width:0.392808;stroke-dasharray:none;stroke-opacity:1" x="64.27961" y="47.437763" id="text50" transform="scale(1.2415022,0.80547583)"><tspan sodipodi:role="line" id="tspan50" style="stroke-width:0.392808" x="64.27961" y="47.437763">1</tspan></text>
    <path style="fill:#141414;fill-opacity:0.784024;stroke:#414141;stroke-width:0.0927675;stroke-dasharray:none;stroke-opacity:0.31470588" d="M 24.003773,44.472418 25.055947,33.362713" id="path50"></path>
    <path style="fill:#141414;fill-opacity:0.784024;stroke:#414141;stroke-width:0.2;stroke-dasharray:none;stroke-opacity:0.31176472" d="M 84.824847,42.79602 84.557999,23.649554" id="path51"></path>
  </g>
</svg>
</div>
<div class="title">Figure 29. LSS primitive with no endcaps</div>
</div>
<div class="paragraph">
<p>A LSS geometry can be defined in multiple ways.
If only the vertex and radius data are specified in
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a> without
specifying the index data, LSS primitives are drawn in pairs of vertices.
Each primitive <span class="eq">i</span> is defined by entries <span class="eq">(i × 2, i × 2
+  1)</span> in the vertex and radius buffers.
For example, if a vertex buffer contains vertices <span class="eq">A, B, C, D, E, F and
G</span>, (assuming each character represents a position vector) with
corresponding radii as <span class="eq">rA, rB, rC, rD, rE, rF and rG</span> respectively, the
LSS primitives drawn will be as shown below with <span class="eq">G</span> skipped because it
does not have a corresponding vertex pair.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<svg width="22cm" height="9cm" viewBox="0 0 220 90" version="1.1" id="svg1" inkscape:version="1.3.2 (091e20e, 2023-11-25, custom)" sodipodi:docname="3.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview id="namedview1" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" inkscape:document-units="mm" inkscape:zoom="1.4022026" inkscape:cx="442.51809" inkscape:cy="192.19762" inkscape:window-width="1920" inkscape:window-height="1001" inkscape:window-x="-9" inkscape:window-y="-9" inkscape:window-maximized="1" inkscape:current-layer="layer1" showguides="true"></sodipodi:namedview>
  <defs id="defs1">
    <rect x="34.231858" y="63.471571" width="153.3302" height="61.33208" id="rect5"></rect>
    <rect x="12.836947" y="9.984292" width="199.68584" height="69.890044" id="rect4"></rect>
    <rect x="173.29878" y="290.25763" width="148.33805" height="44.929314" id="rect2"></rect>
    <rect x="272.78513" y="36.727932" width="23.17782" height="20.325167" id="rect48"></rect>
    <linearGradient id="linearGradient39" inkscape:collect="always">
      <stop style="stop-color:#a3a3a3;stop-opacity:0.78402363;" offset="0" id="stop39"></stop>
      <stop style="stop-color:#a3a3a3;stop-opacity:0;" offset="1" id="stop40"></stop>
    </linearGradient>
    <rect x="55.62677" y="60.975498" width="149.40781" height="34.231857" id="rect38"></rect>
    <rect x="57.053097" y="54.200443" width="50.991207" height="23.17782" id="rect37"></rect>
    <linearGradient inkscape:collect="always" xlink:href="#linearGradient39" id="linearGradient40" x1="27.47444" y1="11.498958" x2="30.811357" y2="11.498958" gradientUnits="userSpaceOnUse"></linearGradient>
  </defs>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1">
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2" cx="24.341169" cy="67.928848" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2" cx="24.353992" cy="67.894821" rx="0.59751034" ry="0.5975104"></ellipse>
    <text xml:space="preserve" style="font-size:6px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="17.359594" y="72.268745" id="text2"><tspan sodipodi:role="line" id="tspan2" style="font-size:6px;stroke-width:0.1" x="17.359594" y="72.268745">A</tspan></text>
    <text xml:space="preserve" style="font-size:4px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="29.201971" y="67.173744" id="text3"><tspan sodipodi:role="line" id="tspan3" style="font-size:4px;stroke-width:0.1" x="29.201971" y="67.173744">rA</tspan></text>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.60000001,0.60000001;stroke-dashoffset:0;stroke-opacity:1" d="m 24.350035,67.846534 9.406451,-7.138228" id="path3"></path>
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3" cx="115.57199" cy="28.025829" rx="14.53855" ry="13.68944"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00585379;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8" cx="115.58755" cy="27.987011" rx="0.72391117" ry="0.68163186"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:0.70538, 0.70538;stroke-dashoffset:0;stroke-opacity:1" d="m 115.58272,27.931924 11.39636,-8.143195" id="path3-1"></path>
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-9" cx="172.75166" cy="69.154282" rx="14.53855" ry="13.68944"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00585379;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-69" cx="172.76721" cy="69.115463" rx="0.72391117" ry="0.68163186"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:0.70538, 0.70538;stroke-dashoffset:0;stroke-opacity:1" d="m 172.7624,69.060378 11.39636,-8.143195" id="path3-1-3"></path>
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-8" cx="137.96722" cy="54.516911" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-6" cx="137.98006" cy="54.482883" rx="0.59751034" ry="0.5975104"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.6, 0.6;stroke-dashoffset:0;stroke-opacity:1" d="m 137.97608,54.434598 9.40646,-7.138228" id="path3-1-8"></path>
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-4" cx="81.439903" cy="20.244766" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-4" cx="81.452736" cy="20.210739" rx="0.59751034" ry="0.5975104"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.6, 0.6;stroke-dashoffset:0;stroke-opacity:1" d="m 81.448766,20.162451 9.40646,-7.138228" id="path3-1-98"></path>
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.119934;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-6" cx="52.61047" cy="49.747684" rx="14.726056" ry="14.065637"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00597182;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-2" cx="52.626209" cy="49.707802" rx="0.73324758" ry="0.7003637"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.119934;stroke-linejoin:bevel;stroke-dasharray:0.719603, 0.719603;stroke-dashoffset:0;stroke-opacity:1" d="M 52.621339,49.651197 64.164677,41.28422" id="path3-1-9"></path>
    <text xml:space="preserve" transform="scale(0.26458333)" id="text4" style="font-size:15.1181px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;white-space:pre;shape-inside:url(#rect4);display:inline;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.377953;stroke-linejoin:bevel;stroke-dasharray:2.26772, 2.26772;stroke-dashoffset:0;stroke-opacity:1"></text>
    <text xml:space="preserve" transform="matrix(0.16168929,0,0,0.198195,50.4688,30.190136)" id="text5" style="font-size:22.6772px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;white-space:pre;shape-inside:url(#rect5);display:inline;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.377953;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"><tspan x="34.232422" y="69.98655" id="tspan1">rB</tspan></text>
    <text xml:space="preserve" style="font-size:3.64232px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0607053;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="91.160934" y="14.302722" id="text6" transform="scale(0.90798546,1.1013392)"><tspan sodipodi:role="line" id="tspan6" style="stroke-width:0.0607053" x="91.160934" y="14.302722">rC</tspan></text>
    <text xml:space="preserve" style="font-size:3.54672px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.059112;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="128.50058" y="25.517927" id="text7" transform="scale(0.95145746,1.0510191)"><tspan sodipodi:role="line" id="tspan7" style="stroke-width:0.059112" x="128.50058" y="25.517927">rD</tspan></text>
    <text xml:space="preserve" style="font-size:3.43481px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0572468;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="144.92928" y="54.073837" id="text8" transform="scale(0.98965656,1.0104515)"><tspan sodipodi:role="line" id="tspan8" style="stroke-width:0.0572468" x="144.92928" y="54.073837">rE</tspan></text>
    <text xml:space="preserve" style="font-size:4.19962px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0699936;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="190.77682" y="64.340256" id="text9" transform="scale(0.93655823,1.0677393)"><tspan sodipodi:role="line" id="tspan9" style="stroke-width:0.0699936" x="190.77682" y="64.340256">rF</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="47.361488" y="58.116901" id="text11"><tspan sodipodi:role="line" id="tspan11" style="stroke-width:0.1" x="47.361488" y="58.116901">B</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="77.552101" y="27.926302" id="text12"><tspan sodipodi:role="line" id="tspan12" style="stroke-width:0.1" x="77.552101" y="27.926302">C</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="114.1582" y="37.360863" id="text13"><tspan sodipodi:role="line" id="tspan13" style="stroke-width:0.1" x="114.1582" y="37.360863">D</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="130.38564" y="58.305592" id="text14"><tspan sodipodi:role="line" id="tspan14" style="stroke-width:0.1" x="130.38564" y="58.305592">E</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="165.48222" y="76.608643" id="text15"><tspan sodipodi:role="line" id="tspan15" style="stroke-width:0.1" x="165.48222" y="76.608643">F</tspan></text>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.118338;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 17.422969,58.121238 26.297173,-19.583852 -0.144976,0.0957" id="path16"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.092601;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="M 29.973338,78.472649 60.750273,61.467188" id="path17"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.106287;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 79.378733,32.066423 33.044057,9.323832" id="path18"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0987962;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="M 82.340563,8.2438004 118.79006,14.676204" id="path19"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.111913;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 133.06748,65.471018 33.54574,16.092659" id="path20"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0950104;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 141.88867,43.175737 36.90374,13.526716" id="path21"></path>
  </g>
</svg>
</div>
<div class="title">Figure 30. Lss primitives drawn with only vertex data</div>
</div>
<div class="paragraph">
<p>LSS primitives <strong class="purple">can</strong> be chained together by specifying an index buffer and
indexing mode in the
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a> structure.</p>
</div>
<div class="paragraph">
<p>If the <a href="chap39.html#VkRayTracingLssIndexingModeNV">VkRayTracingLssIndexingModeNV</a>::<code>indexingMode</code> is set to
<code>VK_RAY_TRACING_LSS_INDEXING_MODE_LIST_NV</code>, then the consecutive pair of
indices in the index buffer select the vertices that define the LSS chain.
For example, assuming the same vertex buffer as before, if the index buffer
contains indices <span class="eq">[6, 5, 5, 4, 4, 3, 2, 1]</span>, the LSS primitives will be
chained as shown:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<svg width="22cm" height="9cm" viewBox="0 0 220 90" version="1.1" id="svg1" inkscape:version="1.3.2 (091e20e, 2023-11-25, custom)" sodipodi:docname="4.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview id="namedview1" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" inkscape:document-units="mm" inkscape:zoom="0.99150697" inkscape:cx="453.35032" inkscape:cy="34.795519" inkscape:window-width="1920" inkscape:window-height="1001" inkscape:window-x="-9" inkscape:window-y="-9" inkscape:window-maximized="1" inkscape:current-layer="layer1" showguides="true"></sodipodi:namedview>
  <defs id="defs1">
    <rect x="34.231858" y="63.471571" width="153.3302" height="61.33208" id="rect5"></rect>
    <rect x="12.836947" y="9.984292" width="199.68584" height="69.890044" id="rect4"></rect>
    <rect x="173.29878" y="290.25763" width="148.33805" height="44.929314" id="rect2"></rect>
    <rect x="272.78513" y="36.727932" width="23.17782" height="20.325167" id="rect48"></rect>
    <linearGradient id="linearGradient39" inkscape:collect="always">
      <stop style="stop-color:#a3a3a3;stop-opacity:0.78402363;" offset="0" id="stop39"></stop>
      <stop style="stop-color:#a3a3a3;stop-opacity:0;" offset="1" id="stop40"></stop>
    </linearGradient>
    <rect x="55.62677" y="60.975498" width="149.40781" height="34.231857" id="rect38"></rect>
    <rect x="57.053097" y="54.200443" width="50.991207" height="23.17782" id="rect37"></rect>
    <linearGradient inkscape:collect="always" xlink:href="#linearGradient39" id="linearGradient40" x1="27.47444" y1="11.498958" x2="30.811357" y2="11.498958" gradientUnits="userSpaceOnUse"></linearGradient>
  </defs>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1">
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3" cx="101.2845" cy="28.025829" rx="14.53855" ry="13.68944"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00585379;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8" cx="101.30006" cy="27.987011" rx="0.72391117" ry="0.68163186"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:0.70538, 0.70538;stroke-dashoffset:0;stroke-opacity:1" d="m 101.29513,27.931924 11.39636,-8.143195" id="path3-1"></path>
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-9" cx="158.46436" cy="69.154282" rx="14.53855" ry="13.68944"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00585379;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-69" cx="158.4799" cy="69.115463" rx="0.72391117" ry="0.68163186"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:0.70538, 0.70538;stroke-dashoffset:0;stroke-opacity:1" d="m 158.47481,69.060378 11.39636,-8.143195" id="path3-1-3"></path>
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-8" cx="123.67986" cy="54.516911" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-6" cx="123.69267" cy="54.482883" rx="0.59751034" ry="0.5975104"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.6, 0.6;stroke-dashoffset:0;stroke-opacity:1" d="m 123.68849,54.434598 9.40646,-7.138228" id="path3-1-8"></path>
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-4" cx="67.15239" cy="20.244766" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-4" cx="67.165222" cy="20.210739" rx="0.59751034" ry="0.5975104"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.6, 0.6;stroke-dashoffset:0;stroke-opacity:1" d="m 67.161257,20.162451 9.40646,-7.138228" id="path3-1-98"></path>
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-4-3" cx="201.02393" cy="58.788746" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-4-1" cx="201.03676" cy="58.754719" rx="0.59751034" ry="0.5975104"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.6, 0.6;stroke-dashoffset:0;stroke-opacity:1" d="m 201.0328,58.706426 9.40646,-7.138228" id="path3-1-98-0"></path>
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.119934;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-6" cx="38.322956" cy="49.747684" rx="14.726056" ry="14.065637"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00597182;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-2" cx="38.338696" cy="49.707802" rx="0.73324758" ry="0.7003637"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.119934;stroke-linejoin:bevel;stroke-dasharray:0.719603, 0.719603;stroke-dashoffset:0;stroke-opacity:1" d="M 38.33383,49.651197 49.877168,41.28422" id="path3-1-9"></path>
    <text xml:space="preserve" transform="scale(0.26458333)" id="text4" style="font-size:15.1181px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;white-space:pre;shape-inside:url(#rect4);display:inline;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.377953;stroke-linejoin:bevel;stroke-dasharray:2.26772, 2.26772;stroke-dashoffset:0;stroke-opacity:1"></text>
    <text xml:space="preserve" transform="matrix(0.16168929,0,0,0.198195,36.181291,30.190136)" id="text5" style="font-size:22.6772px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;white-space:pre;shape-inside:url(#rect5);display:inline;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.377953;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"><tspan x="34.232422" y="69.98655" id="tspan2">rB</tspan></text>
    <text xml:space="preserve" style="font-size:3.64232px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0607053;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="75.425491" y="14.302722" id="text6" transform="scale(0.90798547,1.1013392)"><tspan sodipodi:role="line" id="tspan6" style="stroke-width:0.0607053" x="75.425491" y="14.302722">rC</tspan></text>
    <text xml:space="preserve" style="font-size:3.54672px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.059112;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="113.48415" y="25.517927" id="text7" transform="scale(0.95145749,1.0510191)"><tspan sodipodi:role="line" id="tspan7" style="stroke-width:0.059112" x="113.48415" y="25.517927">rD</tspan></text>
    <text xml:space="preserve" style="font-size:3.43481px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0572468;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="130.49242" y="54.073837" id="text8" transform="scale(0.9896566,1.0104515)"><tspan sodipodi:role="line" id="tspan8" style="stroke-width:0.0572468" x="130.49242" y="54.073837">rE</tspan></text>
    <text xml:space="preserve" style="font-size:4.19962px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0699936;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="175.52136" y="64.340256" id="text9" transform="scale(0.93655821,1.0677393)"><tspan sodipodi:role="line" id="tspan9" style="stroke-width:0.0699936" x="175.52136" y="64.340256">rF</tspan></text>
    <text xml:space="preserve" style="font-size:3.65185px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0608641;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="212.65161" y="57.94994" id="text10" transform="scale(0.97071037,1.0301734)"><tspan sodipodi:role="line" id="tspan10" style="stroke-width:0.0608641" x="212.65161" y="57.94994">rG</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="33.073975" y="58.116901" id="text11"><tspan sodipodi:role="line" id="tspan11" style="stroke-width:0.1" x="33.073975" y="58.116901">B</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="63.264587" y="27.926302" id="text12"><tspan sodipodi:role="line" id="tspan12" style="stroke-width:0.1" x="63.264587" y="27.926302">C</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="99.87072" y="37.360863" id="text13"><tspan sodipodi:role="line" id="tspan13" style="stroke-width:0.1" x="99.87072" y="37.360863">D</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="116.09821" y="58.305592" id="text14"><tspan sodipodi:role="line" id="tspan14" style="stroke-width:0.1" x="116.09821" y="58.305592">E</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="151.19492" y="76.608643" id="text15"><tspan sodipodi:role="line" id="tspan15" style="stroke-width:0.1" x="151.19492" y="76.608643">F</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="194.31505" y="65.119263" id="text16"><tspan sodipodi:role="line" id="tspan16" style="stroke-width:0.1" x="194.31505" y="65.119263">G</tspan></text>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.108096;stroke-linejoin:bevel;stroke-dasharray:none" d="M 29.519735,38.472022 58.695706,11.730984" id="path1"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.0854893;stroke-linejoin:bevel;stroke-dasharray:none" d="M 50.115264,58.172448 75.405157,28.734187" id="path2"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none" d="M 90.178989,36.860644 115.29597,63.102381" id="path3"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.0975131;stroke-linejoin:bevel;stroke-dasharray:none" d="M 132.65551,46.552124 113.31512,20.340475" id="path4"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.112489;stroke-linejoin:bevel;stroke-dasharray:none" d="m 118.72133,65.444533 32.6332,15.64673" id="path5"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.103227;stroke-linejoin:bevel;stroke-dasharray:none" d="m 164.358,56.640106 -36.26061,-13.2805" id="path6" sodipodi:nodetypes="cc"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.0653798;stroke-linejoin:bevel;stroke-dasharray:none" d="m 163.19769,82.097887 41.62855,-11.92747" id="path7" sodipodi:nodetypes="cc"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.0825063;stroke-linejoin:bevel;stroke-dasharray:none" d="m 155.16234,55.822595 44.39948,-8.944443" id="path8" sodipodi:nodetypes="cc"></path>
  </g>
</svg>
</div>
<div class="title">Figure 31. Lss primitives drawn with VK_RAY_TRACING_LSS_INDEXING_MODE_LIST_NV indexing mode</div>
</div>
<div class="paragraph">
<p>Note that due to the lack of a <span class="eq">[3, 2]</span> pair, there is a break in the
chain and <span class="eq">D</span> is not connected to <span class="eq">C</span>.</p>
</div>
<div class="paragraph">
<p>If the <a href="chap39.html#VkRayTracingLssIndexingModeNV">VkRayTracingLssIndexingModeNV</a>::<code>indexingMode</code> is set to
<code>VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</code>, then each LSS
primitive is defined by two successive positions and radii, <span class="eq">(k, k<br>
1)</span>, where <span class="eq">k</span> is a single index in the index buffer.
For example, if the index buffer contains indices <span class="eq">[0, 1, 2, 4]</span>, the
LSS primitives will be chained as shown below.
Note that due to the absence of index 3 in the index buffer, there is a
break in the chain and D is not connected to E.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<svg width="22cm" height="9cm" viewBox="0 0 220 90" version="1.1" id="svg1" inkscape:version="1.3.2 (091e20e, 2023-11-25, custom)" sodipodi:docname="5.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview id="namedview1" pagecolor="#ffffff" bordercolor="#000000" borderopacity="0.25" inkscape:showpageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:deskcolor="#d1d1d1" inkscape:document-units="mm" inkscape:zoom="0.7011013" inkscape:cx="226.07289" inkscape:cy="340.17909" inkscape:window-width="1920" inkscape:window-height="1001" inkscape:window-x="-9" inkscape:window-y="-9" inkscape:window-maximized="1" inkscape:current-layer="layer1" showguides="true"></sodipodi:namedview>
  <defs id="defs1">
    <rect x="34.231858" y="63.471571" width="153.3302" height="61.33208" id="rect5"></rect>
    <rect x="12.836947" y="9.984292" width="199.68584" height="69.890044" id="rect4"></rect>
    <rect x="173.29878" y="290.25763" width="148.33805" height="44.929314" id="rect2"></rect>
    <rect x="272.78513" y="36.727932" width="23.17782" height="20.325167" id="rect48"></rect>
    <linearGradient id="linearGradient39" inkscape:collect="always">
      <stop style="stop-color:#a3a3a3;stop-opacity:0.78402363;" offset="0" id="stop39"></stop>
      <stop style="stop-color:#a3a3a3;stop-opacity:0;" offset="1" id="stop40"></stop>
    </linearGradient>
    <rect x="55.62677" y="60.975498" width="149.40781" height="34.231857" id="rect38"></rect>
    <rect x="57.053097" y="54.200443" width="50.991207" height="23.17782" id="rect37"></rect>
    <linearGradient inkscape:collect="always" xlink:href="#linearGradient39" id="linearGradient40" x1="27.47444" y1="11.498958" x2="30.811357" y2="11.498958" gradientUnits="userSpaceOnUse"></linearGradient>
  </defs>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1">
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2" cx="24.341169" cy="67.928848" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2" cx="24.353992" cy="67.894821" rx="0.59751034" ry="0.5975104"></ellipse>
    <text xml:space="preserve" style="font-size:6px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="17.359594" y="72.268745" id="text2"><tspan sodipodi:role="line" id="tspan2" style="font-size:6px;stroke-width:0.1" x="17.359594" y="72.268745">A</tspan></text>
    <text xml:space="preserve" style="font-size:4px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="29.201971" y="67.173744" id="text3"><tspan sodipodi:role="line" id="tspan3" style="font-size:4px;stroke-width:0.1" x="29.201971" y="67.173744">rA</tspan></text>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.60000001,0.60000001;stroke-dashoffset:0;stroke-opacity:1" d="m 24.350035,67.846534 9.406451,-7.138228" id="path3"></path>
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3" cx="115.57199" cy="28.025829" rx="14.53855" ry="13.68944"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00585379;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8" cx="115.58755" cy="27.987011" rx="0.72391117" ry="0.68163186"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:0.70538, 0.70538;stroke-dashoffset:0;stroke-opacity:1" d="m 115.58272,27.931924 11.39636,-8.143195" id="path3-1"></path>
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-9" cx="172.75166" cy="69.154282" rx="14.53855" ry="13.68944"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00585379;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-69" cx="172.76721" cy="69.115463" rx="0.72391117" ry="0.68163186"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.117563;stroke-linejoin:bevel;stroke-dasharray:0.70538, 0.70538;stroke-dashoffset:0;stroke-opacity:1" d="m 172.7624,69.060378 11.39636,-8.143195" id="path3-1-3"></path>
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-8" cx="137.96722" cy="54.516911" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-6" cx="137.98006" cy="54.482883" rx="0.59751034" ry="0.5975104"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.6, 0.6;stroke-dashoffset:0;stroke-opacity:1" d="m 137.97608,54.434598 9.40646,-7.138228" id="path3-1-8"></path>
    <circle style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-4" cx="81.439903" cy="20.244766" r="12"></circle>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00497926;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-4" cx="81.452736" cy="20.210739" rx="0.59751034" ry="0.5975104"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:0.6, 0.6;stroke-dashoffset:0;stroke-opacity:1" d="m 81.448766,20.162451 9.40646,-7.138228" id="path3-1-98"></path>
    <ellipse style="fill:none;fill-opacity:0.641844;stroke:#242424;stroke-width:0.119934;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="path2-3-6" cx="52.61047" cy="49.747684" rx="14.726056" ry="14.065637"></ellipse>
    <ellipse style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.00597182;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" id="circle2-8-2" cx="52.626209" cy="49.707802" rx="0.73324758" ry="0.7003637"></ellipse>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.119934;stroke-linejoin:bevel;stroke-dasharray:0.719603, 0.719603;stroke-dashoffset:0;stroke-opacity:1" d="M 52.621339,49.651197 64.164677,41.28422" id="path3-1-9"></path>
    <text xml:space="preserve" transform="scale(0.26458333)" id="text4" style="font-size:15.1181px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;white-space:pre;shape-inside:url(#rect4);display:inline;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.377953;stroke-linejoin:bevel;stroke-dasharray:2.26772, 2.26772;stroke-dashoffset:0;stroke-opacity:1"></text>
    <text xml:space="preserve" transform="matrix(0.16168929,0,0,0.198195,50.4688,30.190136)" id="text5" style="font-size:22.6772px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;white-space:pre;shape-inside:url(#rect5);display:inline;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.377953;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"><tspan x="34.232422" y="69.98655" id="tspan4">rB</tspan></text>
    <text xml:space="preserve" style="font-size:3.64232px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0607053;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="91.160934" y="14.302722" id="text6" transform="scale(0.90798546,1.1013392)"><tspan sodipodi:role="line" id="tspan6" style="stroke-width:0.0607053" x="91.160934" y="14.302722">rC</tspan></text>
    <text xml:space="preserve" style="font-size:3.54672px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.059112;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="128.50058" y="25.517927" id="text7" transform="scale(0.95145746,1.0510191)"><tspan sodipodi:role="line" id="tspan7" style="stroke-width:0.059112" x="128.50058" y="25.517927">rD</tspan></text>
    <text xml:space="preserve" style="font-size:3.43481px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0572468;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="144.92928" y="54.073837" id="text8" transform="scale(0.98965656,1.0104515)"><tspan sodipodi:role="line" id="tspan8" style="stroke-width:0.0572468" x="144.92928" y="54.073837">rE</tspan></text>
    <text xml:space="preserve" style="font-size:4.19962px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0699936;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="190.77682" y="64.340256" id="text9" transform="scale(0.93655823,1.0677393)"><tspan sodipodi:role="line" id="tspan9" style="stroke-width:0.0699936" x="190.77682" y="64.340256">rF</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="47.361488" y="58.116901" id="text11"><tspan sodipodi:role="line" id="tspan11" style="stroke-width:0.1" x="47.361488" y="58.116901">B</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="77.552101" y="27.926302" id="text12"><tspan sodipodi:role="line" id="tspan12" style="stroke-width:0.1" x="77.552101" y="27.926302">C</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="114.1582" y="37.360863" id="text13"><tspan sodipodi:role="line" id="tspan13" style="stroke-width:0.1" x="114.1582" y="37.360863">D</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="130.38564" y="58.305592" id="text14"><tspan sodipodi:role="line" id="tspan14" style="stroke-width:0.1" x="130.38564" y="58.305592">E</tspan></text>
    <text xml:space="preserve" style="font-size:6.00001px;line-height:0px;font-family:sans-serif;-inkscape-font-specification:sans-serif;fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.1;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" x="165.48222" y="76.608643" id="text15"><tspan sodipodi:role="line" id="tspan15" style="stroke-width:0.1" x="165.48222" y="76.608643">F</tspan></text>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.118338;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 17.422969,58.121238 26.297173,-19.583852 -0.144976,0.0957" id="path16"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.092601;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="M 29.973338,78.472649 60.750273,61.467188" id="path17"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.106287;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 79.378733,32.066423 33.044057,9.323832" id="path18"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0987962;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="M 82.340563,8.2438004 118.79006,14.676204" id="path19"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.111913;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 133.06748,65.471018 33.54574,16.092659" id="path20"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#242424;stroke-width:0.0950104;stroke-linejoin:bevel;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" d="m 141.88867,43.175737 36.90374,13.526716" id="path21"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.110674;stroke-linejoin:bevel" d="m 42.958031,39.10494 31.000132,-28.242263 -0.0635,0.04959" id="path1"></path>
    <path style="fill:#0f0f0f;fill-opacity:0.641844;stroke:#1c1c1c;stroke-width:0.0948145;stroke-linejoin:bevel" d="M 63.655889,59.050278 90.51456,28.088149" id="path4"></path>
  </g>
</svg>
</div>
<div class="title">Figure 32. Lss primitives drawn with VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV indexing mode</div>
</div>
</div>
<div class="sect3">
<h4 id="acceleration-structure-top-level"><a class="anchor" href="chap39.html#acceleration-structure-top-level"></a>39.1.2. Top Level Acceleration Structures</h4>
<div class="paragraph">
<p>Opaque acceleration structure for an array of instances.
The descriptor or device address referencing this is the starting point for
traversal.</p>
</div>
<div class="paragraph">
<p>The top level acceleration structure takes a reference to any bottom level
acceleration structure referenced by its instances.
Those bottom level acceleration structure objects <strong class="purple">must</strong> be valid when the
top level acceleration structure is accessed.</p>
</div>
</div>
<div class="sect3">
<h4 id="acceleration-structure-bottom-level"><a class="anchor" href="chap39.html#acceleration-structure-bottom-level"></a>39.1.3. Bottom Level Acceleration Structures</h4>
<div class="paragraph">
<p>Opaque acceleration structure for an array of geometries.</p>
</div>
</div>
<div class="sect3">
<h4 id="acceleration-structure-update"><a class="anchor" href="chap39.html#acceleration-structure-update"></a>39.1.4. Acceleration Structure Update Rules</h4>
<div class="paragraph">
<p>The API defines two types of operations to produce acceleration structures
from geometry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>build</em> operation is used to construct an acceleration structure.</p>
</li>
<li>
<p>An <em>update</em> operation is used to modify an existing acceleration
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An update operation imposes certain constraints on the input, in exchange
for considerably faster execution.
When performing an update, the application is required to provide a full
description of the acceleration structure, but is prohibited from changing
anything other than instance definitions, transform matrices, and vertex or
AABB positions.
All other aspects of the description <strong class="purple">must</strong> exactly match the one from the
original build.</p>
</div>
<div class="paragraph">
<p>More precisely, the application <strong class="purple">must</strong> not use an update operation to do any
of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change primitives or instances from <em>active</em> to <em>inactive</em>, or vice
versa (as defined in <a href="chap39.html#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a>).</p>
</li>
<li>
<p>Change the index or vertex formats of triangle geometry.</p>
</li>
<li>
<p>Change triangle geometry transform pointers from null to non-null or
vice versa.</p>
</li>
<li>
<p>Change the number of geometries or instances in the structure.</p>
</li>
<li>
<p>Change the geometry flags for any geometry in the structure.</p>
</li>
<li>
<p>Change the number of vertices or primitives for any geometry in the
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_DATA_UPDATE_BIT_EXT</code>
was set in <code>flags</code>, the application <strong class="purple">must</strong> provide a micromap matching
the original micromap in structure with only opacity values updated.
The application is prohibited from changing anything other than the specific
opacity values assigned to the triangles.</p>
</div>
<div class="paragraph">
<p>More precisely, the application <strong class="purple">must</strong> not use an update operation to do any
of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove micromaps or <a href="chap39.html#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> values from a
geometry which previously had them, or vice versa.</p>
</li>
<li>
<p>Change between use of <a href="chap39.html#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> values and
explicit micro-map triangles.</p>
</li>
<li>
<p>Change the subdivision level or format of the micromap triangle
associated with any acceleration-structure triangle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_UPDATE_BIT_EXT</code>
was set in <code>flags</code>, the application <strong class="purple">must</strong> provide a micromap to the
update operation.</p>
</div>
<div class="paragraph">
<p>If <a href="chap12.html#VkMicromapBuildSizesInfoEXT">VkMicromapBuildSizesInfoEXT</a>::<code>discardable</code> is <code>VK_FALSE</code>, a
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_DATA_UPDATE_BIT_EXT</code>
or
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_UPDATE_BIT_EXT</code>
operation transfers the reference in the acceleration structure to the new
micromap.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using opacity micromaps and
neither opacity micromap update flag is set, the application <strong class="purple">must</strong> provide
the original micromap to the update operation.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using displacement
micromaps and
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_DISPLACEMENT_MICROMAP_UPDATE_BIT_NV</code>
was set in <code>flags</code>, the application <strong class="purple">must</strong> provide a displacement
micromap to the update operation.</p>
</div>
<div class="paragraph">
<p>If the original acceleration structure was built using displacement
micromaps and the displacement micromap update flag is not set the
application <strong class="purple">must</strong> provide the original micromap to the update operation.</p>
</div>
</div>
<div class="sect3">
<h4 id="acceleration-structure-inactive-prims"><a class="anchor" href="chap39.html#acceleration-structure-inactive-prims"></a>39.1.5. Inactive Primitives and Instances</h4>
<div class="paragraph">
<p>Acceleration structures allow the use of particular input values to signal
<em>inactive</em> primitives or instances.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> triangle is one for which the first (X) component of any
vertex is NaN.
If any other vertex component is NaN, and the first is not, the behavior is
undefined.
If the vertex format does not have a NaN representation, then all triangles
are considered active.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> instance is one whose acceleration structure reference is <code>0</code>.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> AABB is one for which the minimum X coordinate is NaN.
If any other component is NaN, and the first is not, the behavior is
undefined.</p>
</div>
<div class="paragraph">
<p>An <em>inactive</em> LSS or sphere is one where any of the radius or position
component is NaN.</p>
</div>
<div class="paragraph">
<p>In the above definitions, “NaN” refers to any type of NaN.
Signaling, non-signaling, quiet, loud, or otherwise.</p>
</div>
<div class="paragraph">
<p>An inactive object is considered invisible to all rays, and <strong class="purple">should</strong> not be
represented in the acceleration structure.
Implementations <strong class="purple">should</strong> ensure that the presence of inactive objects does
not seriously degrade traversal performance.</p>
</div>
<div class="paragraph">
<p>Inactive objects are counted in the auto-generated index sequences which are
provided to shaders via <code>InstanceId</code> and <code>PrimitiveId</code> SPIR-V
decorations.
This allows objects in the scene to change freely between the active and
inactive states, without affecting the layout of any arrays which are being
indexed using the ID values.</p>
</div>
<div class="paragraph">
<p>Any transition between the active and inactive states requires a full
acceleration structure rebuild.
Applications <strong class="purple">must</strong> not perform an acceleration structure update where an
object is active in the source acceleration structure but would be inactive
in the destination, or vice versa.</p>
</div>
<div class="paragraph">
<p>The active/inactive state of primitives <strong class="purple">must</strong> not be changed with
acceleration structure updates.
For chained LSS, using the
<code>VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_CHAINED_NV</code> mode, entire
chains <strong class="purple">must</strong> be either active or inactive.
If any chain contains both active and inactive primitives, the behavior is
undefined.</p>
</div>
</div>
<div class="sect3">
<h4 id="acceleration-structure-degenerate-prims"><a class="anchor" href="chap39.html#acceleration-structure-degenerate-prims"></a>39.1.6. Degenerate Primitives and Instances</h4>
<div class="paragraph">
<p><em>Degenerate</em> primitives and instances behave differently to
<a href="chap39.html#acceleration-structure-inactive-prims">inactive primitives and instances</a>,
and are defined as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>triangles that have one or more vertices whose respective (X), (Y), (Z)
components are identical, or have three vertices that have at least two
of the (X), (Y), or (Z) components identical, therefore forming a line
or point.
Degenerate triangles do not generate any intersections.</p>
</li>
<li>
<p>AABBs whose <code>minX</code>=<code>maxX</code>, <code>minY</code>=<code>maxY</code>, and
<code>minZ</code>=<code>maxZ</code>.
Degenerate AABBs <strong class="purple">may</strong> invoke the intersection shader.</p>
</li>
<li>
<p>LSS primitives where both the radii are set to <code>0</code>.</p>
</li>
<li>
<p>sphere primitives whose radius is set to <code>0</code>.</p>
</li>
<li>
<p>instances that reference bottom level acceleration structures that
contain no active primitives.
When building an acceleration structure, implementations <strong class="purple">should</strong> treat
degenerate instances as though they are a point at the instance origin,
specified by <a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>transform</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike <em>inactive</em> primitives and instances, <em>degenerate</em> primitives and
instances <strong class="purple">may</strong> transition from the degenerate to the non-degenerate state,
or vice versa, when performing an acceleration structure update.</p>
</div>
<div class="paragraph">
<p>If an acceleration structure is built without
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a>::<code>flags</code>
or
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code>
, degenerate primitives <strong class="purple">may</strong> be discarded.
Primitives that are defined with the same index value for more than one
vertex <strong class="purple">can</strong> always be discarded.</p>
</div>
</div>
<div class="sect3">
<h4 id="acceleration-structure-building"><a class="anchor" href="chap39.html#acceleration-structure-building"></a>39.1.7. Building Acceleration Structures</h4>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures call:</p>
</div>
<div id="vkCmdBuildAccelerationStructuresKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkCmdBuildAccelerationStructuresKHR</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="kt">uint32_t</span>                                    <span class="n">infoCount</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureBuildGeometryInfoKHR</span><span class="o">*</span> <span class="n">pInfos</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureBuildRangeInfoKHR</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span> <span class="n">ppBuildRangeInfos</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.
It specifies the number of the <code>pInfos</code> structures and
<code>ppBuildRangeInfos</code> pointers that <strong class="purple">must</strong> be provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>ppBuildRangeInfos</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a>
structures.
Each <code>ppBuildRangeInfos</code>[i] is a pointer to an array of
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>vkCmdBuildAccelerationStructuresKHR</code> command provides the ability
to initiate multiple acceleration structures builds, however there is no
ordering or synchronization implied between any of the individual
acceleration structure builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This means that an application <strong class="purple">cannot</strong> build a top-level acceleration
structure in the same <a href="chap39.html#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> call as the
associated bottom-level or instance acceleration structures are being built.
There also <strong class="purple">cannot</strong> be any memory aliasing between any acceleration structure
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A <a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure is not used when
building an acceleration structure with a geometry type of
<code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div id="acceleration-structure-scratch" class="paragraph">
<p>Accesses to the acceleration structure scratch buffers as identified by the
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>scratchData</code> buffer
device addresses <strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with
the <code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
(<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> |
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>).
Accesses to each
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>srcAccelerationStructure</code>
and
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>dstAccelerationStructure</code>
<strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>, as appropriate.</p>
</div>
<div class="paragraph">
<p>Accesses to other input buffers as identified by any used values of
<a href="chap39.html#VkAccelerationStructureGeometryMotionTrianglesDataNV">VkAccelerationStructureGeometryMotionTrianglesDataNV</a>::<code>vertexData</code>,
<a href="chap39.html#VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX">VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</a>::<code>compressedData</code>,
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>,
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>,
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>,
<a href="chap39.html#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code>, and
<a href="chap39.html#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code> <strong class="purple">must</strong> be
<a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_SHADER_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-accelerationStructure-08923</span><br>

The <a href="chap51.html#features-accelerationStructure"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong class="purple">must</strong> be a valid
<a href="chap39.html#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> be a valid
<a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> have been created with a
value of <a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> have been created with a
value of <a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="chap39.html#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be made
<a href="chap39.html#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-None-03407" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-None-03407"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong class="purple">must</strong> either be the same <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a>, or
not have any <a href="chap12.html#resources-memory-aliasing">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong class="purple">must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong class="purple">must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10898" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10898"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10898</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>numTriangles</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10899" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10899"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10899</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>numVertices</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10900" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10900"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10900</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>maxPrimitiveIndex</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10901" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10901"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10901</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>maxGeometryIndex</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10902" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10902"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10902</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>format</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10903" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10903"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10903</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>dataSize</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong class="purple">must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-primitiveCount-03769</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, the
<code>primitiveCount</code> member of its corresponding
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structure <strong class="purple">must</strong> have the
same value which was specified when <code>srcAccelerationStructure</code> was
last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03707</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03708</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong class="purple">must</strong> be bound
to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03709</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong class="purple">must</strong> be
bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03671</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong class="purple">must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>buildScratchSize</code> member of the
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03672</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong class="purple">must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>updateScratchSize</code> member of the
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-geometry-03673</span><br>

The buffers from which the buffer device addresses for all of the
<code>geometry.triangles.vertexData</code>, <code>geometry.triangles.indexData</code>,
<code>geometry.triangles.transformData</code>, <code>geometry.aabbs.data</code>, and
<code>geometry.instances.data</code> members of all
<code>pInfos</code>[i].<code>pGeometries</code> and <code>pInfos</code>[i].<code>ppGeometries</code>
are queried <strong class="purple">must</strong> have been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03674</span><br>

The buffer from which the buffer device address
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> is queried <strong class="purple">must</strong> have
been created with <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03802</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03710</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong class="purple">must</strong> be a multiple of
<a href="chap52.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>minAccelerationStructureScratchOffsetAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03804</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03711</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong class="purple">must</strong> be aligned to
the size in bytes of the smallest component of the format in
<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03806</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03712</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and with
<code>geometry.triangles.indexType</code> not equal to
<code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong class="purple">must</strong> be aligned to the
size in bytes of the type in <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03808</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03810</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong class="purple">must</strong> be aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03811</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03714</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong class="purple">must</strong> be aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03715</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_FALSE</code>, <code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03716</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, <code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> be
aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03717</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, each element of
<code>geometry.instances.data.deviceAddress</code> in device memory <strong class="purple">must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-03813</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-06707</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> be <code>0</code> or a
value obtained from <a href="chap12.html#vkGetAccelerationStructureDeviceAddressKHR">vkGetAccelerationStructureDeviceAddressKHR</a> for
a valid acceleration structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10607" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10607"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10607</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if
<code>VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_BIT_EXT</code> is set in
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>flags</code> then
<code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> refer to an
acceleration structure that was built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_DISABLE_OPACITY_MICROMAPS_BIT_EXT</code>
set in <a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-09547" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-09547"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-09547</span><br>

<code>commandBuffer</code> <strong class="purple">must</strong> not be a protected command buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10904" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10904"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10904</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if there is an instance of
<a href="chap39.html#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a> in the
<code>geometry.triangles.pNext</code> chain, and its <code>indexType</code> is
<code>VK_INDEX_TYPE_NONE_KHR</code>, then its <code>indexBuffer.deviceAddress</code>
<strong class="purple">must</strong> be 0</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10905" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10905"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10905</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if there is an instance of
<a href="chap39.html#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a> in the
<code>geometry.triangles.pNext</code> chain, and its <code>indexType</code> is not
<code>VK_INDEX_TYPE_NONE_KHR</code>, then its <code>indexBuffer.deviceAddress</code>
<strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10126" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10126"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10126</span><br>

For each <code>pInfos</code>[i], <code>dstAccelerationStructure</code> <strong class="purple">must</strong> have been
created with a value of
<a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code> greater than or
equal to either:</p>
<div class="ulist">
<ul>
<li>
<p>the memory size required by the build operation, as returned by
<a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a> with
<span class="eq"><code>pBuildInfo</code> = <code>pInfos</code>[i]</span> and with each element of the
<code>pMaxPrimitiveCounts</code> array greater than or equal to the equivalent
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> values for <code>j</code> in
<span class="eq">[0,<code>pInfos</code>[i].<code>geometryCount</code>)</span> or,</p>
</li>
<li>
<p>the result of querying the corresponding
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, if
updating a compacted acceleration structure</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676</span><br>

Each element of <code>ppBuildRangeInfos</code>[i] <strong class="purple">must</strong> be a valid pointer to
an array of <code>pInfos</code>[i].<code>geometryCount</code>
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structures
, or <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10906" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10906"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-10906</span><br>

For each element of <code>pInfos</code>[i] whose <code>pGeometries</code> or
<code>ppGeometries</code> members have a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>,
<code>ppBuildRangeInfos</code>[i] <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter</span><br>
 <code>ppBuildRangeInfos</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>infoCount</code> <a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-renderpass" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-videocoding" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdBuildAccelerationStructuresKHR is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures with some parameters sourced on the device
call:</p>
</div>
<div id="vkCmdBuildAccelerationStructuresIndirectKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkCmdBuildAccelerationStructuresIndirectKHR</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="kt">uint32_t</span>                                    <span class="n">infoCount</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureBuildGeometryInfoKHR</span><span class="o">*</span> <span class="n">pInfos</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkDeviceAddress</span><span class="o">*</span>                      <span class="n">pIndirectDeviceAddresses</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">uint32_t</span><span class="o">*</span>                             <span class="n">pIndirectStrides</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">uint32_t</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span>                      <span class="n">ppMaxPrimitiveCounts</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>pIndirectDeviceAddresses</code> is a pointer to an array of
<code>infoCount</code> buffer device addresses which point to
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
<li>
<p><code>pIndirectStrides</code> is a pointer to an array of <code>infoCount</code> byte
strides between elements of <code>pIndirectDeviceAddresses</code>.</p>
</li>
<li>
<p><code>ppMaxPrimitiveCounts</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <code>pInfos</code>[i].<code>geometryCount</code> values
indicating the maximum number of primitives that will be built by this
command for each geometry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to acceleration structures, scratch buffers, vertex buffers, index
buffers, and instance buffers <strong class="purple">must</strong> be synchronized as with
<a href="chap39.html#acceleration-structure-scratch">vkCmdBuildAccelerationStructuresKHR</a>.</p>
</div>
<div class="paragraph">
<p>Accesses to any element of <code>pIndirectDeviceAddresses</code> <strong class="purple">must</strong> be
<a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-accelerationStructureIndirectBuild-03650</span><br>

The <a href="chap51.html#features-accelerationStructureIndirectBuild"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureIndirectBuild</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong class="purple">must</strong> be a valid
<a href="chap39.html#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> be a valid
<a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> have been created with a
value of <a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> have been created with a
value of <a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="chap39.html#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be made
<a href="chap39.html#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong class="purple">must</strong> either be the same <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a>, or
not have any <a href="chap12.html#resources-memory-aliasing">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong class="purple">must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong class="purple">must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10898" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10898"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10898</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>numTriangles</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10899" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10899"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10899</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>numVertices</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10900" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10900"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10900</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>maxPrimitiveIndex</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10901" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10901"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10901</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>maxGeometryIndex</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10902" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10902"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10902</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>format</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10903" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10903"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10903</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>dataSize</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong class="purple">must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-primitiveCount-03769</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, the
<code>primitiveCount</code> member of its corresponding
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structure <strong class="purple">must</strong> have the
same value which was specified when <code>srcAccelerationStructure</code> was
last built</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppMaxPrimitiveCounts</code>[i][j] <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03707</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03708</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong class="purple">must</strong> be bound
to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03709</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong class="purple">must</strong> be
bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03671</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong class="purple">must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>buildScratchSize</code> member of the
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03672</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.deviceAddress</code> and
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> +  N - 1 <strong class="purple">must</strong> be in
the buffer device address range of the same buffer, where N is given by
the <code>updateScratchSize</code> member of the
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned from a
call to <a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a> with an identical
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure and
primitive count</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-geometry-03673</span><br>

The buffers from which the buffer device addresses for all of the
<code>geometry.triangles.vertexData</code>, <code>geometry.triangles.indexData</code>,
<code>geometry.triangles.transformData</code>, <code>geometry.aabbs.data</code>, and
<code>geometry.instances.data</code> members of all
<code>pInfos</code>[i].<code>pGeometries</code> and <code>pInfos</code>[i].<code>ppGeometries</code>
are queried <strong class="purple">must</strong> have been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03674</span><br>

The buffer from which the buffer device address
<code>pInfos</code>[i].<code>scratchData.deviceAddress</code> is queried <strong class="purple">must</strong> have
been created with <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03802</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03710</span><br>

For each element of <code>pInfos</code>, its <code>scratchData.deviceAddress</code>
member <strong class="purple">must</strong> be a multiple of
<a href="chap52.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>minAccelerationStructureScratchOffsetAlignment</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03804</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03711</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.deviceAddress</code> <strong class="purple">must</strong> be aligned to
the size in bytes of the smallest component of the format in
<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03806</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03712</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and with
<code>geometry.triangles.indexType</code> not equal to
<code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.deviceAddress</code> <strong class="purple">must</strong> be aligned to the
size in bytes of the type in <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03808</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03810</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.deviceAddress</code> is not <code>0</code>, it
<strong class="purple">must</strong> be aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03811</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03714</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>geometry.aabbs.data.deviceAddress</code> <strong class="purple">must</strong> be aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03715</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_FALSE</code>, <code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03716</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, <code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> be
aligned to <code>8</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03717</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if <code>geometry.arrayOfPointers</code>
is <code>VK_TRUE</code>, each element of
<code>geometry.instances.data.deviceAddress</code> in device memory <strong class="purple">must</strong> be
aligned to <code>16</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03813</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-06707</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> be <code>0</code> or a
value obtained from <a href="chap12.html#vkGetAccelerationStructureDeviceAddressKHR">vkGetAccelerationStructureDeviceAddressKHR</a> for
a valid acceleration structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10607" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10607"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10607</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, if
<code>VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_BIT_EXT</code> is set in
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>flags</code> then
<code>geometry.instances.data.deviceAddress</code> <strong class="purple">must</strong> refer to an
acceleration structure that was built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_DISABLE_OPACITY_MICROMAPS_BIT_EXT</code>
set in <a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-09547" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-09547"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-09547</span><br>

<code>commandBuffer</code> <strong class="purple">must</strong> not be a protected command buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10904" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10904"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10904</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if there is an instance of
<a href="chap39.html#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a> in the
<code>geometry.triangles.pNext</code> chain, and its <code>indexType</code> is
<code>VK_INDEX_TYPE_NONE_KHR</code>, then its <code>indexBuffer.deviceAddress</code>
<strong class="purple">must</strong> be 0</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10905" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10905"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-10905</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if there is an instance of
<a href="chap39.html#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a> in the
<code>geometry.triangles.pNext</code> chain, and its <code>indexType</code> is not
<code>VK_INDEX_TYPE_NONE_KHR</code>, then its <code>indexBuffer.deviceAddress</code>
<strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03646</span><br>

For any element of <code>pIndirectDeviceAddresses</code>[i], all device
addresses between <code>pIndirectDeviceAddresses</code>[i] and
<span class="eq"><code>pIndirectDeviceAddresses</code>[i] + 
(<code>pInfos</code>[i].<code>geometryCount</code> × <code>pIndirectStrides</code>[i]) -
1</span> <strong class="purple">must</strong> be in the buffer device address range of the same buffer</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03647</span><br>

For any element of <code>pIndirectDeviceAddresses</code>, the buffer from which
it was queried <strong class="purple">must</strong> have been created with the
<code>VK_BUFFER_USAGE_INDIRECT_BUFFER_BIT</code> bit set</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03648</span><br>

Each element of <code>pIndirectDeviceAddresses</code> <strong class="purple">must</strong> be a multiple of
<code>4</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-03787</span><br>

Each element of <code>pIndirectStrides</code> <strong class="purple">must</strong> be a multiple of <code>4</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-03651</span><br>

Each <a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure referenced
by any element of <code>pIndirectDeviceAddresses</code> <strong class="purple">must</strong> be a valid
<a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-03652</span><br>

<code>pInfos</code>[i].<code>dstAccelerationStructure</code> <strong class="purple">must</strong> have been created
with a value of <a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code>
greater than or equal to the memory size required by the build
operation, as returned by <a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a>
with <span class="eq"><code>pBuildInfo</code> = <code>pInfos</code>[i]</span> and
<span class="eq"><code>pMaxPrimitiveCounts</code> = <code>ppMaxPrimitiveCounts</code>[i]</span></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-03653</span><br>

Each <code>ppMaxPrimitiveCounts</code>[i][j] <strong class="purple">must</strong> be greater than or equal to
the <code>primitiveCount</code> value specified by the
<a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structure located at
<span class="eq"><code>pIndirectDeviceAddresses</code>[i] +  (<code>j</code> ×
<code>pIndirectStrides</code>[i])</span></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectDeviceAddresses-parameter</span><br>
 <code>pIndirectDeviceAddresses</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>infoCount</code> <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-pIndirectStrides-parameter</span><br>
 <code>pIndirectStrides</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>infoCount</code> <code>uint32_t</code> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-ppMaxPrimitiveCounts-parameter</span><br>
 <code>ppMaxPrimitiveCounts</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>infoCount</code> <code>uint32_t</code> values</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength" href="chap39.html#VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructuresIndirectKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdBuildAccelerationStructuresIndirectKHR is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureBuildGeometryInfoKHR</code> structure is defined
as:</p>
</div>
<div id="VkAccelerationStructureBuildGeometryInfoKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureBuildGeometryInfoKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                                     <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                                         <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureTypeKHR</span>                      <span class="n">type</span><span class="p">;</span>
    <span class="n">VkBuildAccelerationStructureFlagsKHR</span>                <span class="n">flags</span><span class="p">;</span>
    <span class="n">VkBuildAccelerationStructureModeKHR</span>                 <span class="n">mode</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureKHR</span>                          <span class="n">srcAccelerationStructure</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureKHR</span>                          <span class="n">dstAccelerationStructure</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                            <span class="n">geometryCount</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureGeometryKHR</span><span class="o">*</span>           <span class="n">pGeometries</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureGeometryKHR</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span>    <span class="n">ppGeometries</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressKHR</span>                            <span class="n">scratchData</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureBuildGeometryInfoKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>type</code> is a <a href="chap12.html#VkAccelerationStructureTypeKHR">VkAccelerationStructureTypeKHR</a> value specifying
the type of acceleration structure being built.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of
<a href="chap12.html#VkBuildAccelerationStructureFlagBitsKHR">VkBuildAccelerationStructureFlagBitsKHR</a> specifying additional
parameters of the acceleration structure.</p>
</li>
<li>
<p><code>mode</code> is a <a href="chap39.html#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value
specifying the type of operation to perform.</p>
</li>
<li>
<p><code>srcAccelerationStructure</code> is a pointer to an existing acceleration
structure that is to be used to update the
<code>dstAccelerationStructure</code> acceleration structure when <code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>.</p>
</li>
<li>
<p><code>dstAccelerationStructure</code> is a pointer to the target acceleration
structure for the build.</p>
</li>
<li>
<p><code>geometryCount</code> specifies the number of geometries that will be
built into <code>dstAccelerationStructure</code>.</p>
</li>
<li>
<p><code>pGeometries</code> is a pointer to an array of
<a href="chap39.html#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures.</p>
</li>
<li>
<p><code>ppGeometries</code> is a pointer to an array of pointers to
<a href="chap39.html#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures.</p>
</li>
<li>
<p><code>scratchData</code> is the device or host address to memory that will be
used as scratch memory for the build.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only one of <code>pGeometries</code> or <code>ppGeometries</code> <strong class="purple">can</strong> be a valid pointer,
the other <strong class="purple">must</strong> be <code>NULL</code>.
Each element of the non-<code>NULL</code> array describes the data used to build each
acceleration structure geometry.</p>
</div>
<div id="acceleration-structure-geometry-index" class="paragraph">
<p>The index of each element of the <code>pGeometries</code> or <code>ppGeometries</code>
members of <a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> is used as the
<em>geometry index</em> during ray traversal.
The geometry index is available in ray shaders via the
<a href="chap16.html#interfaces-builtin-variables-raygeometryindex"><code>RayGeometryIndexKHR</code>
built-in</a>, and is <a href="chap43.html#shader-binding-table-hit-shader-indexing">used to
determine hit and intersection shaders executed during traversal</a>.
The geometry index is available to ray queries via the
<code>OpRayQueryGetIntersectionGeometryIndexKHR</code> instruction.</p>
</div>
<div id="acceleration-structure-motion-instances" class="paragraph">
<p>Setting <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> in <code>flags</code>
indicates that this build is a motion top level acceleration structure.
A motion top level uses instances of format
<a href="chap39.html#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> if
<a href="chap39.html#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>arrayOfPointers</code>
is <code>VK_FALSE</code>.</p>
</div>
<div class="paragraph">
<p>If
<a href="chap39.html#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>arrayOfPointers</code>
is <code>VK_TRUE</code>, the pointer for each element of the array of instance
pointers consists of 4 bits of
<code>VkAccelerationStructureMotionInstanceTypeNV</code> in the low 4 bits of the
pointer identifying the type of structure at the pointer.
The device address accessed is the value in the array with the low 4 bits
set to zero.
The structure at the pointer is one of
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>,
<a href="chap39.html#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> or
<a href="chap39.html#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a>, depending on the type
value encoded in the low 4 bits.</p>
</div>
<div class="paragraph">
<p>A top level acceleration structure with either motion instances or vertex
motion in its instances <strong class="purple">must</strong> set
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> in <code>flags</code>.</p>
</div>
<div class="paragraph">
<p>Members <code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
<strong class="purple">may</strong> be the same or different for an update operation (when <code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>).
If they are the same, the update happens in-place.
Otherwise, the target acceleration structure is updated and the source is
not modified.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03654</span><br>

<code>type</code> <strong class="purple">must</strong> not be <code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-03788</span><br>

If <code>geometryCount</code> is not <code>0</code>, exactly one of <code>pGeometries</code> or
<code>ppGeometries</code> <strong class="purple">must</strong> be a valid pointer, the other <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03789</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, the
<code>geometryType</code> member of elements of either <code>pGeometries</code> or
<code>ppGeometries</code> <strong class="purple">must</strong> be <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03790</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>,
<code>geometryCount</code> <strong class="purple">must</strong> be <code>1</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03791</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
the <code>geometryType</code> member of elements of either <code>pGeometries</code> or
<code>ppGeometries</code> <strong class="purple">must</strong> not be <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03792</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
then the <code>geometryType</code> member of each geometry in either
<code>pGeometries</code> or <code>ppGeometries</code> <strong class="purple">must</strong> be the same</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03793</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
then <code>geometryCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxGeometryCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-10884" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-10884"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-10884</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
and the <code>geometryType</code> member of either <code>pGeometries</code> or
<code>ppGeometries</code> is
<code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, then
<code>geometryCount</code> <strong class="purple">must</strong> be <code>1</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03794</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
and the <code>geometryType</code> member of either <code>pGeometries</code> or
<code>ppGeometries</code> is <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the total number
of AABBs in all geometries <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxPrimitiveCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-03795</span><br>

If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>
and the <code>geometryType</code> member of either <code>pGeometries</code> or
<code>ppGeometries</code> is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the total
number of triangles in all geometries <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxPrimitiveCount</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-03796</span><br>

If <code>flags</code> has the
<code>VK_BUILD_ACCELERATION_STRUCTURE_PREFER_FAST_TRACE_BIT_KHR</code> bit set,
then it <strong class="purple">must</strong> not have the
<code>VK_BUILD_ACCELERATION_STRUCTURE_PREFER_FAST_BUILD_BIT_KHR</code> bit set</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-dstAccelerationStructure-04927</span><br>

If <code>dstAccelerationStructure</code> was created with
<code>VK_ACCELERATION_STRUCTURE_CREATE_MOTION_BIT_NV</code> set in
<a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>createFlags</code>,
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> <strong class="purple">must</strong> be set in
<code>flags</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04928</span><br>

If <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> is set in
<code>flags</code>, <code>dstAccelerationStructure</code> <strong class="purple">must</strong> have been created with
<code>VK_ACCELERATION_STRUCTURE_CREATE_MOTION_BIT_NV</code> set in
<a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>createFlags</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-04929</span><br>

If <code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> is set in
<code>flags</code>, <code>type</code> <strong class="purple">must</strong> not be
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-07334</span><br>

If <code>flags</code> has the
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_UPDATE_BIT_EXT</code>
bit set then it <strong class="purple">must</strong> not have the
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_OPACITY_MICROMAP_DATA_UPDATE_BIT_EXT</code>
bit set</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_BUILD_GEOMETRY_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-type-parameter</span><br>
 <code>type</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureTypeKHR">VkAccelerationStructureTypeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-flags-parameter</span><br>
 <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap12.html#VkBuildAccelerationStructureFlagBitsKHR">VkBuildAccelerationStructureFlagBitsKHR</a> values</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-pGeometries-parameter</span><br>
 If <code>geometryCount</code> is not <code>0</code>, and <code>pGeometries</code> is not <code>NULL</code>, <code>pGeometries</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>geometryCount</code> valid <a href="chap39.html#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-ppGeometries-parameter</span><br>
 If <code>geometryCount</code> is not <code>0</code>, and <code>ppGeometries</code> is not <code>NULL</code>, <code>ppGeometries</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>geometryCount</code> valid pointers to valid <a href="chap39.html#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent" href="chap39.html#VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent"></a> <span class="vuid">VUID-VkAccelerationStructureBuildGeometryInfoKHR-commonparent</span><br>
 Both of <code>dstAccelerationStructure</code>, and <code>srcAccelerationStructure</code> that are valid handles of non-ignored parameters <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <a href="chap5.html#VkDevice">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkBuildAccelerationStructureModeKHR</code> enumeration is defined as:</p>
</div>
<div id="VkBuildAccelerationStructureModeKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkBuildAccelerationStructureModeKHR</span> <span class="p">{</span>
    <span class="n">VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkBuildAccelerationStructureModeKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code> specifies that the
destination acceleration structure will be built using the specified
geometries.</p>
</li>
<li>
<p><code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> specifies that the
destination acceleration structure will be built using data in a source
acceleration structure, updated by the specified geometries.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkDeviceOrHostAddressKHR</code> union is defined as:</p>
</div>
<div id="VkDeviceOrHostAddressKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure, VK_NV_cooperative_vector</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">VkDeviceOrHostAddressKHR</span> <span class="p">{</span>
    <span class="n">VkDeviceAddress</span>    <span class="n">deviceAddress</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>              <span class="n">hostAddress</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkDeviceOrHostAddressKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deviceAddress</code> is a buffer device address as returned by the
<a href="chap12.html#vkGetBufferDeviceAddressKHR">vkGetBufferDeviceAddressKHR</a> command.</p>
</li>
<li>
<p><code>hostAddress</code> is a host memory address.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkDeviceOrHostAddressConstKHR</code> union is defined as:</p>
</div>
<div id="VkDeviceOrHostAddressConstKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure, VK_NV_cooperative_vector</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">VkDeviceOrHostAddressConstKHR</span> <span class="p">{</span>
    <span class="n">VkDeviceAddress</span>    <span class="n">deviceAddress</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>        <span class="n">hostAddress</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkDeviceOrHostAddressConstKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deviceAddress</code> is a buffer device address as returned by the
<a href="chap12.html#vkGetBufferDeviceAddressKHR">vkGetBufferDeviceAddressKHR</a> command.</p>
</li>
<li>
<p><code>hostAddress</code> is a const host memory address.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryKHR</code> structure is defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureGeometryKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                           <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                               <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkGeometryTypeKHR</span>                         <span class="n">geometryType</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureGeometryDataKHR</span>    <span class="n">geometry</span><span class="p">;</span>
    <span class="n">VkGeometryFlagsKHR</span>                        <span class="n">flags</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureGeometryKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>geometryType</code> describes which type of geometry this
<code>VkAccelerationStructureGeometryKHR</code> refers to.</p>
</li>
<li>
<p><code>geometry</code> is a <a href="chap39.html#VkAccelerationStructureGeometryDataKHR">VkAccelerationStructureGeometryDataKHR</a> union
describing the geometry data for the relevant geometry type.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="chap12.html#VkGeometryFlagBitsKHR">VkGeometryFlagBitsKHR</a> values
describing additional properties of how the geometry should be built.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-sType-sType" href="chap39.html#VUID-VkAccelerationStructureGeometryKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-pNext-pNext" href="chap39.html#VUID-VkAccelerationStructureGeometryKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong class="purple">must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="chap39.html#VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX">VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</a>, <a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>, or <a href="chap39.html#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-sType-unique" href="chap39.html#VUID-VkAccelerationStructureGeometryKHR-sType-unique"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-sType-unique</span><br>
 The <code>sType</code> value of each structure in the <code>pNext</code> chain <strong class="purple">must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-geometryType-parameter</span><br>
 <code>geometryType</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkGeometryTypeKHR">VkGeometryTypeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-triangles-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryKHR-triangles-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-triangles-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the <code>triangles</code> member of <code>geometry</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-aabbs-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the <code>aabbs</code> member of <code>geometry</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-instances-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryKHR-instances-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-instances-parameter</span><br>
 If <code>geometryType</code> is <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the <code>instances</code> member of <code>geometry</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryKHR-flags-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryKHR-flags-parameter</span><br>
 <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap12.html#VkGeometryFlagBitsKHR">VkGeometryFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryDataKHR</code> union is defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryDataKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">VkAccelerationStructureGeometryDataKHR</span> <span class="p">{</span>
    <span class="n">VkAccelerationStructureGeometryTrianglesDataKHR</span>    <span class="n">triangles</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureGeometryAabbsDataKHR</span>        <span class="n">aabbs</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureGeometryInstancesDataKHR</span>    <span class="n">instances</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureGeometryDataKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>triangles</code> is a
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure.</p>
</li>
<li>
<p><code>aabbs</code> is a <a href="chap39.html#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>
structure.</p>
</li>
<li>
<p><code>instances</code> is a
<a href="chap39.html#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a> structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryTrianglesDataKHR</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryTrianglesDataKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureGeometryTrianglesDataKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                  <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                      <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkFormat</span>                         <span class="n">vertexFormat</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">vertexData</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                     <span class="n">vertexStride</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                         <span class="n">maxVertex</span><span class="p">;</span>
    <span class="n">VkIndexType</span>                      <span class="n">indexType</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">indexData</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">transformData</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureGeometryTrianglesDataKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="chap53.html#VkFormat">VkFormat</a> of each vertex element.</p>
</li>
<li>
<p><code>vertexData</code> is a device or host address to memory containing vertex
data for this geometry.</p>
</li>
<li>
<p><code>vertexStride</code> is the stride in bytes between each vertex.</p>
</li>
<li>
<p><code>maxVertex</code> is the number of vertices in <code>vertexData</code> minus one.</p>
</li>
<li>
<p><code>indexType</code> is the <a href="chap23.html#VkIndexType">VkIndexType</a> of each index element.</p>
</li>
<li>
<p><code>indexData</code> is a device or host address to memory containing index
data for this geometry.</p>
</li>
<li>
<p><code>transformData</code> is a device or host address to memory containing an
optional reference to a <a href="chap39.html#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing
a transformation from the space in which the vertices in this geometry
are described to the space in which the acceleration structure is
defined.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Unlike the stride for vertex buffers in
<a href="chap24.html#VkVertexInputBindingDescription">VkVertexInputBindingDescription</a> for graphics pipelines which must not
exceed <code>maxVertexInputBindingStride</code>, <code>vertexStride</code> for
acceleration structure geometry is instead restricted to being a 32-bit
value.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03735</span><br>

<code>vertexStride</code> <strong class="purple">must</strong> be a multiple of the size in bytes of the
smallest component of <code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexStride-03819</span><br>

<code>vertexStride</code> <strong class="purple">must</strong> be less than or equal to <span class="eq">2<sup>32</sup>-1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-03797</span><br>

The <a href="chap12.html#resources-buffer-view-format-features">format features</a> of
<code>vertexFormat</code> <strong class="purple">must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-03798</span><br>

<code>indexType</code> <strong class="purple">must</strong> be <code>VK_INDEX_TYPE_UINT16</code>,
<code>VK_INDEX_TYPE_UINT32</code>, or <code>VK_INDEX_TYPE_NONE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_TRIANGLES_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-pNext-pNext</span><br>
 Each <code>pNext</code> member of any structure (including this one) in the <code>pNext</code> chain <strong class="purple">must</strong> be either <code>NULL</code> or a pointer to a valid instance of <a href="chap39.html#VkAccelerationStructureGeometryMotionTrianglesDataNV">VkAccelerationStructureGeometryMotionTrianglesDataNV</a>, <a href="chap39.html#VkAccelerationStructureTrianglesDisplacementMicromapNV">VkAccelerationStructureTrianglesDisplacementMicromapNV</a>, or <a href="chap39.html#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-sType-unique</span><br>
 The <code>sType</code> value of each structure in the <code>pNext</code> chain <strong class="purple">must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong class="purple">must</strong> be a valid <a href="chap53.html#VkFormat">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryTrianglesDataKHR-indexType-parameter</span><br>
 <code>indexType</code> <strong class="purple">must</strong> be a valid <a href="chap23.html#VkIndexType">VkIndexType</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryMotionTrianglesDataNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_motion_blur</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureGeometryMotionTrianglesDataNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                  <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                      <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">vertexData</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureGeometryMotionTrianglesDataNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexData</code> is a pointer to vertex data for this geometry at time
1.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> is included in
the <code>pNext</code> chain of a
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, the basic
vertex positions are used for the position of the triangles in the geometry
at time 0.0 and the <code>vertexData</code> in
<code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code> is used for the
vertex positions at time 1.0, with positions linearly interpolated at
intermediate times.</p>
</div>
<div class="paragraph">
<p>Indexing for <code>VkAccelerationStructureGeometryMotionTrianglesDataNV</code>
<code>vertexData</code> is equivalent to the basic vertex position data.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType" href="chap39.html#VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryMotionTrianglesDataNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_MOTION_TRIANGLES_DATA_NV</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureTrianglesOpacityMicromapEXT</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureTrianglesOpacityMicromapEXT" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_EXT_opacity_micromap</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureTrianglesOpacityMicromapEXT</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                     <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>                               <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkIndexType</span>                         <span class="n">indexType</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>       <span class="n">indexBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                        <span class="n">indexStride</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                            <span class="n">baseTriangle</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                            <span class="n">usageCountsCount</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">VkMicromapUsageEXT</span><span class="o">*</span>           <span class="n">pUsageCounts</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">VkMicromapUsageEXT</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span>    <span class="n">ppUsageCounts</span><span class="p">;</span>
    <span class="n">VkMicromapEXT</span>                       <span class="n">micromap</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureTrianglesOpacityMicromapEXT</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>indexType</code> is the type of triangle indices used when indexing this
micromap</p>
</li>
<li>
<p><code>indexBuffer</code> is the address containing the triangle indices</p>
</li>
<li>
<p><code>indexStride</code> is the byte stride between triangle indices</p>
</li>
<li>
<p><code>baseTriangle</code> is the base value added to the non-negative triangle
indices</p>
</li>
<li>
<p><code>usageCountsCount</code> specifies the number of usage counts structures
that will be used to determine the size of this micromap.</p>
</li>
<li>
<p><code>pUsageCounts</code> is a pointer to an array of <a href="chap41.html#VkMicromapUsageEXT">VkMicromapUsageEXT</a>
structures.</p>
</li>
<li>
<p><code>ppUsageCounts</code> is a pointer to an array of pointers to
<a href="chap41.html#VkMicromapUsageEXT">VkMicromapUsageEXT</a> structures.</p>
</li>
<li>
<p><code>micromap</code> is the handle to the micromap object to include in this
geometry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureTrianglesOpacityMicromapEXT</code> is included in
the <code>pNext</code> chain of a
<a href="chap39.html#VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX">VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</a> or
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, that
geometry will reference that micromap.</p>
</div>
<div class="paragraph">
<p>For each triangle in the geometry, the acceleration structure build fetches
an index from <code>indexBuffer</code> using <code>indexType</code> and <code>indexStride</code>
if present.
If <code>indexBuffer</code> is <code>NULL</code> then the index used is the index of the
triangle in the geometry.</p>
</div>
<div class="paragraph">
<p>If that value is the unsigned cast of one of the values from
<a href="chap39.html#VkOpacityMicromapSpecialIndexEXT">VkOpacityMicromapSpecialIndexEXT</a> then that triangle behaves as
described for that special value in <a href="chap42.html#ray-opacity-micromap">Ray Opacity
Micromap</a>.</p>
</div>
<div class="paragraph">
<p>Otherwise that triangle uses the opacity micromap information from
<code>micromap</code> at that index plus <code>baseTriangle</code>.</p>
</div>
<div class="paragraph">
<p>Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong class="purple">can</strong> be a valid
pointer, the other <strong class="purple">must</strong> be <code>NULL</code>.
The elements of the non-<code>NULL</code> array describe the total count used to build
this geometry.
For a given <code>format</code> and <code>subdivisionLevel</code> the number of triangles
in this geometry matching those values after indirection and special index
handling <strong class="purple">must</strong> be equal to the sum of matching <code>count</code> provided.</p>
</div>
<div class="paragraph">
<p>If <code>micromap</code> is <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, then every value read from
<code>indexBuffer</code> <strong class="purple">must</strong> be one of the values in
<code>VkOpacityMicromapSpecialIndexEXT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-07335</span><br>

Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong class="purple">can</strong> be a valid
pointer, the other <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10719" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10719"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10719</span><br>

<code>indexType</code> <strong class="purple">must</strong> be <code>VK_INDEX_TYPE_UINT16</code>,
<code>VK_INDEX_TYPE_UINT32</code>, or <code>VK_INDEX_TYPE_NONE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10722" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10722"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10722</span><br>

If <code>indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>, then
<code>indexStride</code> <strong class="purple">must</strong> be a multiple of the size in bytes of
<code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10723" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10723"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-10723</span><br>

If <code>indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>, then
<code>indexStride</code> <strong class="purple">must</strong> be less than or equal to <span class="eq">2<sup>32</sup>-1</span></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_TRIANGLES_OPACITY_MICROMAP_EXT</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-indexType-parameter</span><br>
 <code>indexType</code> <strong class="purple">must</strong> be a valid <a href="chap23.html#VkIndexType">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-pUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>pUsageCounts</code> is not <code>NULL</code>, <code>pUsageCounts</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>usageCountsCount</code> <a href="chap41.html#VkMicromapUsageEXT">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-ppUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>ppUsageCounts</code> is not <code>NULL</code>, <code>ppUsageCounts</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>usageCountsCount</code> valid pointers to <a href="chap41.html#VkMicromapUsageEXT">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesOpacityMicromapEXT-micromap-parameter</span><br>
 If <code>micromap</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>micromap</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkMicromapEXT">VkMicromapEXT</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkOpacityMicromapSpecialIndexEXT</code> enumeration is defined as:</p>
</div>
<div id="VkOpacityMicromapSpecialIndexEXT" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_EXT_opacity_micromap</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkOpacityMicromapSpecialIndexEXT</span> <span class="p">{</span>
    <span class="n">VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_TRANSPARENT_EXT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_OPAQUE_EXT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_TRANSPARENT_EXT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_OPAQUE_EXT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span>
  <span class="c1">// Provided by VK_EXT_opacity_micromap with VK_NV_cluster_acceleration_structure</span>
    <span class="n">VK_OPACITY_MICROMAP_SPECIAL_INDEX_CLUSTER_GEOMETRY_DISABLE_OPACITY_MICROMAP_NV</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkOpacityMicromapSpecialIndexEXT</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_TRANSPARENT_EXT</code> specifies
that the entire triangle is fully transparent.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_OPAQUE_EXT</code> specifies that
the entire triangle is fully opaque.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_TRANSPARENT_EXT</code>
specifies that the entire triangle is unknown-transparent.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_FULLY_UNKNOWN_OPAQUE_EXT</code>
specifies that the entire triangle is unknown-opaque.</p>
</li>
<li>
<p><code>VK_OPACITY_MICROMAP_SPECIAL_INDEX_CLUSTER_GEOMETRY_DISABLE_OPACITY_MICROMAP_NV</code>
specifies that <a href="chap42.html#ray-opacity-micromap">Opacity Micromap</a> will be
disabled for this triangle and opacity value will be picked from
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>baseGeometryIndexAndGeometryFlags</code>
instead.
Note that this special index is only valid for <a href="chap39.html#cluster-geometry">Cluster Geometry</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureTrianglesDisplacementMicromapNV</code> structure
is defined as:</p>
</div>
<div id="VkAccelerationStructureTrianglesDisplacementMicromapNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_displacement_micromap</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureTrianglesDisplacementMicromapNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                     <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>                               <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkFormat</span>                            <span class="n">displacementBiasAndScaleFormat</span><span class="p">;</span>
    <span class="n">VkFormat</span>                            <span class="n">displacementVectorFormat</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>       <span class="n">displacementBiasAndScaleBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                        <span class="n">displacementBiasAndScaleStride</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>       <span class="n">displacementVectorBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                        <span class="n">displacementVectorStride</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>       <span class="n">displacedMicromapPrimitiveFlags</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                        <span class="n">displacedMicromapPrimitiveFlagsStride</span><span class="p">;</span>
    <span class="n">VkIndexType</span>                         <span class="n">indexType</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>       <span class="n">indexBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                        <span class="n">indexStride</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                            <span class="n">baseTriangle</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                            <span class="n">usageCountsCount</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">VkMicromapUsageEXT</span><span class="o">*</span>           <span class="n">pUsageCounts</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">VkMicromapUsageEXT</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span>    <span class="n">ppUsageCounts</span><span class="p">;</span>
    <span class="n">VkMicromapEXT</span>                       <span class="n">micromap</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureTrianglesDisplacementMicromapNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>displacementBiasAndScaleFormat</code> is the format of displacement bias
and scale used in this displacement micromap reference.</p>
</li>
<li>
<p><code>displacementVectorFormat</code> is the format of displacement vector used
in this displacement micromap reference.</p>
</li>
<li>
<p><code>displacementBiasAndScaleBuffer</code> is the address containing the bias
and scale.</p>
</li>
<li>
<p><code>displacementBiasAndScaleStride</code> is the byte stride between bias and
scale values.</p>
</li>
<li>
<p><code>displacementVectorBuffer</code> is the address containing the
displacement vector values.</p>
</li>
<li>
<p><code>displacementVectorStride</code> is the byte stride between displacement
vector values.</p>
</li>
<li>
<p><code>displacedMicromapPrimitiveFlags</code> is the address containing the
primitive flags.</p>
</li>
<li>
<p><code>displacedMicromapPrimitiveFlagsStride</code> is the byte stride between
primitive flag values.</p>
</li>
<li>
<p><code>indexType</code> is the type of triangle indices used when indexing this
micromap.</p>
</li>
<li>
<p><code>indexBuffer</code> is the address containing the triangle indices.</p>
</li>
<li>
<p><code>indexStride</code> is the byte stride between triangle indices.</p>
</li>
<li>
<p><code>baseTriangle</code> is the base value added to the non-negative triangle
indices.</p>
</li>
<li>
<p><code>usageCountsCount</code> specifies the number of usage counts structures
that will be used to determine the size of this micromap.</p>
</li>
<li>
<p><code>pUsageCounts</code> is a pointer to an array of <a href="chap41.html#VkMicromapUsageEXT">VkMicromapUsageEXT</a>
structures.</p>
</li>
<li>
<p><code>ppUsageCounts</code> is a pointer to an array of pointers to
<a href="chap41.html#VkMicromapUsageEXT">VkMicromapUsageEXT</a> structures.</p>
</li>
<li>
<p><code>micromap</code> is the handle to the micromap object to include in this
geometry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>VkAccelerationStructureTrianglesDisplacementMicromapNV</code> is included
in the <code>pNext</code> chain of a
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a> structure, that
geometry will reference that micromap.</p>
</div>
<div class="paragraph">
<p>For each triangle in the geometry, the acceleration structure build fetches
an index from <code>indexBuffer</code> using <code>indexType</code> and <code>indexStride</code>.
That triangle uses the displacement micromap information from <code>micromap</code>
at that index plus <code>baseTriangle</code>.</p>
</div>
<div class="paragraph">
<p>Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong class="purple">can</strong> be a valid
pointer, the other <strong class="purple">must</strong> be <code>NULL</code>.
The elements of the non-<code>NULL</code> array describe the total count used to build
this geometry.
For a given <code>format</code> and <code>subdivisionLevel</code> the number of triangles
in this geometry matching those values after indirection <strong class="purple">must</strong> be equal to
the sum of matching <code>count</code> provided.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-09501" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-09501"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-09501</span><br>

<code>displacementBiasAndScaleFormat</code> <strong class="purple">must</strong> not be
<code>VK_FORMAT_UNDEFINED</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-09502" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-09502"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-09502</span><br>

<code>displacementVectorFormat</code> <strong class="purple">must</strong> not be <code>VK_FORMAT_UNDEFINED</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-07992</span><br>

Only one of <code>pUsageCounts</code> or <code>ppUsageCounts</code> <strong class="purple">can</strong> be a valid
pointer, the other <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_TRIANGLES_DISPLACEMENT_MICROMAP_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementBiasAndScaleFormat-parameter</span><br>
 <code>displacementBiasAndScaleFormat</code> <strong class="purple">must</strong> be a valid <a href="chap53.html#VkFormat">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-displacementVectorFormat-parameter</span><br>
 <code>displacementVectorFormat</code> <strong class="purple">must</strong> be a valid <a href="chap53.html#VkFormat">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-indexType-parameter</span><br>
 <code>indexType</code> <strong class="purple">must</strong> be a valid <a href="chap23.html#VkIndexType">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-pUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>pUsageCounts</code> is not <code>NULL</code>, <code>pUsageCounts</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>usageCountsCount</code> <a href="chap41.html#VkMicromapUsageEXT">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-ppUsageCounts-parameter</span><br>
 If <code>usageCountsCount</code> is not <code>0</code>, and <code>ppUsageCounts</code> is not <code>NULL</code>, <code>ppUsageCounts</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>usageCountsCount</code> valid pointers to <a href="chap41.html#VkMicromapUsageEXT">VkMicromapUsageEXT</a> structures</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter" href="chap39.html#VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureTrianglesDisplacementMicromapNV-micromap-parameter</span><br>
 If <code>micromap</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>micromap</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkMicromapEXT">VkMicromapEXT</a> handle</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build an acceleration structure for the <code><a href="chap60.html#VK_NV_ray_tracing">VK_NV_ray_tracing</a></code>
extension call:</p>
</div>
<div id="vkCmdBuildAccelerationStructureNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="kt">void</span> <span class="nf">vkCmdBuildAccelerationStructureNV</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureInfoNV</span><span class="o">*</span>        <span class="n">pInfo</span><span class="p">,</span>
    <span class="n">VkBuffer</span>                                    <span class="n">instanceData</span><span class="p">,</span>
    <span class="n">VkDeviceSize</span>                                <span class="n">instanceOffset</span><span class="p">,</span>
    <span class="n">VkBool32</span>                                    <span class="n">update</span><span class="p">,</span>
    <span class="n">VkAccelerationStructureNV</span>                   <span class="n">dst</span><span class="p">,</span>
    <span class="n">VkAccelerationStructureNV</span>                   <span class="n">src</span><span class="p">,</span>
    <span class="n">VkBuffer</span>                                    <span class="n">scratch</span><span class="p">,</span>
    <span class="n">VkDeviceSize</span>                                <span class="n">scratchOffset</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> contains the shared information for the acceleration
structure’s structure.</p>
</li>
<li>
<p><code>instanceData</code> is the buffer containing an array of
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structures defining
acceleration structures.
This parameter <strong class="purple">must</strong> be <code>NULL</code> for bottom level acceleration structures.</p>
</li>
<li>
<p><code>instanceOffset</code> is the offset in bytes (relative to the start of
<code>instanceData</code>) at which the instance data is located.</p>
</li>
<li>
<p><code>update</code> specifies whether to update the <code>dst</code> acceleration
structure with the data in <code>src</code>.</p>
</li>
<li>
<p><code>dst</code> is a pointer to the target acceleration structure for the
build.</p>
</li>
<li>
<p><code>src</code> is a pointer to an existing acceleration structure that is to
be used to update the <code>dst</code> acceleration structure.</p>
</li>
<li>
<p><code>scratch</code> is the <a href="chap12.html#VkBuffer">VkBuffer</a> that will be used as scratch memory
for the build.</p>
</li>
<li>
<p><code>scratchOffset</code> is the offset in bytes relative to the start of
<code>scratch</code> that will be used as a scratch memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>dst</code>, <code>src</code>, and <code>scratch</code> <strong class="purple">must</strong> be
<a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-geometryCount-02241</span><br>

<code>geometryCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceRayTracingPropertiesNV">VkPhysicalDeviceRayTracingPropertiesNV</a>::<code>maxGeometryCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-02488" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-dst-02488"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-02488</span><br>

<code>dst</code> <strong class="purple">must</strong> have been created with compatible
<a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a> where
<a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a>::<code>type</code> and
<a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a>::<code>flags</code> are identical,
<a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a>::<code>instanceCount</code> and
<a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a>::<code>geometryCount</code> for <code>dst</code>
are greater than or equal to the build size and each geometry in
<a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a>::<code>pGeometries</code> for <code>dst</code> has
greater than or equal to the number of vertices, indices, and AABBs</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02489" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-update-02489"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02489</span><br>

If <code>update</code> is <code>VK_TRUE</code>, <code>src</code> <strong class="purple">must</strong> not be
<a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02490" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-update-02490"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02490</span><br>

If <code>update</code> is <code>VK_TRUE</code>, <code>src</code> <strong class="purple">must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_NV</code> set in
<a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a>::<code>flags</code> in the original build</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02491" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-update-02491"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02491</span><br>

If <code>update</code> is <code>VK_FALSE</code>, the <code>size</code> member of the
<a href="chap12.html#VkMemoryRequirements">VkMemoryRequirements</a> structure returned from a call to
<a href="chap12.html#vkGetAccelerationStructureMemoryRequirementsNV">vkGetAccelerationStructureMemoryRequirementsNV</a> with
<a href="chap12.html#VkAccelerationStructureMemoryRequirementsInfoNV">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>accelerationStructure</code>
set to <code>dst</code> and
<a href="chap12.html#VkAccelerationStructureMemoryRequirementsInfoNV">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>type</code> set to
<code>VK_ACCELERATION_STRUCTURE_MEMORY_REQUIREMENTS_TYPE_BUILD_SCRATCH_NV</code>
<strong class="purple">must</strong> be less than or equal to the size of <code>scratch</code> minus
<code>scratchOffset</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-02492" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-update-02492"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-02492</span><br>

If <code>update</code> is <code>VK_TRUE</code>, the <code>size</code> member of the
<a href="chap12.html#VkMemoryRequirements">VkMemoryRequirements</a> structure returned from a call to
<a href="chap12.html#vkGetAccelerationStructureMemoryRequirementsNV">vkGetAccelerationStructureMemoryRequirementsNV</a> with
<a href="chap12.html#VkAccelerationStructureMemoryRequirementsInfoNV">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>accelerationStructure</code>
set to <code>dst</code> and
<a href="chap12.html#VkAccelerationStructureMemoryRequirementsInfoNV">VkAccelerationStructureMemoryRequirementsInfoNV</a>::<code>type</code> set to
<code>VK_ACCELERATION_STRUCTURE_MEMORY_REQUIREMENTS_TYPE_UPDATE_SCRATCH_NV</code>
<strong class="purple">must</strong> be less than or equal to the size of <code>scratch</code> minus
<code>scratchOffset</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-scratch-03522" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-scratch-03522"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-scratch-03522</span><br>

<code>scratch</code> <strong class="purple">must</strong> have been created with
<code>VK_BUFFER_USAGE_RAY_TRACING_BIT_NV</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-instanceData-03523</span><br>

If <code>instanceData</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>instanceData</code>
<strong class="purple">must</strong> have been created with <code>VK_BUFFER_USAGE_RAY_TRACING_BIT_NV</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-accelerationStructureReference-03786</span><br>

Each
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>instanceData</code> <strong class="purple">must</strong> be a value obtained from
<a href="chap12.html#vkGetAccelerationStructureHandleNV">vkGetAccelerationStructureHandleNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03524" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-update-03524"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03524</span><br>

If <code>update</code> is <code>VK_TRUE</code>, then objects that were previously
active <strong class="purple">must</strong> not be made inactive as per
<a href="chap39.html#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03525" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-update-03525"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03525</span><br>

If <code>update</code> is <code>VK_TRUE</code>, then objects that were previously
inactive <strong class="purple">must</strong> not be made active as per
<a href="chap39.html#acceleration-structure-inactive-prims">Inactive Primitives and Instances</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-update-03526" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-update-03526"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-update-03526</span><br>

If <code>update</code> is <code>VK_TRUE</code>, the <code>src</code> and <code>dst</code> objects
<strong class="purple">must</strong> either be the same object or not have any
<a href="chap12.html#resources-memory-aliasing">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-07787" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-dst-07787"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-07787</span><br>

<code>dst</code> <strong class="purple">must</strong> be bound completely and contiguously to a single
<code>VkDeviceMemory</code> object via
<a href="chap12.html#vkBindAccelerationStructureMemoryNV">vkBindAccelerationStructureMemoryNV</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap12.html#VkAccelerationStructureInfoNV">VkAccelerationStructureInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-instanceData-parameter</span><br>
 If <code>instanceData</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>instanceData</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkBuffer">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-dst-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-dst-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-dst-parameter</span><br>
 <code>dst</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureNV">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-src-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-src-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-src-parameter</span><br>
 If <code>src</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>src</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureNV">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-scratch-parameter</span><br>
 <code>scratch</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkBuffer">VkBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-renderpass" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-renderpass"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-videocoding" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-videocoding"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildAccelerationStructureNV-commonparent" href="chap39.html#VUID-vkCmdBuildAccelerationStructureNV-commonparent"></a> <span class="vuid">VUID-vkCmdBuildAccelerationStructureNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>dst</code>, <code>instanceData</code>, <code>scratch</code>, and <code>src</code> that are valid handles of non-ignored parameters <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <a href="chap5.html#VkDevice">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdBuildAccelerationStructureNV is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkTransformMatrixKHR</code> structure is defined as:</p>
</div>
<div id="VkTransformMatrixKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkTransformMatrixKHR</span> <span class="p">{</span>
    <span class="kt">float</span>    <span class="n">matrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span> <span class="n">VkTransformMatrixKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkTransformMatrixNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="k">typedef</span> <span class="n">VkTransformMatrixKHR</span> <span class="n">VkTransformMatrixNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>matrix</code> is a 3x4 row-major affine transformation matrix.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkTransformMatrixKHR-matrix-03799" href="chap39.html#VUID-VkTransformMatrixKHR-matrix-03799"></a> <span class="vuid">VUID-VkTransformMatrixKHR-matrix-03799</span><br>

The first three columns of <code>matrix</code> <strong class="purple">must</strong> define an invertible 3x3
matrix</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryAabbsDataKHR</code> structure is defined
as:</p>
</div>
<div id="VkAccelerationStructureGeometryAabbsDataKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureGeometryAabbsDataKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                  <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                      <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">data</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                     <span class="n">stride</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureGeometryAabbsDataKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>data</code> is a device or host address to memory containing
<a href="chap39.html#VkAabbPositionsKHR">VkAabbPositionsKHR</a> structures containing position data for each
axis-aligned bounding box in the geometry.</p>
</li>
<li>
<p><code>stride</code> is the stride in bytes between each entry in <code>data</code>.
The stride <strong class="purple">must</strong> be a multiple of <code>8</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545" href="chap39.html#VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03545</span><br>

<code>stride</code> <strong class="purple">must</strong> be a multiple of <code>8</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820" href="chap39.html#VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-stride-03820</span><br>

<code>stride</code> <strong class="purple">must</strong> be less than or equal to <span class="eq">2<sup>32</sup>-1</span></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType" href="chap39.html#VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_AABBS_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext" href="chap39.html#VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryAabbsDataKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAabbPositionsKHR</code> structure is defined as:</p>
</div>
<div id="VkAabbPositionsKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAabbPositionsKHR</span> <span class="p">{</span>
    <span class="kt">float</span>    <span class="n">minX</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">minY</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">minZ</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">maxX</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">maxY</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">maxZ</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAabbPositionsKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkAabbPositionsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="k">typedef</span> <span class="n">VkAabbPositionsKHR</span> <span class="n">VkAabbPositionsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>minX</code> is the x position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>minY</code> is the y position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>minZ</code> is the z position of one opposing corner of a bounding box.</p>
</li>
<li>
<p><code>maxX</code> is the x position of the other opposing corner of a bounding
box.</p>
</li>
<li>
<p><code>maxY</code> is the y position of the other opposing corner of a bounding
box.</p>
</li>
<li>
<p><code>maxZ</code> is the z position of the other opposing corner of a bounding
box.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minX-03546" href="chap39.html#VUID-VkAabbPositionsKHR-minX-03546"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minX-03546</span><br>

<code>minX</code> <strong class="purple">must</strong> be less than or equal to <code>maxX</code></p>
</li>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minY-03547" href="chap39.html#VUID-VkAabbPositionsKHR-minY-03547"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minY-03547</span><br>

<code>minY</code> <strong class="purple">must</strong> be less than or equal to <code>maxY</code></p>
</li>
<li>
<p><a id="VUID-VkAabbPositionsKHR-minZ-03548" href="chap39.html#VUID-VkAabbPositionsKHR-minZ-03548"></a> <span class="vuid">VUID-VkAabbPositionsKHR-minZ-03548</span><br>

<code>minZ</code> <strong class="purple">must</strong> be less than or equal to <code>maxZ</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryInstancesDataKHR</code> structure is
defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryInstancesDataKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureGeometryInstancesDataKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                  <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                      <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkBool32</span>                         <span class="n">arrayOfPointers</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureGeometryInstancesDataKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>arrayOfPointers</code> specifies whether <code>data</code> is used as an array
of addresses or just an array.</p>
</li>
<li>
<p><code>data</code> is either the address of an array of device or host addresses
referencing individual <a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
structures
or packed motion instance information as described in
<a href="chap39.html#acceleration-structure-motion-instances">motion instances</a>
if <code>arrayOfPointers</code> is <code>VK_TRUE</code>, or the address of an array of
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
or <a href="chap39.html#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a>
structures.
Addresses and <a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structures are
tightly packed.
<a href="chap39.html#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> structures have a stride
of 160 bytes.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType" href="chap39.html#VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryInstancesDataKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_INSTANCES_DATA_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext" href="chap39.html#VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryInstancesDataKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Acceleration structure instances</em> <strong class="purple">can</strong> be built into top-level acceleration
structures.
Each acceleration structure instance is a separate entry in the top-level
acceleration structure which includes all the geometry of a bottom-level
acceleration structure at a transformed location.
Multiple instances <strong class="purple">can</strong> point to the same bottom level acceleration
structure.</p>
</div>
<div class="paragraph">
<p>An acceleration structure instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureInstanceKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureInstanceKHR</span> <span class="p">{</span>
    <span class="n">VkTransformMatrixKHR</span>          <span class="n">transform</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">instanceCustomIndex</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">mask</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">instanceShaderBindingTableRecordOffset</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
    <span class="n">VkGeometryInstanceFlagsKHR</span>    <span class="n">flags</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
    <span class="kt">uint64_t</span>                      <span class="n">accelerationStructureReference</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureInstanceKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkAccelerationStructureInstanceNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="k">typedef</span> <span class="n">VkAccelerationStructureInstanceKHR</span> <span class="n">VkAccelerationStructureInstanceNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transform</code> is a <a href="chap39.html#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit application-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong class="purple">may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="chap39.html#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is
either
    :</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="chap12.html#vkGetAccelerationStructureDeviceAddressKHR">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="chap12.html#vkGetAccelerationStructureHandleNV">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures)
or,</p>
</li>
<li>
<p>a device address containing a bottom level cluster acceleration
structure built using
<a href="chap39.html#vkCmdBuildClusterAccelerationStructureIndirectNV">vkCmdBuildClusterAccelerationStructureIndirectNV</a></p>
</li>
<li>
<p>a <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong class="purple">must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureInstanceKHR-flags-parameter" href="chap39.html#VUID-VkAccelerationStructureInstanceKHR-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureInstanceKHR-flags-parameter</span><br>
 <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap39.html#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>flags</code> in the instance modifying the behavior of
that instance are:</p>
</div>
<div id="VkGeometryInstanceFlagBitsKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkGeometryInstanceFlagBitsKHR</span> <span class="p">{</span>
    <span class="n">VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR</span> <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
    <span class="n">VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR</span> <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
    <span class="n">VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</span> <span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
    <span class="n">VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</span> <span class="o">=</span> <span class="mh">0x00000008</span><span class="p">,</span>
  <span class="c1">// Provided by VK_EXT_opacity_micromap</span>
    <span class="n">VK_GEOMETRY_INSTANCE_FORCE_OPACITY_MICROMAP_2_STATE_BIT_EXT</span> <span class="o">=</span> <span class="mh">0x00000010</span><span class="p">,</span>
  <span class="c1">// Provided by VK_EXT_opacity_micromap</span>
    <span class="n">VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_BIT_EXT</span> <span class="o">=</span> <span class="mh">0x00000020</span><span class="p">,</span>
    <span class="n">VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_KHR</span> <span class="o">=</span> <span class="n">VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR</span><span class="p">,</span>
  <span class="c1">// Provided by VK_NV_ray_tracing</span>
    <span class="n">VK_GEOMETRY_INSTANCE_TRIANGLE_CULL_DISABLE_BIT_NV</span> <span class="o">=</span> <span class="n">VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR</span><span class="p">,</span>
  <span class="c1">// Provided by VK_NV_ray_tracing</span>
    <span class="n">VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_NV</span> <span class="o">=</span> <span class="n">VK_GEOMETRY_INSTANCE_TRIANGLE_FRONT_COUNTERCLOCKWISE_BIT_KHR</span><span class="p">,</span>
  <span class="c1">// Provided by VK_NV_ray_tracing</span>
    <span class="n">VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_NV</span> <span class="o">=</span> <span class="n">VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</span><span class="p">,</span>
  <span class="c1">// Provided by VK_NV_ray_tracing</span>
    <span class="n">VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_NV</span> <span class="o">=</span> <span class="n">VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</span><span class="p">,</span>
  <span class="c1">// Provided by VK_EXT_opacity_micromap</span>
  <span class="c1">// VK_GEOMETRY_INSTANCE_FORCE_OPACITY_MICROMAP_2_STATE_EXT is a deprecated alias</span>
    <span class="n">VK_GEOMETRY_INSTANCE_FORCE_OPACITY_MICROMAP_2_STATE_EXT</span> <span class="o">=</span> <span class="n">VK_GEOMETRY_INSTANCE_FORCE_OPACITY_MICROMAP_2_STATE_BIT_EXT</span><span class="p">,</span>
  <span class="c1">// Provided by VK_EXT_opacity_micromap</span>
  <span class="c1">// VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_EXT is a deprecated alias</span>
    <span class="n">VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_EXT</span> <span class="o">=</span> <span class="n">VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_BIT_EXT</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkGeometryInstanceFlagBitsKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkGeometryInstanceFlagBitsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="k">typedef</span> <span class="n">VkGeometryInstanceFlagBitsKHR</span> <span class="n">VkGeometryInstanceFlagBitsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_GEOMETRY_INSTANCE_TRIANGLE_FACING_CULL_DISABLE_BIT_KHR</code> disables
face culling for this instance.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_TRIANGLE_FLIP_FACING_BIT_KHR</code> specifies that
the <a href="chap42.html#ray-traversal-culling-face">facing determination</a> for geometry in
this instance is inverted.
Because the facing is determined in object space, an instance transform
does not change the winding, but a geometry transform does.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</code> causes this instance to
act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code> were specified on all
geometries referenced by this instance.
This behavior <strong class="purple">can</strong> be overridden by the SPIR-V <code>NoOpaqueKHR</code> ray
flag.</p>
</li>
<li>
<p><code>VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</code> causes this instance
to act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code> were not specified on
all geometries referenced by this instance.
This behavior <strong class="purple">can</strong> be overridden by the SPIR-V <code>OpaqueKHR</code> ray flag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>VK_GEOMETRY_INSTANCE_FORCE_NO_OPAQUE_BIT_KHR</code> and
<code>VK_GEOMETRY_INSTANCE_FORCE_OPAQUE_BIT_KHR</code> <strong class="purple">must</strong> not be used in the
same flag.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkGeometryInstanceFlagsKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="n">VkFlags</span> <span class="n">VkGeometryInstanceFlagsKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkGeometryInstanceFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="k">typedef</span> <span class="n">VkGeometryInstanceFlagsKHR</span> <span class="n">VkGeometryInstanceFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkGeometryInstanceFlagsKHR</code> is a bitmask type for setting a mask of
zero or more <a href="chap39.html#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><em>Acceleration structure motion instances</em> <strong class="purple">can</strong> be built into top-level
acceleration structures.
Each acceleration structure instance is a separate entry in the top-level
acceleration structure which includes all the geometry of a bottom-level
acceleration structure at a transformed location including a type of motion
and parameters to determine the motion of the instance over time.</p>
</div>
<div class="paragraph">
<p>An acceleration structure motion instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_motion_blur</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureMotionInstanceNV</span> <span class="p">{</span>
    <span class="n">VkAccelerationStructureMotionInstanceTypeNV</span>     <span class="n">type</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureMotionInstanceFlagsNV</span>    <span class="n">flags</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureMotionInstanceDataNV</span>     <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureMotionInstanceNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>type</code> is a <a href="chap39.html#VkAccelerationStructureMotionInstanceTypeNV">VkAccelerationStructureMotionInstanceTypeNV</a>
enumerant identifying which type of motion instance this is and which
type of the union is valid.</p>
</li>
<li>
<p><code>flags</code> is currently unused, but is required to keep natural
alignment of <code>data</code>.</p>
</li>
<li>
<p><code>data</code> is a <a href="chap39.html#VkAccelerationStructureMotionInstanceDataNV">VkAccelerationStructureMotionInstanceDataNV</a>
containing motion instance data for this instance.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If writing this other than with a standard C compiler, note that the final
structure should be 152 bytes in size.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-type-parameter" href="chap39.html#VUID-VkAccelerationStructureMotionInstanceNV-type-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-type-parameter</span><br>
 <code>type</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkAccelerationStructureMotionInstanceTypeNV">VkAccelerationStructureMotionInstanceTypeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask" href="chap39.html#VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-flags-zerobitmask</span><br>
 <code>flags</code> <strong class="purple">must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter" href="chap39.html#VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-staticInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV</code>, the <code>staticInstance</code> member of <code>data</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter" href="chap39.html#VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-matrixMotionInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV</code>, the <code>matrixMotionInstance</code> member of <code>data</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter" href="chap39.html#VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMotionInstanceNV-srtMotionInstance-parameter</span><br>
 If <code>type</code> is <code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV</code>, the <code>srtMotionInstance</code> member of <code>data</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Acceleration structure motion instance is defined by the union:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceDataNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_motion_blur</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">VkAccelerationStructureMotionInstanceDataNV</span> <span class="p">{</span>
    <span class="n">VkAccelerationStructureInstanceKHR</span>               <span class="n">staticInstance</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureMatrixMotionInstanceNV</span>    <span class="n">matrixMotionInstance</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureSRTMotionInstanceNV</span>       <span class="n">srtMotionInstance</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureMotionInstanceDataNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>staticInstance</code> is a <a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
structure containing data for a static instance.</p>
</li>
<li>
<p><code>matrixMotionInstance</code> is a
<a href="chap39.html#VkAccelerationStructureMatrixMotionInstanceNV">VkAccelerationStructureMatrixMotionInstanceNV</a> structure containing
data for a matrix motion instance.</p>
</li>
<li>
<p><code>srtMotionInstance</code> is a
<a href="chap39.html#VkAccelerationStructureSRTMotionInstanceNV">VkAccelerationStructureSRTMotionInstanceNV</a> structure containing
data for an SRT motion instance.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkAccelerationStructureMotionInstanceFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_motion_blur</span>
<span class="k">typedef</span> <span class="n">VkFlags</span> <span class="n">VkAccelerationStructureMotionInstanceFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkAccelerationStructureMotionInstanceFlagsNV</code> is a bitmask type for
setting a mask, but is currently reserved for future use.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureMotionInstanceTypeNV</code> enumeration is defined
as:</p>
</div>
<div id="VkAccelerationStructureMotionInstanceTypeNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_motion_blur</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkAccelerationStructureMotionInstanceTypeNV</span> <span class="p">{</span>
    <span class="n">VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureMotionInstanceTypeNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_STATIC_NV</code> specifies
that the instance is a static instance with no instance motion.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_MATRIX_MOTION_NV</code>
specifies that the instance is a motion instance with motion specified
by interpolation between two matrices.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_MOTION_INSTANCE_TYPE_SRT_MOTION_NV</code>
specifies that the instance is a motion instance with motion specified
by interpolation in the SRT decomposition.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure matrix motion instance is defined by the
structure:</p>
</div>
<div id="VkAccelerationStructureMatrixMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_motion_blur</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureMatrixMotionInstanceNV</span> <span class="p">{</span>
    <span class="n">VkTransformMatrixKHR</span>          <span class="n">transformT0</span><span class="p">;</span>
    <span class="n">VkTransformMatrixKHR</span>          <span class="n">transformT1</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">instanceCustomIndex</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">mask</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">instanceShaderBindingTableRecordOffset</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
    <span class="n">VkGeometryInstanceFlagsKHR</span>    <span class="n">flags</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
    <span class="kt">uint64_t</span>                      <span class="n">accelerationStructureReference</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureMatrixMotionInstanceNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transformT0</code> is a <a href="chap39.html#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure at time 0.</p>
</li>
<li>
<p><code>transformT1</code> is a <a href="chap39.html#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing a
transformation to be applied to the acceleration structure at time 1.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit application-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong class="purple">may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="chap39.html#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is either:</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="chap12.html#vkGetAccelerationStructureDeviceAddressKHR">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="chap12.html#vkGetAccelerationStructureHandleNV">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures) or,</p>
</li>
<li>
<p>a <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong class="purple">must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>The transform for a matrix motion instance at a point in time is derived by
component-wise linear interpolation of the two transforms.
That is, for a <code>time</code> in [0,1] the resulting transform is</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>transformT0</code> × (1 - <code>time</code>) + 
<code>transformT1</code> × <code>time</code></span></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter" href="chap39.html#VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureMatrixMotionInstanceNV-flags-parameter</span><br>
 <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap39.html#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure SRT motion instance is defined by the structure:</p>
</div>
<div id="VkAccelerationStructureSRTMotionInstanceNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_motion_blur</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureSRTMotionInstanceNV</span> <span class="p">{</span>
    <span class="n">VkSRTDataNV</span>                   <span class="n">transformT0</span><span class="p">;</span>
    <span class="n">VkSRTDataNV</span>                   <span class="n">transformT1</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">instanceCustomIndex</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">mask</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                      <span class="n">instanceShaderBindingTableRecordOffset</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
    <span class="n">VkGeometryInstanceFlagsKHR</span>    <span class="n">flags</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
    <span class="kt">uint64_t</span>                      <span class="n">accelerationStructureReference</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureSRTMotionInstanceNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transformT0</code> is a <a href="chap39.html#VkSRTDataNV">VkSRTDataNV</a> structure describing a
transformation to be applied to the acceleration structure at time 0.</p>
</li>
<li>
<p><code>transformT1</code> is a <a href="chap39.html#VkSRTDataNV">VkSRTDataNV</a> structure describing a
transformation to be applied to the acceleration structure at time 1.</p>
</li>
<li>
<p><code>instanceCustomIndex</code> is a 24-bit application-specified index value
accessible to ray shaders in the <code>InstanceCustomIndexKHR</code> built-in.</p>
</li>
<li>
<p><code>mask</code> is an 8-bit visibility mask for the geometry.
The instance <strong class="purple">may</strong> only be hit if <code>Cull Mask &amp; instance.mask != 0</code></p>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> is a 24-bit offset used in
calculating the hit shader binding table index.</p>
</li>
<li>
<p><code>flags</code> is an 8-bit mask of <a href="chap39.html#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a>
values to apply to this instance.</p>
</li>
<li>
<p><code>accelerationStructureReference</code> is either:</p>
<div class="ulist">
<ul>
<li>
<p>a device address containing the value obtained from
<a href="chap12.html#vkGetAccelerationStructureDeviceAddressKHR">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="chap12.html#vkGetAccelerationStructureHandleNV">vkGetAccelerationStructureHandleNV</a>
     (used by device operations which reference acceleration structures) or,</p>
</li>
<li>
<p>a <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> object (used by host operations
which reference acceleration structures).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> and <code>mask</code> occupy the same memory as if a
single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceCustomIndex</code> occupies the 24 least significant bits of
that memory</p>
</li>
<li>
<p><code>mask</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> and <code>flags</code> occupy the
same memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>instanceShaderBindingTableRecordOffset</code> occupies the 24 least
significant bits of that memory</p>
</li>
<li>
<p><code>flags</code> occupies the 8 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong class="purple">must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>The transform for a SRT motion instance at a point in time is derived from
component-wise linear interpolation of the two SRT transforms.
That is, for a <code>time</code> in [0,1] the resulting transform is</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>transformT0</code> × (1 - <code>time</code>) + 
<code>transformT1</code> × <code>time</code></span></p>
</dd>
</dl>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter" href="chap39.html#VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureSRTMotionInstanceNV-flags-parameter</span><br>
 <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap39.html#VkGeometryInstanceFlagBitsKHR">VkGeometryInstanceFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>An acceleration structure SRT transform is defined by the structure:</p>
</div>
<div id="VkSRTDataNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_motion_blur</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkSRTDataNV</span> <span class="p">{</span>
    <span class="kt">float</span>    <span class="n">sx</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">a</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">b</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">pvx</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">sy</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">c</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">pvy</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">sz</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">pvz</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">qx</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">qy</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">qz</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">qw</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">tx</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">ty</span><span class="p">;</span>
    <span class="kt">float</span>    <span class="n">tz</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkSRTDataNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sx</code> is the x component of the scale of the transform</p>
</li>
<li>
<p><code>a</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>b</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>pvx</code> is the x component of the pivot point of the transform</p>
</li>
<li>
<p><code>sy</code> is the y component of the scale of the transform</p>
</li>
<li>
<p><code>c</code> is one component of the shear for the transform</p>
</li>
<li>
<p><code>pvy</code> is the y component of the pivot point of the transform</p>
</li>
<li>
<p><code>sz</code> is the z component of the scale of the transform</p>
</li>
<li>
<p><code>pvz</code> is the z component of the pivot point of the transform</p>
</li>
<li>
<p><code>qx</code> is the x component of the rotation quaternion</p>
</li>
<li>
<p><code>qy</code> is the y component of the rotation quaternion</p>
</li>
<li>
<p><code>qz</code> is the z component of the rotation quaternion</p>
</li>
<li>
<p><code>qw</code> is the w component of the rotation quaternion</p>
</li>
<li>
<p><code>tx</code> is the x component of the post-rotation translation</p>
</li>
<li>
<p><code>ty</code> is the y component of the post-rotation translation</p>
</li>
<li>
<p><code>tz</code> is the z component of the post-rotation translation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This transform decomposition consists of three elements.
The first is a matrix S, consisting of a scale, shear, and translation,
usually used to define the pivot point of the following rotation.
This matrix is constructed from the parameters above by:</p>
</div>
<div class="stemblock">
<div class="content">
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,84c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-92c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">sy</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">sz</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">vx</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,9
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-144c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span></span>
</div>
</div>
<div class="paragraph">
<p>The rotation quaternion is defined as:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>R</code> = [ <code>qx</code>, <code>qy</code>, <code>qz</code>, <code>qw</code> ]</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is a rotation around a conceptual normalized axis <span class="eq">[ ax, ay, az ]</span>
of amount <code>theta</code> such that:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq">[ <code>qx</code>, <code>qy</code>, <code>qz</code> ] = sin(<code>theta</code>/2)
× [ <code>ax</code>, <code>ay</code>, <code>az</code> ]</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>qw</code> = cos(<code>theta</code>/2)</span></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Finally, the transform has a translation T constructed from the parameters
above by:</p>
</div>
<div class="stemblock">
<div class="content">
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,84c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-92c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.875em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.875em" height="3.600em" viewBox="0 0 875 3600"><path d="M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,9
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-144c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span></span>
</div>
</div>
<div class="paragraph">
<p>The effective derived transform is then given by</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"></dt>
<dd>
<p><span class="eq"><code>T</code> × <code>R</code> × <code>S</code></span></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If a <code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure is included in the <code>pNext</code> chain of a
<a href="chap39.html#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structure whose <code>geometryType</code>
member is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, then
that structure defines triangle geometry using compressed data.</p>
</div>
<div class="paragraph">
<p>The <code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure is defined as:</p>
</div>
<div id="VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_AMDX_dense_geometry_format</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                   <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                       <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>     <span class="n">compressedData</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                      <span class="n">dataSize</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                          <span class="n">numTriangles</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                          <span class="n">numVertices</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                          <span class="n">maxPrimitiveIndex</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                          <span class="n">maxGeometryIndex</span><span class="p">;</span>
    <span class="n">VkCompressedTriangleFormatAMDX</span>    <span class="n">format</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>compressedData</code> specifies the base address of the compressed data.</p>
</li>
<li>
<p><code>dataSize</code> specifies the size of the compressed data.</p>
</li>
<li>
<p><code>numTriangles</code> specifies the total number of triangles encoded in
the compressed data.</p>
</li>
<li>
<p><code>numVertices</code> specifies the number of vertices in the compressed
data.</p>
</li>
<li>
<p><code>maxPrimitiveIndex</code> specifies the maximum primitive index encoded in
the compressed data.</p>
</li>
<li>
<p><code>maxGeometryIndex</code> specifies the maximum geometry index encoded in
the compressed data.</p>
</li>
<li>
<p><code>format</code> specifies the <a href="chap39.html#VkCompressedTriangleFormatAMDX">VkCompressedTriangleFormatAMDX</a> format
of the compressed data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>format</code> is <code>VK_COMPRESSED_TRIANGLE_FORMAT_DGF1_AMDX</code>,
<code>numVertices</code> specifies the sum of vertex counts across all blocks.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-compressedData-10885" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-compressedData-10885"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-compressedData-10885</span><br>

The buffer from which <code>compressedData.deviceAddress</code> is queried
<strong class="purple">must</strong> have been created with the
<code>VK_BUFFER_USAGE_2_COMPRESSED_DATA_DGF1_BIT_AMDX</code> usage flag</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-denseGeometryFormat-10886" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-denseGeometryFormat-10886"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-denseGeometryFormat-10886</span><br>

The <a href="chap51.html#features-denseGeometryFormat"><code>VkPhysicalDeviceDenseGeometryFormatFeaturesAMDX</code>::<code>denseGeometryFormat</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-10887" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-10887"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-10887</span><br>

If <code>format</code> is VK_COMPRESSED_TRIANGLE_FORMAT_DGF1_AMDX, then
<code>compressedData.address</code> <strong class="purple">must</strong> be aligned to 128 bytes</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-10888" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-10888"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-10888</span><br>

If <code>format</code> is VK_COMPRESSED_TRIANGLE_FORMAT_DGF1_AMDX, then
<code>dataSize</code> <strong class="purple">must</strong> be aligned to 128 bytes</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-pNext-10890" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-pNext-10890"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-pNext-10890</span><br>

<code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code> or a pointer to a valid
<a href="chap39.html#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a> structure</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-pNext-10891" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-pNext-10891"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-pNext-10891</span><br>

If <code>pNext</code> is a pointer to a valid
<a href="chap39.html#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a> structure, the
<a href="chap51.html#features-micromap"><code>micromap</code></a> feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-sType-sType" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_DENSE_GEOMETRY_FORMAT_TRIANGLES_DATA_AMDX</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-compressedData-parameter" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-compressedData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-compressedData-parameter</span><br>
 <code>compressedData</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-parameter" href="chap39.html#VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX-format-parameter</span><br>
 <code>format</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkCompressedTriangleFormatAMDX">VkCompressedTriangleFormatAMDX</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCompressedTriangleFormatAMDX</code> enumeration is defined as:</p>
</div>
<div id="VkCompressedTriangleFormatAMDX" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_AMDX_dense_geometry_format</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkCompressedTriangleFormatAMDX</span> <span class="p">{</span>
    <span class="n">VK_COMPRESSED_TRIANGLE_FORMAT_DGF1_AMDX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkCompressedTriangleFormatAMDX</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COMPRESSED_TRIANGLE_FORMAT_DGF1_AMDX</code> specifies that the
compressed triangle data is in <a href="chap40.html#dense-geometry-format">Dense Geometry
Format</a>, version 1, consisting of an array of 128B DGF blocks.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>VkAccelerationStructureBuildRangeInfoKHR</code> is defined as:</p>
</div>
<div id="VkAccelerationStructureBuildRangeInfoKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureBuildRangeInfoKHR</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>    <span class="n">primitiveCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>    <span class="n">primitiveOffset</span><span class="p">;</span>
    <span class="kt">uint32_t</span>    <span class="n">firstVertex</span><span class="p">;</span>
    <span class="kt">uint32_t</span>    <span class="n">transformOffset</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureBuildRangeInfoKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>primitiveCount</code> defines the number of primitives for a
corresponding acceleration structure geometry.</p>
</li>
<li>
<p><code>primitiveOffset</code> defines an offset in bytes into the memory where
primitive data is defined.</p>
</li>
<li>
<p><code>firstVertex</code> is the index of the first vertex to build from for
triangle geometry.</p>
</li>
<li>
<p><code>transformOffset</code> defines an offset in bytes into the memory where a
transform matrix is defined.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The primitive count and primitive offset are interpreted differently
depending on the <a href="chap12.html#VkGeometryTypeKHR">VkGeometryTypeKHR</a> used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>primitiveCount</code> is the number of triangles to be built, where each
triangle is treated as 3 vertices.</p>
<div class="ulist">
<ul>
<li>
<p>If the geometry uses indices, <span class="eq"><code>primitiveCount</code> × 3</span>
indices are consumed from
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>,
starting at an offset of <code>primitiveOffset</code>.
The value of <code>firstVertex</code> is added to the index values before
fetching vertices.</p>
</li>
<li>
<p>If the geometry does not use indices, <span class="eq"><code>primitiveCount</code> ×
3</span> vertices are consumed from
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexStride</code>
× <code>firstVertex</code></span>.</p>
</li>
<li>
<p>If
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>
is not <code>NULL</code>, a single <a href="chap39.html#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure is
consumed from
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>,
at an offset of <code>transformOffset</code>.
This matrix describes a transformation from the space in which the
vertices for all triangles in this geometry are described to the space
in which the acceleration structure is defined.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>,
<code>primitiveCount</code> is the number of axis-aligned bounding boxes.
<code>primitiveCount</code> <a href="chap39.html#VkAabbPositionsKHR">VkAabbPositionsKHR</a> structures are consumed
from <a href="chap39.html#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code>,
starting at an offset of <code>primitiveOffset</code>.</p>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_SPHERES_NV</code>,
<code>primitiveCount</code> is the number of spheres to be built, where each
sphere is treated as 1 vertex.</p>
<div class="ulist">
<ul>
<li>
<p>If the geometry uses indices, <code>primitiveCount</code> indices are consumed
from
<a href="chap39.html#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>indexData</code>,
starting at an offset of <code>primitiveOffset</code>.
The value of <code>firstVertex</code> is added to the index values before
fetching vertices and radii.</p>
</li>
<li>
<p>If the geometry does not use indices, <code>primitiveCount</code> vertices and
radii are consumed from
<a href="chap39.html#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>vertexData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="chap39.html#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>vertexStride</code>
× <code>firstVertex</code></span> and
<a href="chap39.html#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>radiusData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="chap39.html#VkAccelerationStructureGeometrySpheresDataNV">VkAccelerationStructureGeometrySpheresDataNV</a>::<code>radiusStride</code>
× <code>firstVertex</code></span> respectively.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_LINEAR_SWEPT_SPHERES_NV</code>,
<code>primitiveCount</code> is the number of LSS primitives to be built, where
each LSS primitive is treated as 2 vertices.</p>
<div class="ulist">
<ul>
<li>
<p>If the geometry uses indices, <span class="eq"><code>primitiveCount</code> × 2</span>
indices are consumed from
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>indexData</code>,
starting at an offset of <code>primitiveOffset</code>.
The value of <code>firstVertex</code> is added to the index values before
fetching vertices and radii.</p>
</li>
<li>
<p>If the geometry does not use indices, <span class="eq"><code>primitiveCount</code> ×
2</span> vertices and radii are consumed from
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>vertexData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>vertexStride</code>
× <code>firstVertex</code></span> and
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>radiusData</code>,
starting at an offset of <span class="eq"><code>primitiveOffset</code> + 
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>radiusStride</code>
× <code>firstVertex</code></span> respectively.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For geometries of type <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>primitiveCount</code> is the number of acceleration structures.
<code>primitiveCount</code> <a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>
or <a href="chap39.html#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a>
structures are consumed from
<a href="chap39.html#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code>,
starting at an offset of <code>primitiveOffset</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-vertexData-10418" href="chap39.html#VUID-VkAccelerationStructureBuildRangeInfoKHR-vertexData-10418"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-vertexData-10418</span><br>

The number of vertices consumed from
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>
<strong class="purple">must</strong> be less than or equal to
<span class="eq"><a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>maxVertex</code>
+ 1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656" href="chap39.html#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03656</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if the
geometry uses indices, the offset <code>primitiveOffset</code> from
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>
<strong class="purple">must</strong> be a multiple of the element size of
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657" href="chap39.html#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03657</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if the
geometry does not use indices, the offset <code>primitiveOffset</code> from
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexData</code>
<strong class="purple">must</strong> be a multiple of:</p>
<div class="ulist">
<ul>
<li>
<p>the <a href="chap53.html">size of the format</a> specified in
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexFormat</code>,
if that format is a <a href="chap53.html#formats-packed">packed format</a></p>
</li>
<li>
<p>the <a href="chap53.html">component size</a> of the
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>vertexFormat</code>,
if that format is not a <a href="chap53.html#formats-packed">packed format</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-maxVertex-10774" href="chap39.html#VUID-VkAccelerationStructureBuildRangeInfoKHR-maxVertex-10774"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-maxVertex-10774</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if the
geometry uses indices, then
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>maxVertex</code>
<strong class="purple">must</strong> be greater than or equal to <code>firstVertex</code> plus the maximum
index value found in the
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>indexData</code>
in the range <span class="eq">[<code>primitiveOffset</code>, <code>primitiveOffset</code><br>
<code>primitiveCount</code> x 3]</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-None-10775" href="chap39.html#VUID-VkAccelerationStructureBuildRangeInfoKHR-None-10775"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-None-10775</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if the
geometry does not use indices, then
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::maxVertex <strong class="purple">must</strong>
be greater than or equal to <span class="eq">firstVertex + primitiveCount x 3 - 1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658" href="chap39.html#VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-transformOffset-03658</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, the offset
<code>transformOffset</code> from
<a href="chap39.html#VkAccelerationStructureGeometryTrianglesDataKHR">VkAccelerationStructureGeometryTrianglesDataKHR</a>::<code>transformData</code>
<strong class="purple">must</strong> be a multiple of 16</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659" href="chap39.html#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03659</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, the offset
<code>primitiveOffset</code> from
<a href="chap39.html#VkAccelerationStructureGeometryAabbsDataKHR">VkAccelerationStructureGeometryAabbsDataKHR</a>::<code>data</code> <strong class="purple">must</strong> be a
multiple of 8</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660" href="chap39.html#VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660"></a> <span class="vuid">VUID-VkAccelerationStructureBuildRangeInfoKHR-primitiveOffset-03660</span><br>

For geometries of type <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the offset
<code>primitiveOffset</code> from
<a href="chap39.html#VkAccelerationStructureGeometryInstancesDataKHR">VkAccelerationStructureGeometryInstancesDataKHR</a>::<code>data</code> <strong class="purple">must</strong>
be a multiple of 16</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If <code>VkAccelerationStructureGeometryLinearSweptSpheresDataNV</code> is included
in the <code>pNext</code> chain of a <a href="chap39.html#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a>
structure, then that structures defines the linear swept sphere’s (LSS)
geometry data.</p>
</div>
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometryLinearSweptSpheresDataNV</code> structure
is defined as:</p>
</div>
<div id="VkAccelerationStructureGeometryLinearSweptSpheresDataNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_linear_swept_spheres</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                          <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                              <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkFormat</span>                                 <span class="n">vertexFormat</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>            <span class="n">vertexData</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                             <span class="n">vertexStride</span><span class="p">;</span>
    <span class="n">VkFormat</span>                                 <span class="n">radiusFormat</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>            <span class="n">radiusData</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                             <span class="n">radiusStride</span><span class="p">;</span>
    <span class="n">VkIndexType</span>                              <span class="n">indexType</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>            <span class="n">indexData</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                             <span class="n">indexStride</span><span class="p">;</span>
    <span class="n">VkRayTracingLssIndexingModeNV</span>            <span class="n">indexingMode</span><span class="p">;</span>
    <span class="n">VkRayTracingLssPrimitiveEndCapsModeNV</span>    <span class="n">endCapsMode</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="chap53.html#VkFormat">VkFormat</a> of each LSS vertex element.</p>
</li>
<li>
<p><code>vertexData</code> is a device or host address to memory containing vertex
data for this geometry.</p>
</li>
<li>
<p><code>vertexStride</code> is the stride in bytes between each vertex element.</p>
</li>
<li>
<p><code>radiusFormat</code> is the <a href="chap53.html#VkFormat">VkFormat</a> of each LSS radius.</p>
</li>
<li>
<p><code>radiusData</code> is a device or host address to memory containing LSS
radius data value.</p>
</li>
<li>
<p><code>radiusStride</code> is the stride in bytes between each radius value.</p>
</li>
<li>
<p><code>indexType</code> is the <a href="chap23.html#VkIndexType">VkIndexType</a> of each index element.</p>
</li>
<li>
<p><code>indexData</code> is <code>NULL</code> or a device or host address to memory
containing index data for vertex and radius buffers for this geometry.</p>
</li>
<li>
<p><code>indexStride</code> is the stride in bytes between each index element.</p>
</li>
<li>
<p><code>indexingMode</code> is a <a href="chap39.html#VkRayTracingLssIndexingModeNV">VkRayTracingLssIndexingModeNV</a> value
specifying the mode of indexing.</p>
</li>
<li>
<p><code>endCapsMode</code> is a <a href="chap39.html#VkRayTracingLssPrimitiveEndCapsModeNV">VkRayTracingLssPrimitiveEndCapsModeNV</a> value
specifying the endcaps mode for LSS primitives.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an index buffer is not specified in <code>indexData</code>, LSS primitives are
rendered individually using subsequent pairs of vertices similar to
<code>VK_PRIMITIVE_TOPOLOGY_LINE_LIST</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-None-10419" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-None-10419"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-None-10419</span><br>

The <a href="chap51.html#features-linearSweptSpheres">linearSweptSpheres</a> feature <strong class="purple">must</strong> be
enabled</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-10420" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-10420"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-10420</span><br>

The memory address in <code>vertexData</code> <strong class="purple">must</strong> not be <code>0</code> or `NULL'</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10421" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10421"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10421</span><br>

<code>vertexStride</code> <strong class="purple">must</strong> be a multiple of:</p>
<div class="ulist">
<ul>
<li>
<p>the <a href="chap53.html">size of the format</a> specified in <code>vertexFormat</code> if
that format is a <a href="chap53.html#formats-packed">packed format</a></p>
</li>
<li>
<p>the <a href="chap53.html">component size</a> specified in <code>vertexFormat</code> if that
format is not a <a href="chap53.html#formats-packed">packed format</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10422" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10422"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexStride-10422</span><br>

<code>vertexStride</code> and <code>radiusStride</code> <strong class="purple">must</strong> be less than or equal to
<span class="eq">2<sup>32</sup>-1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-10423" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-10423"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-10423</span><br>

The <a href="chap12.html#resources-buffer-view-format-features">format features</a> of
<code>vertexFormat</code> <strong class="purple">must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-10424" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-10424"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-10424</span><br>

The <a href="chap12.html#resources-buffer-view-format-features">format features</a> of
<code>radiusFormat</code> <strong class="purple">must</strong> contain
<code>VK_FORMAT_FEATURE_2_ACCELERATION_STRUCTURE_RADIUS_BUFFER_BIT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10425" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10425"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10425</span><br>

The memory address in <code>radiusData</code> <strong class="purple">must</strong> not be <code>0</code> or `NULL'</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10426" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10426"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-10426</span><br>

All values referenced in <code>radiusData</code> <strong class="purple">must</strong> be greater than or equal
to <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-10427" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-10427"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-10427</span><br>

If <code>indexingMode</code> is
<code>VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</code>, <code>indexData</code>
<strong class="purple">must</strong> not be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-10428" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-10428"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-10428</span><br>

If <code>indexData</code> is not <code>NULL</code>, <code>indexType</code> <strong class="purple">must</strong> be one of
<code>VK_INDEX_TYPE_UINT16</code> or <code>VK_INDEX_TYPE_UINT32</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-sType-sType" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_LINEAR_SWEPT_SPHERES_DATA_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong class="purple">must</strong> be a valid <a href="chap53.html#VkFormat">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-vertexData-parameter</span><br>
 <code>vertexData</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusFormat-parameter</span><br>
 <code>radiusFormat</code> <strong class="purple">must</strong> be a valid <a href="chap53.html#VkFormat">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-radiusData-parameter</span><br>
 <code>radiusData</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexType-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexType-parameter</span><br>
 <code>indexType</code> <strong class="purple">must</strong> be a valid <a href="chap23.html#VkIndexType">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexData-parameter</span><br>
 <code>indexData</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-indexingMode-parameter</span><br>
 <code>indexingMode</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkRayTracingLssIndexingModeNV">VkRayTracingLssIndexingModeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-endCapsMode-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-endCapsMode-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometryLinearSweptSpheresDataNV-endCapsMode-parameter</span><br>
 <code>endCapsMode</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkRayTracingLssPrimitiveEndCapsModeNV">VkRayTracingLssPrimitiveEndCapsModeNV</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Chaining LSS primitives <strong class="purple">can</strong> be achieved by specifying an index buffer in
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>indexData</code>
and setting
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>indexingMode</code>
to one of <code>VkRayTracingLssIndexingModeNV</code> values:</p>
</div>
<div id="VkRayTracingLssIndexingModeNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_linear_swept_spheres</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkRayTracingLssIndexingModeNV</span> <span class="p">{</span>
    <span class="n">VK_RAY_TRACING_LSS_INDEXING_MODE_LIST_NV</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkRayTracingLssIndexingModeNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_RAY_TRACING_LSS_INDEXING_MODE_LIST_NV</code> specifies that a list of
indices is provided where each consecutive pair of indices define a LSS
primitive.</p>
</li>
<li>
<p><code>VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</code> specifies a
successive implicit indexing format, in which each LSS primitive is
defined by two successive positions and radii, <span class="eq">(k, k + 1)</span>, where
<span class="eq">k</span> is a single index provided in the index buffer.
In this indexing scheme, there is a 1:1 mapping between the index buffer
and primitive index within the geometry.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The default behavior with endcaps in a LSS chain is that both endcaps will
be enabled for all beginning and end points.
To change the LSS chain’s endcaps mode use
<a href="chap39.html#VkAccelerationStructureGeometryLinearSweptSpheresDataNV">VkAccelerationStructureGeometryLinearSweptSpheresDataNV</a>::<code>endCapsMode</code>.
The possible values for <code>endCapsMode</code> are:</p>
</div>
<div id="VkRayTracingLssPrimitiveEndCapsModeNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_linear_swept_spheres</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkRayTracingLssPrimitiveEndCapsModeNV</span> <span class="p">{</span>
    <span class="n">VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_NONE_NV</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_CHAINED_NV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkRayTracingLssPrimitiveEndCapsModeNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_NONE_NV</code> disables all
endcaps and the chain boundaries have no influence.</p>
</li>
<li>
<p><code>VK_RAY_TRACING_LSS_PRIMITIVE_END_CAPS_MODE_CHAINED_NV</code> specifies
that when <code>VK_RAY_TRACING_LSS_INDEXING_MODE_SUCCESSIVE_NV</code> is used
as indexing mode for the LSS primitive, the first primitive in each
chain will have both endcaps enabled, and every following primitive in
the chain only has endcaps at the trailing position enabled.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>In addition to LSS primitives, simple sphere geometry is also supported.
Spheres do not have an endcap mode.
If an index buffer is present, each entry represents a single position and
radius describing one sphere primitive.
If no index buffer is provided, the vertex position and radius values are
sequentially read from the corresponding buffers.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If <code>VkAccelerationStructureGeometrySpheresDataNV</code> is included in the
<code>pNext</code> chain of a <a href="chap39.html#VkAccelerationStructureGeometryKHR">VkAccelerationStructureGeometryKHR</a> structure,
then that structures defines the sphere’s geometry data.</p>
</div>
<div class="paragraph">
<p>The <code>VkAccelerationStructureGeometrySpheresDataNV</code> structure is defined
as:</p>
</div>
<div id="VkAccelerationStructureGeometrySpheresDataNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing_linear_swept_spheres</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureGeometrySpheresDataNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                  <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                      <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkFormat</span>                         <span class="n">vertexFormat</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">vertexData</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                     <span class="n">vertexStride</span><span class="p">;</span>
    <span class="n">VkFormat</span>                         <span class="n">radiusFormat</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">radiusData</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                     <span class="n">radiusStride</span><span class="p">;</span>
    <span class="n">VkIndexType</span>                      <span class="n">indexType</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>    <span class="n">indexData</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                     <span class="n">indexStride</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureGeometrySpheresDataNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="chap53.html#VkFormat">VkFormat</a> of each sphere’s vertex
element.</p>
</li>
<li>
<p><code>vertexData</code> is a device or host address to memory containing vertex
data in form of pairs of centers of spheres that define all sphere
geometry.</p>
</li>
<li>
<p><code>vertexStride</code> is the stride in bytes between each vertex element.</p>
</li>
<li>
<p><code>radiusFormat</code> is the <a href="chap53.html#VkFormat">VkFormat</a> of each sphere’s radius.</p>
</li>
<li>
<p><code>radiusData</code> is a device or host address to memory containing
sphere’s radius data value.</p>
</li>
<li>
<p><code>radiusStride</code> is the stride in bytes between each radius value.</p>
</li>
<li>
<p><code>indexType</code> is the <a href="chap23.html#VkIndexType">VkIndexType</a> of each index element.</p>
</li>
<li>
<p><code>indexData</code> is <code>NULL</code> or a device or host address to memory
containing index data for vertex and radius buffers for this geometry.</p>
</li>
<li>
<p><code>indexStride</code> is the stride in bytes between each index element.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-None-10429" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-None-10429"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-None-10429</span><br>

The <a href="chap51.html#features-spheres">spheres</a> feature <strong class="purple">must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-10430" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-10430"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-10430</span><br>

The memory address in <code>vertexData</code> <strong class="purple">must</strong> not be <code>0</code> or `NULL'</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10431" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10431"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10431</span><br>

<code>vertexStride</code> <strong class="purple">must</strong> be a multiple of:</p>
<div class="ulist">
<ul>
<li>
<p>the <a href="chap53.html">size of the format</a> specified in <code>vertexFormat</code> if
that format is a <a href="chap53.html#formats-packed">packed format</a></p>
</li>
<li>
<p>the smallest <a href="chap53.html">component size</a> specified in
<code>vertexFormat</code> if that format is not a <a href="chap53.html#formats-packed">packed
format</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10432" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10432"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexStride-10432</span><br>

<code>vertexStride</code> and <code>radiusStride</code> <strong class="purple">must</strong> be less than or equal to
<span class="eq">2<sup>32</sup>-1</span></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10433" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10433"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10433</span><br>

The memory address in <code>radiusData</code> <strong class="purple">must</strong> not be <code>0</code> or `NULL'</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-10434" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-10434"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-10434</span><br>

The <a href="chap12.html#resources-buffer-view-format-features">format features</a> of
<code>vertexFormat</code> <strong class="purple">must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-10435" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-10435"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-10435</span><br>

The <a href="chap12.html#resources-buffer-view-format-features">format features</a> of
<code>radiusFormat</code> <strong class="purple">must</strong> contain
<code>VK_FORMAT_FEATURE_2_ACCELERATION_STRUCTURE_RADIUS_BUFFER_BIT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10436" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10436"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-10436</span><br>

All values referenced in <code>radiusData</code> <strong class="purple">must</strong> be greater than or equal
to <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-10437" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-10437"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-10437</span><br>

If <code>indexData</code> is not <code>NULL</code>, <code>indexType</code> <strong class="purple">must</strong> be one of
<code>VK_INDEX_TYPE_UINT16</code> or <code>VK_INDEX_TYPE_UINT32</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-sType-sType" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_GEOMETRY_SPHERES_DATA_NV</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong class="purple">must</strong> be a valid <a href="chap53.html#VkFormat">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-vertexData-parameter</span><br>
 <code>vertexData</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusFormat-parameter</span><br>
 <code>radiusFormat</code> <strong class="purple">must</strong> be a valid <a href="chap53.html#VkFormat">VkFormat</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-radiusData-parameter</span><br>
 <code>radiusData</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-indexType-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-indexType-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-indexType-parameter</span><br>
 <code>indexType</code> <strong class="purple">must</strong> be a valid <a href="chap23.html#VkIndexType">VkIndexType</a> value</p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-parameter" href="chap39.html#VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureGeometrySpheresDataNV-indexData-parameter</span><br>
 <code>indexData</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkDeviceOrHostAddressConstKHR">VkDeviceOrHostAddressConstKHR</a> union</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="acceleration-structure-copying"><a class="anchor" href="chap39.html#acceleration-structure-copying"></a>39.1.8. Copying Acceleration Structures</h4>
<div class="paragraph">
<p>An additional command exists for copying acceleration structures without
updating their contents.
The acceleration structure object <strong class="purple">can</strong> be compacted in order to improve
performance.
Before copying, an application <strong class="purple">must</strong> query the size of the resulting
acceleration structure.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters call:</p>
</div>
<div id="vkCmdWriteAccelerationStructuresPropertiesKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkCmdWriteAccelerationStructuresPropertiesKHR</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="kt">uint32_t</span>                                    <span class="n">accelerationStructureCount</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureKHR</span><span class="o">*</span>           <span class="n">pAccelerationStructures</span><span class="p">,</span>
    <span class="n">VkQueryType</span>                                 <span class="n">queryType</span><span class="p">,</span>
    <span class="n">VkQueryPool</span>                                 <span class="n">queryPool</span><span class="p">,</span>
    <span class="kt">uint32_t</span>                                    <span class="n">firstQuery</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="chap20.html#VkQueryType">VkQueryType</a> value specifying the type of
queries managed by the pool.</p>
</li>
<li>
<p><code>queryPool</code> is the query pool that will manage the results of the
query.</p>
</li>
<li>
<p><code>firstQuery</code> is the first query index within the query pool that
will contain the <code>accelerationStructureCount</code> number of results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to any of the acceleration structures listed in
<code>pAccelerationStructures</code> <strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a>, and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then the
value written out is the number of bytes required by a compacted
acceleration structure.</p>
</li>
<li>
<p>If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
the value written out is the number of bytes required by a serialized
acceleration structure.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructure-08924</span><br>

The <a href="chap51.html#features-accelerationStructure"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02493</span><br>

<code>queryPool</code> <strong class="purple">must</strong> have been created with a <code>queryType</code> matching
<code>queryType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-02494</span><br>

The queries identified by <code>queryPool</code> and <code>firstQuery</code> <strong class="purple">must</strong> be
<em>unavailable</em></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-buffer-03736</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong class="purple">must</strong> be bound to device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-query-04880</span><br>

The sum of <code>firstQuery</code> plus <code>accelerationStructureCount</code> <strong class="purple">must</strong>
be less than or equal to the number of queries in <code>queryPool</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong class="purple">must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong class="purple">must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-06742</span><br>

<code>queryType</code> <strong class="purple">must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, or
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handles</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryType-parameter</span><br>
 <code>queryType</code> <strong class="purple">must</strong> be a valid <a href="chap20.html#VkQueryType">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-queryPool-parameter</span><br>
 <code>queryPool</code> <strong class="purple">must</strong> be a valid <a href="chap20.html#VkQueryPool">VkQueryPool</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesKHR-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>queryPool</code>, and the elements of <code>pAccelerationStructures</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <a href="chap5.html#VkDevice">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdWriteAccelerationStructuresPropertiesKHR is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters for the
<code><a href="chap60.html#VK_NV_ray_tracing">VK_NV_ray_tracing</a></code> extension call:</p>
</div>
<div id="vkCmdWriteAccelerationStructuresPropertiesNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="kt">void</span> <span class="nf">vkCmdWriteAccelerationStructuresPropertiesNV</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="kt">uint32_t</span>                                    <span class="n">accelerationStructureCount</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureNV</span><span class="o">*</span>            <span class="n">pAccelerationStructures</span><span class="p">,</span>
    <span class="n">VkQueryType</span>                                 <span class="n">queryType</span><span class="p">,</span>
    <span class="n">VkQueryPool</span>                                 <span class="n">queryPool</span><span class="p">,</span>
    <span class="kt">uint32_t</span>                                    <span class="n">firstQuery</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="chap20.html#VkQueryType">VkQueryType</a> value specifying the type of
queries managed by the pool.</p>
</li>
<li>
<p><code>queryPool</code> is the query pool that will manage the results of the
query.</p>
</li>
<li>
<p><code>firstQuery</code> is the first query index within the query pool that
will contain the <code>accelerationStructureCount</code> number of results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to any of the acceleration structures listed in
<code>pAccelerationStructures</code> <strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03755</span><br>

<code>queryPool</code> <strong class="purple">must</strong> have been created with a <code>queryType</code> matching
<code>queryType</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-03756</span><br>

The queries identified by <code>queryPool</code> and <code>firstQuery</code> <strong class="purple">must</strong> be
<em>unavailable</em></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructure-03757</span><br>

<code>accelerationStructure</code> <strong class="purple">must</strong> be bound completely and contiguously
to a single <code>VkDeviceMemory</code> object via
<a href="chap12.html#vkBindAccelerationStructureMemoryNV">vkBindAccelerationStructureMemoryNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-04958</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong class="purple">must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-06215</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong class="purple">must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_NV</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-06216</span><br>

<code>queryType</code> <strong class="purple">must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_NV</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="chap12.html#VkAccelerationStructureNV">VkAccelerationStructureNV</a> handles</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryType-parameter</span><br>
 <code>queryType</code> <strong class="purple">must</strong> be a valid <a href="chap20.html#VkQueryType">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-queryPool-parameter</span><br>
 <code>queryPool</code> <strong class="purple">must</strong> be a valid <a href="chap20.html#VkQueryPool">VkQueryPool</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent" href="chap39.html#VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent"></a> <span class="vuid">VUID-vkCmdWriteAccelerationStructuresPropertiesNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>queryPool</code>, and the elements of <code>pAccelerationStructures</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <a href="chap5.html#VkDevice">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdWriteAccelerationStructuresPropertiesNV is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkCmdCopyAccelerationStructureKHR</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkCopyAccelerationStructureInfoKHR</span><span class="o">*</span>   <span class="n">pInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <a href="chap39.html#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command copies the <code>pInfo-&gt;src</code> acceleration structure to the
<code>pInfo-&gt;dst</code> acceleration structure in the manner specified by
<code>pInfo-&gt;mode</code>.</p>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> and <code>pInfo-&gt;dst</code> <strong class="purple">must</strong> be
<a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a>, and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code> as appropriate.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-accelerationStructure-08925</span><br>

The <a href="chap51.html#features-accelerationStructure"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-buffer-03737</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong class="purple">must</strong> be bound to
device memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-buffer-03738</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong class="purple">must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-renderpass" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureKHR-videocoding" href="chap39.html#VUID-vkCmdCopyAccelerationStructureKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureKHR-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdCopyAccelerationStructureKHR is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyAccelerationStructureInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkCopyAccelerationStructureInfoKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkCopyAccelerationStructureInfoKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                       <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                           <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureKHR</span>            <span class="n">src</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureKHR</span>            <span class="n">dst</span><span class="p">;</span>
    <span class="n">VkCopyAccelerationStructureModeKHR</span>    <span class="n">mode</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkCopyAccelerationStructureInfoKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="chap39.html#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-mode-03410" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-mode-03410"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-mode-03410</span><br>

<code>mode</code> <strong class="purple">must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> or
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-04963" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-src-04963"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-04963</span><br>

The source acceleration structure <code>src</code> <strong class="purple">must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-03411" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-src-03411"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-03411</span><br>

If <code>mode</code> is <code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code>,
<code>src</code> <strong class="purple">must</strong> have been constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> in the
build</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-buffer-03718</span><br>

The <code>buffer</code> used to create <code>src</code> <strong class="purple">must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-buffer-03719</span><br>

The <code>buffer</code> used to create <code>dst</code> <strong class="purple">must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-dst-07791" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-dst-07791"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-dst-07791</span><br>

The range of memory backing <code>dst</code> that is accessed by this command
<strong class="purple">must</strong> not overlap the memory backing <code>src</code> that is accessed by this
command</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-sType-sType" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_COPY_ACCELERATION_STRUCTURE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-src-parameter" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-src-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-src-parameter</span><br>
 <code>src</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-dst-parameter</span><br>
 <code>dst</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureInfoKHR-commonparent" href="chap39.html#VUID-VkCopyAccelerationStructureInfoKHR-commonparent"></a> <span class="vuid">VUID-VkCopyAccelerationStructureInfoKHR-commonparent</span><br>
 Both of <code>dst</code>, and <code>src</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <a href="chap5.html#VkDevice">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure for the <code><a href="chap60.html#VK_NV_ray_tracing">VK_NV_ray_tracing</a></code>
extension call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="kt">void</span> <span class="nf">vkCmdCopyAccelerationStructureNV</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="n">VkAccelerationStructureNV</span>                   <span class="n">dst</span><span class="p">,</span>
    <span class="n">VkAccelerationStructureNV</span>                   <span class="n">src</span><span class="p">,</span>
    <span class="n">VkCopyAccelerationStructureModeKHR</span>          <span class="n">mode</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="chap39.html#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>src</code> and <code>dst</code> <strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a>, and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code> as appropriate.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-mode-03410" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-mode-03410"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-mode-03410</span><br>

<code>mode</code> <strong class="purple">must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> or
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-04963" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-src-04963"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-04963</span><br>

The source acceleration structure <code>src</code> <strong class="purple">must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-03411" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-src-03411"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-03411</span><br>

If <code>mode</code> is <code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code>,
<code>src</code> <strong class="purple">must</strong> have been constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-buffer-03718" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-buffer-03718"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-buffer-03718</span><br>

The <code>buffer</code> used to create <code>src</code> <strong class="purple">must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-buffer-03719" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-buffer-03719"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-buffer-03719</span><br>

The <code>buffer</code> used to create <code>dst</code> <strong class="purple">must</strong> be bound to device
memory</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-07791" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-dst-07791"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-07791</span><br>

The range of memory backing <code>dst</code> that is accessed by this command
<strong class="purple">must</strong> not overlap the memory backing <code>src</code> that is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-07792" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-dst-07792"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-07792</span><br>

<code>dst</code> <strong class="purple">must</strong> be bound completely and contiguously to a single
<code>VkDeviceMemory</code> object via
<a href="chap12.html#vkBindAccelerationStructureMemoryNV">vkBindAccelerationStructureMemoryNV</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-dst-parameter" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-dst-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-dst-parameter</span><br>
 <code>dst</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureNV">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-src-parameter" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-src-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-src-parameter</span><br>
 <code>src</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureNV">VkAccelerationStructureNV</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-mode-parameter" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-mode-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-mode-parameter</span><br>
 <code>mode</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-renderpass" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-videocoding" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureNV-commonparent" href="chap39.html#VUID-vkCmdCopyAccelerationStructureNV-commonparent"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureNV-commonparent</span><br>
 Each of <code>commandBuffer</code>, <code>dst</code>, and <code>src</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from the same <a href="chap5.html#VkDevice">VkDevice</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdCopyAccelerationStructureNV is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>mode</code> specifying additional operations to perform
during the copy, are:</p>
</div>
<div id="VkCopyAccelerationStructureModeKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkCopyAccelerationStructureModeKHR</span> <span class="p">{</span>
    <span class="n">VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
  <span class="c1">// Provided by VK_KHR_acceleration_structure</span>
    <span class="n">VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
  <span class="c1">// Provided by VK_KHR_acceleration_structure</span>
    <span class="n">VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
  <span class="c1">// Provided by VK_NV_ray_tracing</span>
    <span class="n">VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_NV</span> <span class="o">=</span> <span class="n">VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</span><span class="p">,</span>
  <span class="c1">// Provided by VK_NV_ray_tracing</span>
    <span class="n">VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_NV</span> <span class="o">=</span> <span class="n">VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkCopyAccelerationStructureModeKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or the equivalent</p>
</div>
<div id="VkCopyAccelerationStructureModeNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_ray_tracing</span>
<span class="k">typedef</span> <span class="n">VkCopyAccelerationStructureModeKHR</span> <span class="n">VkCopyAccelerationStructureModeNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_CLONE_KHR</code> creates a direct
copy of the acceleration structure specified in <code>src</code> into the one
specified by <code>dst</code>.
The <code>dst</code> acceleration structure <strong class="purple">must</strong> have been created with the
same parameters as <code>src</code>.
If <code>src</code> contains references to other acceleration structures,
<code>dst</code> will reference the same acceleration structures.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_COMPACT_KHR</code> creates a more
    compact version of an acceleration structure <code>src</code> into <code>dst</code>.
    The acceleration structure <code>dst</code> <strong class="purple">must</strong> have been created with a size
    at least as large as that returned by
<a href="chap39.html#vkCmdWriteAccelerationStructuresPropertiesNV">vkCmdWriteAccelerationStructuresPropertiesNV</a>
,
    <a href="chap39.html#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a>, or
    <a href="chap39.html#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a>
    after the build of the acceleration structure specified by <code>src</code>.
    If <code>src</code> contains references to other acceleration structures,
    <code>dst</code> will reference the same acceleration structures.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</code> serializes the
acceleration structure to a semi-opaque format which can be reloaded on
a compatible implementation.</p>
</li>
<li>
<p><code>VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</code> deserializes
the semi-opaque serialization format in the buffer to the acceleration
structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure to device memory call:</p>
</div>
<div id="vkCmdCopyAccelerationStructureToMemoryKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkCmdCopyAccelerationStructureToMemoryKHR</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkCopyAccelerationStructureToMemoryInfoKHR</span><span class="o">*</span> <span class="n">pInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="chap39.html#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;src</code> <strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a>, and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;dst.deviceAddress</code> <strong class="purple">must</strong> be
synchronized with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a>, and an access type of
<code>VK_ACCESS_TRANSFER_WRITE_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<a href="chap39.html#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>, but writes its result to a
device address, and is executed on the device rather than the host.
The output <strong class="purple">may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <a href="chap39.html#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> or
<a href="chap39.html#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a>.</p>
</div>
<div id="serialized-as-header" class="paragraph">
<p>The defined header structure for the serialized data consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data matching
<code>VkPhysicalDeviceIDProperties</code>::<code>driverUUID</code></p>
</li>
<li>
<p><code>VK_UUID_SIZE</code> bytes of data identifying the compatibility for
comparison using <a href="chap39.html#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a></p>
</li>
<li>
<p>A 64-bit integer of the total size matching the value queried using
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p>A 64-bit integer of the deserialized size to be passed in to
<code>VkAccelerationStructureCreateInfoKHR</code>::<code>size</code></p>
</li>
<li>
<p>A 64-bit integer of the count of the number of acceleration structure
handles following.
This value matches the value queried using
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>.
This will be zero for a bottom-level acceleration structure.
For top-level acceleration structures this number is
implementation-dependent; the number of and ordering of the handles may
not match the instance descriptions which were used to build the
acceleration structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The corresponding handles matching the values returned by
<a href="chap12.html#vkGetAccelerationStructureDeviceAddressKHR">vkGetAccelerationStructureDeviceAddressKHR</a>
or
<a href="chap12.html#vkGetAccelerationStructureHandleNV">vkGetAccelerationStructureHandleNV</a>
are tightly packed in the buffer following the count.
The application is expected to store a mapping between those handles and the
original application-generated bottom-level acceleration structures to
provide when deserializing.
The serialized data is written to the buffer (or read from the buffer)
according to the host endianness.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-accelerationStructure-08926</span><br>

The <a href="chap51.html#features-accelerationStructure"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03739</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-03740</span><br>

<code>pInfo-&gt;dst.deviceAddress</code> <strong class="purple">must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-None-03559</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong class="purple">must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding" href="chap39.html#VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyAccelerationStructureToMemoryKHR-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdCopyAccelerationStructureToMemoryKHR is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkCopyAccelerationStructureToMemoryInfoKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkCopyAccelerationStructureToMemoryInfoKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                       <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                           <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureKHR</span>            <span class="n">src</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressKHR</span>              <span class="n">dst</span><span class="p">;</span>
    <span class="n">VkCopyAccelerationStructureModeKHR</span>    <span class="n">mode</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkCopyAccelerationStructureToMemoryInfoKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the source acceleration structure for the copy</p>
</li>
<li>
<p><code>dst</code> is the device or host address to memory which is the target
for the copy</p>
</li>
<li>
<p><code>mode</code> is a <a href="chap39.html#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959" href="chap39.html#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-04959</span><br>

The source acceleration structure <code>src</code> <strong class="purple">must</strong> have been constructed
prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561" href="chap39.html#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-dst-03561</span><br>

The memory pointed to by <code>dst</code> <strong class="purple">must</strong> be at least as large as the
serialization size of <code>src</code>, as reported by
<a href="chap39.html#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a> or
<a href="chap39.html#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a> with a query type of
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412" href="chap39.html#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-03412</span><br>

<code>mode</code> <strong class="purple">must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_SERIALIZE_KHR</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType" href="chap39.html#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_COPY_ACCELERATION_STRUCTURE_TO_MEMORY_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext" href="chap39.html#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter" href="chap39.html#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-src-parameter</span><br>
 <code>src</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter" href="chap39.html#VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyAccelerationStructureToMemoryInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy device memory to an acceleration structure call:</p>
</div>
<div id="vkCmdCopyMemoryToAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkCmdCopyMemoryToAccelerationStructureKHR</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkCopyMemoryToAccelerationStructureInfoKHR</span><span class="o">*</span> <span class="n">pInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command will be
recorded.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="chap39.html#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to <code>pInfo-&gt;dst</code> <strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a>, and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.
Accesses to the buffer indicated by <code>pInfo-&gt;src.deviceAddress</code> <strong class="purple">must</strong> be
synchronized with the
<code>VK_PIPELINE_STAGE_2_ACCELERATION_STRUCTURE_COPY_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> or the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a>, and an access type of
<code>VK_ACCESS_TRANSFER_READ_BIT</code>.</p>
</div>
<div class="paragraph">
<p>This command can accept acceleration structures produced by either
<a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="chap39.html#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
<div class="paragraph">
<p>The structure provided as input to deserialize is as described in
<a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>, with any acceleration
structure handles filled in with the newly-queried handles to bottom level
acceleration structures created before deserialization.
These do not need to be built at deserialize time, but <strong class="purple">must</strong> be created.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-accelerationStructure-08927</span><br>

The <a href="chap51.html#features-accelerationStructure"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03742</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-03743</span><br>

<code>pInfo-&gt;src.deviceAddress</code> <strong class="purple">must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-buffer-03745</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong class="purple">must</strong> be bound to
device memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding" href="chap39.html#VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding"></a> <span class="vuid">VUID-vkCmdCopyMemoryToAccelerationStructureKHR-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdCopyMemoryToAccelerationStructureKHR is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkCopyMemoryToAccelerationStructureInfoKHR</code> structure is defined
as:</p>
</div>
<div id="VkCopyMemoryToAccelerationStructureInfoKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkCopyMemoryToAccelerationStructureInfoKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                       <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                           <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkDeviceOrHostAddressConstKHR</span>         <span class="n">src</span><span class="p">;</span>
    <span class="n">VkAccelerationStructureKHR</span>            <span class="n">dst</span><span class="p">;</span>
    <span class="n">VkCopyAccelerationStructureModeKHR</span>    <span class="n">mode</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkCopyMemoryToAccelerationStructureInfoKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>src</code> is the device or host address to memory containing the source
data for the copy.</p>
</li>
<li>
<p><code>dst</code> is the target acceleration structure for the copy.</p>
</li>
<li>
<p><code>mode</code> is a <a href="chap39.html#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value
specifying additional operations to perform during the copy.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960" href="chap39.html#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-src-04960</span><br>

The source memory pointed to by <code>src</code> <strong class="purple">must</strong> contain data previously
serialized using <a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>,
potentially modified to relocate acceleration structure references as
described in that command</p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413" href="chap39.html#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-03413</span><br>

<code>mode</code> <strong class="purple">must</strong> be
<code>VK_COPY_ACCELERATION_STRUCTURE_MODE_DESERIALIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414" href="chap39.html#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pInfo-03414</span><br>

The data in <code>src</code> <strong class="purple">must</strong> have a format compatible with the
destination physical device as returned by
<a href="chap39.html#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746" href="chap39.html#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-03746</span><br>

<code>dst</code> <strong class="purple">must</strong> have been created with a <code>size</code> greater than or
equal to that used to serialize the data in <code>src</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType" href="chap39.html#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_COPY_MEMORY_TO_ACCELERATION_STRUCTURE_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext" href="chap39.html#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter" href="chap39.html#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-dst-parameter</span><br>
 <code>dst</code> <strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter" href="chap39.html#VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter"></a> <span class="vuid">VUID-VkCopyMemoryToAccelerationStructureInfoKHR-mode-parameter</span><br>
 <code>mode</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkCopyAccelerationStructureModeKHR">VkCopyAccelerationStructureModeKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To check if a serialized acceleration structure is compatible with the
current device call:</p>
</div>
<div id="vkGetDeviceAccelerationStructureCompatibilityKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkGetDeviceAccelerationStructureCompatibilityKHR</span><span class="p">(</span>
    <span class="n">VkDevice</span>                                    <span class="n">device</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureVersionInfoKHR</span><span class="o">*</span> <span class="n">pVersionInfo</span><span class="p">,</span>
    <span class="n">VkAccelerationStructureCompatibilityKHR</span><span class="o">*</span>    <span class="n">pCompatibility</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device to check the version against.</p>
</li>
<li>
<p><code>pVersionInfo</code> is a pointer to a
<a href="chap39.html#VkAccelerationStructureVersionInfoKHR">VkAccelerationStructureVersionInfoKHR</a> structure specifying version
information to check against the device.</p>
</li>
<li>
<p><code>pCompatibility</code> is a pointer to a
<a href="chap39.html#VkAccelerationStructureCompatibilityKHR">VkAccelerationStructureCompatibilityKHR</a> value in which
compatibility information is returned.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928" href="chap39.html#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-accelerationStructure-08928</span><br>

The <a href="chap51.html#features-accelerationStructure"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter" href="chap39.html#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-device-parameter</span><br>
 <code>device</code> <strong class="purple">must</strong> be a valid <a href="chap5.html#VkDevice">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter" href="chap39.html#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pVersionInfo-parameter</span><br>
 <code>pVersionInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkAccelerationStructureVersionInfoKHR">VkAccelerationStructureVersionInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter" href="chap39.html#VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter"></a> <span class="vuid">VUID-vkGetDeviceAccelerationStructureCompatibilityKHR-pCompatibility-parameter</span><br>
 <code>pCompatibility</code> <strong class="purple">must</strong> be a valid pointer to a <a href="chap39.html#VkAccelerationStructureCompatibilityKHR">VkAccelerationStructureCompatibilityKHR</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkAccelerationStructureVersionInfoKHR</code> structure is defined as:</p>
</div>
<div id="VkAccelerationStructureVersionInfoKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkAccelerationStructureVersionInfoKHR</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>    <span class="n">sType</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>        <span class="n">pNext</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span>     <span class="n">pVersionData</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureVersionInfoKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>pVersionData</code> is a pointer to the version header of an acceleration
structure as defined in <a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>pVersionData</code> is a <em>pointer</em> to an array of 2×<code>VK_UUID_SIZE</code>
<code>uint8_t</code> values instead of two <code>VK_UUID_SIZE</code> arrays as the expected
use case for this member is to be pointed at the header of a previously
serialized acceleration structure (via
<a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="chap39.html#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>) that is loaded in memory.
Using arrays would necessitate extra memory copies of the UUIDs.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-sType-sType" href="chap39.html#VUID-VkAccelerationStructureVersionInfoKHR-sType-sType"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_ACCELERATION_STRUCTURE_VERSION_INFO_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext" href="chap39.html#VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter" href="chap39.html#VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter"></a> <span class="vuid">VUID-VkAccelerationStructureVersionInfoKHR-pVersionData-parameter</span><br>
 <code>pVersionData</code> <strong class="purple">must</strong> be a valid pointer to an array of <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7063em;vertical-align:-0.0951em;"></span><span class="mord"><span class="mord mathtt">VK_UUID_SIZE</span></span></span></span></span> <code>uint8_t</code> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Possible values of <code>pCompatibility</code> returned by
<a href="chap39.html#vkGetDeviceAccelerationStructureCompatibilityKHR">vkGetDeviceAccelerationStructureCompatibilityKHR</a> are:</p>
</div>
<div id="VkAccelerationStructureCompatibilityKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkAccelerationStructureCompatibilityKHR</span> <span class="p">{</span>
    <span class="n">VK_ACCELERATION_STRUCTURE_COMPATIBILITY_COMPATIBLE_KHR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_ACCELERATION_STRUCTURE_COMPATIBILITY_INCOMPATIBLE_KHR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkAccelerationStructureCompatibilityKHR</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_COMPATIBILITY_COMPATIBLE_KHR</code> if the
<code>pVersionData</code> version acceleration structure is compatible with
<code>device</code>.</p>
</li>
<li>
<p><code>VK_ACCELERATION_STRUCTURE_COMPATIBILITY_INCOMPATIBLE_KHR</code> if the
<code>pVersionData</code> version acceleration structure is not compatible with
<code>device</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cluster-geometry"><a class="anchor" href="chap39.html#cluster-geometry"></a>39.2. Cluster Level Acceleration Structures</h3>
<div class="paragraph">
<p>Acceleration structure build times in ray tracing applications with
extensive geometry <strong class="purple">can</strong> be reduced by introducing alternative acceleration
structure types that facilitate bottom-level acceleration structure
construction using pre-generated primitive clusters, improving geometry
reuse.
This <strong class="purple">can</strong> be achieved by incorporating additional acceleration structure
types:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="chap39.html#acceleration-structure-clas-geometry">Cluster Level Acceleration
Structure</a></p>
</li>
<li>
<p><a href="chap39.html#acceleration-structure-clas-template">Cluster Template Acceleration
Structure</a></p>
</li>
<li>
<p><a href="chap39.html#acceleration-structure-bottom-level-clas">Cluster Level Bottom Level
Acceleration Structure</a></p>
</li>
</ol>
</div>
<div id="acceleration-structure-clas-geometry" class="paragraph">
<p>Cluster Level Acceleration Structure (CLAS) is an intermediate acceleration
structure constructed from triangles, which serves as a building block for
<a href="chap39.html#acceleration-structure-bottom-level-clas">Cluster Level Bottom Level
Acceleration Structure</a>.
A CLAS shares similarities with a traditional
<a href="chap39.html#acceleration-structure-bottom-level">bottom level acceleration structure</a>
but has several key distinctions.
A CLAS <strong class="purple">can</strong> only contain a limited number of <a href="chap39.html#cluster-geometry-limits">triangles and vertices</a>.
CLAS objects cannot be directly referenced in a top level acceleration
structure, instead, they <strong class="purple">must</strong> be part of a
<a href="chap39.html#acceleration-structure-bottom-level-clas">Cluster Level Bottom Level
Acceleration Structure</a>.
The <a href="chap39.html#cluster-geometry-index-flags">geometry indices</a> within a CLAS are
local to it, potentially non-consecutive, and customizable per primitive.
Each CLAS <strong class="purple">can</strong> also have a user-defined 32-bit
<a href="chap16.html#interfaces-builtin-variables-clusteridnv">ClusterID</a>, which is accessible
in the hit shaders.
The vertex positions within a CLAS <strong class="purple">can</strong> be quantized by
<a href="chap39.html#cluster-vertex-position-truncate">zeroing</a> specific floating-point
mantissa bits to optimize storage.</p>
</div>
<div id="acceleration-structure-clas-template" class="paragraph">
<p>Cluster Template Acceleration Structure is a partially constructed
<a href="chap39.html#acceleration-structure-clas-geometry">CLAS</a> designed for efficient
instantiation into multiple <a href="chap39.html#acceleration-structure-clas-geometry">CLAS</a>
objects.
During a cluster template build, some pre-computation is performed
independent of vertex positions, allowing reuse across multiple CLAS objects
with different vertex data.
A cluster template itself does not require vertex positions but it retains
non-positional properties similar to a CLAS, which are then inherited during
instantiation.
A cluster template <strong class="purple">must</strong> be instantiated into a CLAS object to be usable.</p>
</div>
<div id="acceleration-structure-bottom-level-clas" class="paragraph">
<p>Cluster Level Bottom Level Acceleration Structure is a new alternative to
the existing <a href="chap39.html#acceleration-structure-bottom-level">bottom level
acceleration structures</a>, which is constructed using references to already
built <a href="chap39.html#acceleration-structure-clas-geometry">CLAS</a> objects and is the only
cluster acceleration structure that <strong class="purple">can</strong> be referenced in a top level
acceleration structure.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>These cluster acceleration structures <strong class="purple">can</strong> be built or moved by a single
versatile multi-indirect function
<a href="chap39.html#vkCmdBuildClusterAccelerationStructureIndirectNV">vkCmdBuildClusterAccelerationStructureIndirectNV</a>.
To determine the memory requirements for executing this function, call:</p>
</div>
<div id="vkGetClusterAccelerationStructureBuildSizesNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkGetClusterAccelerationStructureBuildSizesNV</span><span class="p">(</span>
    <span class="n">VkDevice</span>                                    <span class="n">device</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkClusterAccelerationStructureInputInfoNV</span><span class="o">*</span> <span class="n">pInfo</span><span class="p">,</span>
    <span class="n">VkAccelerationStructureBuildSizesInfoKHR</span><span class="o">*</span>   <span class="n">pSizeInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the acceleration structure.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure containing
parameters required for the memory requirements query.</p>
</li>
<li>
<p><code>pSizeInfo</code> is a pointer to a
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure which returns
the size required for an acceleration structure and scratch buffer,
given the build parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>,
acceleration structure and scratch memory sizes are returned for all
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>maxAccelerationStructureCount</code>
acceleration structures.
If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
scratch memory size for all
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>maxAccelerationStructureCount</code>
acceleration structures and the acceleration structure memory size for a
single acceleration structure is returned.
If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>, only
scratch memory size is returned for the requested acceleration structures.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetClusterAccelerationStructureBuildSizesNV-clusterAccelerationStructure-10438" href="chap39.html#VUID-vkGetClusterAccelerationStructureBuildSizesNV-clusterAccelerationStructure-10438"></a> <span class="vuid">VUID-vkGetClusterAccelerationStructureBuildSizesNV-clusterAccelerationStructure-10438</span><br>

The <a href="chap51.html#features-clusterAccelerationStructure"><code>VkPhysicalDeviceClusterAccelerationStructureFeaturesNV</code>::<code>clusterAccelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetClusterAccelerationStructureBuildSizesNV-device-parameter" href="chap39.html#VUID-vkGetClusterAccelerationStructureBuildSizesNV-device-parameter"></a> <span class="vuid">VUID-vkGetClusterAccelerationStructureBuildSizesNV-device-parameter</span><br>
 <code>device</code> <strong class="purple">must</strong> be a valid <a href="chap5.html#VkDevice">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetClusterAccelerationStructureBuildSizesNV-pInfo-parameter" href="chap39.html#VUID-vkGetClusterAccelerationStructureBuildSizesNV-pInfo-parameter"></a> <span class="vuid">VUID-vkGetClusterAccelerationStructureBuildSizesNV-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetClusterAccelerationStructureBuildSizesNV-pSizeInfo-parameter" href="chap39.html#VUID-vkGetClusterAccelerationStructureBuildSizesNV-pSizeInfo-parameter"></a> <span class="vuid">VUID-vkGetClusterAccelerationStructureBuildSizesNV-pSizeInfo-parameter</span><br>
 <code>pSizeInfo</code> <strong class="purple">must</strong> be a valid pointer to a <a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureInputInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureInputInfoNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                            <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>                                      <span class="n">pNext</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                   <span class="n">maxAccelerationStructureCount</span><span class="p">;</span>
    <span class="n">VkBuildAccelerationStructureFlagsKHR</span>       <span class="n">flags</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureOpTypeNV</span>     <span class="n">opType</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureOpModeNV</span>     <span class="n">opMode</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureOpInputNV</span>    <span class="n">opInput</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureInputInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>maxAccelerationStructureCount</code> is the maximum number of
acceleration structures that will be provided to the multi indirect
operation.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="chap12.html#VkBuildAccelerationStructureFlagsKHR">VkBuildAccelerationStructureFlagsKHR</a>
specifying flags for the multi indirect operation.</p>
</li>
<li>
<p><code>opType</code> is a <a href="chap39.html#VkClusterAccelerationStructureOpTypeNV">VkClusterAccelerationStructureOpTypeNV</a> value
specifying the type of operation to perform.</p>
</li>
<li>
<p><code>opMode</code> is a <a href="chap39.html#VkClusterAccelerationStructureOpModeNV">VkClusterAccelerationStructureOpModeNV</a> value
specifying the mode of operation.</p>
</li>
<li>
<p><code>opInput</code> is a <a href="chap39.html#VkClusterAccelerationStructureOpInputNV">VkClusterAccelerationStructureOpInputNV</a> value
specifying the descriptions of the operation.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-sType-sType" href="chap39.html#VUID-VkClusterAccelerationStructureInputInfoNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_INPUT_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-pNext-pNext" href="chap39.html#VUID-VkClusterAccelerationStructureInputInfoNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-flags-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureInputInfoNV-flags-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-flags-parameter</span><br>
 <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap12.html#VkBuildAccelerationStructureFlagBitsKHR">VkBuildAccelerationStructureFlagBitsKHR</a> values</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-opType-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureInputInfoNV-opType-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-opType-parameter</span><br>
 <code>opType</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkClusterAccelerationStructureOpTypeNV">VkClusterAccelerationStructureOpTypeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-opMode-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureInputInfoNV-opMode-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-opMode-parameter</span><br>
 <code>opMode</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkClusterAccelerationStructureOpModeNV">VkClusterAccelerationStructureOpModeNV</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-pClustersBottomLevel-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureInputInfoNV-pClustersBottomLevel-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-pClustersBottomLevel-parameter</span><br>
 If <code>opType</code> is <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code>, the <code>pClustersBottomLevel</code> member of <code>opInput</code> <strong class="purple">must</strong> be a valid pointer to a <a href="chap39.html#VkClusterAccelerationStructureClustersBottomLevelInputNV">VkClusterAccelerationStructureClustersBottomLevelInputNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-pTriangleClusters-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureInputInfoNV-pTriangleClusters-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-pTriangleClusters-parameter</span><br>
 If <code>opType</code> is <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code>, <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code>, <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code>, or <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_GET_CLUSTER_TEMPLATE_INDICES_NV</code>, the <code>pTriangleClusters</code> member of <code>opInput</code> <strong class="purple">must</strong> be a valid pointer to a <a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInputInfoNV-pMoveObjects-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureInputInfoNV-pMoveObjects-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInputInfoNV-pMoveObjects-parameter</span><br>
 If <code>opType</code> is <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>, the <code>pMoveObjects</code> member of <code>opInput</code> <strong class="purple">must</strong> be a valid pointer to a <a href="chap39.html#VkClusterAccelerationStructureMoveObjectsInputNV">VkClusterAccelerationStructureMoveObjectsInputNV</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Values which <strong class="purple">can</strong> be set in <code>VkClusterAccelerationStructureOpTypeNV</code>
are:</p>
</div>
<div id="VkClusterAccelerationStructureOpTypeNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkClusterAccelerationStructureOpTypeNV</span> <span class="p">{</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_GET_CLUSTER_TEMPLATE_INDICES_NV</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureOpTypeNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>
specifies that a cluster acceleration structure, cluster acceleration
structure template or a bottom level acceleration structure built from
cluster acceleration structures will be moved.
If a cluster acceleration structure is moved, the bottom level cluster
acceleration structures containing it will have to be re-built.
If used with
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>, it
returns the size of existing cluster acceleration structures.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code>
specifies that bottom level cluster acceleration structures will be
built.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code>
specifies that cluster acceleration structures will be built.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code>
specifies that a template for cluster acceleration structure will be
built.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code>
specifies that a template for a cluster acceleration structure will be
instantiated, resulting in a built cluster acceleration structure.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_GET_CLUSTER_TEMPLATE_INDICES_NV</code>
specifies that the vertex indices of the cluster template acceleration
structure will be fetched.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Values which <strong class="purple">can</strong> be set in <code>VkClusterAccelerationStructureOpModeNV</code>
are:</p>
</div>
<div id="VkClusterAccelerationStructureOpModeNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkClusterAccelerationStructureOpModeNV</span> <span class="p">{</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureOpModeNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>
specifies that the build or move operation will implicitly distribute
built or compacted cluster acceleration structures starting at the
address provided in
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstImplicitData</code>.
If a move operation is being performed, the acceleration structures will
be tightly compacted.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>
specifies that the build or move operation will explicitly write built
or compacted cluster acceleration structures in the array of addresses
provided in
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstAddressesArray</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>
specifies that computed cluster acceleration structure sizes will be
written to
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstSizesArray</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <code>VkClusterAccelerationStructureOpInputNV</code> union is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureOpInputNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">VkClusterAccelerationStructureOpInputNV</span> <span class="p">{</span>
    <span class="n">VkClusterAccelerationStructureClustersBottomLevelInputNV</span><span class="o">*</span>    <span class="n">pClustersBottomLevel</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureTriangleClusterInputNV</span><span class="o">*</span>        <span class="n">pTriangleClusters</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureMoveObjectsInputNV</span><span class="o">*</span>            <span class="n">pMoveObjects</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureOpInputNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pClustersBottomLevel</code> is a
<a href="chap39.html#VkClusterAccelerationStructureClustersBottomLevelInputNV">VkClusterAccelerationStructureClustersBottomLevelInputNV</a> structure
specifying an upper threshold on parameters to build multiple bottom
level acceleration structures from multiple cluster level acceleration
structures.</p>
</li>
<li>
<p><code>pTriangleClusters</code> is a
<a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a> structure
specifying an upper threshold on parameters to build a regular or
templated cluster acceleration structure.</p>
</li>
<li>
<p><code>pMoveObjects</code> is a
<a href="chap39.html#VkClusterAccelerationStructureMoveObjectsInputNV">VkClusterAccelerationStructureMoveObjectsInputNV</a> structure
specifying an upper threshold on the number of bytes moved and the type
of acceleration structure being moved.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureClustersBottomLevelInputNV">VkClusterAccelerationStructureClustersBottomLevelInputNV</a> structure
is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureClustersBottomLevelInputNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureClustersBottomLevelInputNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>    <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>              <span class="n">pNext</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">maxTotalClusterCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">maxClusterCountPerAccelerationStructure</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureClustersBottomLevelInputNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>maxTotalClusterCount</code> is the total number of clusters acceleration
structures that will be built or moved across all input arguments.</p>
</li>
<li>
<p><code>maxClusterCountPerAccelerationStructure</code> is the maximum number of
clusters acceleration structures that will be built or moved per input
argument.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-sType-sType" href="chap39.html#VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_CLUSTERS_BOTTOM_LEVEL_INPUT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-pNext-pNext" href="chap39.html#VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureClustersBottomLevelInputNV-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a> structure is
defined as:</p>
</div>
<div id="VkClusterAccelerationStructureTriangleClusterInputNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureTriangleClusterInputNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>    <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>              <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkFormat</span>           <span class="n">vertexFormat</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">maxGeometryIndexValue</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">maxClusterUniqueGeometryCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">maxClusterTriangleCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">maxClusterVertexCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">maxTotalTriangleCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">maxTotalVertexCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">minPositionTruncateBitCount</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureTriangleClusterInputNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>vertexFormat</code> is the <a href="chap53.html#VkFormat">VkFormat</a> of each vertex element.</p>
</li>
<li>
<p><code>maxGeometryIndexValue</code> is the maximum geometry index value for any
constructed geometry.</p>
</li>
<li>
<p><code>maxClusterUniqueGeometryCount</code> is the maximum number of unique
values of the geometry index for each cluster or cluster template.</p>
</li>
<li>
<p><a id="cluster-geometry-limits"></a> <code>maxClusterTriangleCount</code> is the maximum
number of triangles in a cluster or cluster template.</p>
</li>
<li>
<p><code>maxClusterVertexCount</code> is the maximum number of unique vertices in
the cluster’s index buffer.</p>
</li>
<li>
<p><code>maxTotalTriangleCount</code> is the sum of all triangles across all
clusters or cluster templates.</p>
</li>
<li>
<p><code>maxTotalVertexCount</code> is the maximum number of vertices across all
clusters or cluster templates.</p>
</li>
<li>
<p><a id="cluster-vertex-position-truncate"></a> <code>minPositionTruncateBitCount</code>
is the least value specified in cluster build in
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>positionTruncateBitCount</code>
or cluster template build in
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>::<code>positionTruncateBitCount</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-10439" href="chap39.html#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-10439"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-10439</span><br>

The <a href="chap12.html#resources-buffer-view-format-features">format features</a> of
<code>vertexFormat</code> <strong class="purple">must</strong> contain
<code>VK_FORMAT_FEATURE_ACCELERATION_STRUCTURE_VERTEX_BUFFER_BIT_KHR</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterTriangleCount-10440" href="chap39.html#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterTriangleCount-10440"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterTriangleCount-10440</span><br>

<code>maxClusterTriangleCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxTrianglesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterVertexCount-10441" href="chap39.html#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterVertexCount-10441"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-maxClusterVertexCount-10441</span><br>

<code>maxClusterVertexCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxVerticesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-minPositionTruncateBitCount-10442" href="chap39.html#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-minPositionTruncateBitCount-10442"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-minPositionTruncateBitCount-10442</span><br>

<code>minPositionTruncateBitCount</code> <strong class="purple">must</strong> be less than or equal to <code>32</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-sType-sType" href="chap39.html#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_TRIANGLE_CLUSTER_INPUT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-pNext-pNext" href="chap39.html#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureTriangleClusterInputNV-vertexFormat-parameter</span><br>
 <code>vertexFormat</code> <strong class="purple">must</strong> be a valid <a href="chap53.html#VkFormat">VkFormat</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureMoveObjectsInputNV">VkClusterAccelerationStructureMoveObjectsInputNV</a> structure is
defined as:</p>
</div>
<div id="VkClusterAccelerationStructureMoveObjectsInputNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureMoveObjectsInputNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                         <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>                                   <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureTypeNV</span>    <span class="n">type</span><span class="p">;</span>
    <span class="n">VkBool32</span>                                <span class="n">noMoveOverlap</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>                            <span class="n">maxMovedBytes</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureMoveObjectsInputNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>type</code> is a <a href="chap39.html#VkClusterAccelerationStructureTypeNV">VkClusterAccelerationStructureTypeNV</a> value
identifying the type of cluster acceleration structure.</p>
</li>
<li>
<p><code>noMoveOverlap</code> specifies if the source and destination cluster
acceleration structures overlap in memory for the move operation.
If set to <code>VK_TRUE</code>, the source cluster acceleration structure
remains valid after the move and move operation acts like a copy.</p>
</li>
<li>
<p><code>maxMovedBytes</code> is the maximum number of bytes that <strong class="purple">may</strong> be moved in
this operation.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInputNV-sType-sType" href="chap39.html#VUID-VkClusterAccelerationStructureMoveObjectsInputNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInputNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_MOVE_OBJECTS_INPUT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInputNV-pNext-pNext" href="chap39.html#VUID-VkClusterAccelerationStructureMoveObjectsInputNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInputNV-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInputNV-type-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureMoveObjectsInputNV-type-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInputNV-type-parameter</span><br>
 <code>type</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkClusterAccelerationStructureTypeNV">VkClusterAccelerationStructureTypeNV</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Values which <strong class="purple">can</strong> be set in <code>VkClusterAccelerationStructureTypeNV</code> are:</p>
</div>
<div id="VkClusterAccelerationStructureTypeNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkClusterAccelerationStructureTypeNV</span> <span class="p">{</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_CLUSTERS_BOTTOM_LEVEL_NV</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_TRIANGLE_CLUSTER_NV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_TRIANGLE_CLUSTER_TEMPLATE_NV</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureTypeNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_CLUSTERS_BOTTOM_LEVEL_NV</code>
specifies a bottom level cluster acceleration structure.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_TRIANGLE_CLUSTER_NV</code>
specifies a cluster acceleration structure.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_TYPE_TRIANGLE_CLUSTER_TEMPLATE_NV</code>
specifies a template cluster acceleration structure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build or move a cluster acceleration structure or a cluster acceleration
structure template call:</p>
</div>
<div id="vkCmdBuildClusterAccelerationStructureIndirectNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkCmdBuildClusterAccelerationStructureIndirectNV</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkClusterAccelerationStructureCommandsInfoNV</span><span class="o">*</span> <span class="n">pCommandInfos</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is
recorded.</p>
</li>
<li>
<p><code>pCommandInfos</code> is a pointer to a
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a> structure containing
parameters required for building or moving the cluster acceleration
structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similar to <a href="chap39.html#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a>, this command <strong class="purple">may</strong>
initiate multiple acceleration structures builds and there is no ordering or
synchronization implied between any of the individual acceleration structure
builds.
Accesses to the acceleration structure scratch memory as identified by the
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>scratchData</code> <strong class="purple">must</strong>
be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
(<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> |
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>).</p>
</div>
<div class="paragraph">
<p>Accesses to each
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstImplicitData</code>,
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstAddressesArray</code>
and <a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstSizesArray</code>
<strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>.</p>
</div>
<div class="paragraph">
<p>Accesses to memory with input data as identified by any used values of
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>srcInfosArray</code> and
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>srcInfosCount</code>
<strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-clusterAccelerationStructure-10443" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-clusterAccelerationStructure-10443"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-clusterAccelerationStructure-10443</span><br>

The <a href="chap51.html#features-clusterAccelerationStructure"><code>VkPhysicalDeviceClusterAccelerationStructureFeaturesNV</code>::<code>clusterAccelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pNext-10444" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pNext-10444"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pNext-10444</span><br>

The <code>pNext</code> chain of the bound ray tracing pipeline <strong class="purple">must</strong> include a
<a href="chap10.html#VkRayTracingPipelineClusterAccelerationStructureCreateInfoNV">VkRayTracingPipelineClusterAccelerationStructureCreateInfoNV</a>
structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10445" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10445"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10445</span><br>

<code>pCommandInfos-&gt;input.maxAccelerationStructureCount</code> <strong class="purple">must</strong> be less
than or equal to the value used in
<code>pInfo-&gt;maxAccelerationStructureCount</code> in
<a href="chap39.html#vkGetClusterAccelerationStructureBuildSizesNV">vkGetClusterAccelerationStructureBuildSizesNV</a> to determine the
memory requirements for the build operation</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10446" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10446"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10446</span><br>

The scratch memory of the cluster acceleration structure specified in
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>scratchData</code>
<strong class="purple">must</strong> be larger than or equal to the scratch size queried with
<a href="chap39.html#vkGetClusterAccelerationStructureBuildSizesNV">vkGetClusterAccelerationStructureBuildSizesNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10447" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10447"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-scratchData-10447</span><br>

The scratch address of the cluster acceleration structure specified in
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>scratchData</code>
<strong class="purple">must</strong> be aligned based on the cluster acceleration structure type and
its alignment properties as queried with
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10448" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10448"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10448</span><br>

If <code>pCommandInfos-&gt;input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong class="purple">must</strong> be an array of
<a href="chap39.html#VkClusterAccelerationStructureMoveObjectsInfoNV">VkClusterAccelerationStructureMoveObjectsInfoNV</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10449" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10449"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10449</span><br>

If <code>pCommandInfos-&gt;input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong class="purple">must</strong> be an array of
<a href="chap39.html#VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV">VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV</a>
structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10450" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10450"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10450</span><br>

If <code>pCommandInfos-&gt;input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong class="purple">must</strong> be an array of
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>
structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10451" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10451"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10451</span><br>

If <code>pCommandInfos-&gt;input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong class="purple">must</strong> be an array of
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>
structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10452" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10452"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10452</span><br>

If <code>pCommandInfos-&gt;input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong class="purple">must</strong> be an array of
<a href="chap39.html#VkClusterAccelerationStructureInstantiateClusterInfoNV">VkClusterAccelerationStructureInstantiateClusterInfoNV</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10832" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10832"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10832</span><br>

If <code>pCommandInfos-&gt;input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_GET_CLUSTER_TEMPLATE_INDICES_NV</code>,
<code>pCommandInfos-&gt;srcInfosArray</code> <strong class="purple">must</strong> be an array of
<a href="chap39.html#VkClusterAccelerationStructureGetTemplateIndicesInfoNV">VkClusterAccelerationStructureGetTemplateIndicesInfoNV</a> structures</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10453" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10453"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10453</span><br>

The value in <code>pCommandInfos-&gt;srcInfosCount</code> <strong class="purple">must</strong> be less than or
equal to <code>pCommandInfos-&gt;input.maxAccelerationStructureCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10454" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10454"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10454</span><br>

The number of inputs specified in <code>pCommandInfos-&gt;srcInfosArray</code>
<strong class="purple">must</strong> be greater than or equal to <code>pCommandInfos-&gt;srcInfosCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstAddressesArray-10455" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstAddressesArray-10455"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstAddressesArray-10455</span><br>

The memory regions specified in
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstAddressesArray</code>
<strong class="purple">must</strong> not overlap with each other or with
<code>pCommandInfos-&gt;scratchData</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstImplicitData-10456" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstImplicitData-10456"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-dstImplicitData-10456</span><br>

The memory region specified in
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstImplicitData</code>
for multiple acceleration structure builds <strong class="purple">must</strong> not overlap with
<code>pCommandInfos-&gt;scratchData</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10457" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10457"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10457</span><br>

The buffer from which the buffer device address for
<code>pCommandInfos-&gt;scratchData</code> is queried <strong class="purple">must</strong> have been created with
the <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10458" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10458"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10458</span><br>

The buffers from which the buffer device addresses for
<code>pCommandInfos-&gt;srcInfosArray</code> and
<code>pCommandInfos-&gt;srcInfosCount</code> are queried <strong class="purple">must</strong> have been created
with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10459" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10459"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-10459</span><br>

The buffers from which the buffer device addresses for
<code>pCommandInfos-&gt;dstImplicitData</code> and
<code>pCommandInfos-&gt;dstAddressesArray</code> are queried <strong class="purple">must</strong> have been
created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_STORAGE_BIT_KHR</code> usage flag</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-parameter" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-parameter" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-parameter"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-pCommandInfos-parameter</span><br>
 <code>pCommandInfos</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-recording" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-renderpass" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-renderpass"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-videocoding" href="chap39.html#VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-videocoding"></a> <span class="vuid">VUID-vkCmdBuildClusterAccelerationStructureIndirectNV-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdBuildClusterAccelerationStructureIndirectNV is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a> structure is defined
as:</p>
</div>
<div id="VkClusterAccelerationStructureCommandsInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureCommandsInfoNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                                           <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>                                                     <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureInputInfoNV</span>                 <span class="n">input</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                           <span class="n">dstImplicitData</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                           <span class="n">scratchData</span><span class="p">;</span>
    <span class="n">VkStridedDeviceAddressRegionKHR</span>                           <span class="n">dstAddressesArray</span><span class="p">;</span>
    <span class="n">VkStridedDeviceAddressRegionKHR</span>                           <span class="n">dstSizesArray</span><span class="p">;</span>
    <span class="n">VkStridedDeviceAddressRegionKHR</span>                           <span class="n">srcInfosArray</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                           <span class="n">srcInfosCount</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureAddressResolutionFlagsNV</span>    <span class="n">addressResolutionFlags</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureCommandsInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>input</code> is <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure
describing the build or move parameters for the cluster acceleration
structure.</p>
</li>
<li>
<p><code>dstImplicitData</code> is the device address for memory where the
implicit build of cluster acceleration structure will be saved.
If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>
or <code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>,
this value is ignored.</p>
</li>
<li>
<p><code>scratchData</code> is the device address of scratch memory that will be
used during cluster acceleration structure move or build.</p>
</li>
<li>
<p><code>dstAddressesArray</code> is a <a href="chap12.html#VkStridedDeviceAddressRegionKHR">VkStridedDeviceAddressRegionKHR</a> where
the individual addresses and stride of moved or built cluster
acceleration structures will be saved or read from depending on
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code>.
If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>
and the address in <code>dstAddressesArray</code> is not <code>0</code>, then the
addresses are saved.
If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
then the addresses are read from.
If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>, then
this value is ignored and <strong class="purple">may</strong> be <code>0</code>.</p>
</li>
<li>
<p><code>dstSizesArray</code> is <code>NULL</code> or a <a href="chap12.html#VkStridedDeviceAddressRegionKHR">VkStridedDeviceAddressRegionKHR</a>
containing sizes of moved or built cluster acceleration structures.
Similar to <code>dstAddressesArray</code>, if
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>,
then the sizes are saved.
If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
then the sizes are read from.</p>
</li>
<li>
<p><code>srcInfosArray</code> is a <a href="chap12.html#VkStridedDeviceAddressRegionKHR">VkStridedDeviceAddressRegionKHR</a> where
input data for the build or move operation is read from.
If the stride is <code>0</code>, the structures are assumed to be packed tightly.
Its format is dependent on
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opType</code> as per the
table below.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input.opType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format of <code>srcInfosArray</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkClusterAccelerationStructureMoveObjectsInfoNV">VkClusterAccelerationStructureMoveObjectsInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV">VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkClusterAccelerationStructureInstantiateClusterInfoNV">VkClusterAccelerationStructureInstantiateClusterInfoNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_GET_CLUSTER_TEMPLATE_INDICES_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkClusterAccelerationStructureGetTemplateIndicesInfoNV">VkClusterAccelerationStructureGetTemplateIndicesInfoNV</a></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p><code>srcInfosCount</code> is the device address of memory containing the count
of number of build or move operations to perform.
The actual value is the minimum of this value and the value specified in
<code>input.maxAccelerationStructureCount</code>.
If this value is <code>0</code>, the count is determined by
<code>input.maxAccelerationStructureCount</code> alone.</p>
</li>
<li>
<p><code>addressResolutionFlags</code> is a bitmask of
<a href="chap39.html#VkClusterAccelerationStructureAddressResolutionFlagBitsNV">VkClusterAccelerationStructureAddressResolutionFlagBitsNV</a> values
specifying how an implementation will interpret the device addresses in
this structure.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10466" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10466"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10466</span><br>

If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>,
<code>dstImplicitData</code> <strong class="purple">must</strong> be a valid address</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10467" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10467"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10467</span><br>

If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>
and <code>input.opType</code> is not
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>, the
memory in <code>dstImplicitData</code> <strong class="purple">must</strong> be equal to or larger than the
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a>::<code>accelerationStructureSize</code>
value returned from <a href="chap39.html#vkGetClusterAccelerationStructureBuildSizesNV">vkGetClusterAccelerationStructureBuildSizesNV</a>
with same input parameters</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10468" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10468"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10468</span><br>

If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_IMPLICIT_DESTINATIONS_NV</code>
and <code>input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>, the
memory in <code>dstImplicitData</code> <strong class="purple">must</strong> be equal to or larger than the sum
of all the built acceleration structures that are being moved</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10469" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10469"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10469</span><br>

If <code>input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_MOVE_OBJECTS_NV</code>, the
total memory moved <strong class="purple">must</strong> not be larger than the size provided in
<a href="chap39.html#VkClusterAccelerationStructureMoveObjectsInputNV">VkClusterAccelerationStructureMoveObjectsInputNV</a>::<code>maxMovedBytes</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10470" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10470"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10470</span><br>

If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_COMPUTE_SIZES_NV</code>,
<code>dstSizesArray</code> <strong class="purple">must</strong> be a valid address</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10471" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10471"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10471</span><br>

If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
the address in <code>dstAddressesArray</code> <strong class="purple">must</strong> be a valid address with
sizes of individual buffers large enough to accommodate built or moved
clusters</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10472" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10472"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10472</span><br>

If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
the buffers in <code>dstAddressesArray</code> <strong class="purple">must</strong> not overlap</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10473" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10473"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-opMode-10473</span><br>

If <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_MODE_EXPLICIT_DESTINATIONS_NV</code>,
the addresses in <code>dstAddressesArray</code> <strong class="purple">must</strong> be aligned based on the
cluster acceleration structure type and its alignment properties as
described in
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-dstAddressesArray-10474" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-dstAddressesArray-10474"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-dstAddressesArray-10474</span><br>

The stride in <code>dstAddressesArray</code> <strong class="purple">must</strong> be greater than or equal to
8</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-dstSizesArray-10475" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-dstSizesArray-10475"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-dstSizesArray-10475</span><br>

The stride in <code>dstSizesArray</code> <strong class="purple">must</strong> be greater than or equal to 4</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosArray-10476" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosArray-10476"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosArray-10476</span><br>

The stride in <code>srcInfosArray</code> <strong class="purple">must</strong> be greater than the type of
structure the address is describing</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10477" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10477"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10477</span><br>

If <code>input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_NV</code>,
then depending on the
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code>,
<code>dstImplicitData</code> or addresses specified in <code>dstAddressesArray</code>
<strong class="purple">must</strong> be aligned to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10478" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10478"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10478</span><br>

If <code>input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_TRIANGLE_CLUSTER_TEMPLATE_NV</code>,
then depending on the
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code>,
<code>dstImplicitData</code> or addresses specified in <code>dstAddressesArray</code>
<strong class="purple">must</strong> be aligned to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterTemplateByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10479" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10479"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10479</span><br>

If <code>input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_INSTANTIATE_TRIANGLE_CLUSTER_NV</code>,
then depending on the
<a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>opMode</code>,
<code>dstImplicitData</code> or addresses specified in <code>dstAddressesArray</code>
<strong class="purple">must</strong> be aligned to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-10480" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-10480"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-10480</span><br>

<code>scratchData</code> <strong class="purple">must</strong> be aligned to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterScratchByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-10481" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-10481"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-10481</span><br>

<code>srcInfosCount</code> <strong class="purple">must</strong> be 4-byte aligned</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10482" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10482"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-10482</span><br>

If <code>input.opType</code> is
<code>VK_CLUSTER_ACCELERATION_STRUCTURE_OP_TYPE_BUILD_CLUSTERS_BOTTOM_LEVEL_NV</code>,
the total and per argument number of cluster acceleration structures
referenced in <code>srcInfosArray</code> <strong class="purple">must</strong> be equal or less than the
maximum values with which memory requirements were queried in
<a href="chap39.html#vkGetClusterAccelerationStructureBuildSizesNV">vkGetClusterAccelerationStructureBuildSizesNV</a> with
<a href="chap39.html#VkClusterAccelerationStructureOpInputNV">VkClusterAccelerationStructureOpInputNV</a>::<code>pClustersBottomLevel</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-sType-sType" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-sType-sType"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_CLUSTER_ACCELERATION_STRUCTURE_COMMANDS_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-pNext-pNext" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-pNext-pNext"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-input-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-input-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-input-parameter</span><br>
 <code>input</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-dstImplicitData-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-dstImplicitData-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-dstImplicitData-parameter</span><br>
 <code>dstImplicitData</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-scratchData-parameter</span><br>
 <code>scratchData</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-srcInfosCount-parameter</span><br>
 <code>srcInfosCount</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureCommandsInfoNV-addressResolutionFlags-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureCommandsInfoNV-addressResolutionFlags-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureCommandsInfoNV-addressResolutionFlags-parameter</span><br>
 <code>addressResolutionFlags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap39.html#VkClusterAccelerationStructureAddressResolutionFlagBitsNV">VkClusterAccelerationStructureAddressResolutionFlagBitsNV</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong class="purple">can</strong> be set in
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>addressResolutionFlags</code>,
specifying how the device address in
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a> are interpreted, are:</p>
</div>
<div id="VkClusterAccelerationStructureAddressResolutionFlagBitsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkClusterAccelerationStructureAddressResolutionFlagBitsNV</span> <span class="p">{</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_NONE_NV</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_IMPLICIT_DATA_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SCRATCH_DATA_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_ADDRESS_ARRAY_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_SIZES_ARRAY_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000008</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SRC_INFOS_ARRAY_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000010</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SRC_INFOS_COUNT_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000020</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureAddressResolutionFlagBitsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_NONE_NV</code>
specifies that no address resolution flags are provided.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_IMPLICIT_DATA_BIT_NV</code>
specifies another level of indirection when reading
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstImplicitData</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SCRATCH_DATA_BIT_NV</code>
specifies another level of indirection when reading
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>scratchData</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_ADDRESS_ARRAY_BIT_NV</code>
specifies another level of indirection when reading
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstAddressesArray</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_DST_SIZES_ARRAY_BIT_NV</code>
specifies another level of indirection when reading
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>dstSizesArray</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SRC_INFOS_ARRAY_BIT_NV</code>
specifies another level of indirection when reading
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>srcInfosArray</code>.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_ADDRESS_RESOLUTION_INDIRECTED_SRC_INFOS_COUNT_BIT_NV</code>
specifies another level of indirection when reading
<a href="chap39.html#VkClusterAccelerationStructureCommandsInfoNV">VkClusterAccelerationStructureCommandsInfoNV</a>::<code>srcInfosCount</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkClusterAccelerationStructureAddressResolutionFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="n">VkFlags</span> <span class="n">VkClusterAccelerationStructureAddressResolutionFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkClusterAccelerationStructureAddressResolutionFlagsNV</code> is a bitmask
type for setting a mask of zero or more
<a href="chap39.html#VkClusterAccelerationStructureAddressResolutionFlagBitsNV">VkClusterAccelerationStructureAddressResolutionFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureMoveObjectsInfoNV">VkClusterAccelerationStructureMoveObjectsInfoNV</a> structure is
defined as:</p>
</div>
<div id="VkClusterAccelerationStructureMoveObjectsInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureMoveObjectsInfoNV</span> <span class="p">{</span>
    <span class="n">VkDeviceAddress</span>    <span class="n">srcAccelerationStructure</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureMoveObjectsInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>srcAccelerationStructure</code> is the device address of the source
cluster acceleration structure that will be moved.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-10483" href="chap39.html#VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-10483"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-10483</span><br>

<code>srcAccelerationStructure</code> <strong class="purple">must</strong> be a type of <a href="chap39.html#cluster-geometry">cluster acceleration structure</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureMoveObjectsInfoNV-srcAccelerationStructure-parameter</span><br>
 <code>srcAccelerationStructure</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV">VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV</a>
structure is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>           <span class="n">clusterReferencesCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">clusterReferencesStride</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>    <span class="n">clusterReferences</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterReferencesCount</code> is the number of clusters this bottom level
acceleration structure will be built from.</p>
</li>
<li>
<p><code>clusterReferencesStride</code> is the stride in <code>clusterReferences</code>.</p>
</li>
<li>
<p><code>clusterReferences</code> is the device memory containing the address of
the clusters.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10484" href="chap39.html#VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10484"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10484</span><br>

All cluster references in <code>clusterReferences</code> <strong class="purple">must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10485" href="chap39.html#VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10485"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-10485</span><br>

<code>clusterReferences</code> <strong class="purple">must</strong> have at least <code>clusterReferencesCount</code>
values</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferencesStride-10486" href="chap39.html#VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferencesStride-10486"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferencesStride-10486</span><br>

<code>clusterReferencesStride</code> <strong class="purple">must</strong> be greater than or equal to 8</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildClustersBottomLevelInfoNV-clusterReferences-parameter</span><br>
 <code>clusterReferences</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong class="purple">can</strong> be set in
<a href="chap39.html#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>::<code>geometryFlags</code>,
specifying geometry flags for cluster acceleration structure, are:</p>
</div>
<div id="VkClusterAccelerationStructureGeometryFlagBitsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkClusterAccelerationStructureGeometryFlagBitsNV</span> <span class="p">{</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_CULL_DISABLE_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_NO_DUPLICATE_ANYHIT_INVOCATION_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_OPAQUE_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureGeometryFlagBitsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_CULL_DISABLE_BIT_NV</code>
disables face culling for this geometry.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_NO_DUPLICATE_ANYHIT_INVOCATION_BIT_NV</code>
specifies that the implementation <strong class="purple">must</strong> only call the any-hit shader a
single time for each primitive in this geometry.
If this bit is absent an implementation <strong class="purple">may</strong> invoke the any-hit shader
more than once for this geometry.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_GEOMETRY_OPAQUE_BIT_NV</code> specifies
that this geometry does not invoke the any-hit shaders even if present
in a hit group.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkClusterAccelerationStructureGeometryFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="n">VkFlags</span> <span class="n">VkClusterAccelerationStructureGeometryFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkClusterAccelerationStructureGeometryFlagsNV</code> is a bitmask type for
setting a mask of zero or more
<a href="chap39.html#VkClusterAccelerationStructureGeometryFlagBitsNV">VkClusterAccelerationStructureGeometryFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
structure is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>    <span class="n">geometryIndex</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
    <span class="kt">uint32_t</span>    <span class="n">reserved</span><span class="o">:</span><span class="mi">5</span><span class="p">;</span>
    <span class="kt">uint32_t</span>    <span class="n">geometryFlags</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>geometryIndex</code> specifies the geometry index for all triangles in
the cluster acceleration structure.</p>
</li>
<li>
<p><code>reserved</code> is reserved for future use.</p>
</li>
<li>
<p><code>geometryFlags</code> is a bitmask of
<a href="chap39.html#VkClusterAccelerationStructureGeometryFlagBitsNV">VkClusterAccelerationStructureGeometryFlagBitsNV</a> values describing
geometry flags for the cluster acceleration structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>geometryIndex</code>, <code>reserved</code> and <code>mask</code> occupy the same
memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>geometryIndex</code> occupies the 24 least significant bits of that
memory</p>
</li>
<li>
<p><code>geometryFlags</code> occupies the 3 most significant bits of that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong class="purple">must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV-reserved-10487" href="chap39.html#VUID-VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV-reserved-10487"></a> <span class="vuid">VUID-VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV-reserved-10487</span><br>

<code>reserved</code> <strong class="purple">must</strong> be <code>0</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong class="purple">can</strong> be set in
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>clusterFlags</code>,
specifying flags for clusters in an acceleration structure, are:</p>
</div>
<div id="VkClusterAccelerationStructureClusterFlagBitsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkClusterAccelerationStructureClusterFlagBitsNV</span> <span class="p">{</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_CLUSTER_ALLOW_DISABLE_OPACITY_MICROMAPS_NV</span> <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureClusterFlagBitsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_CLUSTER_ALLOW_DISABLE_OPACITY_MICROMAPS_NV</code>
specifies that the specified cluster acceleration structure <strong class="purple">may</strong> be
referenced in an instance with
<code>VK_GEOMETRY_INSTANCE_DISABLE_OPACITY_MICROMAPS_BIT_EXT</code> set.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkClusterAccelerationStructureClusterFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="n">VkFlags</span> <span class="n">VkClusterAccelerationStructureClusterFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkClusterAccelerationStructureClusterFlagsNV</code> is a bitmask type for
setting a mask of zero or more
<a href="chap39.html#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a> structure
is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureBuildTriangleClusterInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">clusterID</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureClusterFlagsNV</span>                     <span class="n">clusterFlags</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">triangleCount</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">vertexCount</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">positionTruncateBitCount</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">indexType</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">opacityMicromapIndexType</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</span>    <span class="n">baseGeometryIndexAndGeometryFlags</span><span class="p">;</span>
    <span class="kt">uint16_t</span>                                                         <span class="n">indexBufferStride</span><span class="p">;</span>
    <span class="kt">uint16_t</span>                                                         <span class="n">vertexBufferStride</span><span class="p">;</span>
    <span class="kt">uint16_t</span>                                                         <span class="n">geometryIndexAndFlagsBufferStride</span><span class="p">;</span>
    <span class="kt">uint16_t</span>                                                         <span class="n">opacityMicromapIndexBufferStride</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">indexBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">vertexBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">geometryIndexAndFlagsBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">opacityMicromapArray</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">opacityMicromapIndexBuffer</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterID</code> is a user specified identifier assigned to this cluster.</p>
</li>
<li>
<p><code>clusterFlags</code> is a bitmask of
<a href="chap39.html#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a> values describing
flags how the cluster should be built.</p>
</li>
<li>
<p><code>triangleCount</code> is the number of triangles in this cluster.</p>
</li>
<li>
<p><code>vertexCount</code> is the number of unique vertices in this cluster.</p>
</li>
<li>
<p><code>positionTruncateBitCount</code> is the number of bits starting at the
lowest bit (i.e. the LSBs of the mantissa), of each vertex position that
will be truncated to zero to improve floating-point compression.</p>
</li>
<li>
<p><code>indexType</code> is a single
<a href="chap39.html#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a> value
specifying the index type in <code>indexBuffer</code>.</p>
</li>
<li>
<p><code>opacityMicromapIndexType</code> is a single
<a href="chap39.html#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a> value
specifying the index type in <code>opacityMicromapIndexBuffer</code>.</p>
</li>
<li>
<p><code>baseGeometryIndexAndGeometryFlags</code> is a
<a href="chap39.html#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
value specifying the base geometry index and flags for all triangles in
the cluster.</p>
</li>
<li>
<p><code>indexBufferStride</code> is the stride in bytes in <code>indexBuffer</code> with
<code>0</code> meaning the values are tightly-packed.</p>
</li>
<li>
<p><code>vertexBufferStride</code> is the stride in bytes in <code>vertexBuffer</code>
with <code>0</code> meaning the values are tightly-packed.</p>
</li>
<li>
<p><code>geometryIndexAndFlagsBufferStride</code> is the stride in bytes in
<code>geometryIndexAndFlagsBuffer</code> with <code>0</code> meaning the values are
tightly-packed.</p>
</li>
<li>
<p><code>opacityMicromapIndexBufferStride</code> is the stride in bytes in
<code>opacityMicromapIndexBuffer</code> with <code>0</code> meaning the values are
tightly-packed.</p>
</li>
<li>
<p><code>indexBuffer</code> is a device address containing the indices of the
vertices in the cluster and are of type <code>indexType</code>.</p>
</li>
<li>
<p><code>vertexBuffer</code> is a device address containing the vertex data of the
triangles in the cluster with format specified in
<a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>vertexFormat</code>.</p>
</li>
<li>
<p><a id="cluster-geometry-index-flags"></a> <code>geometryIndexAndFlagsBuffer</code> is
either <code>0</code> or an address containing strided
<a href="chap39.html#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
values specifying the geometry index and flag for every triangle in the
cluster.</p>
</li>
<li>
<p><code>opacityMicromapArray</code> is either <code>0</code> or specifies the address of a
valid opacity micromap array to reference from the cluster acceleration
structure.
If it is <code>0</code>, then opacity micromaps will be disabled for this cluster
acceleration structure.</p>
</li>
<li>
<p><code>opacityMicromapIndexBuffer</code> is either <code>0</code> or specifies the address
of a strided array with size equal to the number of triangles or indices
into the opacity micromap array.
If <code>opacityMicromapIndexBuffer</code> is <code>0</code> then the index used is the
index of the triangle in the geometry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>triangleCount</code>, <code>vertexCount</code>, <code>positionTruncateBitCount</code>,
<code>indexType</code> and <code>opacityMicromapIndexType</code> occupy the same
memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>triangleCount</code> occupies the 9 least significant bits of that
memory</p>
</li>
<li>
<p><code>vertexCount</code> occupies the next 9 least significant bits of that
memory</p>
</li>
<li>
<p><code>positionTruncateBitCount</code> occupies the next 6 least significant
bits of that memory</p>
</li>
<li>
<p><code>indexType</code> occupies the next 4 least significant bits of that
memory</p>
</li>
<li>
<p><code>opacityMicromapIndexType</code> occupies the 4 most significant bits of
that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong class="purple">must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterID-10488" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterID-10488"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterID-10488</span><br>

<code>clusterID</code> <strong class="purple">must</strong> not be 0xFFFFFFFF</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-triangleCount-10489" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-triangleCount-10489"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-triangleCount-10489</span><br>

<code>triangleCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxTrianglesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexCount-10490" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexCount-10490"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexCount-10490</span><br>

<code>vertexCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxVerticesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexType-10491" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexType-10491"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexType-10491</span><br>

<code>indexType</code> <strong class="purple">must</strong> only have a single bit set</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexType-10492" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexType-10492"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexType-10492</span><br>

<code>opacityMicromapIndexType</code> <strong class="purple">must</strong> only have a single bit set</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-positionTruncateBitCount-10493" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-positionTruncateBitCount-10493"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-positionTruncateBitCount-10493</span><br>

<code>positionTruncateBitCount</code> <strong class="purple">must</strong> be greater than or equal to
<a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>minPositionTruncateBitCount</code>
and less than or equal to <code>32</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBufferStride-10494" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBufferStride-10494"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBufferStride-10494</span><br>

<code>indexBufferStride</code> <strong class="purple">must</strong> be <code>0</code> or a multiple of <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBufferStride-10495" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBufferStride-10495"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBufferStride-10495</span><br>

<code>vertexBufferStride</code> <strong class="purple">must</strong> be <code>0</code> or a multiple of value specified
in
<a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-baseGeometryIndex-10496" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-baseGeometryIndex-10496"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-baseGeometryIndex-10496</span><br>

The maximum geometry index after using the values in
<code>baseGeometryIndex</code> and <code>geometryIndexBuffer</code> <strong class="purple">must</strong> be less than
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxClusterGeometryIndex</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapArray-10881" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapArray-10881"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapArray-10881</span><br>

If <code>opacityMicromapArray</code> is not <code>0</code>, then the cluster acceleration
structure <strong class="purple">must</strong> have been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_CLUSTER_OPACITY_MICROMAPS_BIT_NV</code>
flag set in <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>flags</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterFlags-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterFlags-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-clusterFlags-parameter</span><br>
 <code>clusterFlags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap39.html#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a> values</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBuffer-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBuffer-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-indexBuffer-parameter</span><br>
 <code>indexBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBuffer-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBuffer-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-vertexBuffer-parameter</span><br>
 <code>vertexBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-geometryIndexAndFlagsBuffer-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-geometryIndexAndFlagsBuffer-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-geometryIndexAndFlagsBuffer-parameter</span><br>
 <code>geometryIndexAndFlagsBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapArray-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapArray-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapArray-parameter</span><br>
 <code>opacityMicromapArray</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexBuffer-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexBuffer-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterInfoNV-opacityMicromapIndexBuffer-parameter</span><br>
 <code>opacityMicromapIndexBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits that <strong class="purple">can</strong> be set in
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>indexType</code>,
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterInfoNV">VkClusterAccelerationStructureBuildTriangleClusterInfoNV</a>::<code>opacityMicromapIndexType</code>,
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>::<code>indexType</code>
and
<a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>::<code>opacityMicromapIndexType</code>
specifying the index type is one of:</p>
</div>
<div id="VkClusterAccelerationStructureIndexFormatFlagBitsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkClusterAccelerationStructureIndexFormatFlagBitsNV</span> <span class="p">{</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_8BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_16BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
    <span class="n">VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_32BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureIndexFormatFlagBitsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_8BIT_NV</code> specifies
that 8-bit indices will be used.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_16BIT_NV</code> specifies
that 16-bit indices will be used.</p>
</li>
<li>
<p><code>VK_CLUSTER_ACCELERATION_STRUCTURE_INDEX_FORMAT_32BIT_NV</code> specifies
that 32-bit indices will be used.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkClusterAccelerationStructureIndexFormatFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="n">VkFlags</span> <span class="n">VkClusterAccelerationStructureIndexFormatFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkClusterAccelerationStructureIndexFormatFlagsNV</code> is a bitmask type for
setting a single <a href="chap39.html#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</a>
structure is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">clusterID</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureClusterFlagsNV</span>                     <span class="n">clusterFlags</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">triangleCount</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">vertexCount</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">positionTruncateBitCount</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">indexType</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                                         <span class="n">opacityMicromapIndexType</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
    <span class="n">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</span>    <span class="n">baseGeometryIndexAndGeometryFlags</span><span class="p">;</span>
    <span class="kt">uint16_t</span>                                                         <span class="n">indexBufferStride</span><span class="p">;</span>
    <span class="kt">uint16_t</span>                                                         <span class="n">vertexBufferStride</span><span class="p">;</span>
    <span class="kt">uint16_t</span>                                                         <span class="n">geometryIndexAndFlagsBufferStride</span><span class="p">;</span>
    <span class="kt">uint16_t</span>                                                         <span class="n">opacityMicromapIndexBufferStride</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">indexBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">vertexBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">geometryIndexAndFlagsBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">opacityMicromapArray</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">opacityMicromapIndexBuffer</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                                  <span class="n">instantiationBoundingBoxLimit</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterID</code> is a user specified identifier assigned to this cluster
template.</p>
</li>
<li>
<p><code>clusterFlags</code> is a bitmask of
<a href="chap39.html#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a> values describing
flags how the cluster template should be built.</p>
</li>
<li>
<p><code>triangleCount</code> is the number of triangles in this cluster.</p>
</li>
<li>
<p><code>vertexCount</code> is the number of unique vertices in this cluster.</p>
</li>
<li>
<p><code>positionTruncateBitCount</code> is the number of bits starting at the
lowest bit (i.e. the LSBs of the mantissa), of each vertex position that
will be truncated to zero to improve floating-point compression.</p>
</li>
<li>
<p><code>indexType</code> is a single
<a href="chap39.html#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a> value
specifying the index type in <code>indexBuffer</code>.</p>
</li>
<li>
<p><code>opacityMicromapIndexType</code> is a single
<a href="chap39.html#VkClusterAccelerationStructureIndexFormatFlagBitsNV">VkClusterAccelerationStructureIndexFormatFlagBitsNV</a> value
specifying the index type in <code>opacityMicromapIndexBuffer</code>.</p>
</li>
<li>
<p><code>baseGeometryIndexAndGeometryFlags</code> is a
<a href="chap39.html#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
value specifying the base geometry index and flags for all triangles in
the cluster template.</p>
</li>
<li>
<p><code>indexBufferStride</code> is the stride in bytes in <code>indexBuffer</code>.</p>
</li>
<li>
<p><code>vertexBufferStride</code> is the stride in bytes in <code>vertexBuffer</code>.</p>
</li>
<li>
<p><code>geometryIndexAndFlagsBufferStride</code> is the stride in bytes in
<code>geometryIndexAndFlagsBuffer</code>.</p>
</li>
<li>
<p><code>opacityMicromapIndexBufferStride</code> is the stride in bytes in
<code>opacityMicromapIndexBuffer</code>.</p>
</li>
<li>
<p><code>indexBuffer</code> contains the indices of vertices in the cluster and is
of type <code>indexType</code>.</p>
</li>
<li>
<p><code>vertexBuffer</code> is either <code>0</code> or specifies the vertex data of the
triangles in the cluster template with format specified in
<a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>vertexFormat</code>.</p>
</li>
<li>
<p><code>geometryIndexAndFlagsBuffer</code> is either <code>0</code> or an address containing
strided
<a href="chap39.html#VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV">VkClusterAccelerationStructureGeometryIndexAndGeometryFlagsNV</a>
values specifying the geometry index and flag for every triangle in the
cluster.</p>
</li>
<li>
<p><code>opacityMicromapArray</code> is either <code>0</code> or specifies the address of a
valid opacity micromap array to reference from the cluster acceleration
structure.
If it is <code>0</code>, then opacity micromaps will be disabled for this cluster
acceleration structure.</p>
</li>
<li>
<p><code>opacityMicromapIndexBuffer</code> is either <code>0</code> or specifies the address
of a strided array with size equal to the number of triangles or indices
into the opacity micromap array.
If <code>opacityMicromapIndexBuffer</code> is <code>0</code> then the index used is the
index of the triangle in the geometry.</p>
</li>
<li>
<p><code>instantiationBoundingBoxLimit</code> is either <code>0</code> or specifies the
address of a bounding box within which all instantiated clusters <strong class="purple">must</strong>
lie.
The bounding box is specified by six 32-bit floating-point values in the
order MinX, MinY, MinZ, MaxX, MaxY, MaxZ.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The C language specification does not define the ordering of bit-fields, but
in practice, this structure produces the correct layout with existing
compilers.
The intended bit pattern is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>triangleCount</code>, <code>vertexCount</code>, <code>positionTruncateBitCount</code>,
<code>indexType</code> and <code>opacityMicromapIndexType</code> occupy the same
memory as if a single <code>uint32_t</code> was specified in their place</p>
<div class="ulist">
<ul>
<li>
<p><code>triangleCount</code> occupies the 9 least significant bits of that
memory</p>
</li>
<li>
<p><code>vertexCount</code> occupies the next 9 least significant bits of that
memory</p>
</li>
<li>
<p><code>positionTruncateBitCount</code> occupies the next 6 least significant
bits of that memory</p>
</li>
<li>
<p><code>indexType</code> occupies the next 4 least significant bits of that
memory</p>
</li>
<li>
<p><code>opacityMicromapIndexType</code> occupies the 4 most significant bits of
that memory</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a compiler produces code that diverges from that pattern, applications
<strong class="purple">must</strong> employ another method to set values according to the correct bit
pattern.</p>
</div>
<div class="paragraph">
<p>Cluster templates cannot be directly used to build bottom level acceleration
structures, instead, they <strong class="purple">must</strong> be instantiated into
<a href="chap39.html#acceleration-structure-clas-geometry">CLAS objects</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterID-10497" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterID-10497"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterID-10497</span><br>

<code>clusterID</code> <strong class="purple">must</strong> not be 0xFFFFFFFF</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-triangleCount-10498" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-triangleCount-10498"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-triangleCount-10498</span><br>

<code>triangleCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxTrianglesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexCount-10499" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexCount-10499"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexCount-10499</span><br>

<code>vertexCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxVerticesPerCluster</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexType-10500" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexType-10500"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexType-10500</span><br>

<code>indexType</code> <strong class="purple">must</strong> only have a single bit set</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexType-10501" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexType-10501"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexType-10501</span><br>

<code>opacityMicromapIndexType</code> <strong class="purple">must</strong> only have a single bit set</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-positionTruncateBitCount-10502" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-positionTruncateBitCount-10502"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-positionTruncateBitCount-10502</span><br>

<code>positionTruncateBitCount</code> <strong class="purple">must</strong> be greater than or equal to
<a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>minPositionTruncateBitCount</code>
and less than or equal to <code>32</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBufferStride-10503" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBufferStride-10503"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBufferStride-10503</span><br>

<code>indexBufferStride</code> <strong class="purple">must</strong> be <code>0</code> or a multiple of <code>indexType</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBufferStride-10504" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBufferStride-10504"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBufferStride-10504</span><br>

<code>vertexBufferStride</code> <strong class="purple">must</strong> be <code>0</code> or a multiple of value specified
in
<a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a>::<code>vertexFormat</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-10505" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-10505"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-10505</span><br>

<code>instantiationBoundingBoxLimit</code> <strong class="purple">must</strong> be aligned to
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>clusterTemplateBoundsByteAlignment</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-baseGeometryIndex-10506" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-baseGeometryIndex-10506"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-baseGeometryIndex-10506</span><br>

The maximum geometry index after using the values in
<code>baseGeometryIndex</code> and <code>geometryIndexBuffer</code> <strong class="purple">must</strong> be less than
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxClusterGeometryIndex</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapArray-10882" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapArray-10882"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapArray-10882</span><br>

If <code>opacityMicromapArray</code> is not <code>0</code>, then the template cluster
acceleration structure <strong class="purple">must</strong> have been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_CLUSTER_OPACITY_MICROMAPS_BIT_NV</code>
flag set in <a href="chap39.html#VkClusterAccelerationStructureInputInfoNV">VkClusterAccelerationStructureInputInfoNV</a>::<code>flags</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterFlags-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterFlags-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-clusterFlags-parameter</span><br>
 <code>clusterFlags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap39.html#VkClusterAccelerationStructureClusterFlagBitsNV">VkClusterAccelerationStructureClusterFlagBitsNV</a> values</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBuffer-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBuffer-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-indexBuffer-parameter</span><br>
 <code>indexBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBuffer-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBuffer-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-vertexBuffer-parameter</span><br>
 <code>vertexBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-geometryIndexAndFlagsBuffer-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-geometryIndexAndFlagsBuffer-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-geometryIndexAndFlagsBuffer-parameter</span><br>
 <code>geometryIndexAndFlagsBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapArray-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapArray-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapArray-parameter</span><br>
 <code>opacityMicromapArray</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexBuffer-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexBuffer-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-opacityMicromapIndexBuffer-parameter</span><br>
 <code>opacityMicromapIndexBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureBuildTriangleClusterTemplateInfoNV-instantiationBoundingBoxLimit-parameter</span><br>
 <code>instantiationBoundingBoxLimit</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureInstantiateClusterInfoNV">VkClusterAccelerationStructureInstantiateClusterInfoNV</a> structure
is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureInstantiateClusterInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureInstantiateClusterInfoNV</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>                    <span class="n">clusterIdOffset</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                    <span class="n">geometryIndexOffset</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                    <span class="n">reserved</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>             <span class="n">clusterTemplateAddress</span><span class="p">;</span>
    <span class="n">VkStridedDeviceAddressNV</span>    <span class="n">vertexBuffer</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureInstantiateClusterInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterIdOffset</code> is an unsigned offset applied to the
<code>clusterID</code> value stored in the cluster template.</p>
</li>
<li>
<p><code>geometryIndexOffset</code> is a signed offset applied to the geometry
index of each triangle.</p>
</li>
<li>
<p><code>reserved</code> is reserved for future use.</p>
</li>
<li>
<p><code>clusterTemplateAddress</code> is the address of a previously built
cluster template.</p>
</li>
<li>
<p><code>vertexBuffer</code> is either <code>0</code> or a <a href="chap39.html#VkStridedDeviceAddressNV">VkStridedDeviceAddressNV</a>
structure containing the vertex data for the indexed triangles stored in
the cluster template.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10507" href="chap39.html#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10507"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10507</span><br>

<code>vertexBuffer</code> <strong class="purple">must</strong> not be <code>0</code> if the template was built without
vertex data</p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10508" href="chap39.html#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10508"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-vertexBuffer-10508</span><br>

The format in <code>vertexBuffer</code> <strong class="purple">must</strong> match the original format
specified in <a href="chap39.html#VkClusterAccelerationStructureTriangleClusterInputNV">VkClusterAccelerationStructureTriangleClusterInputNV</a></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-reserved-10509" href="chap39.html#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-reserved-10509"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-reserved-10509</span><br>

<code>reserved</code> <strong class="purple">must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-geometryIndexOffset-10510" href="chap39.html#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-geometryIndexOffset-10510"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-geometryIndexOffset-10510</span><br>

The maximum geometry index after using the value in
<code>geometryIndexOffset</code> <strong class="purple">must</strong> be less than
<a href="chap52.html#VkPhysicalDeviceClusterAccelerationStructurePropertiesNV">VkPhysicalDeviceClusterAccelerationStructurePropertiesNV</a>::<code>maxClusterGeometryIndex</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-clusterTemplateAddress-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-clusterTemplateAddress-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureInstantiateClusterInfoNV-clusterTemplateAddress-parameter</span><br>
 <code>clusterTemplateAddress</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkClusterAccelerationStructureGetTemplateIndicesInfoNV">VkClusterAccelerationStructureGetTemplateIndicesInfoNV</a> structure
is defined as:</p>
</div>
<div id="VkClusterAccelerationStructureGetTemplateIndicesInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkClusterAccelerationStructureGetTemplateIndicesInfoNV</span> <span class="p">{</span>
    <span class="n">VkDeviceAddress</span>    <span class="n">clusterTemplateAddress</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkClusterAccelerationStructureGetTemplateIndicesInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterTemplateAddress</code> is the device address of the cluster
template acceleration structure whose index data is being fetched.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureGetTemplateIndicesInfoNV-clusterTemplateAddress-10833" href="chap39.html#VUID-VkClusterAccelerationStructureGetTemplateIndicesInfoNV-clusterTemplateAddress-10833"></a> <span class="vuid">VUID-VkClusterAccelerationStructureGetTemplateIndicesInfoNV-clusterTemplateAddress-10833</span><br>

<code>clusterTemplateAddress</code> <strong class="purple">must</strong> be a
<a href="chap39.html#acceleration-structure-clas-template">template cluster acceleration
structure</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkClusterAccelerationStructureGetTemplateIndicesInfoNV-clusterTemplateAddress-parameter" href="chap39.html#VUID-VkClusterAccelerationStructureGetTemplateIndicesInfoNV-clusterTemplateAddress-parameter"></a> <span class="vuid">VUID-VkClusterAccelerationStructureGetTemplateIndicesInfoNV-clusterTemplateAddress-parameter</span><br>
 <code>clusterTemplateAddress</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkStridedDeviceAddressNV">VkStridedDeviceAddressNV</a> structure is defined as:</p>
</div>
<div id="VkStridedDeviceAddressNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_cluster_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkStridedDeviceAddressNV</span> <span class="p">{</span>
    <span class="n">VkDeviceAddress</span>    <span class="n">startAddress</span><span class="p">;</span>
    <span class="n">VkDeviceSize</span>       <span class="n">strideInBytes</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkStridedDeviceAddressNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>startAddress</code> is the device address (as returned by the
<a href="chap12.html#vkGetBufferDeviceAddress">vkGetBufferDeviceAddress</a> command) at which the region starts, or
zero if the region is unused.</p>
</li>
<li>
<p><code>strideInBytes</code> is the byte stride between consecutive elements.
Only the bottom 32 bits are used.
The field is 64 bits to ensure consistent alignment across all
containing structures.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkStridedDeviceAddressNV-startAddress-parameter" href="chap39.html#VUID-VkStridedDeviceAddressNV-startAddress-parameter"></a> <span class="vuid">VUID-VkStridedDeviceAddressNV-startAddress-parameter</span><br>
 <code>startAddress</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="partitioned-tlas"><a class="anchor" href="chap39.html#partitioned-tlas"></a>39.3. Partitioned Top Level Acceleration Structures</h3>
<div class="paragraph">
<p>Partitioned Top Level Acceleration Structures (PTLAS) allow efficient reuse
of previously constructed sections of the top level acceleration structure
by eliminating a full rebuild when only a few instances are modified.
This reduces build times and supports handling a higher number of instances,
making it more suitable for large and complex scenes.</p>
</div>
<div class="paragraph">
<p>PTLAS organizes instances into partitions, enabling a two-stage build
process: first, it constructs an acceleration structure for each partition
by grouping the instances within it, and second, it combines these partition
structures into a single acceleration structure, similar to the current
top-level acceleration structure.</p>
</div>
<div class="paragraph">
<p>To maintain compatibility, PTLAS behaves identically to the current
top-level acceleration structure from the perspective of ray tracing shaders
and pipelines.</p>
</div>
<div id="ptlas-global-partition" class="paragraph">
<p>PTLAS includes a unique global partition that operates independently of
other partitions.
Instances <strong class="purple">can</strong> be assigned to this global partition just like they would to
regular partitions.
The global partition is well-suited for frequently updated instances, such
as animated characters.
During the build process, instances in the global partition are treated as
if they belong to individual partitions, without increasing the maximum
partition count.
However, instances in the global partition may still impact build
performance.
Once these instances become stable, they should be moved to a spatially
optimized, non-global partition to lower build costs and minimize trace
performance issues.</p>
</div>
<div id="ptlas-partition-translation" class="paragraph">
<p>To handle large worlds requiring more precision than 32-bit floating-point
numbers offer, PTLAS offers efficient partition translation.
Typically, applications maintain precision by placing the world center near
the camera.
Partition translation allows an additional translation of instances during
construction without changing their stored transforms.
This method stores instance transforms relative to partitions, applying a
translation to achieve accurate world positions.
Higher precision is maintained using smaller floating-point numbers until
the structure is built.
World space coordinates <strong class="purple">can</strong> also be updated efficiently without rebuilding
the entire PTLAS.
Partition translation requires extra memory for untranslated instance
transforms and <strong class="purple">must</strong> be explicitly enabled with
<a href="chap39.html#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a>::<code>enablePartitionTranslation</code>
flag.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To determine the memory requirements for a PTAS, call:</p>
</div>
<div id="vkGetPartitionedAccelerationStructuresBuildSizesNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkGetPartitionedAccelerationStructuresBuildSizesNV</span><span class="p">(</span>
    <span class="n">VkDevice</span>                                    <span class="n">device</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkPartitionedAccelerationStructureInstancesInputNV</span><span class="o">*</span> <span class="n">pInfo</span><span class="p">,</span>
    <span class="n">VkAccelerationStructureBuildSizesInfoKHR</span><span class="o">*</span>   <span class="n">pSizeInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the logical device that owns the acceleration structure.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="chap39.html#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure
containing parameters required for the memory requirements query.</p>
</li>
<li>
<p><code>pSizeInfo</code> is a pointer to a
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure which returns
the size required for an acceleration structure and the sizes required
for the scratch buffers, given the build parameters.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-partitionedAccelerationStructure-10534" href="chap39.html#VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-partitionedAccelerationStructure-10534"></a> <span class="vuid">VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-partitionedAccelerationStructure-10534</span><br>

The <a href="chap51.html#features-partitionedAccelerationStructure"><code>VkPhysicalDevicePartitionedAccelerationStructureFeaturesNV</code>::<code>partitionedAccelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-device-parameter" href="chap39.html#VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-device-parameter"></a> <span class="vuid">VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-device-parameter</span><br>
 <code>device</code> <strong class="purple">must</strong> be a valid <a href="chap5.html#VkDevice">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pInfo-parameter" href="chap39.html#VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pInfo-parameter"></a> <span class="vuid">VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pSizeInfo-parameter" href="chap39.html#VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pSizeInfo-parameter"></a> <span class="vuid">VUID-vkGetPartitionedAccelerationStructuresBuildSizesNV-pSizeInfo-parameter</span><br>
 <code>pSizeInfo</code> <strong class="purple">must</strong> be a valid pointer to a <a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure is
defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureInstancesInputNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkPartitionedAccelerationStructureInstancesInputNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                         <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>                                   <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkBuildAccelerationStructureFlagsKHR</span>    <span class="n">flags</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                <span class="n">instanceCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                <span class="n">maxInstancePerPartitionCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                <span class="n">partitionCount</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                <span class="n">maxInstanceInGlobalPartitionCount</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkPartitionedAccelerationStructureInstancesInputNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>flags</code> is a bitmask of <a href="chap12.html#VkBuildAccelerationStructureFlagsKHR">VkBuildAccelerationStructureFlagsKHR</a>
specifying flags for the PTLAS build operation.</p>
</li>
<li>
<p><code>instanceCount</code> is the number of instances in this PTLAS.</p>
</li>
<li>
<p><code>maxInstancePerPartitionCount</code> is the maximum number of instances
per partition in the PTLAS.</p>
</li>
<li>
<p><code>partitionCount</code> is the number of partitions in the PTLAS.</p>
</li>
<li>
<p><code>maxInstanceInGlobalPartitionCount</code> is maximum number of instances
in the <a href="chap39.html#ptlas-global-partition">global partition</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>pNext</code> chain includes a
<a href="chap39.html#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a> structure, then that
structure specifies additional flags for the PTLAS.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-partitionCount-10535" href="chap39.html#VUID-VkPartitionedAccelerationStructureInstancesInputNV-partitionCount-10535"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-partitionCount-10535</span><br>

The sum of <code>partitionCount</code> and
<code>maxInstanceInGlobalPartitionCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDevicePartitionedAccelerationStructurePropertiesNV">VkPhysicalDevicePartitionedAccelerationStructurePropertiesNV</a>::<code>maxPartitionCount</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-sType" href="chap39.html#VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-sType"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCES_INPUT_NV</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-pNext-pNext" href="chap39.html#VUID-VkPartitionedAccelerationStructureInstancesInputNV-pNext-pNext"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code> or a pointer to a valid instance of <a href="chap39.html#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-unique" href="chap39.html#VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-unique"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-sType-unique</span><br>
 The <code>sType</code> value of each structure in the <code>pNext</code> chain <strong class="purple">must</strong> be unique</p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureInstancesInputNV-flags-parameter" href="chap39.html#VUID-VkPartitionedAccelerationStructureInstancesInputNV-flags-parameter"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureInstancesInputNV-flags-parameter</span><br>
 <code>flags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap12.html#VkBuildAccelerationStructureFlagBitsKHR">VkBuildAccelerationStructureFlagBitsKHR</a> values</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a> structure is defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkPartitionedAccelerationStructureFlagsNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>    <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>              <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkBool32</span>           <span class="n">enablePartitionTranslation</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkPartitionedAccelerationStructureFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>enablePartitionTranslation</code> specifies if a
<a href="chap39.html#ptlas-partition-translation">partition translation</a> <strong class="purple">may</strong> be applied
with
<a href="chap39.html#VkPartitionedAccelerationStructureWritePartitionTranslationDataNV">VkPartitionedAccelerationStructureWritePartitionTranslationDataNV</a>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureFlagsNV-sType-sType" href="chap39.html#VUID-VkPartitionedAccelerationStructureFlagsNV-sType-sType"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureFlagsNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_PARTITIONED_ACCELERATION_STRUCTURE_FLAGS_NV</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build a partitioned top level acceleration structure, call:</p>
</div>
<div id="vkCmdBuildPartitionedAccelerationStructuresNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="kt">void</span> <span class="nf">vkCmdBuildPartitionedAccelerationStructuresNV</span><span class="p">(</span>
    <span class="n">VkCommandBuffer</span>                             <span class="n">commandBuffer</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkBuildPartitionedAccelerationStructureInfoNV</span><span class="o">*</span> <span class="n">pBuildInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>commandBuffer</code> is the command buffer into which the command is
recorded.</p>
</li>
<li>
<p><code>pBuildInfo</code> is a pointer to a
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a> structure containing
parameters required for building a PTLAS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accesses to the acceleration structure scratch memory as identified by the
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>scratchData</code> <strong class="purple">must</strong>
be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
(<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> |
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>).</p>
</div>
<div class="paragraph">
<p>Accesses to each
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>srcAccelerationStructureData</code>
and
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>dstAccelerationStructureData</code>
<strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_KHR</code> or
<code>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_KHR</code>, as appropriate.</p>
</div>
<div class="paragraph">
<p>Accesses to memory with input data as identified by any used values of
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>srcInfos</code> and
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>srcInfosCount</code>
<strong class="purple">must</strong> be <a href="chap7.html#synchronization-dependencies">synchronized</a> with the
<code>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_KHR</code>
<a href="chap7.html#synchronization-pipeline-stages">pipeline stage</a> and an
<a href="chap7.html#synchronization-access-types">access type</a> of
<code>VK_ACCESS_INDIRECT_COMMAND_READ_BIT</code>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-partitionedAccelerationStructure-10536" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-partitionedAccelerationStructure-10536"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-partitionedAccelerationStructure-10536</span><br>

The <a href="chap51.html#features-partitionedAccelerationStructure"><code>VkPhysicalDevicePartitionedAccelerationStructureFeaturesNV</code>::<code>partitionedAccelerationStructure</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10537" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10537"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10537</span><br>

The count specified in <code>pBuildInfo-&gt;input.instanceCount</code> for the
build operation <strong class="purple">must</strong> not exceed the value provided in
<code>pInfo-&gt;instanceCount</code> when calling
<a href="chap39.html#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> to determine
the memory size</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10538" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10538"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10538</span><br>

The count specified in
<code>pBuildInfo-&gt;input.maxInstancePerPartitionCount</code> for the build
operation <strong class="purple">must</strong> not exceed the value provided in
<code>pInfo-&gt;maxInstancePerPartitionCount</code> when calling
<a href="chap39.html#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> to determine
the memory size</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10539" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10539"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10539</span><br>

The count specified in <code>pBuildInfo-&gt;input.partitionCount</code> for the
build operation <strong class="purple">must</strong> not exceed the value provided in
<code>pInfo-&gt;partitionCount</code> when calling
<a href="chap39.html#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> to determine
the memory size</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10540" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10540"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10540</span><br>

The count specified in
<code>pBuildInfo-&gt;input.maxInstanceInGlobalPartitionCount</code> for the build
operation <strong class="purple">must</strong> not exceed the value provided in
<code>pInfo-&gt;maxInstanceInGlobalPartitionCount</code> when calling
<a href="chap39.html#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> to determine
the memory size</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10541" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10541"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10541</span><br>

The scratch memory for the partitioned acceleration structure build
specified in <code>pBuildInfo-&gt;scratchData</code> <strong class="purple">must</strong> be larger than or equal
to the scratch size queried with
<a href="chap39.html#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10542" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10542"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10542</span><br>

<code>pBuildInfo-&gt;scratchData</code> <strong class="purple">must</strong> be aligned to <code>256</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10543" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10543"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10543</span><br>

The destination memory of the partitioned acceleration structure build
specified in <code>pBuildInfo-&gt;dstAccelerationStructureData</code> <strong class="purple">must</strong> be
larger than or equal to the size queried with
<a href="chap39.html#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10544" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10544"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10544</span><br>

<code>pBuildInfo-&gt;srcAccelerationStructureData</code> <strong class="purple">must</strong> be aligned to <code>256</code>
bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10545" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10545"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10545</span><br>

<code>pBuildInfo-&gt;dstAccelerationStructureData</code> <strong class="purple">must</strong> be aligned to <code>256</code>
bytes</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10546" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10546"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10546</span><br>

The number of inputs specified in <code>pBuildInfo-&gt;srcInfos</code> <strong class="purple">must</strong> be
greater than or equal to <code>pBuildInfo-&gt;srcInfosCount</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10547" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10547"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10547</span><br>

The memory region containing the acceleration structure at address
<code>pBuildInfo-&gt;srcAccelerationStructureData</code> <strong class="purple">must</strong> not overlap with
scratch memory region at address <code>pBuildInfo-&gt;scratchData</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10548" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10548"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10548</span><br>

The memory region containing the acceleration structure at address
<code>pBuildInfo-&gt;dstAccelerationStructureData</code> <strong class="purple">must</strong> not overlap with
scratch memory region at address <code>pBuildInfo-&gt;scratchData</code></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10549" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10549"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10549</span><br>

The memory regions containing the acceleration structures at addresses
<code>pBuildInfo-&gt;srcAccelerationStructureData</code> and
<code>pBuildInfo-&gt;dstAccelerationStructureData</code> <strong class="purple">must</strong> not overlap with
each other</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10550" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10550"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10550</span><br>

The buffer from which the buffer device address for
<code>pBuildInfo-&gt;scratchData</code> is queried <strong class="purple">must</strong> have been created with
the <code>VK_BUFFER_USAGE_STORAGE_BUFFER_BIT</code> usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10551" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10551"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10551</span><br>

The buffers from which the buffer device addresses for
<code>pBuildInfo-&gt;srcInfos</code> and <code>pBuildInfo-&gt;srcInfosCount</code> are
queried <strong class="purple">must</strong> have been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_BUILD_INPUT_READ_ONLY_BIT_KHR</code>
usage flag</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10552" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10552"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-10552</span><br>

The buffers from which the buffer device addresses for
<code>pBuildInfo-&gt;srcAccelerationStructureData</code> and
<code>pBuildInfo-&gt;dstAccelerationStructureData</code> are queried <strong class="purple">must</strong> have
been created with the
<code>VK_BUFFER_USAGE_ACCELERATION_STRUCTURE_STORAGE_BIT_KHR</code> usage flag</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-parameter" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-parameter"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-parameter</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be a valid <a href="chap6.html#VkCommandBuffer">VkCommandBuffer</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-parameter" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-parameter"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-pBuildInfo-parameter</span><br>
 <code>pBuildInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-recording" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-recording"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-recording</span><br>
 <code>commandBuffer</code> <strong class="purple">must</strong> be in the <a href="chap6.html#commandbuffers-lifecycle">recording state</a></p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-cmdpool" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-cmdpool"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-commandBuffer-cmdpool</span><br>
 The <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> support VK_QUEUE_COMPUTE_BIT operations</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-renderpass" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-renderpass"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-renderpass</span><br>
 This command <strong class="purple">must</strong> only be called outside of a render pass instance</p>
</li>
<li>
<p><a id="VUID-vkCmdBuildPartitionedAccelerationStructuresNV-videocoding" href="chap39.html#VUID-vkCmdBuildPartitionedAccelerationStructuresNV-videocoding"></a> <span class="vuid">VUID-vkCmdBuildPartitionedAccelerationStructuresNV-videocoding</span><br>
 This command <strong class="purple">must</strong> only be called outside of a video coding scope</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Host Synchronization</div>
<div class="ulist">
<ul>
<li>
<p>Host access to <code>commandBuffer</code> <strong class="purple">must</strong> be externally synchronized</p>
</li>
<li>
<p>Host access to the <code>VkCommandPool</code> that <code>commandBuffer</code> was allocated from <strong class="purple">must</strong> be externally synchronized</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Command Properties</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><a href="chap6.html#VkCommandBufferLevel">Command Buffer Levels</a></th>
<th class="tableblock halign-left valign-top"><a href="chap8.html#vkCmdBeginRenderPass">Render Pass Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap45.html#vkCmdBeginVideoCodingKHR">Video Coding Scope</a></th>
<th class="tableblock halign-left valign-top"><a href="chap5.html#VkQueueFlagBits">Supported Queue Types</a></th>
<th class="tableblock halign-left valign-top"><a href="chap3.html#fundamentals-queueoperation-command-types">Command Type</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary<br>
Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outside</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VK_QUEUE_COMPUTE_BIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Action</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Conditional Rendering</div>
<div class="paragraph">
<p>vkCmdBuildPartitionedAccelerationStructuresNV is not affected by <a href="chap23.html#drawing-conditional-rendering">conditional rendering</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a> structure is defined
as:</p>
</div>
<div id="VkBuildPartitionedAccelerationStructureInfoNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkBuildPartitionedAccelerationStructureInfoNV</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>                                       <span class="n">sType</span><span class="p">;</span>
    <span class="kt">void</span><span class="o">*</span>                                                 <span class="n">pNext</span><span class="p">;</span>
    <span class="n">VkPartitionedAccelerationStructureInstancesInputNV</span>    <span class="n">input</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                       <span class="n">srcAccelerationStructureData</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                       <span class="n">dstAccelerationStructureData</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                       <span class="n">scratchData</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                       <span class="n">srcInfos</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                       <span class="n">srcInfosCount</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkBuildPartitionedAccelerationStructureInfoNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sType</code> is a <a href="chap3.html#VkStructureType">VkStructureType</a> value identifying this structure.</p>
</li>
<li>
<p><code>pNext</code> is <code>NULL</code> or a pointer to a structure extending this
structure.</p>
</li>
<li>
<p><code>input</code> is a
<a href="chap39.html#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure
describing the instance and partition count information in the PTLAS.</p>
</li>
<li>
<p><code>srcAccelerationStructureData</code> is <code>NULL</code> or an address of a
previously built PTLAS.
If non-<code>NULL</code>, the PTLAS stored at this address is used as a basis to
create new PTLAS.</p>
</li>
<li>
<p><code>dstAccelerationStructureData</code> is the address to store the built
PTLAS.</p>
</li>
<li>
<p><code>scratchData</code> is the device address of scratch memory that will be
used during PTLAS build.</p>
</li>
<li>
<p><code>srcInfos</code> is the device address of an array of
<a href="chap39.html#VkBuildPartitionedAccelerationStructureIndirectCommandNV">VkBuildPartitionedAccelerationStructureIndirectCommandNV</a>
structures describing the type of operation to perform.</p>
</li>
<li>
<p><code>srcInfosCount</code> is a device address containing the size of
<code>srcInfos</code> array.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Members <code>srcAccelerationStructureData</code> and
<code>dstAccelerationStructureData</code> <strong class="purple">may</strong> be the same or different.
If they are the same, the update happens in-place.
Otherwise, the destination acceleration structure is updated and the source
is not modified.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10558" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10558"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10558</span><br>

<code>scratchData</code> <strong class="purple">must</strong> not be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10559" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10559"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-10559</span><br>

Memory at <code>scratchData</code> <strong class="purple">must</strong> be equal or larger than the
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a>::<code>buildScratchSize</code>
value returned from
<a href="chap39.html#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> with the same
build parameters</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-10560" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-10560"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-10560</span><br>

If <code>srcAccelerationStructureData</code> is not <code>NULL</code>, it <strong class="purple">must</strong> have
previously been built as a PTLAS</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10561" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10561"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10561</span><br>

<code>dstAccelerationStructureData</code> <strong class="purple">must</strong> not be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10562" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10562"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-10562</span><br>

Memory at <code>dstAccelerationStructureData</code> <strong class="purple">must</strong> be equal or larger
than the
<a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a>::<code>accelerationStructureSize</code>
value returned from
<a href="chap39.html#vkGetPartitionedAccelerationStructuresBuildSizesNV">vkGetPartitionedAccelerationStructuresBuildSizesNV</a> with the same
build parameters</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-10563" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-10563"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-10563</span><br>

<code>srcInfosCount</code> <strong class="purple">must</strong> be 4-byte aligned</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-10564" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-10564"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-10564</span><br>

Each element of <code>srcInfos</code> array <strong class="purple">must</strong> have a unique
<a href="chap39.html#VkBuildPartitionedAccelerationStructureIndirectCommandNV">VkBuildPartitionedAccelerationStructureIndirectCommandNV</a>::<code>opType</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-sType-sType" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-sType-sType"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-sType-sType</span><br>
 <code>sType</code> <strong class="purple">must</strong> be <code>VK_STRUCTURE_TYPE_BUILD_PARTITIONED_ACCELERATION_STRUCTURE_INFO_NV</code></p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-pNext-pNext" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-pNext-pNext"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-pNext-pNext</span><br>
 <code>pNext</code> <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-input-parameter" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-input-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-input-parameter</span><br>
 <code>input</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkPartitionedAccelerationStructureInstancesInputNV">VkPartitionedAccelerationStructureInstancesInputNV</a> structure</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-parameter" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcAccelerationStructureData-parameter</span><br>
 <code>srcAccelerationStructureData</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-parameter" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-dstAccelerationStructureData-parameter</span><br>
 <code>dstAccelerationStructureData</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-parameter" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-scratchData-parameter</span><br>
 <code>scratchData</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-parameter" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfos-parameter</span><br>
 <code>srcInfos</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-parameter" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureInfoNV-srcInfosCount-parameter</span><br>
 <code>srcInfosCount</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkBuildPartitionedAccelerationStructureIndirectCommandNV">VkBuildPartitionedAccelerationStructureIndirectCommandNV</a> structure
is defined as:</p>
</div>
<div id="VkBuildPartitionedAccelerationStructureIndirectCommandNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkBuildPartitionedAccelerationStructureIndirectCommandNV</span> <span class="p">{</span>
    <span class="n">VkPartitionedAccelerationStructureOpTypeNV</span>    <span class="n">opType</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                      <span class="n">argCount</span><span class="p">;</span>
    <span class="n">VkStridedDeviceAddressNV</span>                      <span class="n">argData</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkBuildPartitionedAccelerationStructureIndirectCommandNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>opType</code> is a <a href="chap39.html#VkPartitionedAccelerationStructureOpTypeNV">VkPartitionedAccelerationStructureOpTypeNV</a>
describing the type of operation.</p>
</li>
<li>
<p><code>argCount</code> the number of structures in <code>argData</code> array.</p>
</li>
<li>
<p><code>argData</code> is an array of <a href="chap39.html#VkStridedDeviceAddressNV">VkStridedDeviceAddressNV</a> structures
containing the write or update data for instances and partitions in the
PTLAS.
The structure is dependent on <code>opType</code> as shown in the table below.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>opType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format of <code>argData</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_INSTANCE_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_UPDATE_INSTANCE_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkPartitionedAccelerationStructureUpdateInstanceDataNV">VkPartitionedAccelerationStructureUpdateInstanceDataNV</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_PARTITION_TRANSLATION_NV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="chap39.html#VkPartitionedAccelerationStructureWritePartitionTranslationDataNV">VkPartitionedAccelerationStructureWritePartitionTranslationDataNV</a></p></td>
</tr>
</tbody>
</table>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-argData-10565" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-argData-10565"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-argData-10565</span><br>

An instance index <strong class="purple">must</strong> not be referenced by more than one structure in
<code>argData</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-opType-parameter" href="chap39.html#VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-opType-parameter"></a> <span class="vuid">VUID-VkBuildPartitionedAccelerationStructureIndirectCommandNV-opType-parameter</span><br>
 <code>opType</code> <strong class="purple">must</strong> be a valid <a href="chap39.html#VkPartitionedAccelerationStructureOpTypeNV">VkPartitionedAccelerationStructureOpTypeNV</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Values which <strong class="purple">can</strong> be set in <a href="chap39.html#VkPartitionedAccelerationStructureOpTypeNV">VkPartitionedAccelerationStructureOpTypeNV</a>
are:</p>
</div>
<div id="VkPartitionedAccelerationStructureOpTypeNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkPartitionedAccelerationStructureOpTypeNV</span> <span class="p">{</span>
    <span class="n">VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_INSTANCE_NV</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_UPDATE_INSTANCE_NV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_PARTITION_TRANSLATION_NV</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkPartitionedAccelerationStructureOpTypeNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_INSTANCE_NV</code> is
used to assign a transformed bottom level acceleration structure to an
instance and partition.
This is similar to <a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a> that defines
the properties and transformations for a single instance in
non-partitioned TLAS.
Any partition that contains at least one of the affected instances will
have their internal acceleration structure rebuilt.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_UPDATE_INSTANCE_NV</code>
specifies that an instance will be updated with a new bottom level
acceleration structure.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_OP_TYPE_WRITE_PARTITION_TRANSLATION_NV</code>
specifies that a partition will be assigned a
<a href="chap39.html#ptlas-partition-translation">translation vector</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a> structure is
defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureWriteInstanceDataNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkPartitionedAccelerationStructureWriteInstanceDataNV</span> <span class="p">{</span>
    <span class="n">VkTransformMatrixKHR</span>                                 <span class="n">transform</span><span class="p">;</span>
    <span class="kt">float</span>                                                <span class="n">explicitAABB</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="kt">uint32_t</span>                                             <span class="n">instanceID</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                             <span class="n">instanceMask</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                             <span class="n">instanceContributionToHitGroupIndex</span><span class="p">;</span>
    <span class="n">VkPartitionedAccelerationStructureInstanceFlagsNV</span>    <span class="n">instanceFlags</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                             <span class="n">instanceIndex</span><span class="p">;</span>
    <span class="kt">uint32_t</span>                                             <span class="n">partitionIndex</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>                                      <span class="n">accelerationStructure</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkPartitionedAccelerationStructureWriteInstanceDataNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>transform</code> is a <a href="chap39.html#VkTransformMatrixKHR">VkTransformMatrixKHR</a> structure describing the
transformation to be applied to the instance in PTLAS.</p>
</li>
<li>
<p><code>explicitAABB</code> specifies an axis aligned bounding box representing
the maximum extent of any vertex within the used acceleration structure
after applying the instance-to-world transformation.
The <a href="chap39.html#ptlas-partition-translation">partition translation</a> is not
applied to the bounding box.</p>
</li>
<li>
<p><code>instanceID</code> is a user specified constant assigned to an instance in
the PTLAS.</p>
</li>
<li>
<p><code>instanceMask</code> is a 8-bit mask assigned to the instance that <strong class="purple">may</strong> be
used to include or reject group of instances.</p>
</li>
<li>
<p><code>instanceContributionToHitGroupIndex</code> is a 24-bit per application
specified instance value added in the indexing into the shader binding
table to fetch the hit group to use.</p>
</li>
<li>
<p><code>instanceFlags</code> is a bitmask of
<a href="chap39.html#VkPartitionedAccelerationStructureInstanceFlagsNV">VkPartitionedAccelerationStructureInstanceFlagsNV</a> specifying flags
an instance in the PTLAS.</p>
</li>
<li>
<p><code>instanceIndex</code> is the index of the instance within the PTLAS.</p>
</li>
<li>
<p><code>partitionIndex</code> is the index of the partition to which this
instance belongs.
<a href="chap39.html#ptlas-global-partition">Global partitions</a> are referred to by
<code>VK_PARTITIONED_ACCELERATION_STRUCTURE_PARTITION_INDEX_GLOBAL_NV</code>.</p>
</li>
<li>
<p><code>accelerationStructure</code> is the device address of the bottom level
acceleration structure or a clustered bottom level acceleration
structure that is being instanced.
This instance is disabled if the device address is <code>0</code>.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceMask-10566" href="chap39.html#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceMask-10566"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceMask-10566</span><br>

The most significant 24 bits of <code>instanceMask</code> <strong class="purple">must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceContributionToHitGroupIndex-10567" href="chap39.html#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceContributionToHitGroupIndex-10567"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceContributionToHitGroupIndex-10567</span><br>

The most significant 8 bits of <code>instanceContributionToHitGroupIndex</code>
<strong class="purple">must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceIndex-10568" href="chap39.html#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceIndex-10568"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceIndex-10568</span><br>

<code>instanceIndex</code> <strong class="purple">must</strong> be less than
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>input.instanceCount</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-partitionIndex-10569" href="chap39.html#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-partitionIndex-10569"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-partitionIndex-10569</span><br>

<code>partitionIndex</code> <strong class="purple">must</strong> be less than
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>input.partitionCount</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-explicitAABB-10570" href="chap39.html#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-explicitAABB-10570"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-explicitAABB-10570</span><br>

<code>explicitAABB</code> <strong class="purple">must</strong> be a valid bounding box if instance was created
with flag
<code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_ENABLE_EXPLICIT_BOUNDING_BOX_NV</code>
set</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceFlags-parameter" href="chap39.html#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceFlags-parameter"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-instanceFlags-parameter</span><br>
 <code>instanceFlags</code> <strong class="purple">must</strong> be a valid combination of <a href="chap39.html#VkPartitionedAccelerationStructureInstanceFlagBitsNV">VkPartitionedAccelerationStructureInstanceFlagBitsNV</a> values</p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-accelerationStructure-parameter" href="chap39.html#VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-accelerationStructure-parameter"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWriteInstanceDataNV-accelerationStructure-parameter</span><br>
 <code>accelerationStructure</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkPartitionedAccelerationStructureUpdateInstanceDataNV">VkPartitionedAccelerationStructureUpdateInstanceDataNV</a> structure
is defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureUpdateInstanceDataNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkPartitionedAccelerationStructureUpdateInstanceDataNV</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>           <span class="n">instanceIndex</span><span class="p">;</span>
    <span class="kt">uint32_t</span>           <span class="n">instanceContributionToHitGroupIndex</span><span class="p">;</span>
    <span class="n">VkDeviceAddress</span>    <span class="n">accelerationStructure</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkPartitionedAccelerationStructureUpdateInstanceDataNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>instanceIndex</code> is the index of the instance being updated.</p>
</li>
<li>
<p><code>instanceContributionToHitGroupIndex</code> is a 24-bit per instance value
added in the indexing into the shader binding table to fetch the hit
group to use.</p>
</li>
<li>
<p><code>accelerationStructure</code> is the device address of the bottom level
acceleration structure or a clustered bottom level acceleration
structure whose instance is being updated.
The instance is disabled if the device address is <code>0</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the instance was originally disabled by specifying a <code>0</code> in
<a href="chap39.html#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a>::<code>accelerationStructure</code>,
it can not be updated to a new acceleration structure as the instance <strong class="purple">may</strong>
have been permanently disabled by the implementation.</p>
</div>
<div class="paragraph">
<p>To avoid a refit, the new acceleration structure <strong class="purple">must</strong> be within the
bounding box specified by
<a href="chap39.html#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a>::<code>explicitAABB</code>
when the instance was first created.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceContributionToHitGroupIndex-10571" href="chap39.html#VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceContributionToHitGroupIndex-10571"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceContributionToHitGroupIndex-10571</span><br>

The most significant 8 bits of <code>instanceContributionToHitGroupIndex</code>
<strong class="purple">must</strong> be <code>0</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-None-10572" href="chap39.html#VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-None-10572"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-None-10572</span><br>

The instance <strong class="purple">must</strong> have either been created with flag
<code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_ENABLE_EXPLICIT_BOUNDING_BOX_NV</code>
or did not have an acceleration structure assigned with
<a href="chap39.html#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceIndex-10573" href="chap39.html#VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceIndex-10573"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-instanceIndex-10573</span><br>

<code>instanceIndex</code> <strong class="purple">must</strong> be less than
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>input.instanceCount</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-accelerationStructure-parameter" href="chap39.html#VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-accelerationStructure-parameter"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureUpdateInstanceDataNV-accelerationStructure-parameter</span><br>
 <code>accelerationStructure</code> <strong class="purple">must</strong> be a valid <a href="chap3.html#VkDeviceAddress">VkDeviceAddress</a> value</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Bits which <strong class="purple">can</strong> be set in
<a href="chap39.html#VkPartitionedAccelerationStructureWriteInstanceDataNV">VkPartitionedAccelerationStructureWriteInstanceDataNV</a>::<code>instanceFlags</code>,
specifying flags for instances, are:</p>
</div>
<div id="VkPartitionedAccelerationStructureInstanceFlagBitsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="n">VkPartitionedAccelerationStructureInstanceFlagBitsNV</span> <span class="p">{</span>
    <span class="n">VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_TRIANGLE_FACING_CULL_DISABLE_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
    <span class="n">VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_TRIANGLE_FLIP_FACING_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
    <span class="n">VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_FORCE_OPAQUE_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
    <span class="n">VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_FORCE_NO_OPAQUE_BIT_NV</span> <span class="o">=</span> <span class="mh">0x00000008</span><span class="p">,</span>
    <span class="n">VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_ENABLE_EXPLICIT_BOUNDING_BOX_NV</span> <span class="o">=</span> <span class="mh">0x00000010</span><span class="p">,</span>
<span class="p">}</span> <span class="n">VkPartitionedAccelerationStructureInstanceFlagBitsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_TRIANGLE_FACING_CULL_DISABLE_BIT_NV</code>
disables face culling for this instance.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_TRIANGLE_FLIP_FACING_BIT_NV</code>
specifies that the <a href="chap42.html#ray-traversal-culling-face">facing determination</a>
for geometry in this instance is inverted.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_FORCE_OPAQUE_BIT_NV</code>
causes this instance to act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code>
were specified on all geometries referenced by this instance.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_FORCE_NO_OPAQUE_BIT_NV</code>
causes this instance to act as though <code>VK_GEOMETRY_OPAQUE_BIT_KHR</code>
were not specified on all geometries referenced by this instance.</p>
</li>
<li>
<p><code>VK_PARTITIONED_ACCELERATION_STRUCTURE_INSTANCE_FLAG_ENABLE_EXPLICIT_BOUNDING_BOX_NV</code>
enables use of an explicit bounding box for this instance.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div id="VkPartitionedAccelerationStructureInstanceFlagsNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="n">VkFlags</span> <span class="n">VkPartitionedAccelerationStructureInstanceFlagsNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VkPartitionedAccelerationStructureInstanceFlagsNV</code> is a bitmask type
for setting a mask of zero or more
<a href="chap39.html#VkPartitionedAccelerationStructureInstanceFlagBitsNV">VkPartitionedAccelerationStructureInstanceFlagBitsNV</a>.</p>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <a href="chap39.html#VkPartitionedAccelerationStructureWritePartitionTranslationDataNV">VkPartitionedAccelerationStructureWritePartitionTranslationDataNV</a>
structure is defined as:</p>
</div>
<div id="VkPartitionedAccelerationStructureWritePartitionTranslationDataNV" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_NV_partitioned_acceleration_structure</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkPartitionedAccelerationStructureWritePartitionTranslationDataNV</span> <span class="p">{</span>
    <span class="kt">uint32_t</span>    <span class="n">partitionIndex</span><span class="p">;</span>
    <span class="kt">float</span>       <span class="n">partitionTranslation</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span> <span class="n">VkPartitionedAccelerationStructureWritePartitionTranslationDataNV</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>partitionIndex</code> is the index of partition to write.
<a href="chap39.html#ptlas-global-partition">Global partition</a> is referred to by
<code>VK_PARTITIONED_ACCELERATION_STRUCTURE_PARTITION_INDEX_GLOBAL_NV</code>.</p>
</li>
<li>
<p><code>partitionTranslation</code> sets the <a href="chap39.html#ptlas-partition-translation">translation vector</a> for this partition.
When tracing this partition, the contained instances will behave as if
the partition translation was added to the translation component of the
instance transform.
This translation vector is also added to the instances in the partition
that had their bounding box specified.</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-partitionIndex-10574" href="chap39.html#VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-partitionIndex-10574"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-partitionIndex-10574</span><br>

<code>partitionIndex</code> <strong class="purple">must</strong> be less than
<a href="chap39.html#VkBuildPartitionedAccelerationStructureInfoNV">VkBuildPartitionedAccelerationStructureInfoNV</a>::<code>input.partitionCount</code></p>
</li>
<li>
<p><a id="VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-enablePartitionTranslation-10575" href="chap39.html#VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-enablePartitionTranslation-10575"></a> <span class="vuid">VUID-VkPartitionedAccelerationStructureWritePartitionTranslationDataNV-enablePartitionTranslation-10575</span><br>

The partitioned acceleration structure <strong class="purple">must</strong> have the
<a href="chap39.html#VkPartitionedAccelerationStructureFlagsNV">VkPartitionedAccelerationStructureFlagsNV</a>::<code>enablePartitionTranslation</code>
flag set</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="host-acceleration-structure"><a class="anchor" href="chap39.html#host-acceleration-structure"></a>39.4. Host Acceleration Structure Operations</h3>
<div class="paragraph">
<p>Implementations are also required to provide host implementations of the
acceleration structure operations if the
<a href="chap51.html#features-accelerationStructureHostCommands"><code>accelerationStructureHostCommands</code></a> feature is enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="chap39.html#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> corresponding to
<a href="chap39.html#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a></p>
</li>
<li>
<p><a href="chap39.html#vkCopyAccelerationStructureKHR">vkCopyAccelerationStructureKHR</a> corresponding to
<a href="chap39.html#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a></p>
</li>
<li>
<p><a href="chap39.html#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a> corresponding to
<a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a></p>
</li>
<li>
<p><a href="chap39.html#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a> corresponding to
<a href="chap39.html#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a></p>
</li>
<li>
<p><a href="chap39.html#vkWriteAccelerationStructuresPropertiesKHR">vkWriteAccelerationStructuresPropertiesKHR</a> corresponding to
<a href="chap39.html#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These commands are functionally equivalent to their device counterparts,
except that they are executed on the host timeline, rather than being
enqueued into command buffers.</p>
</div>
<div class="paragraph">
<p>All acceleration structures used by the host commands <strong class="purple">must</strong> be bound to
host-visible memory, and all input data for acceleration structure builds
<strong class="purple">must</strong> be referenced using host addresses instead of device addresses.
Applications are not required to map acceleration structure memory when
using the host commands.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="chap39.html#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> and
<a href="chap39.html#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> <strong class="purple">may</strong> use different algorithms, and
thus are not required to produce identical structures.
The structures produced by these two commands <strong class="purple">may</strong> exhibit different memory
footprints or traversal performance, but should strive to be similar where
possible.</p>
</div>
<div class="paragraph">
<p>Apart from these details, the host and device operations are
interchangeable.
For example, an application <strong class="purple">can</strong> use <a href="chap39.html#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a>
to build a structure, compact it on the device using
<a href="chap39.html#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a>, and serialize the result using
<a href="chap39.html#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For efficient execution, acceleration structures manipulated using these
commands should always be bound to host cached memory, as the implementation
may need to repeatedly read and write this memory during the execution of
the command.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To build acceleration structures on the host, call:</p>
</div>
<div id="vkBuildAccelerationStructuresKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="n">VkResult</span> <span class="nf">vkBuildAccelerationStructuresKHR</span><span class="p">(</span>
    <span class="n">VkDevice</span>                                    <span class="n">device</span><span class="p">,</span>
    <span class="n">VkDeferredOperationKHR</span>                      <span class="n">deferredOperation</span><span class="p">,</span>
    <span class="kt">uint32_t</span>                                    <span class="n">infoCount</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureBuildGeometryInfoKHR</span><span class="o">*</span> <span class="n">pInfos</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureBuildRangeInfoKHR</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span> <span class="n">ppBuildRangeInfos</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the <code>VkDevice</code> for which the acceleration structures
are being built.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="chap37.html#VkDeferredOperationKHR">VkDeferredOperationKHR</a> to
<a href="chap37.html#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>infoCount</code> is the number of acceleration structures to build.
It specifies the number of the <code>pInfos</code> structures and
<code>ppBuildRangeInfos</code> pointers that <strong class="purple">must</strong> be provided.</p>
</li>
<li>
<p><code>pInfos</code> is a pointer to an array of <code>infoCount</code>
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures defining
the geometry used to build each acceleration structure.</p>
</li>
<li>
<p><code>ppBuildRangeInfos</code> is a pointer to an array of <code>infoCount</code>
pointers to arrays of <a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a>
structures.
Each <code>ppBuildRangeInfos</code>[i] is a pointer to an array of
<code>pInfos</code>[i].<code>geometryCount</code>
<a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures defining
dynamic offsets to the addresses where geometry data is stored, as
defined by <code>pInfos</code>[i].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="chap39.html#vkCmdBuildAccelerationStructuresKHR">vkCmdBuildAccelerationStructuresKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>The <code>vkBuildAccelerationStructuresKHR</code> command provides the ability to
initiate multiple acceleration structures builds, however there is no
ordering or synchronization implied between any of the individual
acceleration structure builds.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This means that an application <strong class="purple">cannot</strong> build a top-level acceleration
structure in the same <a href="chap39.html#vkBuildAccelerationStructuresKHR">vkBuildAccelerationStructuresKHR</a> call as the
associated bottom-level or instance acceleration structures are being built.
There also <strong class="purple">cannot</strong> be any memory aliasing between any acceleration structure
memories or scratch memories being used by any of the builds.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-accelerationStructureHostCommands-03581</span><br>

The <a href="chap51.html#features-accelerationStructureHostCommands"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-mode-04628" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-mode-04628"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-mode-04628</span><br>

The <code>mode</code> member of each element of <code>pInfos</code> <strong class="purple">must</strong> be a valid
<a href="chap39.html#VkBuildAccelerationStructureModeKHR">VkBuildAccelerationStructureModeKHR</a> value</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-srcAccelerationStructure-04629</span><br>

If the <code>srcAccelerationStructure</code> member of any element of
<code>pInfos</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, the
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> be a valid
<a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-04630" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-04630"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-04630</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03403" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03403"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03403</span><br>

The <code>srcAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03698</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be the same acceleration structure as the
<code>dstAccelerationStructure</code> member of any other element of
<code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03800</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> be a valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03699" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03699"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03699</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> have been created with a
value of <a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_TOP_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03700" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03700"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03700</span><br>

For each element of <code>pInfos</code>, if its <code>type</code> member is
<code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code>, its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> have been created with a
value of <a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>type</code> equal to
either <code>VK_ACCELERATION_STRUCTURE_TYPE_BOTTOM_LEVEL_KHR</code> or
<code>VK_ACCELERATION_STRUCTURE_TYPE_GENERIC_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03663" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03663"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03663</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>,
<a href="chap39.html#acceleration-structure-inactive-prims">inactive primitives</a> in its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be made active</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03664" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03664"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03664</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, active primitives
in its <code>srcAccelerationStructure</code> member <strong class="purple">must</strong> not be made
<a href="chap39.html#acceleration-structure-inactive-prims">inactive</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-None-03407" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-None-03407"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-None-03407</span><br>

The <code>dstAccelerationStructure</code> member of any element of <code>pInfos</code>
<strong class="purple">must</strong> not be referenced by the <code>geometry.instances.data</code> member of
any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other
element of <code>pInfos</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03701</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>srcAccelerationStructure</code> member of
any other element of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, which is accessed
by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03702</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>dstAccelerationStructure</code> member of
any other element of <code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03703</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> (including the same element), which is accessed by this
command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-scratchData-03704" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-scratchData-03704"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-scratchData-03704</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not overlap the
memory backing the <code>scratchData</code> member of any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-scratchData-03705" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-scratchData-03705"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-scratchData-03705</span><br>

The range of memory backing the <code>scratchData</code> member of any element
of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not overlap the
memory backing the <code>srcAccelerationStructure</code> member of any element
of <code>pInfos</code> with a <code>mode</code> equal to
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> (including the
same element), which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-dstAccelerationStructure-03706</span><br>

The range of memory backing the <code>dstAccelerationStructure</code> member of
any element of <code>pInfos</code> that is accessed by this command <strong class="purple">must</strong> not
overlap the memory backing any acceleration structure referenced by the
<code>geometry.instances.data</code> member of any element of <code>pGeometries</code>
or <code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> in any other element of
<code>pInfos</code>, which is accessed by this command</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03667" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03667"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03667</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> member <strong class="purple">must</strong> have previously been
constructed with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_UPDATE_BIT_KHR</code> set in
<a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a>::<code>flags</code> in the
build</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03668" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03668"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03668</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>srcAccelerationStructure</code> and <code>dstAccelerationStructure</code>
members <strong class="purple">must</strong> either be the same <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a>, or
not have any <a href="chap12.html#resources-memory-aliasing">memory aliasing</a></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03758" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03758"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03758</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its
<code>geometryCount</code> member <strong class="purple">must</strong> have the same value which was specified
when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03759" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03759"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03759</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>flags</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03760" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03760"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03760</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, its <code>type</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03761" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03761"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03761</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>geometryType</code>
member <strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03762" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03762"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03762</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, its <code>flags</code> member
<strong class="purple">must</strong> have the same value which was specified when
<code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03763" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03763"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03763</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.vertexFormat</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03764" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03764"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03764</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.maxVertex</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03765" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03765"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03765</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, its
<code>geometry.triangles.indexType</code> member <strong class="purple">must</strong> have the same value
which was specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03766" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03766"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03766</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03767" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03767"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03767</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if its
<code>geometry.triangles.transformData</code> address was not <code>NULL</code> when
<code>srcAccelerationStructure</code> was last built, then it <strong class="purple">must</strong> not be
<code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10898" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10898"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10898</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>numTriangles</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10899" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10899"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10899</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>numVertices</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10900" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10900"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10900</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>maxPrimitiveIndex</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10901" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10901"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10901</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>maxGeometryIndex</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10902" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10902"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10902</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>format</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10903" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10903"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10903</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>, the
<code>dataSize</code> member of the
<code>VkAccelerationStructureDenseGeometryFormatTrianglesDataAMDX</code>
structure in the <code>pNext</code> chain <strong class="purple">must</strong> have the same value which was
specified when <code>srcAccelerationStructure</code> was last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03768" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03768"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03768</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, if <code>geometryType</code>
is <code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, and
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
then the value of each index referenced <strong class="purple">must</strong> be the same as the
corresponding index value when <code>srcAccelerationStructure</code> was last
built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-primitiveCount-03769</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, then for each
<code>VkAccelerationStructureGeometryKHR</code> structure referred to by its
<code>pGeometries</code> or <code>ppGeometries</code> members, the
<code>primitiveCount</code> member of its corresponding
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structure <strong class="purple">must</strong> have the
same value which was specified when <code>srcAccelerationStructure</code> was
last built</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03801" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03801"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03801</span><br>

For each element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, the corresponding
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> <strong class="purple">must</strong> be less than or equal to
<a href="chap52.html#VkPhysicalDeviceAccelerationStructurePropertiesKHR">VkPhysicalDeviceAccelerationStructurePropertiesKHR</a>::<code>maxInstanceCount</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10126" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10126"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10126</span><br>

For each <code>pInfos</code>[i], <code>dstAccelerationStructure</code> <strong class="purple">must</strong> have been
created with a value of
<a href="chap12.html#VkAccelerationStructureCreateInfoKHR">VkAccelerationStructureCreateInfoKHR</a>::<code>size</code> greater than or
equal to either:</p>
<div class="ulist">
<ul>
<li>
<p>the memory size required by the build operation, as returned by
<a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a> with
<span class="eq"><code>pBuildInfo</code> = <code>pInfos</code>[i]</span> and with each element of the
<code>pMaxPrimitiveCounts</code> array greater than or equal to the equivalent
<code>ppBuildRangeInfos</code>[i][j].<code>primitiveCount</code> values for <code>j</code> in
<span class="eq">[0,<code>pInfos</code>[i].<code>geometryCount</code>)</span> or,</p>
</li>
<li>
<p>the result of querying the corresponding
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, if
updating a compacted acceleration structure</p>
</li>
</ul>
</div>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-03676</span><br>

Each element of <code>ppBuildRangeInfos</code>[i] <strong class="purple">must</strong> be a valid pointer to
an array of <code>pInfos</code>[i].<code>geometryCount</code>
<code>VkAccelerationStructureBuildRangeInfoKHR</code> structures
, or <code>NULL</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10906" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10906"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10906</span><br>

For each element of <code>pInfos</code>[i] whose <code>pGeometries</code> or
<code>ppGeometries</code> members have a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code>,
<code>ppBuildRangeInfos</code>[i] <strong class="purple">must</strong> be <code>NULL</code></p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong class="purple">must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03722" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03722"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03722</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> be bound to host-visible
device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03723" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03723"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03723</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong class="purple">must</strong> be bound
to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03724" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03724"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03724</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong class="purple">must</strong> be
bound to host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03725" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03725"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03725</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_BUILD_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong class="purple">must</strong> be valid
host memory, where N is given by the <code>buildScratchSize</code> member of
the <a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned
from a call to <a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a> with an
identical <a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure
and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03726" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03726"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03726</span><br>

If <code>pInfos</code>[i].<code>mode</code> is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code>, all addresses
between <code>pInfos</code>[i].<code>scratchData.hostAddress</code> and
<code>pInfos</code>[i].<code>scratchData.hostAddress</code> + N - 1 <strong class="purple">must</strong> be valid
host memory, where N is given by the <code>updateScratchSize</code> member of
the <a href="chap12.html#VkAccelerationStructureBuildSizesInfoKHR">VkAccelerationStructureBuildSizesInfoKHR</a> structure returned
from a call to <a href="chap12.html#vkGetAccelerationStructureBuildSizesKHR">vkGetAccelerationStructureBuildSizesKHR</a> with an
identical <a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structure
and primitive count</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03771" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03771"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03771</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>,
<code>geometry.triangles.vertexData.hostAddress</code> <strong class="purple">must</strong> be a valid host
address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03772" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03772"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03772</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.indexType</code> is not <code>VK_INDEX_TYPE_NONE_KHR</code>,
<code>geometry.triangles.indexData.hostAddress</code> <strong class="purple">must</strong> be a valid host
address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03773" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03773"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03773</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if
<code>geometry.triangles.transformData.hostAddress</code> is not <code>0</code>, it <strong class="purple">must</strong>
be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03774" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03774"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03774</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_AABBS_KHR</code>, <code>geometry.aabbs.data.hostAddress</code>
<strong class="purple">must</strong> be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03775" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03775"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03775</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create its
<code>dstAccelerationStructure</code> member <strong class="purple">must</strong> be bound to memory that was
not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03776" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03776"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03776</span><br>

For each element of <code>pInfos</code>, if its <code>mode</code> member is
<code>VK_BUILD_ACCELERATION_STRUCTURE_MODE_UPDATE_KHR</code> the <code>buffer</code>
used to create its <code>srcAccelerationStructure</code> member <strong class="purple">must</strong> be bound
to memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03777" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03777"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03777</span><br>

For each element of <code>pInfos</code>, the <code>buffer</code> used to create each
acceleration structure referenced by the <code>geometry.instances.data</code>
member of any element of <code>pGeometries</code> or <code>ppGeometries</code> with a
<code>geometryType</code> of <code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> <strong class="purple">must</strong> be
bound to memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03778" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03778"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03778</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>,
<code>geometry.instances.data.hostAddress</code> <strong class="purple">must</strong> be a valid host address</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-03779" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-03779"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-03779</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code>, each
<a href="chap39.html#VkAccelerationStructureInstanceKHR">VkAccelerationStructureInstanceKHR</a>::<code>accelerationStructureReference</code>
value in <code>geometry.instances.data.hostAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> object</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-04930" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-04930"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-04930</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_INSTANCES_KHR</code> with
<code>VK_BUILD_ACCELERATION_STRUCTURE_MOTION_BIT_NV</code> set, each
<code>accelerationStructureReference</code> in any structure in
<a href="chap39.html#VkAccelerationStructureMotionInstanceNV">VkAccelerationStructureMotionInstanceNV</a> value in
<code>geometry.instances.data.hostAddress</code> <strong class="purple">must</strong> be a valid
<a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> object</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10892" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10892"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10892</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code> with a <code>geometryType</code> of
<code>VK_GEOMETRY_TYPE_TRIANGLES_KHR</code>, if there is an instance of
<a href="chap39.html#VkAccelerationStructureTrianglesOpacityMicromapEXT">VkAccelerationStructureTrianglesOpacityMicromapEXT</a> in the
<code>geometry.triangles.pNext</code> chain, and its <code>indexType</code> is
<code>VK_INDEX_TYPE_NONE_KHR</code>, then its <code>indexBuffer.hostAddress</code>
<strong class="purple">must</strong> be 0</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-10893" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-10893"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-10893</span><br>

For any element of <code>pInfos</code>[i].<code>pGeometries</code> or
<code>pInfos</code>[i].<code>ppGeometries</code>, <code>geometryType</code> <strong class="purple">must</strong> not be
<code>VK_GEOMETRY_TYPE_DENSE_GEOMETRY_FORMAT_TRIANGLES_AMDX</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-device-parameter" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-device-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-device-parameter</span><br>
 <code>device</code> <strong class="purple">must</strong> be a valid <a href="chap5.html#VkDevice">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong class="purple">must</strong> be a valid <a href="chap37.html#VkDeferredOperationKHR">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-pInfos-parameter</span><br>
 <code>pInfos</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>infoCount</code> valid <a href="chap39.html#VkAccelerationStructureBuildGeometryInfoKHR">VkAccelerationStructureBuildGeometryInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-ppBuildRangeInfos-parameter</span><br>
 <code>ppBuildRangeInfos</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>infoCount</code> <a href="chap39.html#VkAccelerationStructureBuildRangeInfoKHR">VkAccelerationStructureBuildRangeInfoKHR</a> structures</p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-infoCount-arraylength</span><br>
 <code>infoCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent" href="chap39.html#VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkBuildAccelerationStructuresKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap3.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap3.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_UNKNOWN</code></p>
</li>
<li>
<p><code>VK_ERROR_VALIDATION_FAILED</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy or compact an acceleration structure on the host, call:</p>
</div>
<div id="vkCopyAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="n">VkResult</span> <span class="nf">vkCopyAccelerationStructureKHR</span><span class="p">(</span>
    <span class="n">VkDevice</span>                                    <span class="n">device</span><span class="p">,</span>
    <span class="n">VkDeferredOperationKHR</span>                      <span class="n">deferredOperation</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkCopyAccelerationStructureInfoKHR</span><span class="o">*</span>   <span class="n">pInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the acceleration structures.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="chap37.html#VkDeferredOperationKHR">VkDeferredOperationKHR</a> to
<a href="chap37.html#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a <a href="chap39.html#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a>
structure defining the copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="chap39.html#vkCmdCopyAccelerationStructureKHR">vkCmdCopyAccelerationStructureKHR</a> but is executed by the host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-accelerationStructureHostCommands-03582</span><br>

The <a href="chap51.html#features-accelerationStructureHostCommands"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong class="purple">must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03727" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-buffer-03727"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03727</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong class="purple">must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03728" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-buffer-03728"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03728</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong class="purple">must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03780" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-buffer-03780"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03780</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong class="purple">must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-buffer-03781" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-buffer-03781"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-buffer-03781</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong class="purple">must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-device-parameter" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-device-parameter</span><br>
 <code>device</code> <strong class="purple">must</strong> be a valid <a href="chap5.html#VkDevice">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong class="purple">must</strong> be a valid <a href="chap37.html#VkDeferredOperationKHR">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-pInfo-parameter" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkCopyAccelerationStructureInfoKHR">VkCopyAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent" href="chap39.html#VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyAccelerationStructureKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap3.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap3.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_UNKNOWN</code></p>
</li>
<li>
<p><code>VK_ERROR_VALIDATION_FAILED</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy host accessible memory to an acceleration structure, call:</p>
</div>
<div id="vkCopyMemoryToAccelerationStructureKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="n">VkResult</span> <span class="nf">vkCopyMemoryToAccelerationStructureKHR</span><span class="p">(</span>
    <span class="n">VkDevice</span>                                    <span class="n">device</span><span class="p">,</span>
    <span class="n">VkDeferredOperationKHR</span>                      <span class="n">deferredOperation</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkCopyMemoryToAccelerationStructureInfoKHR</span><span class="o">*</span> <span class="n">pInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;dst</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="chap37.html#VkDeferredOperationKHR">VkDeferredOperationKHR</a> to
<a href="chap37.html#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="chap39.html#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="chap39.html#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command can accept acceleration structures produced by either
<a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> or
<a href="chap39.html#vkCopyAccelerationStructureToMemoryKHR">vkCopyAccelerationStructureToMemoryKHR</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-accelerationStructureHostCommands-03583</span><br>

The <a href="chap51.html#features-accelerationStructureHostCommands"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong class="purple">must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03729</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong class="purple">must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-03750</span><br>

<code>pInfo-&gt;src.hostAddress</code> <strong class="purple">must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03730</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong class="purple">must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-buffer-03782</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;dst</code> <strong class="purple">must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-device-parameter</span><br>
 <code>device</code> <strong class="purple">must</strong> be a valid <a href="chap5.html#VkDevice">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong class="purple">must</strong> be a valid <a href="chap37.html#VkDeferredOperationKHR">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkCopyMemoryToAccelerationStructureInfoKHR">VkCopyMemoryToAccelerationStructureInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent" href="chap39.html#VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyMemoryToAccelerationStructureKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap3.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap3.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_UNKNOWN</code></p>
</li>
<li>
<p><code>VK_ERROR_VALIDATION_FAILED</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To copy an acceleration structure to host accessible memory, call:</p>
</div>
<div id="vkCopyAccelerationStructureToMemoryKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="n">VkResult</span> <span class="nf">vkCopyAccelerationStructureToMemoryKHR</span><span class="p">(</span>
    <span class="n">VkDevice</span>                                    <span class="n">device</span><span class="p">,</span>
    <span class="n">VkDeferredOperationKHR</span>                      <span class="n">deferredOperation</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkCopyAccelerationStructureToMemoryInfoKHR</span><span class="o">*</span> <span class="n">pInfo</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns <code>pInfo-&gt;src</code>.</p>
</li>
<li>
<p><code>deferredOperation</code> is an optional <a href="chap37.html#VkDeferredOperationKHR">VkDeferredOperationKHR</a> to
<a href="chap37.html#deferred-host-operations-requesting">request deferral</a> for this
command.</p>
</li>
<li>
<p><code>pInfo</code> is a pointer to a
<a href="chap39.html#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure defining the
copy operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a> but is executed by the host.</p>
</div>
<div class="paragraph">
<p>This command produces the same results as
<a href="chap39.html#vkCmdCopyAccelerationStructureToMemoryKHR">vkCmdCopyAccelerationStructureToMemoryKHR</a>, but writes its result
directly to a host pointer, and is executed on the host rather than the
device.
The output <strong class="purple">may</strong> not necessarily be bit-for-bit identical, but it can be
equally used by either <a href="chap39.html#vkCmdCopyMemoryToAccelerationStructureKHR">vkCmdCopyMemoryToAccelerationStructureKHR</a> or
<a href="chap39.html#vkCopyMemoryToAccelerationStructureKHR">vkCopyMemoryToAccelerationStructureKHR</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-accelerationStructureHostCommands-03584</span><br>

The <a href="chap51.html#features-accelerationStructureHostCommands"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-03678</span><br>

Any previous deferred operation that was associated with
<code>deferredOperation</code> <strong class="purple">must</strong> be complete</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03731</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong class="purple">must</strong> be bound to
host-visible device memory</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03732</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong class="purple">must</strong> be a valid host pointer</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-03751</span><br>

<code>pInfo-&gt;dst.hostAddress</code> <strong class="purple">must</strong> be aligned to 16 bytes</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-buffer-03783</span><br>

The <code>buffer</code> used to create <code>pInfo-&gt;src</code> <strong class="purple">must</strong> be bound to
memory that was not allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-device-parameter</span><br>
 <code>device</code> <strong class="purple">must</strong> be a valid <a href="chap5.html#VkDevice">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parameter</span><br>
 If <code>deferredOperation</code> is not <a href="chap63.html#VK_NULL_HANDLE">VK_NULL_HANDLE</a>, <code>deferredOperation</code> <strong class="purple">must</strong> be a valid <a href="chap37.html#VkDeferredOperationKHR">VkDeferredOperationKHR</a> handle</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-pInfo-parameter</span><br>
 <code>pInfo</code> <strong class="purple">must</strong> be a valid pointer to a valid <a href="chap39.html#VkCopyAccelerationStructureToMemoryInfoKHR">VkCopyAccelerationStructureToMemoryInfoKHR</a> structure</p>
</li>
<li>
<p><a id="VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent" href="chap39.html#VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent"></a> <span class="vuid">VUID-vkCopyAccelerationStructureToMemoryKHR-deferredOperation-parent</span><br>
 If <code>deferredOperation</code> is a valid handle, it <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap3.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_OPERATION_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_OPERATION_NOT_DEFERRED_KHR</code></p>
</li>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap3.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_UNKNOWN</code></p>
</li>
<li>
<p><code>VK_ERROR_VALIDATION_FAILED</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To query acceleration structure size parameters on the host, call:</p>
</div>
<div id="vkWriteAccelerationStructuresPropertiesKHR" class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="c1">// Provided by VK_KHR_acceleration_structure</span>
<span class="n">VkResult</span> <span class="nf">vkWriteAccelerationStructuresPropertiesKHR</span><span class="p">(</span>
    <span class="n">VkDevice</span>                                    <span class="n">device</span><span class="p">,</span>
    <span class="kt">uint32_t</span>                                    <span class="n">accelerationStructureCount</span><span class="p">,</span>
    <span class="k">const</span> <span class="n">VkAccelerationStructureKHR</span><span class="o">*</span>           <span class="n">pAccelerationStructures</span><span class="p">,</span>
    <span class="n">VkQueryType</span>                                 <span class="n">queryType</span><span class="p">,</span>
    <span class="kt">size_t</span>                                      <span class="n">dataSize</span><span class="p">,</span>
    <span class="kt">void</span><span class="o">*</span>                                       <span class="n">pData</span><span class="p">,</span>
    <span class="kt">size_t</span>                                      <span class="n">stride</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>device</code> is the device which owns the acceleration structures in
<code>pAccelerationStructures</code>.</p>
</li>
<li>
<p><code>accelerationStructureCount</code> is the count of acceleration structures
for which to query the property.</p>
</li>
<li>
<p><code>pAccelerationStructures</code> is a pointer to an array of existing
previously built acceleration structures.</p>
</li>
<li>
<p><code>queryType</code> is a <a href="chap20.html#VkQueryType">VkQueryType</a> value specifying the property to
be queried.</p>
</li>
<li>
<p><code>dataSize</code> is the size in bytes of the buffer pointed to by
<code>pData</code>.</p>
</li>
<li>
<p><code>pData</code> is a pointer to an application-allocated buffer where the
results will be written.</p>
</li>
<li>
<p><code>stride</code> is the stride in bytes between results for individual
queries within <code>pData</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This command fulfills the same task as
<a href="chap39.html#vkCmdWriteAccelerationStructuresPropertiesKHR">vkCmdWriteAccelerationStructuresPropertiesKHR</a> but is executed by the
host.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureHostCommands-03585</span><br>

The <a href="chap51.html#features-accelerationStructureHostCommands"><code>VkPhysicalDeviceAccelerationStructureFeaturesKHR</code>::<code>accelerationStructureHostCommands</code></a>
feature <strong class="purple">must</strong> be enabled</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-04964</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong class="purple">must</strong> have
been built prior to the execution of this command</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructures-03431</span><br>

All acceleration structures in <code>pAccelerationStructures</code> <strong class="purple">must</strong> have
been built with
<code>VK_BUILD_ACCELERATION_STRUCTURE_ALLOW_COMPACTION_BIT_KHR</code> if
<code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06742</span><br>

<code>queryType</code> <strong class="purple">must</strong> be
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, or
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03448</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then
<code>stride</code> <strong class="purple">must</strong> be a multiple of the size of <a href="chap3.html#VkDeviceSize">VkDeviceSize</a></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03449</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_COMPACTED_SIZE_KHR</code>, then
<code>pData</code> <strong class="purple">must</strong> point to a <a href="chap3.html#VkDeviceSize">VkDeviceSize</a></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03450</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
<code>stride</code> <strong class="purple">must</strong> be a multiple of the size of <a href="chap3.html#VkDeviceSize">VkDeviceSize</a></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-03451</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_SIZE_KHR</code>, then
<code>pData</code> <strong class="purple">must</strong> point to a <a href="chap3.html#VkDeviceSize">VkDeviceSize</a></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06731</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>, then <code>stride</code>
<strong class="purple">must</strong> be a multiple of the size of <a href="chap3.html#VkDeviceSize">VkDeviceSize</a></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06732</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SIZE_KHR</code>, then <code>pData</code>
<strong class="purple">must</strong> point to a <a href="chap3.html#VkDeviceSize">VkDeviceSize</a></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06733</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
then <code>stride</code> <strong class="purple">must</strong> be a multiple of the size of
<a href="chap3.html#VkDeviceSize">VkDeviceSize</a></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-06734</span><br>

If <code>queryType</code> is
<code>VK_QUERY_TYPE_ACCELERATION_STRUCTURE_SERIALIZATION_BOTTOM_LEVEL_POINTERS_KHR</code>,
then <code>pData</code> <strong class="purple">must</strong> point to a <a href="chap3.html#VkDeviceSize">VkDeviceSize</a></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-03452</span><br>

<code>dataSize</code> <strong class="purple">must</strong> be greater than or equal to
<span class="eq"><code>accelerationStructureCount</code>*<code>stride</code></span></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03733</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong class="purple">must</strong> be bound to host-visible device
memory</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-buffer-03784</span><br>

The <code>buffer</code> used to create each acceleration structure in
<code>pAccelerationStructures</code> <strong class="purple">must</strong> be bound to memory that was not
allocated with multiple instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Valid Usage (Implicit)</div>
<div class="ulist">
<ul>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-device-parameter</span><br>
 <code>device</code> <strong class="purple">must</strong> be a valid <a href="chap5.html#VkDevice">VkDevice</a> handle</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parameter</span><br>
 <code>pAccelerationStructures</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>accelerationStructureCount</code> valid <a href="chap12.html#VkAccelerationStructureKHR">VkAccelerationStructureKHR</a> handles</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-queryType-parameter</span><br>
 <code>queryType</code> <strong class="purple">must</strong> be a valid <a href="chap20.html#VkQueryType">VkQueryType</a> value</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pData-parameter</span><br>
 <code>pData</code> <strong class="purple">must</strong> be a valid pointer to an array of <code>dataSize</code> bytes</p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-accelerationStructureCount-arraylength</span><br>
 <code>accelerationStructureCount</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-dataSize-arraylength</span><br>
 <code>dataSize</code> <strong class="purple">must</strong> be greater than <code>0</code></p>
</li>
<li>
<p><a id="VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent" href="chap39.html#VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent"></a> <span class="vuid">VUID-vkWriteAccelerationStructuresPropertiesKHR-pAccelerationStructures-parent</span><br>
 Each element of <code>pAccelerationStructures</code> <strong class="purple">must</strong> have been created, allocated, or retrieved from <code>device</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Return Codes</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="chap3.html#fundamentals-successcodes">Success</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_SUCCESS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><a href="chap3.html#fundamentals-errorcodes">Failure</a></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_OUT_OF_HOST_MEMORY</code></p>
</li>
<li>
<p><code>VK_ERROR_UNKNOWN</code></p>
</li>
<li>
<p><code>VK_ERROR_VALIDATION_FAILED</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div></div>
<nav>
  <a rel="prev" href="chap38.html" class="nav nav-prev" title="Previous page" aria-label="Previous page" aria-keyshortcuts="Left">
        <i class="fa fa-angle-left"></i>
     </a>
  <a rel="next" href="chap40.html" class="nav nav-next" title="Next page" aria-label="Next page" aria-keyshortcuts="Right">
        <i class="fa fa-angle-right"></i>
     </a>
  <div style="clear: both"></div>
</nav>




</body>
  <script>
  function isInViewport(ele) {
    const rect = ele.getBoundingClientRect();
    return (
        rect.top >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)
    );
  }
  function yPosition (ele) {
    const rect = ele.getBoundingClientRect();
    return (rect.top - 20); // 20px above
  }
  let curr = document.getElementsByClassName('current');
  if (!isInViewport(curr[curr.length - 1])) {
    document.getElementById('toc').scrollTo({
      top: yPosition(curr[0]),
      left: 0,
      behavior: 'smooth'
    });
  }

  /* For page navigation */
  function gotoPage(selector) {
    const button = document.querySelector(selector);
    if (button)
      window.location.href = button.href;
  }
  document.addEventListener('keydown', e => {
    switch (e.key) {
      case 'ArrowRight':
        e.preventDefault();
        gotoPage('.nav-next');
        break;
      case 'ArrowLeft':
        e.preventDefault();
        gotoPage('.nav-prev');
        break;
    }
  });
  </script>
  </html>