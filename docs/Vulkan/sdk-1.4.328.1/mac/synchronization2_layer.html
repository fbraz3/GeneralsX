<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="icon" href="images/Vulkan_LogoBug_48px_Nov17.png">
<link rel="stylesheet" href="github-markdown.css">
</head>
<body>
<article class="markdown-body">
<!-- markdownlint-disable MD041 -->

<p align="left"><img src="https://vulkan.lunarg.com/img/NewLunarGLogoBlack.png" alt="LunarG" width=263 height=113 /></p>

<p>Copyright © 2015-2022 LunarG, Inc.</p>
<p><a href="https://creativecommons.org/licenses/by-nd/4.0/" TARGET="_blank"><img src="https://i.creativecommons.org/l/by-nd/4.0/88x31.png" title="Creative Commons License" alt="Creative Commons" /></a></p>
<h1 id="vk_layer_khronos_synchronization2">VK_LAYER_KHRONOS_synchronization2</h1>
<p>The <code>VK_LAYER_KHRONOS_synchronization2</code> extension layer implements the <code>VK_KHR_synchronization2</code> extension. By default, it will disable itself if the underlying driver provides the extension.</p>
<p>Even though the <code>VK_KHR_synchronization2</code> extension requires the <code>VK_KHR_get_physical_device_properties2</code> and <code>VK_KHR_create_renderpass2</code> extensions, this layer will work on devices that do not implement them. See the <code>Sync2CompatTest.Vulkan10</code> test case for an example of how to do this.</p>
<h2 id="configuring-the-synchronization2-layer">Configuring the Synchronization2 Layer</h2>
<p>For an overview of how to configure layers, refer to the <a href="./layer_configuration.html">Layers Overview and Configuration</a> document.</p>
<p>The Synchronization2 Layer settings are documented in the <a href="./synchronization2_layer.html#user-content-layer-details">Layer Details</a> section below.</p>
<p>The Synchronization2 Layer can also be enabled and configured using vkconfig. See the <a href="./vkconfig.html">vkconfig</a> documentation for more information.</p>
<h2 id="enabling-the-layer">Enabling the Layer</h2>
<h3 id="desktop-linuxwindowsmacos">Desktop (Linux/Windows/MacOS)</h3>
<p>You must add the location of the generated <code>VK_LAYER_KHRONOS_synchronization2.json</code> file and corresponding <code>VkLayer_synchronization2</code> library to your <code>VK_LAYER_PATH</code> in order for the Vulkan loader to be able to find the layer.</p>
<p>Then, you must also enable the layer in one of two ways:</p>
<ul>
<li>Directly in your application using the layer's name during vkCreateInstance</li>
<li>Indirectly by using the <code>VK_INSTANCE_LAYERS</code> environment variable.</li>
</ul>
<h4 id="setting-the-vk_layer_path">Setting the <code>VK_LAYER_PATH</code></h4>
<p><strong>Windows</strong></p>
<p>If your source was located in: <code>C:\my_folder\ExtensionLayer</code> and your build folder was build64, then you would add it to the layer path in the following way:</p>
<pre><code>set VK_LAYER_PATH=C:\my_folder\ExtensionLayer\build64\layers\Debug;%VK_LAYER_PATH%
</code></pre>
<p><strong>Linux/MacOS</strong></p>
<p>If your source was located in: <code>/my_folder/ExtensionLayer</code> and your build folder was build, then you would add it to the layer path in the following way:</p>
<pre><code>export VK_LAYER_PATH=/my_folder/ExtensionLayer/build/layers:$VK_LAYER_PATH
</code></pre>
<p>Forcing the layer with <code>VK_INSTANCE_LAYERS</code></p>
<p>To force the layer to be enabled for Vulkan applications, you can set the <code>VK_INSTANCE_LAYERS</code> environment variable in the following way:</p>
<p><strong>Windows</strong></p>
<pre><code>set VK_INSTANCE_LAYERS=VK_LAYER_KHRONOS_synchronization2
</code></pre>
<p><strong>Linux/MacOS</strong></p>
<pre><code>export VK_INSTANCE_LAYERS=VK_LAYER_KHRONOS_synchronization2
</code></pre>
<p>To force the layer to be enabled for Vulkan applications, even though the Vulkan implementation supports <code>VK_KHR_synchronization2</code> extension, you can set the <code>VK_SYNCHRONIZATION2_FORCE_ENABLE</code> environment variable in the following way:</p>
<p><strong>Windows</strong></p>
<pre><code>set VK_VK_SYNCHRONIZATION2_FORCE_ENABLE=true
</code></pre>
<p><strong>Linux/MacOS</strong></p>
<pre><code>export VK_VK_SYNCHRONIZATION2_FORCE_ENABLE=true
</code></pre>
<p><br></br></p>
<h3 id="android">Android</h3>
<h4 id="packaging-layer-with-application">Packaging layer with application</h4>
<p>This layer should not require your application to need any additional permissions.</p>
<p>At <code>vkCreateInstance</code> time add the layer</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// std::vector&lt;const char *&gt; instance_layers</span></a>
<a class="sourceLine" id="cb7-2" title="2">instance_layers.push_back(<span class="st">&quot;VK_LAYER_KHRONOS_synchronization2&quot;</span>);</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">VkInstanceCreateInfo info;</a>
<a class="sourceLine" id="cb7-5" title="5">info.enabledLayerCount = <span class="kw">static_cast</span>&lt;<span class="dt">uint32_t</span>&gt;(<span class="va">instance_layers_</span>.size());</a>
<a class="sourceLine" id="cb7-6" title="6">info.ppEnabledLayerNames = <span class="va">instance_layers_</span>.data();</a></code></pre></div>
<p>For this to work <code>libVkLayer_khronos_synchronization2.so</code> needs to be packaged inside the APK as Android will be able to read in the layer from there. One can open the APK in Android Studio to verify the binary is there. Make sure to match up the correct ABI as well (<code>armeabi-v7a</code>, <code>arm64-v8a</code>, etc).</p>
<h4 id="globally-enabling-the-layer">Globally Enabling the Layer</h4>
<p>This will require a debugable application or additional permissions. For more information please read the <a href="https://developer.android.com/ndk/guides/graphics/validation-layer#enable-layers-outside-app" TARGET="_blank">Android Developer page</a></p>
<p>Use ADB to enable the layer for your project by:</p>
<pre><code>adb shell &quot;setprop debug.vulkan.layers &#39;VK_LAYER_KHRONOS_synchronization2&#39;&quot;
</code></pre>
<p>When done, disable the layer using:</p>
<pre><code>adb shell &quot;setprop debug.vulkan.layers &#39;&#39;&quot;
</code></pre>
<p><br></br></p>
<h3 id="settings-priority">Settings Priority</h3>
<p>If you have a setting defined in both the Settings File as well as an Environment Variable, the Environment Variable value will <strong>always</strong> override the Settings File value. This is intended to let you dynamically change settings without having to adjust the Settings File.</p>
<p><br></br></p>
<h3 id="applying-environment-settings-on-android">Applying Environment Settings on Android</h3>
<p>On Android, you must use properties to set the environment variables. The format of the properties to set takes the following form:</p>
<pre><code>debug. + (lower-case environment variable with &#39;vk_&#39; stripped)
</code></pre>
<p>The easiest way to set a property is from the ADB shell:</p>
<pre><code>adb shell &quot;setprop &lt;property_name&gt; &#39;&lt;property_value&gt;&#39;&quot;
</code></pre>
<p><strong>For example:</strong></p>
<p>To set force enable, which on desktop uses <code>VK_SYNC2_FORCE_ENABLE</code> set the following property:</p>
<pre><code>debug.vulkan.synchronization2.force_enable
</code></pre>
<p>Which you can set in the following way:</p>
<pre><code>adb shell &quot;setprop debug.vulkan.synchronization2.force_enable true&quot;
</code></pre>
<p><br></br></p>
<h2 id="layer-properties">Layer Properties</h2>
<ul>
<li>API Version: 1.4.328</li>
<li>Implementation Version: 1</li>
<li>Layer Manifest: <code>VkLayer_khronos_synchronization2.json</code>
<ul>
<li>File Format: 1.2.0</li>
<li>Layer Binary: <code>libVkLayer_khronos_synchronization2.so</code></li>
</ul></li>
<li>Variables:
<ul>
<li><code>vk_layer_settings.txt</code> namespace: <code>khronos_synchronization2</code></li>
<li>Environment Variable prefix: <code>VK_KHRONOS_SYNCHRONIZATION2_</code></li>
<li>Android system property prefix: <code>adb setprop debug.vulkan.khronos_synchronization2.</code></li>
</ul></li>
<li>Platforms: <code>WINDOWS_X86</code>, <code>WINDOWS_ARM</code>, <code>LINUX</code>, <code>MACOS</code>, <code>ANDROID</code></li>
<li>Number of Layer Settings: 1</li>
<li>Number of Layer Presets: 1</li>
</ul>
<h2 id="layer-settings-overview">Layer Settings Overview</h2>
<table>
<thead>
<tr class="header">
<th>Label</th>
<th>Variables Key</th>
<th>Type</th>
<th>Default Value</th>
<th>Platforms</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#force-enable">Force Enable</a></td>
<td><code>force_enable</code></td>
<td><code>BOOL</code></td>
<td><code>false</code></td>
<td><code>WINDOWS_X86</code>, <code>WINDOWS_ARM</code>, <code>LINUX</code>, <code>MACOS</code>, <code>ANDROID</code></td>
</tr>
</tbody>
</table>
<h2 id="layer-settings-details">Layer Settings Details</h2>
<h3 id="force-enable">Force Enable</h3>
<p>Force the layer to be active even if the underlying driver also implements the synchonization2 extension.</p>
<ul>
<li>Key: <code>force_enable</code></li>
<li>Type: <code>BOOL</code></li>
<li>Default Value: <code>false</code></li>
<li>Platforms: <code>WINDOWS_X86</code>, <code>WINDOWS_ARM</code>, <code>LINUX</code>, <code>MACOS</code>, <code>ANDROID</code></li>
</ul>
<table>
<thead>
<tr class="header">
<th>Methods:</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>VK_EXT_layer_settings</code>:</td>
<td><pre>VkBool32 data[] = { VK_FALSE };<br>VkLayerSettingEXT setting {<br> "VK_LAYER_KHRONOS_synchronization2", "force_enable", VK_LAYER_SETTING_TYPE_BOOL32_EXT,<br> static_cast&lt;uint32_t&gt;(std::size(data)), data };</pre></td>
</tr>
<tr class="even">
<td><code>vk_layer_settings.txt</code>:</td>
<td><pre>khronos_synchronization2.force_enable = false</pre></td>
</tr>
<tr class="odd">
<td>Environment variables:</td>
<td><pre>export VK_KHRONOS_SYNCHRONIZATION2_FORCE_ENABLE=false<br>export VK_SYNCHRONIZATION2_FORCE_ENABLE=false<br>export VK_FORCE_ENABLE=false<br>export VK_SYNCHRONIZATION2_FORCE_ENABLE=false</pre></td>
</tr>
<tr class="even">
<td>Android system properties:</td>
<td><pre>adb setprop debug.vulkan.khronos_synchronization2.force_enable false<br>adb setprop debug.vulkan.synchronization2.force_enable false<br>adb setprop debug.vulkan.force_enable false</pre></td>
</tr>
</tbody>
</table>
<h2 id="layer-presets">Layer Presets</h2>
<h3 id="default">Default</h3>
<h4 id="preset-setting-values">Preset Setting Values:</h4>
<ul>
<li>Force Enable: false</li>
</ul>
</article>
</body>
</html>
