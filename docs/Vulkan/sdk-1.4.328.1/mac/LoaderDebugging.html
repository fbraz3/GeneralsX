<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="icon" href="images/Vulkan_LogoBug_48px_Nov17.png">
<link rel="stylesheet" href="github-markdown.css">
</head>
<body>
<article class="markdown-body">
<!-- markdownlint-disable MD041 -->

<p><a href="https://www.khronos.org/vulkan/" TARGET="_blank"><img src="https://vulkan.lunarg.com/img/Vulkan_100px_Dec16.png" title="https://www.khronos.org/vulkan/" alt="Khronos Vulkan" /></a></p>
<h1 id="debugging-the-vulkan-desktop-loader-">Debugging The Vulkan Desktop Loader <!-- omit from toc --></h1>
<p><a href="https://creativecommons.org/licenses/by-nd/4.0/" TARGET="_blank"><img src="https://i.creativecommons.org/l/by-nd/4.0/88x31.png" title="Creative Commons License" alt="Creative Commons" /></a></p>
<!-- Copyright &copy; 2015-2023 LunarG, Inc. -->

<h2 id="table-of-contents-">Table of Contents <!-- omit from toc --></h2>
<ul>
<li><a href="#debugging-issues">Debugging Issues</a></li>
<li><a href="#loader-logging">Loader Logging</a></li>
<li><a href="#debugging-possible-layer-issues">Debugging Possible Layer Issues</a>
<ul>
<li><a href="#enable-layer-logging">Enable Layer Logging</a></li>
<li><a href="#disable-layers">Disable Layers</a></li>
<li><a href="#selectively-re-enable-layers">Selectively Re-enable Layers</a></li>
</ul></li>
<li><a href="#allow-specific-layers-to-be-ignored-by-vk_loader_layers_disable">Allow specific layers to be ignored by VK_LOADER_LAYERS_DISABLE</a></li>
<li><a href="#debugging-possible-driver-issues">Debugging Possible Driver Issues</a>
<ul>
<li><a href="#enable-driver-logging">Enable Driver Logging</a></li>
<li><a href="#selectively-enable-specific-drivers">Selectively Enable Specific Drivers</a></li>
</ul></li>
</ul>
<h2 id="debugging-issues">Debugging Issues</h2>
<p>If your application is crashing or behaving weirdly, the loader provides several mechanisms for you to debug the issues.</p>
<p><strong>NOTE</strong>: This functionality is all specific to the desktop Vulkan loader and does not work for the Android loader.</p>
<h2 id="loader-logging">Loader Logging</h2>
<p>The Vulkan desktop loader has added logging functionality that can be enabled by using the <code>VK_LOADER_DEBUG</code> environment variable. The results will be output to the standard output, but will also be passed to any <code>VK_EXT_debug_utils</code> messengers present as well. The variable can be set to a comma-delimited list of debug level options which include:</p>
<ul>
<li>error      Report any errors encountered by the loader</li>
<li>warn      Report any warnings encountered by the loader</li>
<li>info        Report info-level messages generated by the loader</li>
<li>debug    Report debug-level messages generated by the loader</li>
<li>layer      Report all layer-specific messages generated by the loader</li>
<li>driver     Report all driver-specific messages generated by the loader</li>
<li>all          Report all messages generated by the loader (includes all of the above)</li>
</ul>
<p>If you're not sure where the issue comes from, at least set it to output all messages through the "info" level:</p>
<pre><code>set VK_LOADER_DEBUG=error,warn,info
</code></pre>
<p>Then, you can search the list for any errors or warnings that might provide a hint at why you're seeing issues.</p>
<p>For more info on enabling loader logging, refer to the <a href="LoaderApplicationInterface.html#enable-loader-debug-layer-output">Enable Loader Debug Layer Output</a> and the <a href="LoaderInterfaceArchitecture.html#table-of-debug-environment-variables">Table of Debug Environment Variables</a> below.</p>
<h2 id="debugging-possible-layer-issues">Debugging Possible Layer Issues</h2>
<h3 id="enable-layer-logging">Enable Layer Logging</h3>
<p>If you suspect a layer issue, set the loader logging to specifically output layer messages in addition to warnings and errors:</p>
<pre><code>set VK_LOADER_DEBUG=error,warn,layer
</code></pre>
<p>Most important layer messages should go out with error or warning levels set, but this will provide more layer-specific info as well such as:</p>
<ul>
<li>What layers are found</li>
<li>Where they were found</li>
<li>If they are implicit, what environment variables can be used to disable them</li>
<li>If there is any incompatibility with a given layer, this could include:
<ul>
<li>The layer library file (.so/.dll) wasn't found</li>
<li>The layer library is the wrong bit-depth for the executing application (i.e. 32-bit vs 64-bit)</li>
<li>The layer itself doesn't support the application desired version of Vulkan</li>
</ul></li>
<li>If any environment variables are disabling any layers</li>
</ul>
<p>For example, the output of the loader looking for implicit layers may look like the following:</p>
<pre><code>[Vulkan Loader] LAYER: Searching for implicit layer manifest files
[Vulkan Loader] LAYER:  In following locations:
[Vulkan Loader] LAYER:   /home/${USER}/.config/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:   /etc/xdg/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:   /usr/local/etc/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:   /etc/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:   /home/${USER}/.local/share/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:   /home/${USER}/.local/share/flatpak/exports/share/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:   /var/lib/flatpak/exports/share/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:   /usr/local/share/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:   /usr/share/vulkan/implicit_layer.d
[Vulkan Loader] LAYER:  Found the following files:
[Vulkan Loader] LAYER:   /home/${USER}/.local/share/vulkan/implicit_layer.d/renderdoc_capture.json
[Vulkan Loader] LAYER:   /home/${USER}/.local/share/vulkan/implicit_layer.d/steamfossilize_i386.json
[Vulkan Loader] LAYER:   /home/${USER}/.local/share/vulkan/implicit_layer.d/steamfossilize_x86_64.json
[Vulkan Loader] LAYER:   /home/${USER}/.local/share/vulkan/implicit_layer.d/steamoverlay_i386.json
[Vulkan Loader] LAYER:   /home/${USER}/.local/share/vulkan/implicit_layer.d/steamoverlay_x86_64.json
[Vulkan Loader] LAYER:   /usr/share/vulkan/implicit_layer.d/nvidia_layers.json
[Vulkan Loader] LAYER:   /usr/share/vulkan/implicit_layer.d/VkLayer_MESA_device_select.json
</code></pre>
<p>Then, the loading of layer libraries is reported similar to this:</p>
<pre><code>[Vulkan Loader] DEBUG | LAYER : Loading layer library libVkLayer_khronos_validation.so
[Vulkan Loader] INFO | LAYER : Insert instance layer VK_LAYER_KHRONOS_validation (libVkLayer_khronos_validation.so)
[Vulkan Loader] DEBUG | LAYER : Loading layer library libVkLayer_MESA_device_select.so
[Vulkan Loader] INFO | LAYER : Insert instance layer VK_LAYER_MESA_device_select (libVkLayer_MESA_device_select.so)
</code></pre>
<p>Finally, when the Vulkan instance is created, you can see the full instance call-chain from a functional standpoint with output like this:</p>
<pre><code>[Vulkan Loader] LAYER: vkCreateInstance layer callstack setup to:
[Vulkan Loader] LAYER:  &lt;Application&gt;
[Vulkan Loader] LAYER:    ||
[Vulkan Loader] LAYER:  &lt;Loader&gt;
[Vulkan Loader] LAYER:    ||
[Vulkan Loader] LAYER:  VK_LAYER_MESA_device_select
[Vulkan Loader] LAYER:      Type: Implicit
[Vulkan Loader] LAYER:      Enabled By: Implicit Layer
[Vulkan Loader] LAYER:         Disable Env Var:  NODEVICE_SELECT
[Vulkan Loader] LAYER:      Manifest: /usr/share/vulkan/implicit_layer.d/VkLayer_MESA_device_select.json
[Vulkan Loader] LAYER:      Library:  libVkLayer_MESA_device_select.so
[Vulkan Loader] LAYER:    ||
[Vulkan Loader] LAYER:  VK_LAYER_KHRONOS_validation
[Vulkan Loader] LAYER:      Type: Explicit
[Vulkan Loader] LAYER:      Enabled By: By the Application
[Vulkan Loader] LAYER:      Manifest: /usr/share/vulkan/explicit_layer.d/VkLayer_khronos_validation.json
[Vulkan Loader] LAYER:      Library:  libVkLayer_khronos_validation.so
[Vulkan Loader] LAYER:    ||
[Vulkan Loader] LAYER:  &lt;Drivers&gt;
</code></pre>
<p>In this scenario, two layers were used (the same two that were loaded earlier):</p>
<ul>
<li><code>VK_LAYER_MESA_device_select</code></li>
<li><code>VK_LAYER_KHRONOS_validation</code></li>
</ul>
<p>This information now shows us that the <code>VK_LAYER_MESA_device_select</code> is loaded first, followed by <code>VK_LAYER_KHRONOS_validation</code> which will then continue into any available drivers. It also shows that <code>VK_LAYER_MESA_device_select</code> is an implicit layer which implies that it wasn't directly enabled by the application. On the other hand, <code>VK_LAYER_KHRONOS_validation</code> is shown as an explicit layer which indicates that it was likely enabled by the application.</p>
<h3 id="disable-layers">Disable Layers</h3>
<p><strong>NOTE:</strong> This functionality is only available with Loaders built with version 1.3.234 of the Vulkan headers and later.</p>
<p>Sometimes, implicit layers can cause issues with an application. Because of this, the next step is to try to disable one or more of the listed implicit layers. You can use the filtering environment variables (<code>VK_LOADER_LAYERS_ENABLE</code> and <code>VK_LOADER_LAYERS_DISABLE</code>) to selectively enable or disable various layers. If you're not sure what to do, try disabling all implicit layers manually by setting <code>VK_LOADER_LAYERS_DISABLE</code> to <code>~implicit~</code>.</p>
<pre><code>  set VK_LOADER_LAYERS_DISABLE=~implicit~
</code></pre>
<p>This will disable all implicit layers and the loader will report any disabled layers to the logging output when layer logging is enabled in the following way:</p>
<pre><code>[Vulkan Loader] WARNING | LAYER:  Implicit layer &quot;VK_LAYER_MESA_device_select&quot; forced disabled because name matches filter of env var &#39;VK_LOADER_LAYERS_DISABLE&#39;.
[Vulkan Loader] WARNING | LAYER:  Implicit layer &quot;VK_LAYER_AMD_switchable_graphics_64&quot; forced disabled because name matches filter of env var &#39;VK_LOADER_LAYERS_DISABLE&#39;.
[Vulkan Loader] WARNING | LAYER:  Implicit layer &quot;VK_LAYER_Twitch_Overlay&quot; forced disabled because name matches filter of env var &#39;VK_LOADER_LAYERS_DISABLE&#39;.
</code></pre>
<h3 id="selectively-re-enable-layers">Selectively Re-enable Layers</h3>
<p><strong>NOTE:</strong> This functionality is only available with Loaders built with version 1.3.234 of the Vulkan headers and later.</p>
<p>When trying to diagnose problems caused by layers, it is useful to first disable all layers and re-enable each layer individually. If the problem reappears, then it is immediately clear which layer is the source of the issue.</p>
<p>For example, from the above given list of disabled layers, let’s selectively re-enable one:</p>
<pre><code>set VK_LOADER_LAYERS_DISABLE=~implicit~
set VK_LOADER_LAYERS_ENABLE=*AMD*
</code></pre>
<p>This would keep both the "VK_LAYER_MESA_device_select" and "VK_LAYER_Twitch_Overlay" layers disabled, while enabling the "VK_LAYER_AMD_switchable_graphics_64" layer. If everything continues to work, then the evidence seems to suggest the issue is likely not related to the AMD layer. This would lead to enabling one other layer and trying again:</p>
<pre><code>set VK_LOADER_LAYERS_DISABLE=~implicit~
set VK_LOADER_LAYERS_ENABLE=*AMD*,*twitch*
</code></pre>
<p>And so forth.</p>
<p>For more info on how to use the filtering environment variables, refer to the <a href="LoaderLayerInterface.html#layer-filtering">Layer Filtering</a> section of the <a href="LoaderLayerInterface.html">LoaderLayerInterface</a> document.</p>
<h2 id="allow-specific-layers-to-be-ignored-by-vk_loader_layers_disable">Allow specific layers to be ignored by VK_LOADER_LAYERS_DISABLE</h2>
<p><strong>NOTE:</strong> VK_LOADER_LAYERS_DISABLE is only available with Loaders built with version 1.3.262 of the Vulkan headers and later.</p>
<p>When using <code>VK_LOADER_LAYERS_DISABLE</code> to disable implicit layers, it is possible to allow specific layers to be enabled using <code>VK_LOADER_LAYERS_ENABLE</code>. However, this has the effect of <em>forcing</em> layers to be enabled, which is not always desired. Implicit layers have the ability to only be enabled when a layer specified environment variable is set, allow for context dependent enablement. <code>VK_LOADER_LAYERS_ENABLE</code> ignores that context.</p>
<p>Thus, a different environment variable is needed: <code>VK_LOADER_LAYERS_ALLOW</code></p>
<p>The behavior of <code>VK_LOADER_LAYERS_ALLOW</code> is similar to <code>VK_LOADER_LAYERS_ENABLE</code> except that it does not force a layer to be enabled. The way to think about this environment variable is that every layer matching <code>VK_LOADER_LAYERS_ALLOW</code> is excluded from being forcibly disabled by <code>VK_LOADER_LAYERS_DISABLE</code>. this allows for implicit layers that are context dependent to be enabled depending on the relevant context instead of force enabling them.</p>
<p>Example: Disable all implicit layers except for any layers that have steam or mesa in their name.</p>
<pre><code>set VK_LOADER_LAYERS_DISABLE=~implicit~
set VK_LOADER_LAYERS_ALLOW=*steam*,*Mesa*
</code></pre>
<h2 id="debugging-possible-driver-issues">Debugging Possible Driver Issues</h2>
<h3 id="enable-driver-logging">Enable Driver Logging</h3>
<p><strong>NOTE:</strong> This functionality is only available with Loaders built with version 1.3.234 of the Vulkan headers and later.</p>
<p>If you suspect a driver issue, set the loader logging to specifically output driver messages:</p>
<pre><code>set VK_LOADER_DEBUG=error,warn,driver
</code></pre>
<p>Most important driver messages should go out with error or warning levels set, but this will provide more driver-specific info as well such as:</p>
<ul>
<li>What drivers are found</li>
<li>Where they were found</li>
<li>If there is any incompatibility with a given driver</li>
<li>If any environment variables are disabling any of the drivers</li>
</ul>
<p>For example, the output of the loader looking for drivers on a Linux system may look like the following (NOTE: additional spaces have been removed from the output for easier reading):</p>
<pre><code>[Vulkan Loader] DRIVER: Searching for driver manifest files
[Vulkan Loader] DRIVER:    In following folders:
[Vulkan Loader] DRIVER:       /home/$(USER)/.config/vulkan/icd.d
[Vulkan Loader] DRIVER:       /etc/xdg/vulkan/icd.d
[Vulkan Loader] DRIVER:       /etc/vulkan/icd.d
[Vulkan Loader] DRIVER:       /home/$(USER)/.local/share/vulkan/icd.d
[Vulkan Loader] DRIVER:       /home/$(USER)/.local/share/flatpak/exports/share/vulkan/icd.d
[Vulkan Loader] DRIVER:       /var/lib/flatpak/exports/share/vulkan/icd.d
[Vulkan Loader] DRIVER:       /usr/local/share/vulkan/icd.d
[Vulkan Loader] DRIVER:       /usr/share/vulkan/icd.d
[Vulkan Loader] DRIVER:    Found the following files:
[Vulkan Loader] DRIVER:       /usr/share/vulkan/icd.d/intel_icd.x86_64.json
[Vulkan Loader] DRIVER:       /usr/share/vulkan/icd.d/lvp_icd.x86_64.json
[Vulkan Loader] DRIVER:       /usr/share/vulkan/icd.d/radeon_icd.x86_64.json
[Vulkan Loader] DRIVER:       /usr/share/vulkan/icd.d/lvp_icd.i686.json
[Vulkan Loader] DRIVER:       /usr/share/vulkan/icd.d/radeon_icd.i686.json
[Vulkan Loader] DRIVER:       /usr/share/vulkan/icd.d/intel_icd.i686.json
[Vulkan Loader] DRIVER:       /usr/share/vulkan/icd.d/nvidia_icd.json
[Vulkan Loader] DRIVER: Found ICD manifest file /usr/share/vulkan/icd.d/intel_icd.x86_64.json, version &quot;1.0.0&quot;
[Vulkan Loader] DRIVER: Found ICD manifest file /usr/share/vulkan/icd.d/lvp_icd.x86_64.json, version &quot;1.0.0&quot;
[Vulkan Loader] DRIVER: Found ICD manifest file /usr/share/vulkan/icd.d/radeon_icd.x86_64.json, version &quot;1.0.0&quot;
[Vulkan Loader] DRIVER: Found ICD manifest file /usr/share/vulkan/icd.d/lvp_icd.i686.json, version &quot;1.0.0&quot;
[Vulkan Loader] DRIVER: Requested driver /usr/lib/libvulkan_lvp.so was wrong bit-type. Ignoring this JSON
[Vulkan Loader] DRIVER: Found ICD manifest file /usr/share/vulkan/icd.d/radeon_icd.i686.json, version &quot;1.0.0&quot;
[Vulkan Loader] DRIVER: Requested driver /usr/lib/libvulkan_radeon.so was wrong bit-type. Ignoring this JSON
[Vulkan Loader] DRIVER: Found ICD manifest file /usr/share/vulkan/icd.d/intel_icd.i686.json, version &quot;1.0.0&quot;
[Vulkan Loader] DRIVER: Requested driver /usr/lib/libvulkan_intel.so was wrong bit-type. Ignoring this JSON
[Vulkan Loader] DRIVER: Found ICD manifest file /usr/share/vulkan/icd.d/nvidia_icd.json, version &quot;1.0.0&quot;
</code></pre>
<p>Then when the application selects the device to use, you will see the Vulkan device call chain reported in the following way (NOTE: additional spaces have been removed from the output for easier reading):</p>
<pre><code>[Vulkan Loader] DRIVER: vkCreateDevice layer callstack setup to:
[Vulkan Loader] DRIVER:    &lt;Application&gt;
[Vulkan Loader] DRIVER:      ||
[Vulkan Loader] DRIVER:    &lt;Loader&gt;
[Vulkan Loader] DRIVER:      ||
[Vulkan Loader] DRIVER:    &lt;Device&gt;
[Vulkan Loader] DRIVER:        Using &quot;Intel(R) UHD Graphics 630 (CFL GT2)&quot; with driver: &quot;/usr/lib64/libvulkan_intel.so&quot;
</code></pre>
<h3 id="selectively-enable-specific-drivers">Selectively Enable Specific Drivers</h3>
<p><strong>NOTE:</strong> This functionality is only available with Loaders built with version 1.3.234 of the Vulkan headers and later.</p>
<p>You can now use the filtering environment variables (<code>VK_LOADER_DRIVERS_SELECT</code> and <code>VK_LOADER_DRIVERS_DISABLE</code>) to control what drivers the loader will attempt to load. For drivers, the string globs passed into the above environment variables will be compared against the driver JSON file name since there is no driver name known to the loader until much later in the Vulkan initialization process.</p>
<p>For example, to disable all drivers except Nvidia you could do the following:</p>
<pre><code>set VK_LOADER_DRIVERS_DISABLE=*
set VK_LOADER_DRIVERS_SELECT=*nvidia*
</code></pre>
<p>The loader outputs messages like the following when the environment variables are used:</p>
<pre><code>[Vulkan Loader] WARNING | DRIVER: Driver &quot;intel_icd.x86_64.json&quot; ignored because not selected by env var &#39;VK_LOADER_DRIVERS_SELECT&#39;
[Vulkan Loader] WARNING | DRIVER: Driver &quot;radeon_icd.x86_64.json&quot; ignored because it was disabled by env var &#39;VK_LOADER_DRIVERS_DISABLE&#39;
</code></pre>
<p>For more info on how to use the filtering environment variables, refer to the <a href="LoaderDriverInterface.html#driver-filtering">Driver Filtering</a> section of the <a href="LoaderDriverInterface.html">LoaderDriverInterface</a> document.</p>
</article>
</body>
</html>
