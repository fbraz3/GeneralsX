<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="icon" href="images/Vulkan_LogoBug_48px_Nov17.png">
<link rel="stylesheet" href="github-markdown.css">
</head>
<body>
<article class="markdown-body">
<h1 id="error-message-overview">Error Message Overview</h1>
<blockquote>
<p>Note: This is written for the 1.4.309 SDK and afterwards, the older versions of the Validation Layers will be slightly different</p>
</blockquote>
<p>When an error message is found, the Validation Layers use the "debug callback" mechanism (<code>PFN_vkDebugUtilsMessengerCallbackEXT</code>) to report the error message.</p>
<p>There are 2 options</p>
<ol>
<li>Use the default callback (provided by the validation layers)</li>
<li>Use a custom callback (more details below)</li>
</ol>
<p>By default, the Validation Layers will format the <code>VkDebugUtilsMessengerCallbackDataEXT</code> struct for you and print to the following to the OS-dependent standard output (<code>stdout</code>, <code>logcat</code>, <code>OutputDebugString</code>, etc):</p>
<blockquote>
<p>Validation Error: [ VUID-vkCmdSetScissor-firstScissor-00593 ] | MessageID = 0x603fac6b</p>
<p>vkCmdSetScissor(): firstScissor is 1 but the multiViewport feature was not enabled.</p>
<p>The Vulkan spec states: If the multiViewport feature is not enabled, firstScissor must be 0 (<a href="https://docs.vulkan.org/spec/latest/chapters/fragops.html#VUID-vkCmdSetScissor-firstScissor-00593" TARGET="_blank">https://docs.vulkan.org/spec/latest/chapters/fragops.html#VUID-vkCmdSetScissor-firstScissor-00593</a>)</p>
<p>Objects: 1 [0] VkCommandBuffer 0x5c11921d2d10</p>
<p>(new line)</p>
</blockquote>
<p>Here we see a few things, listed in the order they appear</p>
<ol>
<li>The message severity (error, warning, etc)</li>
<li>The <a href="https://github.com/KhronosGroup/Vulkan-Guide/blob/main/chapters/validation_overview.adoc#valid-usage-id-vuid" TARGET="_blank">VUID</a></li>
<li>Message ID
<ul>
<li>This is just a hash of the VUID used internally to detect if the message duplication rate was hit</li>
</ul></li>
<li>Which function the error occured at</li>
<li>The faulty parameter / struct member
<ul>
<li>Helps if there is an array to know which index it is in</li>
</ul></li>
<li>The "main message"
<ul>
<li>This is normally hand written by the Validation Layer developer</li>
</ul></li>
<li>The Vulkan spec langague for this VUID</li>
<li>Link to the VUID</li>
<li>List of Objects
<ul>
<li>Contain handle type, hex value, and optional debug util name</li>
</ul></li>
<li>There is a new line under to allow for easy seperation of multiple error messages</li>
</ol>
<h1 id="custom-callback">Custom Callback</h1>
<p>For those who want to handle the callback to format the message the way they want, here is how the <code>VkDebugUtilsMessengerCallbackDataEXT</code> is laid out</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb1-1" title="1"><span class="co">// VkDebugUtilsMessengerCallbackDataEXT</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="at">const</span> <span class="dt">char</span>*                           pMessageIdName;  <span class="co">// VUID</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="dt">int32_t</span>                               messageIdNumber; <span class="co">// Hash of the VUID</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="at">const</span> <span class="dt">char</span>*                           pMessage;        <span class="co">// The &quot;main message&quot; (includes the spec text on seperate line)</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">// Debug Objects that Validaiton will print for you in a default callback</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="dt">uint32_t</span>                              queueLabelCount;</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="at">const</span> VkDebugUtilsLabelEXT*           pQueueLabels;</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="dt">uint32_t</span>                              cmdBufLabelCount;</a>
<a class="sourceLine" id="cb1-10" title="10"><span class="at">const</span> VkDebugUtilsLabelEXT*           pCmdBufLabels;</a>
<a class="sourceLine" id="cb1-11" title="11"><span class="dt">uint32_t</span>                              objectCount;</a>
<a class="sourceLine" id="cb1-12" title="12"><span class="at">const</span> VkDebugUtilsObjectNameInfoEXT*  pObjects;</a></code></pre></div>
<p>The following is an example of how one could do their custom callback</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c++"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1">VkBool32 DebugCallback(VkDebugUtilsMessageSeverityFlagBitsEXT message_severity,</a>
<a class="sourceLine" id="cb2-2" title="2">                       VkDebugUtilsMessageTypeFlagsEXT <span class="dt">message_type</span>,</a>
<a class="sourceLine" id="cb2-3" title="3">                       <span class="at">const</span> VkDebugUtilsMessengerCallbackDataEXT *callback_data) {</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="co">// Other layers might also be trying to report via the callback, so can filter using the type</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="dt">bool</span> is_validation = messageType &amp; VK_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXT;</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="co">// Only report Errors and Warnings</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="dt">bool</span> is_error = messageSeverity &amp; VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT;</a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="dt">bool</span> is_warning = messageSeverity &amp; VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT;</a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="cf">if</span> (is_error || is_warning) {</a>
<a class="sourceLine" id="cb2-12" title="12">        <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;Validation &quot;</span> &lt;&lt; (is_error ? <span class="st">&quot;Error:&quot;</span> : <span class="st">&quot;Warning:&quot;</span>);</a>
<a class="sourceLine" id="cb2-13" title="13">        <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot; [ &quot;</span> &lt;&lt; pCallbackData-&gt;pMessageIdName &lt;&lt; <span class="st">&quot; ]</span><span class="sc">\n</span><span class="st">&quot;</span>;</a>
<a class="sourceLine" id="cb2-14" title="14">        <span class="bu">std::</span>cout &lt;&lt; pCallbackData-&gt;pMessage;</a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16">        <span class="cf">for</span> (<span class="dt">uint32_t</span> i = <span class="dv">0</span>; i &lt; pCallbackData-&gt;objectCount; i++) {</a>
<a class="sourceLine" id="cb2-17" title="17">            <span class="bu">std::</span>cout &lt;&lt; <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</a>
<a class="sourceLine" id="cb2-18" title="18">            <span class="cf">if</span> (pCallbackData-&gt;pObjects[i].objectHandle) {</a>
<a class="sourceLine" id="cb2-19" title="19">                <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;    Object Handle [&quot;</span> &lt;&lt; i &lt;&lt; <span class="st">&quot;] = &quot;</span> &lt;&lt; <span class="st">&quot; 0x&quot;</span> &lt;&lt; <span class="bu">std::</span>hex &lt;&lt; pCallbackData-&gt;pObjects[i].objectHandle;</a>
<a class="sourceLine" id="cb2-20" title="20">            }</a>
<a class="sourceLine" id="cb2-21" title="21">            <span class="cf">if</span> (pCallbackData-&gt;pObjects[i].pObjectName) {</a>
<a class="sourceLine" id="cb2-22" title="22">                <span class="bu">std::</span>cout &lt;&lt; <span class="st">&quot;[&quot;</span> &lt;&lt; pCallbackData-&gt;pObjects[i].pObjectName &lt;&lt; <span class="st">&quot;]&quot;</span>;</a>
<a class="sourceLine" id="cb2-23" title="23">            }</a>
<a class="sourceLine" id="cb2-24" title="24">        }</a>
<a class="sourceLine" id="cb2-25" title="25">    }</a>
<a class="sourceLine" id="cb2-26" title="26">    <span class="bu">std::</span>cout &lt;&lt; <span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span>;</a>
<a class="sourceLine" id="cb2-27" title="27"></a>
<a class="sourceLine" id="cb2-28" title="28">    <span class="co">// Return false to move on and still call the function to the driver</span></a>
<a class="sourceLine" id="cb2-29" title="29">    <span class="cf">return</span> VK_FALSE;</a>
<a class="sourceLine" id="cb2-30" title="30">    <span class="co">// Return true to have validation skip passing down the call to the driver</span></a>
<a class="sourceLine" id="cb2-31" title="31">    <span class="cf">return</span> VK_TRUE;</a>
<a class="sourceLine" id="cb2-32" title="32">};</a></code></pre></div>
<h1 id="json-error-format">JSON Error Format</h1>
<p>For those who want something more machine readable, or don't want to deal with regex parsing, there is an option to output the error in JSON.</p>
<p>The string returned in <code>VkDebugUtilsMessengerCallbackDataEXT::pMessage</code> will be a valid JSON object.</p>
<p>The JSON schema:</p>
<blockquote>
<p>All fields are always printed, an empty string will be given if no value is provided</p>
</blockquote>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="dt">&quot;Severity&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="dt">&quot;VUID&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="dt">&quot;Objects&quot;</span> <span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb3-5" title="5">        <span class="fu">{</span><span class="dt">&quot;type&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span> <span class="dt">&quot;handle&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span> <span class="dt">&quot;name&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb3-6" title="6">        <span class="er">...</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="dt">&quot;MessageID&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="dt">&quot;Function&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="dt">&quot;Location&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="dt">&quot;MainMessage&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span> <span class="er">//</span> <span class="er">Newline</span> <span class="er">&#39;\n&#39;</span> <span class="er">will</span> <span class="er">be</span> <span class="er">inlined</span> <span class="er">here</span></a>
<a class="sourceLine" id="cb3-12" title="12">    <span class="dt">&quot;DebugRegion&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="dt">&quot;SpecText&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-14" title="14">    <span class="dt">&quot;SpecUrl&quot;</span> <span class="fu">:</span> <span class="st">&quot;string&quot;</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="fu">}</span></a></code></pre></div>
<p>Here is an example of what it looks like</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb4-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="dt">&quot;Severity&quot;</span> <span class="fu">:</span> <span class="st">&quot;Error&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="dt">&quot;VUID&quot;</span> <span class="fu">:</span> <span class="st">&quot;VUID-vkCmdSetScissor-x-00595&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="dt">&quot;Objects&quot;</span> <span class="fu">:</span> <span class="ot">[</span></a>
<a class="sourceLine" id="cb4-5" title="5">        <span class="fu">{</span><span class="dt">&quot;type&quot;</span> <span class="fu">:</span> <span class="st">&quot;VkCommandBuffer&quot;</span><span class="fu">,</span> <span class="dt">&quot;handle&quot;</span> <span class="fu">:</span> <span class="st">&quot;0x618497491590&quot;</span><span class="fu">,</span> <span class="dt">&quot;name&quot;</span> <span class="fu">:</span> <span class="st">&quot;command_buffer_name&quot;</span><span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">&quot;MessageID&quot;</span> <span class="fu">:</span> <span class="st">&quot;0xa54a6ff8&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="dt">&quot;Function&quot;</span> <span class="fu">:</span> <span class="st">&quot;vkCmdSetScissor&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="dt">&quot;Location&quot;</span> <span class="fu">:</span> <span class="st">&quot;pScissors[0].offset.x&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="dt">&quot;MainMessage&quot;</span> <span class="fu">:</span> <span class="st">&quot;(-1) is negative.&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="dt">&quot;DebugRegion&quot;</span> <span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="dt">&quot;SpecText&quot;</span> <span class="fu">:</span> <span class="st">&quot;The x and y members of offset member of any element of pScissors must be greater than or equal to 0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="dt">&quot;SpecUrl&quot;</span> <span class="fu">:</span> <span class="st">&quot;https://docs.vulkan.org/spec/latest/chapters/fragops.html#VUID-vkCmdSetScissor-x-00595&quot;</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="fu">}</span></a></code></pre></div>
<blockquote>
<p>On Android, we will print it all in a single line to work better with <code>logcat</code>.</p>
</blockquote>
<p>To try it out, use <code>vkconfig</code> or set with</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Windows</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">set</span> <span class="va">VK_LAYER_MESSAGE_FORMAT_JSON=</span>1</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co"># Linux</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="bu">export</span> <span class="va">VK_LAYER_MESSAGE_FORMAT_JSON=</span>1</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co"># Android</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="ex">adb</span> setprop debug.vulkan.khronos_validation.message_format_json=1</a></code></pre></div>
<h1 id="logging-to-a-file">Logging to a file</h1>
<p>By default the validation layers will try to print the error message out to <code>OutputDebugString</code> on Windows, <code>logcat</code> on Android, and <code>stdout</code> for Linux/MacOS.</p>
<p>You have the option to have the files write out to a file as well.</p>
<p>To try it out, use <code>vkconfig</code> or set with</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># Windows</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">set</span> <span class="va">VK_LAYER_DEBUG_ACTION=</span>VK_DBG_LAYER_ACTION_LOG_MSG</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">set</span> <span class="va">VK_LAYER_LOG_FILENAME=</span>C:\<span class="ex">vvl_errors.txt</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co"># Linux</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="bu">export</span> <span class="va">VK_LAYER_DEBUG_ACTION=</span>VK_DBG_LAYER_ACTION_LOG_MSG</a>
<a class="sourceLine" id="cb6-7" title="7"><span class="bu">export</span> <span class="va">VK_LAYER_LOG_FILENAME=</span>/tmp/vvl_errors.txt</a>
<a class="sourceLine" id="cb6-8" title="8"></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co"># Android</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="ex">adb</span> setprop debug.vulkan.khronos_validation.debug_action=VK_DBG_LAYER_ACTION_LOG_MSG</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="ex">adb</span> setprop debug.vulkan.khronos_validation.log_filename=/data/local/tmp/vvl_errors.txt</a></code></pre></div>
<h1 id="additional-information">Additional information</h1>
<p>Synchronization validation detects memory hazards and has custom error conventions. Additional information about SyncVal errors can be found in the <a href="./syncval_usage.html#synchronization-validation-messages">Synchronization Validation Messages</a> document.</p>
</article>
</body>
</html>
